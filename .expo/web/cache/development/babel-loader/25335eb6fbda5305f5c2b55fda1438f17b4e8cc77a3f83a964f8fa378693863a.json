{"ast":null,"code":"import { supabase } from './supabase';\nimport { sendPaymentConfirmationEmail, sendFeeAssignmentEmail } from './emailService';\nexport const sendPaymentReminder = async params => {\n  try {\n    const {\n      data: fee,\n      error: feeError\n    } = await supabase.from('fees').select(`\n                id,\n                title,\n                amount,\n                due_date,\n                paid_amount,\n                status,\n                students (\n                    id,\n                    name,\n                    user_id\n                ),\n                student_id\n            `).eq('id', params.feeId).single();\n    if (feeError || !fee) {\n      console.error('Error fetching fee:', feeError);\n      return {\n        success: false,\n        error: 'Fee not found'\n      };\n    }\n    if (fee.status === 'paid') {\n      return {\n        success: true\n      };\n    }\n    const studentId = fee.student_id;\n    const {\n      data: parentLinks,\n      error: linksError\n    } = await supabase.from('parent_children').select('parent_id').eq('student_id', studentId);\n    if (linksError || !parentLinks || parentLinks.length === 0) {\n      console.warn('No parents found for student');\n      return {\n        success: true\n      };\n    }\n    const parentIds = parentLinks.map(link => link.parent_id);\n    const {\n      data: parents,\n      error: parentsError\n    } = await supabase.from('profiles').select('id, name, email, phone, notification_preferences').in('id', parentIds).eq('role', 'parent');\n    if (parentsError || !parents || parents.length === 0) {\n      return {\n        success: true\n      };\n    }\n    const balance = fee.amount - (fee.paid_amount || 0);\n    const dueDate = new Date(fee.due_date).toLocaleDateString();\n    for (const parent of parents) {\n      const prefs = parent.notification_preferences || {};\n      if (parent.phone && prefs.sms !== false) {\n        try {\n          const smsMessage = `Payment Reminder: ${fee.title} - ₦${balance.toLocaleString()} due on ${dueDate}. Pay online via the school portal.`;\n          const {\n            data: authData\n          } = await supabase.auth.getSession();\n          if (authData.session) {\n            await supabase.functions.invoke('send-notification', {\n              body: {\n                userId: parent.id,\n                title: 'Payment Reminder',\n                body: smsMessage,\n                urgency: 'high',\n                channel: 'sms'\n              }\n            });\n          }\n        } catch (err) {\n          console.error('Error sending payment reminder SMS:', err);\n        }\n      }\n    }\n    console.log('✅ Payment reminders sent for fee:', fee.id);\n    return {\n      success: true\n    };\n  } catch (err) {\n    console.error('Error in sendPaymentReminder:', err);\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};\nexport const sendPaymentConfirmation = async params => {\n  try {\n    const {\n      data: transaction,\n      error: txError\n    } = await supabase.from('transactions').select(`\n                id,\n                reference,\n                amount,\n                created_at,\n                fee_id,\n                student_id\n            `).eq('id', params.transactionId).single();\n    if (txError || !transaction) {\n      return {\n        success: false,\n        error: 'Transaction not found'\n      };\n    }\n    const {\n      data: fee,\n      error: feeError\n    } = await supabase.from('fees').select('id, title, amount, paid_amount').eq('id', transaction.fee_id).single();\n    if (feeError || !fee) {\n      return {\n        success: false,\n        error: 'Fee not found'\n      };\n    }\n    const {\n      data: student,\n      error: studentError\n    } = await supabase.from('students').select('id, name').eq('id', transaction.student_id).single();\n    if (studentError || !student) {\n      return {\n        success: false,\n        error: 'Student not found'\n      };\n    }\n    const {\n      data: parentLinks\n    } = await supabase.from('parent_children').select('parent_id').eq('student_id', student.id);\n    if (!parentLinks || parentLinks.length === 0) {\n      return {\n        success: true\n      };\n    }\n    const parentIds = parentLinks.map(link => link.parent_id);\n    const {\n      data: parents\n    } = await supabase.from('profiles').select('id, name, email, notification_preferences').in('id', parentIds).eq('role', 'parent');\n    if (!parents || parents.length === 0) {\n      return {\n        success: true\n      };\n    }\n    const balance = fee.amount - (fee.paid_amount || 0);\n    for (const parent of parents) {\n      const prefs = parent.notification_preferences || {};\n      if (parent.email && prefs.email !== false) {\n        try {\n          await sendPaymentConfirmationEmail({\n            toEmail: parent.email,\n            parentName: parent.name || 'Parent',\n            studentName: student.name,\n            feeTitle: fee.title,\n            amountPaid: transaction.amount,\n            transactionReference: transaction.reference,\n            paymentDate: new Date(transaction.created_at).toLocaleDateString(),\n            balance: balance\n          });\n        } catch (err) {\n          console.error('Error sending payment confirmation email:', err);\n        }\n      }\n    }\n    console.log('✅ Payment confirmation sent for transaction:', transaction.id);\n    return {\n      success: true\n    };\n  } catch (err) {\n    console.error('Error in sendPaymentConfirmation:', err);\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};\nexport const sendFeeAssignmentNotification = async feeId => {\n  try {\n    const {\n      data: fee,\n      error: feeError\n    } = await supabase.from('fees').select(`\n                id,\n                title,\n                amount,\n                due_date,\n                description,\n                student_id\n            `).eq('id', feeId).single();\n    if (feeError || !fee) {\n      return {\n        success: false,\n        error: 'Fee not found'\n      };\n    }\n    const {\n      data: student\n    } = await supabase.from('students').select('id, name').eq('id', fee.student_id).single();\n    if (!student) {\n      return {\n        success: false,\n        error: 'Student not found'\n      };\n    }\n    const {\n      data: parentLinks\n    } = await supabase.from('parent_children').select('parent_id').eq('student_id', student.id);\n    if (!parentLinks || parentLinks.length === 0) {\n      return {\n        success: true\n      };\n    }\n    const parentIds = parentLinks.map(link => link.parent_id);\n    const {\n      data: parents\n    } = await supabase.from('profiles').select('id, name, email, notification_preferences').in('id', parentIds).eq('role', 'parent');\n    if (!parents || parents.length === 0) {\n      return {\n        success: true\n      };\n    }\n    for (const parent of parents) {\n      const prefs = parent.notification_preferences || {};\n      if (parent.email && prefs.email !== false) {\n        try {\n          await sendFeeAssignmentEmail({\n            toEmail: parent.email,\n            parentName: parent.name || 'Parent',\n            studentName: student.name,\n            feeTitle: fee.title,\n            amount: fee.amount,\n            dueDate: new Date(fee.due_date).toLocaleDateString(),\n            description: fee.description\n          });\n        } catch (err) {\n          console.error('Error sending fee assignment email:', err);\n        }\n      }\n    }\n    console.log('✅ Fee assignment notification sent for fee:', fee.id);\n    return {\n      success: true\n    };\n  } catch (err) {\n    console.error('Error in sendFeeAssignmentNotification:', err);\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};","map":{"version":3,"names":["supabase","sendPaymentConfirmationEmail","sendFeeAssignmentEmail","sendPaymentReminder","params","data","fee","error","feeError","from","select","eq","feeId","single","console","success","status","studentId","student_id","parentLinks","linksError","length","warn","parentIds","map","link","parent_id","parents","parentsError","in","balance","amount","paid_amount","dueDate","Date","due_date","toLocaleDateString","parent","prefs","notification_preferences","phone","sms","smsMessage","title","toLocaleString","authData","auth","getSession","session","functions","invoke","body","userId","id","urgency","channel","err","log","message","sendPaymentConfirmation","transaction","txError","transactionId","fee_id","student","studentError","email","toEmail","parentName","name","studentName","feeTitle","amountPaid","transactionReference","reference","paymentDate","created_at","sendFeeAssignmentNotification","description"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/payment-notifications.ts"],"sourcesContent":["/**\r\n * Payment Notifications\r\n * Handles payment reminders and confirmations\r\n */\r\n\r\nimport { supabase } from './supabase';\r\nimport { sendPaymentConfirmationEmail, sendFeeAssignmentEmail } from './emailService';\r\n\r\ninterface PaymentReminderParams {\r\n    feeId: number;\r\n    daysBeforeDue: number;\r\n}\r\n\r\ninterface PaymentConfirmationParams {\r\n    transactionId: number;\r\n}\r\n\r\n/**\r\n * Send payment reminder SMS to parent when fee is due soon\r\n */\r\nexport const sendPaymentReminder = async (params: PaymentReminderParams): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n        // Get fee details\r\n        const { data: fee, error: feeError } = await supabase\r\n            .from('fees')\r\n            .select(`\r\n                id,\r\n                title,\r\n                amount,\r\n                due_date,\r\n                paid_amount,\r\n                status,\r\n                students (\r\n                    id,\r\n                    name,\r\n                    user_id\r\n                ),\r\n                student_id\r\n            `)\r\n            .eq('id', params.feeId)\r\n            .single();\r\n\r\n        if (feeError || !fee) {\r\n            console.error('Error fetching fee:', feeError);\r\n            return { success: false, error: 'Fee not found' };\r\n        }\r\n\r\n        // Skip if already paid\r\n        if (fee.status === 'paid') {\r\n            return { success: true };\r\n        }\r\n\r\n        const studentId = fee.student_id;\r\n\r\n        // Get parent(s)\r\n        const { data: parentLinks, error: linksError } = await supabase\r\n            .from('parent_children')\r\n            .select('parent_id')\r\n            .eq('student_id', studentId);\r\n\r\n        if (linksError || !parentLinks || parentLinks.length === 0) {\r\n            console.warn('No parents found for student');\r\n            return { success: true };\r\n        }\r\n\r\n        const parentIds = parentLinks.map((link: any) => link.parent_id);\r\n\r\n        const { data: parents, error: parentsError } = await supabase\r\n            .from('profiles')\r\n            .select('id, name, email, phone, notification_preferences')\r\n            .in('id', parentIds)\r\n            .eq('role', 'parent');\r\n\r\n        if (parentsError || !parents || parents.length === 0) {\r\n            return { success: true };\r\n        }\r\n\r\n        const balance = fee.amount - (fee.paid_amount || 0);\r\n        const dueDate = new Date(fee.due_date).toLocaleDateString();\r\n\r\n        // Send reminders to parents\r\n        for (const parent of parents) {\r\n            const prefs = parent.notification_preferences || {};\r\n\r\n            // Send SMS reminder (high priority)\r\n            if (parent.phone && prefs.sms !== false) {\r\n                try {\r\n                    const smsMessage = `Payment Reminder: ${fee.title} - ₦${balance.toLocaleString()} due on ${dueDate}. Pay online via the school portal.`;\r\n\r\n                    const { data: authData } = await supabase.auth.getSession();\r\n                    if (authData.session) {\r\n                        await supabase.functions.invoke('send-notification', {\r\n                            body: {\r\n                                userId: parent.id,\r\n                                title: 'Payment Reminder',\r\n                                body: smsMessage,\r\n                                urgency: 'high',\r\n                                channel: 'sms'\r\n                            }\r\n                        });\r\n                    }\r\n                } catch (err) {\r\n                    console.error('Error sending payment reminder SMS:', err);\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log('✅ Payment reminders sent for fee:', fee.id);\r\n        return { success: true };\r\n    } catch (err: any) {\r\n        console.error('Error in sendPaymentReminder:', err);\r\n        return { success: false, error: err.message };\r\n    }\r\n};\r\n\r\n/**\r\n * Send payment confirmation after successful payment\r\n */\r\nexport const sendPaymentConfirmation = async (params: PaymentConfirmationParams): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n        // Get transaction details\r\n        const { data: transaction, error: txError } = await supabase\r\n            .from('transactions')\r\n            .select(`\r\n                id,\r\n                reference,\r\n                amount,\r\n                created_at,\r\n                fee_id,\r\n                student_id\r\n            `)\r\n            .eq('id', params.transactionId)\r\n            .single();\r\n\r\n        if (txError || !transaction) {\r\n            return { success: false, error: 'Transaction not found' };\r\n        }\r\n\r\n        // Get fee details\r\n        const { data: fee, error: feeError } = await supabase\r\n            .from('fees')\r\n            .select('id, title, amount, paid_amount')\r\n            .eq('id', transaction.fee_id)\r\n            .single();\r\n\r\n        if (feeError || !fee) {\r\n            return { success: false, error: 'Fee not found' };\r\n        }\r\n\r\n        // Get student details\r\n        const { data: student, error: studentError } = await supabase\r\n            .from('students')\r\n            .select('id, name')\r\n            .eq('id', transaction.student_id)\r\n            .single();\r\n\r\n        if (studentError || !student) {\r\n            return { success: false, error: 'Student not found' };\r\n        }\r\n\r\n        // Get parent(s)\r\n        const { data: parentLinks } = await supabase\r\n            .from('parent_children')\r\n            .select('parent_id')\r\n            .eq('student_id', student.id);\r\n\r\n        if (!parentLinks || parentLinks.length === 0) {\r\n            return { success: true };\r\n        }\r\n\r\n        const parentIds = parentLinks.map((link: any) => link.parent_id);\r\n\r\n        const { data: parents } = await supabase\r\n            .from('profiles')\r\n            .select('id, name, email, notification_preferences')\r\n            .in('id', parentIds)\r\n            .eq('role', 'parent');\r\n\r\n        if (!parents || parents.length === 0) {\r\n            return { success: true };\r\n        }\r\n\r\n        const balance = fee.amount - (fee.paid_amount || 0);\r\n\r\n        // Send confirmation emails\r\n        for (const parent of parents) {\r\n            const prefs = parent.notification_preferences || {};\r\n\r\n            if (parent.email && prefs.email !== false) {\r\n                try {\r\n                    await sendPaymentConfirmationEmail({\r\n                        toEmail: parent.email,\r\n                        parentName: parent.name || 'Parent',\r\n                        studentName: student.name,\r\n                        feeTitle: fee.title,\r\n                        amountPaid: transaction.amount,\r\n                        transactionReference: transaction.reference,\r\n                        paymentDate: new Date(transaction.created_at).toLocaleDateString(),\r\n                        balance: balance\r\n                    });\r\n                } catch (err) {\r\n                    console.error('Error sending payment confirmation email:', err);\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log('✅ Payment confirmation sent for transaction:', transaction.id);\r\n        return { success: true };\r\n    } catch (err: any) {\r\n        console.error('Error in sendPaymentConfirmation:', err);\r\n        return { success: false, error: err.message };\r\n    }\r\n};\r\n\r\n/**\r\n * Send fee assignment notification to parent\r\n */\r\nexport const sendFeeAssignmentNotification = async (feeId: number): Promise<{ success: boolean; error?: string }> => {\r\n    try {\r\n        // Get fee details\r\n        const { data: fee, error: feeError } = await supabase\r\n            .from('fees')\r\n            .select(`\r\n                id,\r\n                title,\r\n                amount,\r\n                due_date,\r\n                description,\r\n                student_id\r\n            `)\r\n            .eq('id', feeId)\r\n            .single();\r\n\r\n        if (feeError || !fee) {\r\n            return { success: false, error: 'Fee not found' };\r\n        }\r\n\r\n        // Get student\r\n        const { data: student } = await supabase\r\n            .from('students')\r\n            .select('id, name')\r\n            .eq('id', fee.student_id)\r\n            .single();\r\n\r\n        if (!student) {\r\n            return { success: false, error: 'Student not found' };\r\n        }\r\n\r\n        // Get parents\r\n        const { data: parentLinks } = await supabase\r\n            .from('parent_children')\r\n            .select('parent_id')\r\n            .eq('student_id', student.id);\r\n\r\n        if (!parentLinks || parentLinks.length === 0) {\r\n            return { success: true };\r\n        }\r\n\r\n        const parentIds = parentLinks.map((link: any) => link.parent_id);\r\n\r\n        const { data: parents } = await supabase\r\n            .from('profiles')\r\n            .select('id, name, email, notification_preferences')\r\n            .in('id', parentIds)\r\n            .eq('role', 'parent');\r\n\r\n        if (!parents || parents.length === 0) {\r\n            return { success: true };\r\n        }\r\n\r\n        // Send notifications\r\n        for (const parent of parents) {\r\n            const prefs = parent.notification_preferences || {};\r\n\r\n            if (parent.email && prefs.email !== false) {\r\n                try {\r\n                    await sendFeeAssignmentEmail({\r\n                        toEmail: parent.email,\r\n                        parentName: parent.name || 'Parent',\r\n                        studentName: student.name,\r\n                        feeTitle: fee.title,\r\n                        amount: fee.amount,\r\n                        dueDate: new Date(fee.due_date).toLocaleDateString(),\r\n                        description: fee.description\r\n                    });\r\n                } catch (err) {\r\n                    console.error('Error sending fee assignment email:', err);\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log('✅ Fee assignment notification sent for fee:', fee.id);\r\n        return { success: true };\r\n    } catch (err: any) {\r\n        console.error('Error in sendFeeAssignmentNotification:', err);\r\n        return { success: false, error: err.message };\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}