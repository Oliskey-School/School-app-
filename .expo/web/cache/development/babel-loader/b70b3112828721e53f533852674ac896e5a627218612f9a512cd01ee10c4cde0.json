{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\admin\\\\AddParentScreen.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon, StudentsIcon } from '../../constants';\nimport { toast } from 'react-hot-toast';\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\nimport { createUserAccount } from '../../lib/auth';\nimport CredentialsModal from '../ui/CredentialsModal';\nimport { mockParents } from '../../data';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AddParentScreen = ({\n  parentToEdit,\n  forceUpdate,\n  handleBack\n}) => {\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [phone, setPhone] = useState('');\n  const [childIds, setChildIds] = useState('');\n  const [avatar, setAvatar] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showCredentialsModal, setShowCredentialsModal] = useState(false);\n  const [credentials, setCredentials] = useState(null);\n  useEffect(() => {\n    const loadParentData = async () => {\n      if (parentToEdit) {\n        setName(parentToEdit.name);\n        setEmail(parentToEdit.email);\n        setPhone(parentToEdit.phone);\n        setAvatar(parentToEdit.avatarUrl);\n        if (isSupabaseConfigured) {\n          try {\n            const {\n              data: links\n            } = await supabase.from('parent_children').select('student_id').eq('parent_id', parentToEdit.id);\n            if (links && links.length > 0) {\n              setChildIds(links.map(l => l.student_id).join(', '));\n            } else {\n              setChildIds((parentToEdit.childIds || []).join(', '));\n            }\n          } catch (err) {\n            console.error(\"Error loading child links:\", err);\n            setChildIds((parentToEdit.childIds || []).join(', '));\n          }\n        } else {\n          setChildIds((parentToEdit.childIds || []).join(', '));\n        }\n      }\n    };\n    loadParentData();\n  }, [parentToEdit]);\n  const handleImageChange = event => {\n    if (event.target.files && event.target.files[0]) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setAvatar(reader.result);\n      };\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      const avatarUrl = avatar || `https://i.pravatar.cc/150?u=${name.replace(' ', '')}`;\n      const childIdArray = childIds.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));\n      if (!isSupabaseConfigured) {\n        if (parentToEdit) {\n          const index = mockParents.findIndex(p => p.id === parentToEdit.id);\n          if (index !== -1) {\n            mockParents[index] = Object.assign({}, mockParents[index], {\n              name,\n              email,\n              phone,\n              avatarUrl,\n              childIds: childIdArray\n            });\n          }\n          toast.success('Parent updated successfully (Mock Mode - Session Only)');\n        } else {\n          const newId = mockParents.length > 0 ? Math.max(...mockParents.map(p => p.id)) + 1 : 1;\n          mockParents.push({\n            id: newId,\n            name,\n            email,\n            phone,\n            avatarUrl,\n            childIds: childIdArray\n          });\n          setCredentials({\n            username: email.split('@')[0],\n            password: 'password123',\n            email: email\n          });\n          setShowCredentialsModal(true);\n          setIsLoading(false);\n          return;\n        }\n        forceUpdate();\n        handleBack();\n        return;\n      }\n      if (parentToEdit) {\n        const {\n          error: updateError\n        } = await supabase.from('parents').update({\n          name,\n          email,\n          phone,\n          avatar_url: avatarUrl\n        }).eq('id', parentToEdit.id);\n        if (updateError) throw updateError;\n        if (parentToEdit.user_id) {\n          await supabase.from('users').update({\n            name: name,\n            avatar_url: avatarUrl\n          }).eq('id', parentToEdit.user_id);\n        }\n        await supabase.from('parent_children').delete().eq('parent_id', parentToEdit.id);\n        if (childIdArray.length > 0) {\n          const relations = childIdArray.map(childId => ({\n            parent_id: parentToEdit.id,\n            student_id: childId\n          }));\n          await supabase.from('parent_children').insert(relations);\n        }\n        toast.success('Parent updated successfully!');\n        forceUpdate();\n        handleBack();\n        return;\n      }\n      const authResult = await createUserAccount(name, 'Parent', email);\n      if (authResult.error) {\n        if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\n          toast.error('This email is already registered. Please use a different email.');\n        } else {\n          toast.error('Failed to create account: ' + authResult.error);\n        }\n        setIsLoading(false);\n        return;\n      }\n      const {\n        data: newUserData,\n        error: userError\n      } = await supabase.from('users').insert([{\n        email: email,\n        name: name,\n        role: 'Parent',\n        avatar_url: avatarUrl\n      }]).select().single();\n      if (userError) {\n        throw userError;\n      }\n      const userData = newUserData;\n      const {\n        data: newParentData,\n        error: parentError\n      } = await supabase.from('parents').insert([{\n        user_id: userData.id,\n        name,\n        email: email,\n        phone,\n        avatar_url: avatarUrl\n      }]).select().single();\n      if (parentError) throw parentError;\n      const parentData = newParentData;\n      if (childIdArray.length > 0) {\n        const relations = childIdArray.map(childId => ({\n          parent_id: parentData.id,\n          student_id: childId\n        }));\n        const {\n          error: relationError\n        } = await supabase.from('parent_children').insert(relations);\n        if (relationError) console.warn(\"Could not link all students:\", relationError.message);\n      }\n      console.log('User created. Verification email sent by Supabase.');\n      setCredentials({\n        username: authResult.username,\n        password: authResult.password,\n        email: email\n      });\n      setShowCredentialsModal(true);\n    } catch (error) {\n      console.error('Error saving parent:', error);\n      toast.error('Failed to save parent: ' + (error.message || 'Unknown error'));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50\",\n    children: [_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"flex-grow flex flex-col\",\n      children: [_jsxDEV(\"main\", {\n        className: \"flex-grow p-4 space-y-6 overflow-y-auto\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex justify-center\",\n          children: _jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [_jsxDEV(\"div\", {\n              className: \"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\",\n              children: avatar ? _jsxDEV(\"img\", {\n                src: avatar,\n                alt: \"Parent\",\n                className: \"w-full h-full rounded-full object-cover\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 43\n              }, this) : _jsxDEV(UserIcon, {\n                className: \"w-12 h-12 text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 267,\n                columnNumber: 131\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 29\n            }, this), _jsxDEV(\"label\", {\n              htmlFor: \"photo-upload\",\n              className: \"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\",\n              children: [_jsxDEV(CameraIcon, {\n                className: \"text-white h-4 w-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 33\n              }, this), _jsxDEV(\"input\", {\n                id: \"photo-upload\",\n                type: \"file\",\n                className: \"sr-only\",\n                accept: \"image/*\",\n                onChange: handleImageChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-xl shadow-sm border border-gray-100 space-y-6\",\n          children: [_jsxDEV(\"div\", {\n            className: \"space-y-4\",\n            children: [_jsxDEV(\"h3\", {\n              className: \"text-lg font-semibold text-gray-800 border-b pb-2\",\n              children: \"Personal Details\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 279,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              className: \"grid grid-cols-1 md:grid-cols-2 gap-4\",\n              children: [_jsxDEV(InputField, {\n                id: \"name\",\n                label: \"Full Name\",\n                value: name,\n                onChange: setName,\n                icon: _jsxDEV(UserIcon, {\n                  className: \"w-5 h-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 281,\n                  columnNumber: 111\n                }, this),\n                placeholder: \"e.g. John Doe\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 281,\n                columnNumber: 33\n              }, this), _jsxDEV(InputField, {\n                id: \"phone\",\n                label: \"Phone Number\",\n                value: phone,\n                onChange: setPhone,\n                icon: _jsxDEV(PhoneIcon, {\n                  className: \"w-5 h-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 282,\n                  columnNumber: 117\n                }, this),\n                type: \"tel\",\n                placeholder: \"+1234567890\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 282,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 29\n            }, this), _jsxDEV(InputField, {\n              id: \"email\",\n              label: \"Email Address\",\n              value: email,\n              onChange: setEmail,\n              icon: _jsxDEV(MailIcon, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 284,\n                columnNumber: 114\n              }, this),\n              type: \"email\",\n              placeholder: \"john.doe@example.com\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 284,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"space-y-4 pt-2\",\n            children: [_jsxDEV(\"div\", {\n              className: \"flex items-center justify-between border-b pb-2\",\n              children: [_jsxDEV(\"h3\", {\n                className: \"text-lg font-semibold text-gray-800\",\n                children: \"Link Students\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 290,\n                columnNumber: 33\n              }, this), _jsxDEV(\"span\", {\n                className: \"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full\",\n                children: \"Optional\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 291,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 29\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-sm text-gray-500\",\n              children: \"Enter the IDs of students this parent is responsible for.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 29\n            }, this), _jsxDEV(InputField, {\n              id: \"childIds\",\n              label: \"Student IDs (Comma Separated)\",\n              value: childIds,\n              onChange: setChildIds,\n              icon: _jsxDEV(StudentsIcon, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 39\n              }, this),\n              placeholder: \"e.g. 101, 102\",\n              required: false\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"p-4 mt-auto bg-gray-50\",\n        children: _jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: isLoading,\n          className: `w-full flex justify-center py-3 px-4 rounded-lg text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} transition-colors`,\n          children: isLoading ? 'Saving...' : parentToEdit ? 'Update Parent' : 'Save Parent'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 13\n    }, this), credentials && _jsxDEV(CredentialsModal, {\n      isOpen: showCredentialsModal,\n      userName: name,\n      username: credentials.username,\n      password: credentials.password,\n      email: credentials.email,\n      userType: \"Parent\",\n      onClose: () => {\n        setShowCredentialsModal(false);\n        forceUpdate();\n        handleBack();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 261,\n    columnNumber: 9\n  }, this);\n};\nconst InputField = ({\n  id,\n  label,\n  value,\n  onChange,\n  icon,\n  type = 'text',\n  placeholder,\n  required = true\n}) => _jsxDEV(\"div\", {\n  children: [_jsxDEV(\"label\", {\n    htmlFor: id,\n    className: \"block text-sm font-medium text-gray-700 mb-1\",\n    children: [label, \" \", required && _jsxDEV(\"span\", {\n      className: \"text-red-500\",\n      children: \"*\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 107\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 348,\n    columnNumber: 9\n  }, this), _jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [_jsxDEV(\"span\", {\n      className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400 pointer-events-none\",\n      children: icon\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 13\n    }, this), _jsxDEV(\"input\", {\n      type: type,\n      name: id,\n      id: id,\n      value: value,\n      onChange: e => onChange(e.target.value),\n      className: \"w-full pl-10 pr-4 py-3 text-gray-900 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-all placeholder-gray-400 focus:bg-white\",\n      placeholder: placeholder || label,\n      required: required\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 351,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 349,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 347,\n  columnNumber: 5\n}, this);\nexport default AddParentScreen;","map":{"version":3,"names":["React","useState","useEffect","CameraIcon","UserIcon","MailIcon","PhoneIcon","StudentsIcon","toast","supabase","isSupabaseConfigured","createUserAccount","CredentialsModal","mockParents","jsxDEV","_jsxDEV","AddParentScreen","parentToEdit","forceUpdate","handleBack","name","setName","email","setEmail","phone","setPhone","childIds","setChildIds","avatar","setAvatar","isLoading","setIsLoading","showCredentialsModal","setShowCredentialsModal","credentials","setCredentials","loadParentData","avatarUrl","data","links","from","select","eq","id","length","map","l","student_id","join","err","console","error","handleImageChange","event","target","files","reader","FileReader","onloadend","result","readAsDataURL","handleSubmit","e","preventDefault","replace","childIdArray","split","parseInt","trim","filter","isNaN","index","findIndex","p","Object","assign","success","newId","Math","max","push","username","password","updateError","update","avatar_url","user_id","delete","relations","childId","parent_id","insert","authResult","includes","newUserData","userError","role","single","userData","newParentData","parentError","parentData","relationError","warn","message","log","className","children","onSubmit","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","htmlFor","type","accept","onChange","InputField","label","value","icon","placeholder","required","disabled","isOpen","userName","userType","onClose"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/admin/AddParentScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon, StudentsIcon } from '../../constants';\r\n\r\nimport { toast } from 'react-hot-toast';\r\nimport { Formik, Form, Field, ErrorMessage, FormikHelpers } from 'formik';\r\nimport { Parent } from '../../types';\r\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\r\nimport { createUserAccount, sendVerificationEmail, checkEmailExists } from '../../lib/auth';\r\nimport { sendWelcomeEmail } from '../../lib/emailService';\r\nimport CredentialsModal from '../ui/CredentialsModal';\r\nimport { mockParents } from '../../data';\r\n\r\ninterface AddParentScreenProps {\r\n    parentToEdit?: Parent;\r\n    forceUpdate: () => void;\r\n    handleBack: () => void;\r\n}\r\n\r\nconst AddParentScreen: React.FC<AddParentScreenProps> = ({ parentToEdit, forceUpdate, handleBack }) => {\r\n    const [name, setName] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [phone, setPhone] = useState('');\r\n    const [childIds, setChildIds] = useState('');\r\n    const [avatar, setAvatar] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showCredentialsModal, setShowCredentialsModal] = useState(false);\r\n    const [credentials, setCredentials] = useState<{\r\n        username: string;\r\n        password: string;\r\n        email: string;\r\n    } | null>(null);\r\n\r\n    useEffect(() => {\r\n        const loadParentData = async () => {\r\n            if (parentToEdit) {\r\n                setName(parentToEdit.name);\r\n                setEmail(parentToEdit.email);\r\n                setPhone(parentToEdit.phone);\r\n                setAvatar(parentToEdit.avatarUrl);\r\n\r\n                if (isSupabaseConfigured) {\r\n                    try {\r\n                        const { data: links } = await supabase\r\n                            .from('parent_children')\r\n                            .select('student_id')\r\n                            .eq('parent_id', parentToEdit.id);\r\n\r\n                        if (links && links.length > 0) {\r\n                            setChildIds(links.map(l => l.student_id).join(', '));\r\n                        } else {\r\n                            // Fallback to prop if DB fetch empty (or just empty)\r\n                            setChildIds((parentToEdit.childIds || []).join(', '));\r\n                        }\r\n                    } catch (err) {\r\n                        console.error(\"Error loading child links:\", err);\r\n                        setChildIds((parentToEdit.childIds || []).join(', '));\r\n                    }\r\n                } else {\r\n                    setChildIds((parentToEdit.childIds || []).join(', '));\r\n                }\r\n            }\r\n        };\r\n        loadParentData();\r\n    }, [parentToEdit]);\r\n\r\n    const handleImageChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (event.target.files && event.target.files[0]) {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => { setAvatar(reader.result as string); };\r\n            reader.readAsDataURL(event.target.files[0]);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const avatarUrl = avatar || `https://i.pravatar.cc/150?u=${name.replace(' ', '')}`;\r\n            const childIdArray = childIds.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));\r\n\r\n            // MOCK MODE HANDLING\r\n            if (!isSupabaseConfigured) {\r\n                if (parentToEdit) {\r\n                    const index = mockParents.findIndex(p => p.id === parentToEdit.id);\r\n                    if (index !== -1) {\r\n                        mockParents[index] = {\r\n                            ...mockParents[index],\r\n                            name,\r\n                            email,\r\n                            phone,\r\n                            avatarUrl,\r\n                            childIds: childIdArray\r\n                        };\r\n                    }\r\n                    toast.success('Parent updated successfully (Mock Mode - Session Only)');\r\n                } else {\r\n                    const newId = mockParents.length > 0 ? Math.max(...mockParents.map(p => p.id)) + 1 : 1;\r\n                    mockParents.push({\r\n                        id: newId,\r\n                        name,\r\n                        email,\r\n                        phone,\r\n                        avatarUrl,\r\n                        childIds: childIdArray\r\n                    });\r\n                    // Simulate credentials generation\r\n                    setCredentials({\r\n                        username: email.split('@')[0],\r\n                        password: 'password123',\r\n                        email: email\r\n                    });\r\n                    setShowCredentialsModal(true);\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n                forceUpdate();\r\n                handleBack();\r\n                return;\r\n            }\r\n\r\n            if (parentToEdit) {\r\n                // UPDATE MODE\r\n                const { error: updateError } = await supabase\r\n                    .from('parents')\r\n                    .update({\r\n                        name,\r\n                        email,\r\n                        phone,\r\n                        avatar_url: avatarUrl\r\n                    })\r\n                    .eq('id', parentToEdit.id);\r\n\r\n                if (updateError) throw updateError;\r\n\r\n                // Also update the core User record to keep name/avatar in sync\r\n                if (parentToEdit.user_id) {\r\n                    await supabase\r\n                        .from('users')\r\n                        .update({ name: name, avatar_url: avatarUrl })\r\n                        .eq('id', parentToEdit.user_id);\r\n                }\r\n\r\n                // Sync Children Relations\r\n                // 1. Remove all existing links for this parent\r\n                await supabase.from('parent_children').delete().eq('parent_id', parentToEdit.id);\r\n\r\n                // 2. Add new links if any\r\n                if (childIdArray.length > 0) {\r\n                    const relations = childIdArray.map(childId => ({\r\n                        parent_id: parentToEdit.id,\r\n                        student_id: childId\r\n                    }));\r\n                    await supabase.from('parent_children').insert(relations);\r\n                }\r\n\r\n                toast.success('Parent updated successfully!');\r\n                forceUpdate();\r\n                handleBack();\r\n                return; // Stop execution here\r\n            }\r\n            // CREATE MODE\r\n\r\n            // 1. Create Login Credentials (Auth User) FIRST.\r\n            // This ensures we don't end up with a DB record but no login method if Auth fails.\r\n            // Also, this handles the email uniqueness check via Supabase Auth.\r\n\r\n            const authResult = await createUserAccount(\r\n                name,\r\n                'Parent',\r\n                email\r\n            );\r\n\r\n            if (authResult.error) {\r\n                // Determine if it is a duplicate email error\r\n                if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\r\n                    toast.error('This email is already registered. Please use a different email.');\r\n                } else {\r\n                    toast.error('Failed to create account: ' + authResult.error);\r\n                }\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            // 2. Create User Record (Legacy Table)\r\n            // We use the ID from the previous step if we can, but since public.users uses Serial/BigInt,\r\n            // we let it generate its own ID, and we just link them logically via email or a new column if exists.\r\n            // Ideally we should store the Auth UUID in 'users' table, but adhering to existing schema:\r\n\r\n            const { data: newUserData, error: userError } = await supabase\r\n                .from('users')\r\n                .insert([{\r\n                    email: email,\r\n                    name: name,\r\n                    role: 'Parent',\r\n                    avatar_url: avatarUrl\r\n                }])\r\n                .select()\r\n                .single();\r\n\r\n            if (userError) {\r\n                // Rollback opportunity here (delete auth user), but for MVP we just show error.\r\n                // In production, use a transaction or edge function.\r\n                throw userError;\r\n            }\r\n\r\n            const userData = newUserData;\r\n\r\n            // 3. Create Parent Profile\r\n            const { data: newParentData, error: parentError } = await supabase\r\n                .from('parents')\r\n                .insert([{\r\n                    user_id: userData.id, // Linking to Legacy User ID\r\n                    name,\r\n                    email: email,\r\n                    phone,\r\n                    avatar_url: avatarUrl\r\n                }])\r\n                .select()\r\n                .single();\r\n\r\n            if (parentError) throw parentError;\r\n            const parentData = newParentData;\r\n\r\n            // 4. Link Students to Parent\r\n            if (childIdArray.length > 0) {\r\n                const relations = childIdArray.map(childId => ({\r\n                    parent_id: parentData.id,\r\n                    student_id: childId\r\n                }));\r\n\r\n                const { error: relationError } = await supabase\r\n                    .from('parent_children')\r\n                    .insert(relations);\r\n\r\n                if (relationError) console.warn(\"Could not link all students:\", relationError.message);\r\n            }\r\n\r\n            // 5. Send Welcome Email (Handled by Supabase Auth automatically now)\r\n            // But we can still simulate the welcome message in the UI or logs.\r\n            console.log('User created. Verification email sent by Supabase.');\r\n\r\n            // Show credentials modal\r\n            setCredentials({\r\n                username: authResult.username,\r\n                password: authResult.password,\r\n                email: email\r\n            });\r\n            setShowCredentialsModal(true);\r\n            // Don't call forceUpdate/handleBack here - let modal handle it\r\n        } catch (error: any) {\r\n            console.error('Error saving parent:', error);\r\n            toast.error('Failed to save parent: ' + (error.message || 'Unknown error'));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-50\">\r\n            <form onSubmit={handleSubmit} className=\"flex-grow flex flex-col\">\r\n                <main className=\"flex-grow p-4 space-y-6 overflow-y-auto\">\r\n                    <div className=\"flex justify-center\">\r\n                        <div className=\"relative\">\r\n                            <div className=\"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                {avatar ? <img src={avatar} alt=\"Parent\" className=\"w-full h-full rounded-full object-cover\" /> : <UserIcon className=\"w-12 h-12 text-gray-400\" />}\r\n                            </div>\r\n                            <label htmlFor=\"photo-upload\" className=\"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\">\r\n                                <CameraIcon className=\"text-white h-4 w-4\" />\r\n                                <input id=\"photo-upload\" type=\"file\" className=\"sr-only\" accept=\"image/*\" onChange={handleImageChange} />\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"bg-white p-6 rounded-xl shadow-sm border border-gray-100 space-y-6\">\r\n\r\n                        {/* Personal Information Section */}\r\n                        <div className=\"space-y-4\">\r\n                            <h3 className=\"text-lg font-semibold text-gray-800 border-b pb-2\">Personal Details</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                <InputField id=\"name\" label=\"Full Name\" value={name} onChange={setName} icon={<UserIcon className=\"w-5 h-5\" />} placeholder=\"e.g. John Doe\" />\r\n                                <InputField id=\"phone\" label=\"Phone Number\" value={phone} onChange={setPhone} icon={<PhoneIcon className=\"w-5 h-5\" />} type=\"tel\" placeholder=\"+1234567890\" />\r\n                            </div>\r\n                            <InputField id=\"email\" label=\"Email Address\" value={email} onChange={setEmail} icon={<MailIcon className=\"w-5 h-5\" />} type=\"email\" placeholder=\"john.doe@example.com\" />\r\n                        </div>\r\n\r\n                        {/* Student Linking Section */}\r\n                        <div className=\"space-y-4 pt-2\">\r\n                            <div className=\"flex items-center justify-between border-b pb-2\">\r\n                                <h3 className=\"text-lg font-semibold text-gray-800\">Link Students</h3>\r\n                                <span className=\"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full\">Optional</span>\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-500\">Enter the IDs of students this parent is responsible for.</p>\r\n                            <InputField\r\n                                id=\"childIds\"\r\n                                label=\"Student IDs (Comma Separated)\"\r\n                                value={childIds}\r\n                                onChange={setChildIds}\r\n                                icon={<StudentsIcon className=\"w-5 h-5\" />}\r\n                                placeholder=\"e.g. 101, 102\"\r\n                                required={false}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </main>\r\n                <div className=\"p-4 mt-auto bg-gray-50\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isLoading}\r\n                        className={`w-full flex justify-center py-3 px-4 rounded-lg text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} transition-colors`}\r\n                    >\r\n                        {isLoading ? 'Saving...' : (parentToEdit ? 'Update Parent' : 'Save Parent')}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n\r\n            {/* Credentials Modal */}\r\n            {credentials && (\r\n                <CredentialsModal\r\n                    isOpen={showCredentialsModal}\r\n                    userName={name}\r\n                    username={credentials.username}\r\n                    password={credentials.password}\r\n                    email={credentials.email}\r\n                    userType=\"Parent\"\r\n                    onClose={() => {\r\n                        setShowCredentialsModal(false);\r\n                        forceUpdate();\r\n                        handleBack();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst InputField: React.FC<{\r\n    id: string,\r\n    label: string,\r\n    value: string,\r\n    onChange: (val: string) => void,\r\n    icon: React.ReactNode,\r\n    type?: string,\r\n    placeholder?: string,\r\n    required?: boolean\r\n}> = ({ id, label, value, onChange, icon, type = 'text', placeholder, required = true }) => (\r\n    <div>\r\n        <label htmlFor={id} className=\"block text-sm font-medium text-gray-700 mb-1\">{label} {required && <span className=\"text-red-500\">*</span>}</label>\r\n        <div className=\"relative\">\r\n            <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400 pointer-events-none\">{icon}</span>\r\n            <input\r\n                type={type}\r\n                name={id}\r\n                id={id}\r\n                value={value}\r\n                onChange={e => onChange(e.target.value)}\r\n                className=\"w-full pl-10 pr-4 py-3 text-gray-900 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-all placeholder-gray-400 focus:bg-white\"\r\n                placeholder={placeholder || label}\r\n                required={required}\r\n            />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default AddParentScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}