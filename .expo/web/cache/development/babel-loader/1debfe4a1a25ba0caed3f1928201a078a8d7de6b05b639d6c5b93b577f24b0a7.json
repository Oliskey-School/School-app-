{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\admin\\\\AddTeacherScreen.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon, UsersIcon, XCircleIcon, CheckCircleIcon } from '../../constants';\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\nimport { createUserAccount, sendVerificationEmail } from '../../lib/auth';\nimport CredentialsModal from '../ui/CredentialsModal';\nimport { mockTeachers } from '../../data';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TagInput = ({\n  label,\n  tags,\n  setTags,\n  placeholder,\n  validOptions,\n  validationMessage\n}) => {\n  const [input, setInput] = useState('');\n  const [error, setError] = useState(null);\n  const handleAddTag = () => {\n    const newTag = input.trim();\n    if (!newTag) return;\n    if (tags.includes(newTag)) {\n      setInput('');\n      setError(null);\n      return;\n    }\n    if (validOptions && validOptions.length > 0) {\n      const match = validOptions.find(opt => opt.toLowerCase() === newTag.toLowerCase());\n      if (!match) {\n        setError(validationMessage || `Invalid value.Please select from the list.`);\n        return;\n      }\n      setTags([...tags, match]);\n    } else {\n      setTags([...tags, newTag]);\n    }\n    setInput('');\n    setError(null);\n  };\n  const handleRemoveTag = tagToRemove => {\n    setTags(tags.filter(tag => tag !== tagToRemove));\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' || e.key === ',') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n  return _jsxDEV(\"div\", {\n    children: [_jsxDEV(\"label\", {\n      className: \"text-sm font-medium text-gray-700 mb-1 block\",\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this), _jsxDEV(\"div\", {\n      className: `flex flex - wrap items - center gap - 2 p - 2 border rounded - lg bg - gray - 50 ${error ? 'border-red-300 ring-1 ring-red-200' : 'border-gray-300'} `,\n      children: [tags.map(tag => _jsxDEV(\"span\", {\n        className: \"flex items-center gap-1.5 bg-sky-100 text-sky-800 text-sm font-semibold px-2 py-1 rounded-md\",\n        children: [tag, _jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: () => handleRemoveTag(tag),\n          className: \"text-sky-600 hover:text-sky-800\",\n          children: _jsxDEV(XCircleIcon, {\n            className: \"w-4 h-4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 25\n        }, this)]\n      }, tag, true, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 21\n      }, this)), _jsxDEV(\"input\", {\n        type: \"text\",\n        value: input,\n        onChange: e => {\n          setInput(e.target.value);\n          setError(null);\n        },\n        onKeyDown: handleKeyDown,\n        placeholder: placeholder,\n        className: \"flex-grow bg-transparent p-1 text-gray-700 focus:outline-none\",\n        list: `list - ${label.replace(/\\s/g, '')} `\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }, this), error && _jsxDEV(\"p\", {\n      className: \"text-xs text-red-500 mt-1\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 23\n    }, this), validOptions && _jsxDEV(\"datalist\", {\n      id: `list - ${label.replace(/\\s/g, '')} `,\n      children: validOptions.map(opt => _jsxDEV(\"option\", {\n        value: opt\n      }, opt, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 46\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 9\n  }, this);\n};\nconst AddTeacherScreen = ({\n  teacherToEdit,\n  forceUpdate,\n  handleBack\n}) => {\n  const [name, setName] = useState('');\n  const [email, setEmail] = useState('');\n  const [phone, setPhone] = useState('');\n  const [subjects, setSubjects] = useState([]);\n  const [classes, setClasses] = useState([]);\n  const [status, setStatus] = useState('Active');\n  const [avatar, setAvatar] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [showCredentialsModal, setShowCredentialsModal] = useState(false);\n  const [curriculumEligibility, setCurriculumEligibility] = useState(['NIGERIAN']);\n  const [uploadedDocs, setUploadedDocs] = useState([]);\n  const [validSubjects, setValidSubjects] = useState([]);\n  const [validClasses, setValidClasses] = useState([]);\n  const [loadingRefs, setLoadingRefs] = useState(true);\n  const [credentials, setCredentials] = useState(null);\n  useEffect(() => {\n    const fetchRefs = async () => {\n      if (!isSupabaseConfigured) {\n        setValidSubjects(['Math', 'English', 'Science', 'History', 'Geography', 'Art', 'Music', 'PE', 'Physics', 'Chemistry', 'Biology']);\n        setValidClasses(['Grade 7', 'Grade 8', 'Grade 9', 'Grade 10', 'Grade 11', 'Grade 12']);\n        setLoadingRefs(false);\n        return;\n      }\n      try {\n        const {\n          data: sData\n        } = await supabase.from('subjects').select('name');\n        if (sData) setValidSubjects(sData.map(d => d.name));\n        const {\n          data: cData\n        } = await supabase.from('classes').select('class_name');\n        if (cData) setValidClasses(cData.map(d => d.class_name));\n      } catch (err) {\n        console.error(\"Error fetching reference data:\", err);\n      } finally {\n        setLoadingRefs(false);\n      }\n    };\n    fetchRefs();\n  }, []);\n  useEffect(() => {\n    if (teacherToEdit) {\n      setName(teacherToEdit.name);\n      setEmail(teacherToEdit.email);\n      setPhone(teacherToEdit.phone);\n      setSubjects(teacherToEdit.subjects);\n      const normalize = s => {\n        if (!s) return s;\n        let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\n        const m = cleaned.match(/(\\d+)([A-Z]+)/i);\n        if (m) return `${parseInt(m[1], 10)}${m[2]} `;\n        const m2 = cleaned.match(/(\\d+)/);\n        if (m2) return `${parseInt(m2[1], 10)} `;\n        return cleaned;\n      };\n      setClasses((teacherToEdit.classes || []).map(normalize));\n      setStatus(teacherToEdit.status);\n      setAvatar(teacherToEdit.avatarUrl);\n    }\n  }, [teacherToEdit]);\n  const handleImageChange = event => {\n    if (event.target.files && event.target.files[0]) {\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setAvatar(reader.result);\n      };\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      const avatarUrl = avatar || `https://i.pravatar.cc/150?u=${name.replace(' ', '')}`;\n      if (!isSupabaseConfigured) {\n        const teacherEmail = email || `teacher${Date.now()}@school.com`;\n        if (teacherToEdit) {\n          const index = mockTeachers.findIndex(t => t.id === teacherToEdit.id);\n          if (index !== -1) {\n            mockTeachers[index] = Object.assign({}, mockTeachers[index], {\n              name,\n              email: teacherEmail,\n              phone,\n              subjects,\n              classes,\n              status,\n              avatarUrl\n            });\n          }\n          toast.success('Teacher updated successfully (Mock Mode - Session Only)');\n        } else {\n          const newId = mockTeachers.length > 0 ? Math.max(...mockTeachers.map(t => t.id)) + 1 : 1;\n          mockTeachers.push({\n            id: newId,\n            name,\n            email: teacherEmail,\n            phone,\n            subjects,\n            classes,\n            status,\n            avatarUrl\n          });\n          setCredentials({\n            username: teacherEmail.split('@')[0],\n            password: 'password123',\n            email: teacherEmail\n          });\n          setShowCredentialsModal(true);\n          setIsLoading(false);\n          return;\n        }\n        forceUpdate();\n        handleBack();\n        return;\n      }\n      if (teacherToEdit) {\n        const {\n          error: updateError\n        } = await supabase.from('teachers').update({\n          name,\n          email,\n          phone,\n          status,\n          avatar_url: avatarUrl\n        }).eq('id', teacherToEdit.id);\n        if (updateError) throw updateError;\n        await supabase.from('teacher_subjects').delete().eq('teacher_id', teacherToEdit.id);\n        if (subjects.length > 0) {\n          const subjectInserts = subjects.map(subject => ({\n            teacher_id: teacherToEdit.id,\n            subject\n          }));\n          await supabase.from('teacher_subjects').insert(subjectInserts);\n        }\n        await supabase.from('teacher_classes').delete().eq('teacher_id', teacherToEdit.id);\n        if (classes.length > 0) {\n          const normalize = s => {\n            if (!s) return s;\n            let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\n            const m = cleaned.match(/(\\d+)([A-Z]+)/i);\n            if (m) return `${parseInt(m[1], 10)}${m[2]}`;\n            const m2 = cleaned.match(/(\\d+)/);\n            if (m2) return `${parseInt(m2[1], 10)}`;\n            return cleaned;\n          };\n          const normalized = Array.from(new Set(classes.map(normalize).filter(Boolean)));\n          const classInserts = normalized.map(className => ({\n            teacher_id: teacherToEdit.id,\n            class_name: className\n          }));\n          await supabase.from('teacher_classes').insert(classInserts);\n        }\n        toast.success('Teacher updated successfully!');\n      } else {\n        const teacherEmail = email || `teacher${Date.now()}@school.com`;\n        const authResult = await createUserAccount(name, 'Teacher', teacherEmail);\n        if (authResult.error) {\n          if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\n            toast.error(`Teacher with email ${teacherEmail} is already registered.`);\n          } else {\n            toast.error('Failed to create account: ' + authResult.error);\n          }\n          setIsLoading(false);\n          return;\n        }\n        const {\n          data: newUserData,\n          error: userError\n        } = await supabase.from('users').insert([{\n          email: teacherEmail,\n          name: name,\n          role: 'Teacher',\n          avatar_url: avatarUrl\n        }]).select().single();\n        if (userError) throw userError;\n        const userData = newUserData;\n        const {\n          data: newTeacherData,\n          error: teacherError\n        } = await supabase.from('teachers').insert([{\n          user_id: userData.id,\n          name,\n          email: teacherEmail,\n          phone,\n          avatar_url: avatarUrl,\n          status\n        }]).select().single();\n        if (teacherError) throw teacherError;\n        const teacherData = newTeacherData;\n        if (subjects.length > 0) {\n          const subjectInserts = subjects.map(subject => ({\n            teacher_id: teacherData.id,\n            subject\n          }));\n          await supabase.from('teacher_subjects').insert(subjectInserts);\n        }\n        if (classes.length > 0) {\n          const normalize = s => {\n            if (!s) return s;\n            let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\n            const m = cleaned.match(/(\\d+)([A-Z]+)/i);\n            if (m) return `${parseInt(m[1], 10)}${m[2]}`;\n            const m2 = cleaned.match(/(\\d+)/);\n            if (m2) return `${parseInt(m2[1], 10)}`;\n            return cleaned;\n          };\n          const normalized = Array.from(new Set(classes.map(normalize).filter(Boolean)));\n          const classInserts = normalized.map(className => ({\n            teacher_id: teacherData.id,\n            class_name: className\n          }));\n          await supabase.from('teacher_classes').insert(classInserts);\n        }\n        console.log('Teacher credentials created successfully.');\n        const emailResult = await sendVerificationEmail(name, teacherEmail, 'School App');\n        if (!emailResult.success) {\n          console.warn('Warning: Email verification notification failed:', emailResult.error);\n        }\n        setCredentials({\n          username: authResult.username,\n          password: authResult.password,\n          email: teacherEmail\n        });\n        setShowCredentialsModal(true);\n      }\n    } catch (error) {\n      console.error('Error saving teacher:', error);\n      toast.error('Failed to save teacher: ' + (error.message || 'Unknown error'));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50\",\n    children: [_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"flex-grow flex flex-col\",\n      children: [_jsxDEV(\"main\", {\n        className: \"flex-grow p-4 space-y-6 overflow-y-auto\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex justify-center\",\n          children: _jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [_jsxDEV(\"div\", {\n              className: \"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\",\n              children: avatar ? _jsxDEV(\"img\", {\n                src: avatar,\n                alt: \"Teacher\",\n                className: \"w-full h-full rounded-full object-cover\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 414,\n                columnNumber: 43\n              }, this) : _jsxDEV(UserIcon, {\n                className: \"w-12 h-12 text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 414,\n                columnNumber: 132\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 413,\n              columnNumber: 29\n            }, this), _jsxDEV(\"label\", {\n              htmlFor: \"photo-upload\",\n              className: \"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\",\n              children: [_jsxDEV(CameraIcon, {\n                className: \"text-white h-4 w-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 417,\n                columnNumber: 33\n              }, this), _jsxDEV(\"input\", {\n                id: \"photo-upload\",\n                type: \"file\",\n                className: \"sr-only\",\n                accept: \"image/*\",\n                onChange: handleImageChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 418,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 416,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"bg-white p-4 rounded-lg shadow-sm space-y-4\",\n          children: [_jsxDEV(InputField, {\n            id: \"name\",\n            label: \"Full Name\",\n            value: name,\n            onChange: setName,\n            icon: _jsxDEV(UserIcon, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 103\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 25\n          }, this), _jsxDEV(InputField, {\n            id: \"email\",\n            label: \"Email\",\n            value: email,\n            onChange: setEmail,\n            icon: _jsxDEV(MailIcon, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 424,\n              columnNumber: 102\n            }, this),\n            type: \"email\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 424,\n            columnNumber: 25\n          }, this), _jsxDEV(InputField, {\n            id: \"phone\",\n            label: \"Phone\",\n            value: phone,\n            onChange: setPhone,\n            icon: _jsxDEV(PhoneIcon, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 425,\n              columnNumber: 102\n            }, this),\n            type: \"tel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 25\n          }, this), _jsxDEV(TagInput, {\n            label: \"Subjects\",\n            tags: subjects,\n            setTags: setSubjects,\n            placeholder: loadingRefs ? \"Loading subjects...\" : \"Add subject & press Enter\",\n            validOptions: validSubjects,\n            validationMessage: \"Subject not found in database. Please ask admin to add it.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 427,\n            columnNumber: 25\n          }, this), _jsxDEV(TagInput, {\n            label: \"Classes\",\n            tags: classes,\n            setTags: setClasses,\n            placeholder: loadingRefs ? \"Loading classes...\" : \"Add class (e.g., 7A) & press Enter\",\n            validOptions: validClasses,\n            validationMessage: \"Class not found in database. Please ask admin to add it.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"pt-2 border-t border-gray-100\",\n            children: [_jsxDEV(\"label\", {\n              className: \"text-sm font-medium text-gray-700 mb-2 block\",\n              children: [\"Curriculum Eligibility \", _jsxDEV(\"span\", {\n                className: \"text-red-500\",\n                children: \"*\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 447,\n                columnNumber: 116\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              className: \"flex gap-4 mb-4\",\n              children: [_jsxDEV(\"label\", {\n                className: `flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors ${curriculumEligibility.includes('NIGERIAN') ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`,\n                children: [_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: curriculumEligibility.includes('NIGERIAN'),\n                  onChange: e => {\n                    if (e.target.checked) setCurriculumEligibility([...curriculumEligibility, 'NIGERIAN']);else setCurriculumEligibility(curriculumEligibility.filter(c => c !== 'NIGERIAN'));\n                  },\n                  className: \"rounded text-green-600 focus:ring-green-500\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 450,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"span\", {\n                    className: \"font-semibold text-gray-800 text-sm\",\n                    children: \"Nigerian\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 460,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"p\", {\n                    className: \"text-[10px] text-gray-500\",\n                    children: \"Requires TRCN\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 461,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 459,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 33\n              }, this), _jsxDEV(\"label\", {\n                className: `flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors ${curriculumEligibility.includes('BRITISH') ? 'bg-red-50 border-red-200' : 'bg-gray-50 border-gray-200'}`,\n                children: [_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: curriculumEligibility.includes('BRITISH'),\n                  onChange: e => {\n                    if (e.target.checked) setCurriculumEligibility([...curriculumEligibility, 'BRITISH']);else setCurriculumEligibility(curriculumEligibility.filter(c => c !== 'BRITISH'));\n                  },\n                  className: \"rounded text-red-600 focus:ring-red-500\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 466,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"span\", {\n                    className: \"font-semibold text-gray-800 text-sm\",\n                    children: \"British\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 476,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"p\", {\n                    className: \"text-[10px] text-gray-500\",\n                    children: \"Requires QTS/Intl Cert\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 477,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 475,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 465,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 448,\n              columnNumber: 29\n            }, this), _jsxDEV(\"label\", {\n              className: \"text-sm font-medium text-gray-700 mb-2 block\",\n              children: \"Compliance Documents\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              className: \"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors cursor-pointer\",\n              children: [_jsxDEV(UsersIcon, {\n                className: \"mx-auto h-8 w-8 text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 33\n              }, this), _jsxDEV(\"p\", {\n                className: \"mt-1 text-sm text-gray-600\",\n                children: \"Click to upload TRCN / Certificates\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 485,\n                columnNumber: 33\n              }, this), _jsxDEV(\"p\", {\n                className: \"text-xs text-gray-400 mt-1\",\n                children: \"(PDF, JPG, PNG)\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 486,\n                columnNumber: 33\n              }, this), _jsxDEV(\"input\", {\n                type: \"file\",\n                multiple: true,\n                className: \"hidden\",\n                onChange: e => {\n                  if (e.target.files) setUploadedDocs(Array.from(e.target.files));\n                  toast.success(\"Documents selected (Mock Upload)\");\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 487,\n                columnNumber: 33\n              }, this), uploadedDocs.length > 0 && _jsxDEV(\"div\", {\n                className: \"mt-2 text-left space-y-1\",\n                children: uploadedDocs.map((file, i) => _jsxDEV(\"p\", {\n                  className: \"text-xs text-green-600 flex items-center gap-1\",\n                  children: [_jsxDEV(CheckCircleIcon, {\n                    className: \"w-3 h-3\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 495,\n                    columnNumber: 49\n                  }, this), \" \", file.name]\n                }, i, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 494,\n                  columnNumber: 45\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 492,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 483,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 446,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            children: [_jsxDEV(\"label\", {\n              htmlFor: \"status\",\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"Status\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 504,\n              columnNumber: 29\n            }, this), _jsxDEV(\"select\", {\n              id: \"status\",\n              value: status,\n              onChange: e => setStatus(e.target.value),\n              className: \"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-700\",\n              children: [_jsxDEV(\"option\", {\n                value: \"Active\",\n                children: \"Active\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 506,\n                columnNumber: 33\n              }, this), _jsxDEV(\"option\", {\n                value: \"On Leave\",\n                children: \"On Leave\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 507,\n                columnNumber: 33\n              }, this), _jsxDEV(\"option\", {\n                value: \"Inactive\",\n                children: \"Inactive\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 508,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 505,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 503,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"p-4 mt-auto bg-gray-50\",\n        children: _jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: isLoading,\n          className: `w-full flex justify-center py-3 px-4 rounded-lg text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} transition-colors`,\n          children: isLoading ? 'Saving...' : teacherToEdit ? 'Update Teacher' : 'Save Teacher'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 514,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 513,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 13\n    }, this), credentials && _jsxDEV(CredentialsModal, {\n      isOpen: showCredentialsModal,\n      userName: name,\n      username: credentials.username,\n      password: credentials.password,\n      email: credentials.email,\n      userType: \"Teacher\",\n      onClose: () => {\n        setShowCredentialsModal(false);\n        forceUpdate();\n        handleBack();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 408,\n    columnNumber: 9\n  }, this);\n};\nconst InputField = ({\n  id,\n  label,\n  value,\n  onChange,\n  icon,\n  type = 'text'\n}) => _jsxDEV(\"div\", {\n  children: [_jsxDEV(\"label\", {\n    htmlFor: id,\n    className: \"text-sm font-medium text-gray-600 sr-only\",\n    children: label\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 546,\n    columnNumber: 9\n  }, this), _jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [_jsxDEV(\"span\", {\n      className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\",\n      children: icon\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 548,\n      columnNumber: 13\n    }, this), _jsxDEV(\"input\", {\n      type: type,\n      name: id,\n      id: id,\n      value: value,\n      onChange: e => onChange(e.target.value),\n      className: \"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n      placeholder: label,\n      required: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 549,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 547,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 545,\n  columnNumber: 5\n}, this);\nexport default AddTeacherScreen;","map":{"version":3,"names":["React","useState","useEffect","toast","CameraIcon","UserIcon","MailIcon","PhoneIcon","UsersIcon","XCircleIcon","CheckCircleIcon","supabase","isSupabaseConfigured","createUserAccount","sendVerificationEmail","CredentialsModal","mockTeachers","jsxDEV","_jsxDEV","TagInput","label","tags","setTags","placeholder","validOptions","validationMessage","input","setInput","error","setError","handleAddTag","newTag","trim","includes","length","match","find","opt","toLowerCase","handleRemoveTag","tagToRemove","filter","tag","handleKeyDown","e","key","preventDefault","children","className","fileName","_jsxFileName","lineNumber","columnNumber","map","type","onClick","value","onChange","target","onKeyDown","list","replace","id","AddTeacherScreen","teacherToEdit","forceUpdate","handleBack","name","setName","email","setEmail","phone","setPhone","subjects","setSubjects","classes","setClasses","status","setStatus","avatar","setAvatar","isLoading","setIsLoading","showCredentialsModal","setShowCredentialsModal","curriculumEligibility","setCurriculumEligibility","uploadedDocs","setUploadedDocs","validSubjects","setValidSubjects","validClasses","setValidClasses","loadingRefs","setLoadingRefs","credentials","setCredentials","fetchRefs","data","sData","from","select","d","cData","class_name","err","console","normalize","s","cleaned","toUpperCase","m","parseInt","m2","avatarUrl","handleImageChange","event","files","reader","FileReader","onloadend","result","readAsDataURL","handleSubmit","teacherEmail","Date","now","index","findIndex","t","Object","assign","success","newId","Math","max","push","username","split","password","updateError","update","avatar_url","eq","delete","subjectInserts","subject","teacher_id","insert","normalized","Array","Set","Boolean","classInserts","authResult","newUserData","userError","role","single","userData","newTeacherData","teacherError","user_id","teacherData","log","emailResult","warn","message","onSubmit","src","alt","htmlFor","accept","InputField","icon","checked","c","multiple","file","i","disabled","isOpen","userName","userType","onClose","required"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/admin/AddTeacherScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\n// import { useNavigate } from 'react-router-dom';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Formik, Form, Field, ErrorMessage, FormikHelpers } from 'formik';\r\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon, BookOpenIcon, UsersIcon, XCircleIcon, CheckCircleIcon } from '../../constants';\r\nimport { Teacher } from '../../types';\r\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\r\nimport { createUserAccount, sendVerificationEmail, checkEmailExists } from '../../lib/auth';\r\nimport CredentialsModal from '../ui/CredentialsModal';\r\nimport { mockTeachers } from '../../data';\r\n\r\ninterface AddTeacherScreenProps {\r\n    teacherToEdit?: Teacher;\r\n    forceUpdate: () => void;\r\n    handleBack: () => void;\r\n}\r\n\r\nconst TagInput: React.FC<{\r\n    label: string;\r\n    tags: string[];\r\n    setTags: React.Dispatch<React.SetStateAction<string[]>>;\r\n    placeholder: string;\r\n    validOptions?: string[];\r\n    validationMessage?: string;\r\n}> = ({ label, tags, setTags, placeholder, validOptions, validationMessage }) => {\r\n    const [input, setInput] = useState('');\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const handleAddTag = () => {\r\n        const newTag = input.trim();\r\n        if (!newTag) return;\r\n\r\n        if (tags.includes(newTag)) {\r\n            setInput('');\r\n            setError(null);\r\n            return;\r\n        }\r\n\r\n        // VALIDATION LOGIC\r\n        if (validOptions && validOptions.length > 0) {\r\n            // Case-insensitive check\r\n            const match = validOptions.find(opt => opt.toLowerCase() === newTag.toLowerCase());\r\n            if (!match) {\r\n                setError(validationMessage || `Invalid value.Please select from the list.`);\r\n                // Optional: Show valid options in console or UI suggestion\r\n                return;\r\n            }\r\n            // Use the canonical casing from validOptions\r\n            setTags([...tags, match]);\r\n        } else {\r\n            setTags([...tags, newTag]);\r\n        }\r\n\r\n        setInput('');\r\n        setError(null);\r\n    };\r\n\r\n    const handleRemoveTag = (tagToRemove: string) => {\r\n        setTags(tags.filter(tag => tag !== tagToRemove));\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === 'Enter' || e.key === ',') {\r\n            e.preventDefault();\r\n            handleAddTag();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <label className=\"text-sm font-medium text-gray-700 mb-1 block\">{label}</label>\r\n            <div className={`flex flex - wrap items - center gap - 2 p - 2 border rounded - lg bg - gray - 50 ${error ? 'border-red-300 ring-1 ring-red-200' : 'border-gray-300'} `}>\r\n                {tags.map(tag => (\r\n                    <span key={tag} className=\"flex items-center gap-1.5 bg-sky-100 text-sky-800 text-sm font-semibold px-2 py-1 rounded-md\">\r\n                        {tag}\r\n                        <button type=\"button\" onClick={() => handleRemoveTag(tag)} className=\"text-sky-600 hover:text-sky-800\">\r\n                            <XCircleIcon className=\"w-4 h-4\" />\r\n                        </button>\r\n                    </span>\r\n                ))}\r\n                <input\r\n                    type=\"text\"\r\n                    value={input}\r\n                    onChange={e => { setInput(e.target.value); setError(null); }}\r\n                    onKeyDown={handleKeyDown}\r\n                    placeholder={placeholder}\r\n                    className=\"flex-grow bg-transparent p-1 text-gray-700 focus:outline-none\"\r\n                    list={`list - ${label.replace(/\\s/g, '')} `}\r\n                />\r\n            </div>\r\n            {error && <p className=\"text-xs text-red-500 mt-1\">{error}</p>}\r\n\r\n            {/* Datalist for suggestions */}\r\n            {validOptions && (\r\n                <datalist id={`list - ${label.replace(/\\s/g, '')} `}>\r\n                    {validOptions.map(opt => <option key={opt} value={opt} />)}\r\n                </datalist>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nconst AddTeacherScreen: React.FC<AddTeacherScreenProps> = ({ teacherToEdit, forceUpdate, handleBack }) => {\r\n    const [name, setName] = useState('');\r\n    const [email, setEmail] = useState('');\r\n    const [phone, setPhone] = useState('');\r\n    const [subjects, setSubjects] = useState<string[]>([]);\r\n    const [classes, setClasses] = useState<string[]>([]);\r\n    const [status, setStatus] = useState<'Active' | 'Inactive' | 'On Leave'>('Active');\r\n    const [avatar, setAvatar] = useState<string | null>(null);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showCredentialsModal, setShowCredentialsModal] = useState(false);\r\n\r\n    // Phase 7: Curriculum & Compliance\r\n    const [curriculumEligibility, setCurriculumEligibility] = useState<string[]>(['NIGERIAN']); // Default to Nigerian\r\n    const [uploadedDocs, setUploadedDocs] = useState<File[]>([]);\r\n\r\n    // Validation Lists\r\n    const [validSubjects, setValidSubjects] = useState<string[]>([]);\r\n    const [validClasses, setValidClasses] = useState<string[]>([]);\r\n    const [loadingRefs, setLoadingRefs] = useState(true);\r\n\r\n    const [credentials, setCredentials] = useState<{\r\n        username: string;\r\n        password: string;\r\n        email: string;\r\n    } | null>(null);\r\n\r\n    // Fetch Reference Data\r\n    useEffect(() => {\r\n        const fetchRefs = async () => {\r\n            if (!isSupabaseConfigured) {\r\n                // Mock reference data\r\n                setValidSubjects(['Math', 'English', 'Science', 'History', 'Geography', 'Art', 'Music', 'PE', 'Physics', 'Chemistry', 'Biology']);\r\n                setValidClasses(['Grade 7', 'Grade 8', 'Grade 9', 'Grade 10', 'Grade 11', 'Grade 12']);\r\n                setLoadingRefs(false);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                // Fetch Subjects\r\n                const { data: sData } = await supabase.from('subjects').select('name');\r\n                if (sData) setValidSubjects(sData.map(d => d.name));\r\n\r\n                // Fetch Classes\r\n                const { data: cData } = await supabase.from('classes').select('class_name');\r\n                if (cData) setValidClasses(cData.map(d => d.class_name));\r\n\r\n            } catch (err) {\r\n                console.error(\"Error fetching reference data:\", err);\r\n            } finally {\r\n                setLoadingRefs(false);\r\n            }\r\n        };\r\n        fetchRefs();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (teacherToEdit) {\r\n            setName(teacherToEdit.name);\r\n            setEmail(teacherToEdit.email);\r\n            setPhone(teacherToEdit.phone);\r\n            setSubjects(teacherToEdit.subjects);\r\n            // Normalize incoming class strings so they match the app format (e.g. `10A`)\r\n            const normalize = (s: string) => {\r\n                if (!s) return s;\r\n                let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\r\n                const m = cleaned.match(/(\\d+)([A-Z]+)/i);\r\n                if (m) return `${parseInt(m[1], 10)}${m[2]} `;\r\n                const m2 = cleaned.match(/(\\d+)/);\r\n                if (m2) return `${parseInt(m2[1], 10)} `;\r\n                return cleaned;\r\n            };\r\n            setClasses((teacherToEdit.classes || []).map(normalize));\r\n            setStatus(teacherToEdit.status);\r\n            setAvatar(teacherToEdit.avatarUrl);\r\n        }\r\n    }, [teacherToEdit]);\r\n\r\n    const handleImageChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (event.target.files && event.target.files[0]) {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => { setAvatar(reader.result as string); };\r\n            reader.readAsDataURL(event.target.files[0]);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const avatarUrl = avatar || `https://i.pravatar.cc/150?u=${name.replace(' ', '')}`;\r\n\r\n            // MOCK MODE HANDLING\r\n            if (!isSupabaseConfigured) {\r\n                const teacherEmail = email || `teacher${Date.now()}@school.com`;\r\n                if (teacherToEdit) {\r\n                    const index = mockTeachers.findIndex(t => t.id === teacherToEdit.id);\r\n                    if (index !== -1) {\r\n                        mockTeachers[index] = {\r\n                            ...mockTeachers[index],\r\n                            name,\r\n                            email: teacherEmail,\r\n                            phone,\r\n                            subjects,\r\n                            classes,\r\n                            status,\r\n                            avatarUrl\r\n                        };\r\n                    }\r\n                    toast.success('Teacher updated successfully (Mock Mode - Session Only)');\r\n                } else {\r\n                    const newId = mockTeachers.length > 0 ? Math.max(...mockTeachers.map(t => t.id)) + 1 : 1;\r\n                    mockTeachers.push({\r\n                        id: newId,\r\n                        name,\r\n                        email: teacherEmail,\r\n                        phone,\r\n                        subjects,\r\n                        classes,\r\n                        status,\r\n                        avatarUrl,\r\n                    });\r\n                    // Simulate credentials generation\r\n                    setCredentials({\r\n                        username: teacherEmail.split('@')[0],\r\n                        password: 'password123',\r\n                        email: teacherEmail\r\n                    });\r\n                    setShowCredentialsModal(true);\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n                forceUpdate();\r\n                handleBack();\r\n                return;\r\n            }\r\n\r\n            if (teacherToEdit) {\r\n                // UPDATE MODE\r\n                // 1. Update basic info\r\n                const { error: updateError } = await supabase\r\n                    .from('teachers')\r\n                    .update({\r\n                        name,\r\n                        email,\r\n                        phone,\r\n                        status,\r\n                        avatar_url: avatarUrl\r\n                    })\r\n                    .eq('id', teacherToEdit.id);\r\n\r\n                if (updateError) throw updateError;\r\n\r\n                // 2. Update Subjects (Delete all, re-insert)\r\n                await supabase.from('teacher_subjects').delete().eq('teacher_id', teacherToEdit.id);\r\n                if (subjects.length > 0) {\r\n                    const subjectInserts = subjects.map(subject => ({\r\n                        teacher_id: teacherToEdit.id,\r\n                        subject\r\n                    }));\r\n                    await supabase.from('teacher_subjects').insert(subjectInserts);\r\n                }\r\n\r\n                // 3. Update Classes (Delete all, re-insert)\r\n                await supabase.from('teacher_classes').delete().eq('teacher_id', teacherToEdit.id);\r\n                if (classes.length > 0) {\r\n                    // Normalize classes to a canonical format (e.g. `10A`) before inserting\r\n                    const normalize = (s: string) => {\r\n                        if (!s) return s;\r\n                        let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\r\n                        const m = cleaned.match(/(\\d+)([A-Z]+)/i);\r\n                        if (m) return `${parseInt(m[1], 10)}${m[2]}`;\r\n                        const m2 = cleaned.match(/(\\d+)/);\r\n                        if (m2) return `${parseInt(m2[1], 10)}`;\r\n                        return cleaned;\r\n                    };\r\n\r\n                    const normalized = Array.from(new Set(classes.map(normalize).filter(Boolean)));\r\n                    const classInserts = normalized.map(className => ({\r\n                        teacher_id: teacherToEdit.id,\r\n                        class_name: className\r\n                    }));\r\n                    await supabase.from('teacher_classes').insert(classInserts);\r\n                }\r\n\r\n                toast.success('Teacher updated successfully!');\r\n            } else {\r\n                // CREATE MODE\r\n                const teacherEmail = email || `teacher${Date.now()}@school.com`;\r\n\r\n                // 1. Create Login Credentials (Auth User) FIRST\r\n                const authResult = await createUserAccount(\r\n                    name,\r\n                    'Teacher',\r\n                    teacherEmail\r\n                );\r\n\r\n                if (authResult.error) {\r\n                    if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\r\n                        toast.error(`Teacher with email ${teacherEmail} is already registered.`);\r\n                    } else {\r\n                        toast.error('Failed to create account: ' + authResult.error);\r\n                    }\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // 2. Create User (Legacy Table)\r\n\r\n                const { data: newUserData, error: userError } = await supabase\r\n                    .from('users')\r\n                    .insert([{\r\n                        email: teacherEmail,\r\n                        name: name,\r\n                        role: 'Teacher',\r\n                        avatar_url: avatarUrl\r\n                    }])\r\n                    .select()\r\n                    .single();\r\n\r\n                if (userError) throw userError;\r\n                const userData = newUserData;\r\n\r\n                // 3. Create Teacher Profile\r\n\r\n                // Check if teacher profile also exists (unlikely in this flow, but safe to keep logic if merging)\r\n                // Since this is CREATE MODE, we assume it's fresh.\r\n\r\n                const { data: newTeacherData, error: teacherError } = await supabase\r\n                    .from('teachers')\r\n                    .insert([{\r\n                        user_id: userData.id,\r\n                        name,\r\n                        email: teacherEmail,\r\n                        phone,\r\n                        avatar_url: avatarUrl,\r\n                        status\r\n                    }])\r\n                    .select()\r\n                    .single();\r\n\r\n                if (teacherError) throw teacherError;\r\n                const teacherData = newTeacherData;\r\n\r\n                // 4. Add subjects (linked to Legacy ID)\r\n                if (subjects.length > 0) {\r\n                    const subjectInserts = subjects.map(subject => ({\r\n                        teacher_id: teacherData.id,\r\n                        subject\r\n                    }));\r\n                    await supabase.from('teacher_subjects').insert(subjectInserts);\r\n                }\r\n\r\n                // 5. Add classes (linked to Legacy ID)\r\n                if (classes.length > 0) {\r\n                    // Normalize classes to a canonical format (e.g. `10A`) before inserting\r\n                    const normalize = (s: string) => {\r\n                        if (!s) return s;\r\n                        let cleaned = s.replace(/Grade\\s*/i, '').replace(/\\s+/g, '').toUpperCase();\r\n                        const m = cleaned.match(/(\\d+)([A-Z]+)/i);\r\n                        if (m) return `${parseInt(m[1], 10)}${m[2]}`;\r\n                        const m2 = cleaned.match(/(\\d+)/);\r\n                        if (m2) return `${parseInt(m2[1], 10)}`;\r\n                        return cleaned;\r\n                    };\r\n\r\n                    const normalized = Array.from(new Set(classes.map(normalize).filter(Boolean)));\r\n                    const classInserts = normalized.map(className => ({\r\n                        teacher_id: teacherData.id,\r\n                        class_name: className\r\n                    }));\r\n                    await supabase.from('teacher_classes').insert(classInserts);\r\n                }\r\n\r\n                // 6. (Auth was already created)\r\n                console.log('Teacher credentials created successfully.');\r\n\r\n\r\n                // Send verification email\r\n                const emailResult = await sendVerificationEmail(name, teacherEmail, 'School App');\r\n                if (!emailResult.success) {\r\n                    console.warn('Warning: Email verification notification failed:', emailResult.error);\r\n                }\r\n\r\n                // Show credentials modal instead of alert\r\n                setCredentials({\r\n                    username: authResult.username,\r\n                    password: authResult.password,\r\n                    email: teacherEmail\r\n                });\r\n                setShowCredentialsModal(true);\r\n            }\r\n\r\n            // Don't call forceUpdate/handleBack here - let modal handle it\r\n        } catch (error: any) {\r\n            console.error('Error saving teacher:', error);\r\n            toast.error('Failed to save teacher: ' + (error.message || 'Unknown error'));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-50\">\r\n            <form onSubmit={handleSubmit} className=\"flex-grow flex flex-col\">\r\n                <main className=\"flex-grow p-4 space-y-6 overflow-y-auto\">\r\n                    <div className=\"flex justify-center\">\r\n                        <div className=\"relative\">\r\n                            <div className=\"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                {avatar ? <img src={avatar} alt=\"Teacher\" className=\"w-full h-full rounded-full object-cover\" /> : <UserIcon className=\"w-12 h-12 text-gray-400\" />}\r\n                            </div>\r\n                            <label htmlFor=\"photo-upload\" className=\"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\">\r\n                                <CameraIcon className=\"text-white h-4 w-4\" />\r\n                                <input id=\"photo-upload\" type=\"file\" className=\"sr-only\" accept=\"image/*\" onChange={handleImageChange} />\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"bg-white p-4 rounded-lg shadow-sm space-y-4\">\r\n                        <InputField id=\"name\" label=\"Full Name\" value={name} onChange={setName} icon={<UserIcon className=\"w-5 h-5\" />} />\r\n                        <InputField id=\"email\" label=\"Email\" value={email} onChange={setEmail} icon={<MailIcon className=\"w-5 h-5\" />} type=\"email\" />\r\n                        <InputField id=\"phone\" label=\"Phone\" value={phone} onChange={setPhone} icon={<PhoneIcon className=\"w-5 h-5\" />} type=\"tel\" />\r\n\r\n                        <TagInput\r\n                            label=\"Subjects\"\r\n                            tags={subjects}\r\n                            setTags={setSubjects}\r\n                            placeholder={loadingRefs ? \"Loading subjects...\" : \"Add subject & press Enter\"}\r\n                            validOptions={validSubjects}\r\n                            validationMessage=\"Subject not found in database. Please ask admin to add it.\"\r\n                        />\r\n                        <TagInput\r\n                            label=\"Classes\"\r\n                            tags={classes}\r\n                            setTags={setClasses}\r\n                            placeholder={loadingRefs ? \"Loading classes...\" : \"Add class (e.g., 7A) & press Enter\"}\r\n                            validOptions={validClasses}\r\n                            validationMessage=\"Class not found in database. Please ask admin to add it.\"\r\n                        />\r\n\r\n\r\n                        {/* Phase 7: Curriculum & Compliance Section */}\r\n                        <div className=\"pt-2 border-t border-gray-100\">\r\n                            <label className=\"text-sm font-medium text-gray-700 mb-2 block\">Curriculum Eligibility <span className=\"text-red-500\">*</span></label>\r\n                            <div className=\"flex gap-4 mb-4\">\r\n                                <label className={`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors ${curriculumEligibility.includes('NIGERIAN') ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={curriculumEligibility.includes('NIGERIAN')}\r\n                                        onChange={e => {\r\n                                            if (e.target.checked) setCurriculumEligibility([...curriculumEligibility, 'NIGERIAN']);\r\n                                            else setCurriculumEligibility(curriculumEligibility.filter(c => c !== 'NIGERIAN'));\r\n                                        }}\r\n                                        className=\"rounded text-green-600 focus:ring-green-500\"\r\n                                    />\r\n                                    <div>\r\n                                        <span className=\"font-semibold text-gray-800 text-sm\">Nigerian</span>\r\n                                        <p className=\"text-[10px] text-gray-500\">Requires TRCN</p>\r\n                                    </div>\r\n                                </label>\r\n\r\n                                <label className={`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-colors ${curriculumEligibility.includes('BRITISH') ? 'bg-red-50 border-red-200' : 'bg-gray-50 border-gray-200'}`}>\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        checked={curriculumEligibility.includes('BRITISH')}\r\n                                        onChange={e => {\r\n                                            if (e.target.checked) setCurriculumEligibility([...curriculumEligibility, 'BRITISH']);\r\n                                            else setCurriculumEligibility(curriculumEligibility.filter(c => c !== 'BRITISH'));\r\n                                        }}\r\n                                        className=\"rounded text-red-600 focus:ring-red-500\"\r\n                                    />\r\n                                    <div>\r\n                                        <span className=\"font-semibold text-gray-800 text-sm\">British</span>\r\n                                        <p className=\"text-[10px] text-gray-500\">Requires QTS/Intl Cert</p>\r\n                                    </div>\r\n                                </label>\r\n                            </div>\r\n\r\n                            <label className=\"text-sm font-medium text-gray-700 mb-2 block\">Compliance Documents</label>\r\n                            <div className=\"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:bg-gray-50 transition-colors cursor-pointer\">\r\n                                <UsersIcon className=\"mx-auto h-8 w-8 text-gray-400\" />\r\n                                <p className=\"mt-1 text-sm text-gray-600\">Click to upload TRCN / Certificates</p>\r\n                                <p className=\"text-xs text-gray-400 mt-1\">(PDF, JPG, PNG)</p>\r\n                                <input type=\"file\" multiple className=\"hidden\" onChange={(e) => {\r\n                                    if (e.target.files) setUploadedDocs(Array.from(e.target.files));\r\n                                    toast.success(\"Documents selected (Mock Upload)\");\r\n                                }} />\r\n                                {uploadedDocs.length > 0 && (\r\n                                    <div className=\"mt-2 text-left space-y-1\">\r\n                                        {uploadedDocs.map((file, i) => (\r\n                                            <p key={i} className=\"text-xs text-green-600 flex items-center gap-1\">\r\n                                                <CheckCircleIcon className=\"w-3 h-3\" /> {file.name}\r\n                                            </p>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label htmlFor=\"status\" className=\"block text-sm font-medium text-gray-700 mb-1\">Status</label>\r\n                            <select id=\"status\" value={status} onChange={e => setStatus(e.target.value as 'Active' | 'Inactive' | 'On Leave')} className=\"w-full p-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-700\">\r\n                                <option value=\"Active\">Active</option>\r\n                                <option value=\"On Leave\">On Leave</option>\r\n                                <option value=\"Inactive\">Inactive</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                </main>\r\n                <div className=\"p-4 mt-auto bg-gray-50\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isLoading}\r\n                        className={`w-full flex justify-center py-3 px-4 rounded-lg text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} transition-colors`}\r\n                    >\r\n                        {isLoading ? 'Saving...' : (teacherToEdit ? 'Update Teacher' : 'Save Teacher')}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n\r\n            {/* Credentials Modal */}\r\n            {credentials && (\r\n                <CredentialsModal\r\n                    isOpen={showCredentialsModal}\r\n                    userName={name}\r\n                    username={credentials.username}\r\n                    password={credentials.password}\r\n                    email={credentials.email}\r\n                    userType=\"Teacher\"\r\n                    onClose={() => {\r\n                        setShowCredentialsModal(false);\r\n                        forceUpdate();\r\n                        handleBack();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst InputField: React.FC<{ id: string, label: string, value: string, onChange: (val: string) => void, icon: React.ReactNode, type?: string }> = ({ id, label, value, onChange, icon, type = 'text' }) => (\r\n    <div>\r\n        <label htmlFor={id} className=\"text-sm font-medium text-gray-600 sr-only\">{label}</label>\r\n        <div className=\"relative\">\r\n            <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\">{icon}</span>\r\n            <input type={type} name={id} id={id} value={value} onChange={e => onChange(e.target.value)} className=\"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder={label} required />\r\n        </div>\r\n    </div>\r\n);\r\n\r\nexport default AddTeacherScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}