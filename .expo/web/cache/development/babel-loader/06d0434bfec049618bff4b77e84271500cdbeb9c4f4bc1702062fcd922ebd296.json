{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\payments\\\\PaystackWrapper.tsx\";\nimport React, { useState } from 'react';\nimport { usePaystackPayment } from 'react-paystack';\nimport { initializeTransaction, verifyTransaction } from '../../lib/payments';\nimport { supabase } from '../../lib/supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const PaystackButton = ({\n  fee,\n  email,\n  onSuccess,\n  onClose\n}) => {\n  const [loading, setLoading] = useState(false);\n  const publicKey = import.meta.env.VITE_PAYSTACK_PUBLIC_KEY;\n  const isConfigured = publicKey && publicKey !== '' && publicKey !== 'pk_test_placeholder' && publicKey !== 'your_paystack_public_key_here';\n  const hasValidEmail = email && email.trim() !== '';\n  const amountInKobo = fee.amount * 100;\n  const config = {\n    reference: `TX-${Date.now()}-${fee.id}`,\n    email: email || 'noemail@example.com',\n    amount: amountInKobo,\n    publicKey: publicKey || '',\n    metadata: {\n      custom_fields: [{\n        display_name: \"Fee Title\",\n        variable_name: \"fee_title\",\n        value: fee.title\n      }, {\n        display_name: \"Student ID\",\n        variable_name: \"student_id\",\n        value: fee.studentId.toString()\n      }]\n    }\n  };\n  const handlePaystackSuccessAction = async reference => {\n    try {\n      await verifyTransaction(reference.reference);\n      try {\n        const {\n          data: transaction\n        } = await supabase.from('transactions').select('id').eq('reference', reference.reference).single();\n        if (transaction?.id) {\n          const {\n            sendPaymentConfirmation\n          } = await import('../../lib/payment-notifications');\n          await sendPaymentConfirmation({\n            transactionId: transaction.id\n          });\n        }\n      } catch (notifError) {\n        console.error('Error sending payment notification:', notifError);\n      }\n      if (onSuccess) onSuccess();\n    } catch (e) {\n      console.error(\"Verification failed\", e);\n    }\n  };\n  const handlePaystackCloseAction = () => {\n    console.log('closed');\n    if (onClose) onClose();\n  };\n  const componentProps = Object.assign({}, config, {\n    text: 'Pay Now',\n    onSuccess: reference => handlePaystackSuccessAction(reference),\n    onClose: handlePaystackCloseAction\n  });\n  const handlePaymentClick = async () => {\n    if (!isConfigured) {\n      const toast = (await import('react-hot-toast')).toast;\n      toast.error('Paystack payment gateway not configured. Please contact administrator.');\n      console.error('Paystack public key not configured in environment variables');\n      return;\n    }\n    if (!hasValidEmail) {\n      const toast = (await import('react-hot-toast')).toast;\n      toast.error('Email is required for payment. Please update your profile.');\n      return;\n    }\n    setLoading(true);\n    await initializeTransaction(fee.id, fee.studentId, fee.amount, config.reference, 'Paystack');\n    setLoading(false);\n  };\n  const initializePayment = usePaystackPayment(config);\n  return _jsxDEV(\"button\", {\n    onClick: () => {\n      handlePaymentClick().then(() => {\n        initializePayment(handlePaystackSuccessAction, handlePaystackCloseAction);\n      });\n    },\n    disabled: loading,\n    className: \"hidden\",\n    id: `paystack-btn-${fee.id}`,\n    children: \"Pay\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 113,\n    columnNumber: 9\n  }, this);\n};","map":{"version":3,"names":["React","useState","usePaystackPayment","initializeTransaction","verifyTransaction","supabase","jsxDEV","_jsxDEV","PaystackButton","fee","email","onSuccess","onClose","loading","setLoading","publicKey","import","meta","env","VITE_PAYSTACK_PUBLIC_KEY","isConfigured","hasValidEmail","trim","amountInKobo","amount","config","reference","Date","now","id","metadata","custom_fields","display_name","variable_name","value","title","studentId","toString","handlePaystackSuccessAction","data","transaction","from","select","eq","single","sendPaymentConfirmation","transactionId","notifError","console","error","e","handlePaystackCloseAction","log","componentProps","Object","assign","text","handlePaymentClick","toast","initializePayment","onClick","then","disabled","className","children","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/payments/PaystackWrapper.tsx"],"sourcesContent":["\r\nimport React, { useState } from 'react';\r\nimport { usePaystackPayment } from 'react-paystack';\r\nimport { Fee } from '../../types';\r\nimport { initializeTransaction, verifyTransaction } from '../../lib/payments';\r\nimport { supabase } from '../../lib/supabase';\r\n\r\ninterface PaystackButtonProps {\r\n    fee: Fee;\r\n    email: string;\r\n    onSuccess?: () => void;\r\n    onClose?: () => void;\r\n}\r\n\r\nexport const PaystackButton: React.FC<PaystackButtonProps> = ({ fee, email, onSuccess, onClose }) => {\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Get Paystack public key from environment\r\n    const publicKey = import.meta.env.VITE_PAYSTACK_PUBLIC_KEY;\r\n\r\n    // Check if public key is configured\r\n    const isConfigured = publicKey && publicKey !== '' && publicKey !== 'pk_test_placeholder' && publicKey !== 'your_paystack_public_key_here';\r\n\r\n    // Check if email is valid\r\n    const hasValidEmail = email && email.trim() !== '';\r\n\r\n    const amountInKobo = fee.amount * 100; // Paystack takes amount in kobo\r\n\r\n    const config = {\r\n        reference: `TX-${Date.now()}-${fee.id}`,\r\n        email: email || 'noemail@example.com',\r\n        amount: amountInKobo,\r\n        publicKey: publicKey || '',\r\n        metadata: {\r\n            custom_fields: [\r\n                { display_name: \"Fee Title\", variable_name: \"fee_title\", value: fee.title },\r\n                { display_name: \"Student ID\", variable_name: \"student_id\", value: fee.studentId.toString() }\r\n            ]\r\n        }\r\n    };\r\n\r\n    const handlePaystackSuccessAction = async (reference: any) => {\r\n        // Implementation for whatever you want to do with reference and after success call.\r\n        try {\r\n            await verifyTransaction(reference.reference);\r\n\r\n            // Send payment confirmation notification\r\n            try {\r\n                // Fetch the transaction that was just verified\r\n                const { data: transaction } = await supabase\r\n                    .from('transactions')\r\n                    .select('id')\r\n                    .eq('reference', reference.reference)\r\n                    .single();\r\n\r\n                if (transaction?.id) {\r\n                    const { sendPaymentConfirmation } = await import('../../lib/payment-notifications');\r\n                    await sendPaymentConfirmation({ transactionId: transaction.id });\r\n                }\r\n            } catch (notifError) {\r\n                console.error('Error sending payment notification:', notifError);\r\n                // Don't fail the payment if notification fails\r\n            }\r\n\r\n            if (onSuccess) onSuccess();\r\n        } catch (e) {\r\n            console.error(\"Verification failed\", e);\r\n        }\r\n    };\r\n\r\n    const handlePaystackCloseAction = () => {\r\n        // implementation for  whatever you want to do when the Paystack dialog closed.\r\n        console.log('closed');\r\n        if (onClose) onClose();\r\n    };\r\n\r\n    const componentProps = {\r\n        ...config,\r\n        text: 'Pay Now',\r\n        onSuccess: (reference: any) => handlePaystackSuccessAction(reference),\r\n        onClose: handlePaystackCloseAction,\r\n    };\r\n\r\n    // Logic to initialize before opening modal\r\n    const handlePaymentClick = async () => {\r\n        // Validate configuration before attempting payment\r\n        if (!isConfigured) {\r\n            const toast = (await import('react-hot-toast')).toast;\r\n            toast.error('Paystack payment gateway not configured. Please contact administrator.');\r\n            console.error('Paystack public key not configured in environment variables');\r\n            return;\r\n        }\r\n\r\n        if (!hasValidEmail) {\r\n            const toast = (await import('react-hot-toast')).toast;\r\n            toast.error('Email is required for payment. Please update your profile.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        // Create Pending Transaction in DB\r\n        await initializeTransaction(fee.id, fee.studentId, fee.amount, config.reference, 'Paystack');\r\n\r\n        // We can't actually trigger the Hook manually nicely here without using the hook at top level\r\n        // So usually we just let the hook handle the click.\r\n        setLoading(false);\r\n    };\r\n\r\n    // Since usePaystackPayment returns a function found in the hook\r\n    const initializePayment = usePaystackPayment(config);\r\n\r\n    return (\r\n        <button\r\n            onClick={() => {\r\n                handlePaymentClick().then(() => {\r\n                    (initializePayment as any)(handlePaystackSuccessAction, handlePaystackCloseAction);\r\n                });\r\n            }}\r\n            disabled={loading}\r\n            className=\"hidden\" // This is a logic wrapper, actual button is in FeeCard. But wait, we need to expose this.\r\n            id={`paystack-btn-${fee.id}`}\r\n        >\r\n            Pay\r\n        </button>\r\n    );\r\n};\r\n\r\n// NOTE: In a real app, you'd likely use the hook directly in the parent or wrap this differently.\r\n// For now, I'll document that we need 'react-paystack' installed.\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}