{"ast":null,"code":"import { supabase, isSupabaseConfigured } from './supabase';\nexport const generateUsername = (fullName, userType) => {\n  const cleaned = fullName.toLowerCase().trim().replace(/\\s+/g, '.');\n  return `${userType.charAt(0).toLowerCase()}${cleaned}`;\n};\nexport const generatePassword = surname => {\n  return `${surname.toLowerCase()}1234`;\n};\nexport const createUserAccount = async (fullName, userType, email, userId) => {\n  try {\n    const nameParts = fullName.trim().split(/\\s+/);\n    const surname = nameParts[nameParts.length - 1];\n    const username = generateUsername(fullName, userType);\n    const password = generatePassword(surname);\n    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\n    const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\n    if (!supabaseUrl || !supabaseAnonKey) {\n      return {\n        username,\n        password,\n        error: 'Supabase configuration missing'\n      };\n    }\n    const {\n      createClient\n    } = await import('@supabase/supabase-js');\n    const tempClient = createClient(supabaseUrl, supabaseAnonKey, {\n      auth: {\n        persistSession: false,\n        autoRefreshToken: false,\n        detectSessionInUrl: false\n      }\n    });\n    const {\n      data: authData,\n      error: authError\n    } = await tempClient.auth.signUp({\n      email: email,\n      password: password,\n      options: {\n        emailRedirectTo: window.location.origin,\n        data: {\n          full_name: fullName,\n          user_type: userType,\n          username: username\n        }\n      }\n    });\n    if (authError) {\n      console.error('Error creating auth user:', authError);\n      return {\n        username,\n        password,\n        error: authError.message\n      };\n    }\n    const {\n      error: dbError\n    } = await supabase.from('auth_accounts').insert([{\n      username: username,\n      email: email,\n      password: password,\n      user_type: userType,\n      user_id: userId,\n      is_verified: false,\n      verification_sent_at: new Date().toISOString()\n    }]);\n    if (dbError) {\n      console.error('Error inserting into auth_accounts:', dbError);\n      console.warn('Auth created but DB save failed:', dbError.message);\n    }\n    return {\n      username,\n      password\n    };\n  } catch (err) {\n    console.error('Error in createUserAccount:', err);\n    return {\n      username: '',\n      password: '',\n      error: err.message\n    };\n  }\n};\nexport const checkEmailExists = async email => {\n  if (!isSupabaseConfigured) {\n    return {\n      inUsers: false,\n      userRow: null,\n      inAuthAccounts: false,\n      authAccountRow: null,\n      error: null\n    };\n  }\n  try {\n    const {\n      data: userRow,\n      error: userError\n    } = await supabase.from('users').select('id, email, name').eq('email', email).maybeSingle();\n    const {\n      data: authAccountRow,\n      error: authError\n    } = await supabase.from('auth_accounts').select('id, username, email, user_id').eq('email', email).maybeSingle();\n    const inUsers = !!userRow;\n    const inAuthAccounts = !!authAccountRow;\n    if (userError && userError.code !== 'PGRST116') {\n      return {\n        inUsers,\n        userRow: userRow || null,\n        inAuthAccounts,\n        authAccountRow: authAccountRow || null,\n        error: userError.message\n      };\n    }\n    if (authError && authError.code !== 'PGRST116') {\n      return {\n        inUsers,\n        userRow: userRow || null,\n        inAuthAccounts,\n        authAccountRow: authAccountRow || null,\n        error: authError.message\n      };\n    }\n    return {\n      inUsers,\n      userRow: userRow || null,\n      inAuthAccounts,\n      authAccountRow: authAccountRow || null,\n      error: null\n    };\n  } catch (err) {\n    return {\n      inUsers: false,\n      userRow: null,\n      inAuthAccounts: false,\n      authAccountRow: null,\n      error: err.message\n    };\n  }\n};\nexport const sendVerificationEmail = async (fullName, email, schoolName = 'School App') => {\n  try {\n    console.log(`Verification email automatically sent to ${email} by Supabase Auth`);\n    const {\n      error: emailLogError\n    } = await supabase.from('email_logs').insert([{\n      recipient_email: email,\n      recipient_name: fullName,\n      email_type: 'verification',\n      sent_at: new Date().toISOString(),\n      status: 'sent'\n    }]);\n    if (emailLogError) {\n      console.warn('Warning: Could not log email sending:', emailLogError);\n    }\n    return {\n      success: true\n    };\n  } catch (err) {\n    console.error('Error in sendVerificationEmail:', err);\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};\nexport const authenticateUser = async (username, password) => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.rpc('authenticate_user', {\n      username_input: username.toLowerCase(),\n      password_input: password\n    });\n    if (error) {\n      console.error('RPC Error:', error);\n      return {\n        success: false,\n        error: 'Invalid credentials'\n      };\n    }\n    if (!data || data.length === 0) {\n      return {\n        success: false,\n        error: 'Invalid credentials'\n      };\n    }\n    const user = data[0];\n    let finalUserId = user.id.toString();\n    if (user.user_id) {\n      finalUserId = user.user_id.toString();\n    }\n    return {\n      success: true,\n      userType: user.role,\n      userId: finalUserId,\n      email: user.email\n    };\n  } catch (err) {\n    console.error('Error in authenticateUser:', err);\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};\nexport const checkUsernameExists = async username => {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('auth_accounts').select('id', {\n      count: 'exact'\n    }).eq('username', username.toLowerCase()).single();\n    return !!data;\n  } catch {\n    return false;\n  }\n};\nexport const signOutUser = async () => {\n  try {\n    const {\n      error\n    } = await supabase.auth.signOut();\n    if (error) {\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n    return {\n      success: true\n    };\n  } catch (err) {\n    return {\n      success: false,\n      error: err.message\n    };\n  }\n};","map":{"version":3,"names":["supabase","isSupabaseConfigured","generateUsername","fullName","userType","cleaned","toLowerCase","trim","replace","charAt","generatePassword","surname","createUserAccount","email","userId","nameParts","split","length","username","password","supabaseUrl","import","meta","env","VITE_SUPABASE_URL","supabaseAnonKey","VITE_SUPABASE_ANON_KEY","error","createClient","tempClient","auth","persistSession","autoRefreshToken","detectSessionInUrl","data","authData","authError","signUp","options","emailRedirectTo","window","location","origin","full_name","user_type","console","message","dbError","from","insert","user_id","is_verified","verification_sent_at","Date","toISOString","warn","err","checkEmailExists","inUsers","userRow","inAuthAccounts","authAccountRow","userError","select","eq","maybeSingle","code","sendVerificationEmail","schoolName","log","emailLogError","recipient_email","recipient_name","email_type","sent_at","status","success","authenticateUser","rpc","username_input","password_input","user","finalUserId","id","toString","role","checkUsernameExists","count","single","signOutUser","signOut"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/auth.ts"],"sourcesContent":["import { supabase, isSupabaseConfigured } from './supabase';\r\nimport { emailTemplates } from './emailTemplates';\r\nimport bcrypt from 'bcryptjs';\r\n\r\n/**\r\n * Generates a username from a full name\r\n * Example: \"Adebayo Adewale\" -> \"adebayo.adewale\" or \"aadewale\"\r\n */\r\nexport const generateUsername = (fullName: string, userType: string): string => {\r\n  const cleaned = fullName.toLowerCase().trim().replace(/\\s+/g, '.');\r\n  // Optionally add user type prefix for uniqueness\r\n  return `${userType.charAt(0).toLowerCase()}${cleaned}`;\r\n};\r\n\r\n/**\r\n * Generates a password from surname\r\n * Example: \"Adewale\" -> \"adewale1234\"\r\n */\r\nexport const generatePassword = (surname: string): string => {\r\n  return `${surname.toLowerCase()}1234`;\r\n};\r\n\r\n/**\r\n * Creates a login account for a user using Supabase Authentication\r\n * Returns username and password that was created\r\n */\r\n/**\r\n * Creates a login account for a user using Supabase Authentication.\r\n * Uses a secondary client to ensure the current session (Admin) is not replaced.\r\n * Returns username and password that was created.\r\n */\r\nexport const createUserAccount = async (\r\n  fullName: string,\r\n  userType: 'Student' | 'Teacher' | 'Parent' | 'Admin' | 'Principal' | 'Counselor',\r\n  email: string,\r\n  userId?: number\r\n): Promise<{ username: string; password: string; error?: string }> => {\r\n  try {\r\n    // Extract surname (last name)\r\n    const nameParts = fullName.trim().split(/\\s+/);\r\n    const surname = nameParts[nameParts.length - 1];\r\n\r\n    // Generate username and password\r\n    const username = generateUsername(fullName, userType);\r\n    const password = generatePassword(surname);\r\n\r\n    // Create a temporary client that DOES NOT persist the session.\r\n    // This is critical so the Admin performing this action doesn't get logged out\r\n    // and switched to the new user's session.\r\n    const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;\r\n    const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;\r\n\r\n    if (!supabaseUrl || !supabaseAnonKey) {\r\n      return { username, password, error: 'Supabase configuration missing' };\r\n    }\r\n\r\n    const { createClient } = await import('@supabase/supabase-js');\r\n    const tempClient = createClient(supabaseUrl, supabaseAnonKey, {\r\n      auth: {\r\n        persistSession: false, // Don't save this session to localStorage\r\n        autoRefreshToken: false,\r\n        detectSessionInUrl: false\r\n      }\r\n    });\r\n\r\n    // 1. Create Supabase Auth user\r\n    // This sends the confirmation email automatically if \"Confirm Email\" is enabled in Supabase\r\n    const { data: authData, error: authError } = await tempClient.auth.signUp({\r\n      email: email,\r\n      password: password,\r\n      options: {\r\n        emailRedirectTo: window.location.origin, // Redirect back to app after confirmation\r\n        data: {\r\n          full_name: fullName,\r\n          user_type: userType,\r\n          username: username,\r\n        }\r\n      }\r\n    });\r\n\r\n    if (authError) {\r\n      console.error('Error creating auth user:', authError);\r\n      return { username, password, error: authError.message };\r\n    }\r\n\r\n    // 2. Insert into auth_accounts table (Legacy support / Quick Login mapping)\r\n    // We use the MAIN supabase client here because we need RLS permissions of the Admin\r\n    // (Ensure Admin has INSERT permission on auth_accounts)\r\n    const { error: dbError } = await supabase\r\n      .from('auth_accounts')\r\n      .insert([{\r\n        username: username,\r\n        email: email,\r\n        password: password, // Storing plaintext for \"Quick Login\" features (Demo only)\r\n        user_type: userType,\r\n        user_id: userId,\r\n        is_verified: false, // Wait for email confirmation\r\n        verification_sent_at: new Date().toISOString(),\r\n      }]);\r\n\r\n    if (dbError) {\r\n      console.error('Error inserting into auth_accounts:', dbError);\r\n      // We don't return error here because Auth User was created successfully\r\n      console.warn('Auth created but DB save failed:', dbError.message);\r\n    }\r\n\r\n    return { username, password };\r\n  } catch (err: any) {\r\n    console.error('Error in createUserAccount:', err);\r\n    return { username: '', password: '', error: err.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Check whether an email exists in relevant tables (`users`, `auth_accounts`).\r\n * Returns an object describing where the email was found (and the row data when available).\r\n */\r\nexport const checkEmailExists = async (email: string): Promise<{\r\n  inUsers: boolean;\r\n  userRow?: any | null;\r\n  inAuthAccounts: boolean;\r\n  authAccountRow?: any | null;\r\n  error?: string | null;\r\n}> => {\r\n  if (!isSupabaseConfigured) {\r\n    return { inUsers: false, userRow: null, inAuthAccounts: false, authAccountRow: null, error: null };\r\n  }\r\n\r\n  try {\r\n    // Query users table\r\n    const { data: userRow, error: userError } = await supabase\r\n      .from('users')\r\n      .select('id, email, name')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n\r\n    // Query auth_accounts table\r\n    const { data: authAccountRow, error: authError } = await supabase\r\n      .from('auth_accounts')\r\n      .select('id, username, email, user_id')\r\n      .eq('email', email)\r\n      .maybeSingle();\r\n\r\n    const inUsers = !!userRow;\r\n    const inAuthAccounts = !!authAccountRow;\r\n\r\n    if (userError && userError.code !== 'PGRST116') {\r\n      // Unexpected error\r\n      return { inUsers, userRow: userRow || null, inAuthAccounts, authAccountRow: authAccountRow || null, error: userError.message };\r\n    }\r\n    if (authError && authError.code !== 'PGRST116') {\r\n      return { inUsers, userRow: userRow || null, inAuthAccounts, authAccountRow: authAccountRow || null, error: authError.message };\r\n    }\r\n\r\n    return { inUsers, userRow: userRow || null, inAuthAccounts, authAccountRow: authAccountRow || null, error: null };\r\n  } catch (err: any) {\r\n    return { inUsers: false, userRow: null, inAuthAccounts: false, authAccountRow: null, error: err.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Sends a verification email to a newly created user using Supabase built-in email functionality\r\n */\r\nexport const sendVerificationEmail = async (\r\n  fullName: string,\r\n  email: string,\r\n  schoolName: string = 'School App'\r\n): Promise<{ success: boolean; error?: string }> => {\r\n  try {\r\n    // Get the confirmation link from Supabase Auth\r\n    // Note: Supabase automatically sends a confirmation email, but we can customize the content\r\n\r\n    // For now, we'll log that we attempted to send the email\r\n    // Supabase handles the actual email sending automatically when signUp is called\r\n    console.log(`Verification email automatically sent to ${email} by Supabase Auth`);\r\n\r\n    // Optionally: Store email sending attempt in database\r\n    const { error: emailLogError } = await supabase\r\n      .from('email_logs')\r\n      .insert([\r\n        {\r\n          recipient_email: email,\r\n          recipient_name: fullName,\r\n          email_type: 'verification',\r\n          sent_at: new Date().toISOString(),\r\n          status: 'sent'\r\n        }\r\n      ]);\r\n\r\n    if (emailLogError) {\r\n      console.warn('Warning: Could not log email sending:', emailLogError);\r\n      // Don't fail - email was sent by Supabase\r\n    }\r\n\r\n    return { success: true };\r\n  } catch (err: any) {\r\n    console.error('Error in sendVerificationEmail:', err);\r\n    return { success: false, error: err.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Authenticates a user with email and password using Supabase Authentication\r\n * Returns user type and user_id if successful\r\n */\r\nexport const authenticateUser = async (\r\n  username: string,\r\n  password: string\r\n): Promise<{\r\n  success: boolean;\r\n  userType?: 'Student' | 'Teacher' | 'Parent' | 'Admin' | 'Principal' | 'Counselor';\r\n  userId?: string; // We return string for compatibility, though DB gives number\r\n  email?: string;\r\n  error?: string\r\n}> => {\r\n  try {\r\n    // Call the database function to verify credentials\r\n    // This bypasses Supabase Auth email verification requirement for a smoother UX\r\n    const { data, error } = await supabase.rpc('authenticate_user', {\r\n      username_input: username.toLowerCase(),\r\n      password_input: password\r\n    });\r\n\r\n    if (error) {\r\n      console.error('RPC Error:', error);\r\n      return { success: false, error: 'Invalid credentials' };\r\n    }\r\n\r\n    // RPC returns an array (set of rows). If empty, no match.\r\n    if (!data || data.length === 0) {\r\n      return { success: false, error: 'Invalid credentials' };\r\n    }\r\n\r\n    const user = data[0];\r\n\r\n    // Handle both UUID (string) and Numeric ID (number)\r\n    // The new RPC 'authenticate_user' returns UUID 'id' (from auth.users) and 'user_id' (could be same)\r\n    // Legacy schema might use numbers. Convert safely.\r\n    let finalUserId = user.id.toString();\r\n    if (user.user_id) {\r\n      finalUserId = user.user_id.toString();\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      userType: user.role as any,\r\n      userId: finalUserId,\r\n      email: user.email,\r\n    };\r\n  } catch (err: any) {\r\n    console.error('Error in authenticateUser:', err);\r\n    return { success: false, error: err.message };\r\n  }\r\n};\r\n\r\n/**\r\n * Checks if a username already exists\r\n */\r\nexport const checkUsernameExists = async (username: string): Promise<boolean> => {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('auth_accounts')\r\n      .select('id', { count: 'exact' })\r\n      .eq('username', username.toLowerCase())\r\n      .single();\r\n\r\n    return !!data;\r\n  } catch {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Sign out the current user\r\n */\r\nexport const signOutUser = async (): Promise<{ success: boolean; error?: string }> => {\r\n  try {\r\n    const { error } = await supabase.auth.signOut();\r\n    if (error) {\r\n      return { success: false, error: error.message };\r\n    }\r\n    return { success: true };\r\n  } catch (err: any) {\r\n    return { success: false, error: err.message };\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}