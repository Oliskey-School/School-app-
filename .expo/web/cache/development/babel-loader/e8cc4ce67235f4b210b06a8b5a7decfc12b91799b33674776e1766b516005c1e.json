{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\context\\\\ProfileContext.tsx\";\nimport React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProfileContext = createContext(undefined);\nexport const ProfileProvider = ({\n  children\n}) => {\n  const [profile, setProfileState] = useState({\n    name: 'Demo User',\n    email: 'user@school.com',\n    phone: '+234 801 234 5678',\n    avatarUrl: 'https://i.pravatar.cc/150?u=user',\n    role: 'Admin'\n  });\n  const [isLoading, setIsLoading] = useState(false);\n  useEffect(() => {\n    const initProfile = async () => {\n      setIsLoading(true);\n      try {\n        const {\n          data: authData,\n          error: authError\n        } = await supabase.auth.getUser();\n        if (authData?.user?.email) {\n          const {\n            data: userData,\n            error: userError\n          } = await supabase.from('users').select('id, name, email, avatar_url, role').eq('email', authData.user.email).single();\n          if (!userError && userData) {\n            const dbProfile = {\n              id: userData.id,\n              name: userData.name || 'Demo User',\n              email: userData.email,\n              phone: profile.phone,\n              avatarUrl: userData.avatar_url || 'https://i.pravatar.cc/150?u=user',\n              role: userData.role || profile.role\n            };\n            setProfileState(dbProfile);\n            return;\n          }\n        }\n        const savedProfile = sessionStorage.getItem('userProfile');\n        if (savedProfile) {\n          try {\n            setProfileState(JSON.parse(savedProfile));\n          } catch (e) {\n            console.warn('Could not parse saved profile:', e);\n          }\n        }\n      } catch (err) {\n        console.warn('Error initializing profile from Supabase:', err);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    initProfile();\n  }, []);\n  const setProfile = useCallback(newProfile => {\n    setProfileState(newProfile);\n    sessionStorage.setItem('userProfile', JSON.stringify(newProfile));\n  }, []);\n  const loadProfileFromDatabase = useCallback(async (userId, email) => {\n    setIsLoading(true);\n    try {\n      let userData = null;\n      let error = null;\n      if (userId && !isNaN(Number(userId))) {\n        const result = await supabase.from('users').select('id, name, email, avatar_url, role').eq('id', Number(userId)).single();\n        userData = result.data;\n        error = result.error;\n      } else if (email) {\n        const result = await supabase.from('users').select('id, name, email, avatar_url, role').eq('email', email).single();\n        userData = result.data;\n        error = result.error;\n      }\n      if (!error && userData) {\n        const dbProfile = {\n          id: userData.id,\n          name: userData.name || profile.name,\n          email: userData.email,\n          phone: profile.phone,\n          avatarUrl: userData.avatar_url || profile.avatarUrl,\n          role: userData.role || profile.role\n        };\n        setProfileState(dbProfile);\n        sessionStorage.setItem('userProfile', JSON.stringify(dbProfile));\n        return dbProfile;\n      } else {\n        console.warn('Could not load profile from database:', error);\n      }\n    } catch (err) {\n      console.error('Error loading profile from database:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [profile]);\n  const updateProfile = useCallback(async updates => {\n    setIsLoading(true);\n    try {\n      const updated = Object.assign({}, profile, updates);\n      let saveSuccess = false;\n      if (updated.id && !isNaN(Number(updated.id))) {\n        const {\n          error\n        } = await supabase.from('users').update({\n          name: updated.name,\n          email: updated.email,\n          avatar_url: updated.avatarUrl\n        }).eq('id', Number(updated.id));\n        if (error) {\n          console.error('Error saving profile to Supabase:', error);\n        } else {\n          saveSuccess = true;\n          console.log('Profile saved to Supabase successfully');\n        }\n      } else if (updated.email) {\n        const {\n          error\n        } = await supabase.from('users').update({\n          name: updated.name,\n          avatar_url: updated.avatarUrl\n        }).eq('email', updated.email);\n        if (error) {\n          console.error('Error saving profile to Supabase:', error);\n        } else {\n          saveSuccess = true;\n          console.log('Profile saved to Supabase successfully');\n        }\n      }\n      if (!saveSuccess) {\n        throw new Error('Failed to save profile to Supabase');\n      }\n      setProfileState(updated);\n      sessionStorage.setItem('userProfile', JSON.stringify(updated));\n      if (updated.role) {\n        const userId = Number(updated.id);\n        const userEmail = updated.email;\n        const commonUpdates = {};\n        if (updates.name) commonUpdates.name = updates.name;\n        if (updates.avatarUrl) commonUpdates.avatar_url = updates.avatarUrl;\n        if (updates.phone && (updated.role === 'Teacher' || updated.role === 'Parent')) {\n          commonUpdates.phone = updates.phone;\n        }\n        if (Object.keys(commonUpdates).length > 0) {\n          let tableName = '';\n          if (updated.role === 'Student') tableName = 'students';\n          if (updated.role === 'Teacher') tableName = 'teachers';\n          if (updated.role === 'Parent') tableName = 'parents';\n          if (tableName) {\n            let query = supabase.from(tableName).update(commonUpdates);\n            if (!isNaN(userId)) {\n              query = query.eq('user_id', userId);\n            } else if (userEmail) {\n              if (tableName !== 'students') {\n                query = query.eq('email', userEmail);\n              } else {\n                console.warn('Cannot update student record without valid user_id');\n                return;\n              }\n            }\n            const {\n              error: roleError\n            } = await query;\n            if (roleError) {\n              console.error(`Error syncing profile to ${tableName} table:`, roleError);\n            } else {\n              console.log(`Synced profile to ${tableName} successfully`);\n            }\n          }\n        }\n      }\n    } catch (err) {\n      console.error('Error updating profile:', err);\n      throw err;\n    } finally {\n      setIsLoading(false);\n    }\n  }, [profile]);\n  const refreshProfile = useCallback(async () => {\n    setIsLoading(true);\n    try {\n      if (profile.id && !isNaN(Number(profile.id))) {\n        const {\n          data,\n          error\n        } = await supabase.from('users').select('id, name, email, avatar_url, phone, role').eq('id', Number(profile.id)).single();\n        if (!error && data) {\n          const refreshed = {\n            id: data.id,\n            name: data.name || profile.name,\n            email: data.email,\n            phone: data.phone || profile.phone,\n            avatarUrl: data.avatar_url || profile.avatarUrl,\n            role: data.role || profile.role\n          };\n          setProfileState(refreshed);\n          sessionStorage.setItem('userProfile', JSON.stringify(refreshed));\n          return;\n        }\n      } else if (profile.email) {\n        const {\n          data,\n          error\n        } = await supabase.from('users').select('id, name, email, avatar_url, phone, role').eq('email', profile.email).single();\n        if (!error && data) {\n          const refreshed = {\n            id: data.id,\n            name: data.name || profile.name,\n            email: data.email,\n            phone: profile.phone,\n            avatarUrl: data.avatar_url || profile.avatarUrl,\n            role: data.role || profile.role\n          };\n          setProfileState(refreshed);\n          sessionStorage.setItem('userProfile', JSON.stringify(refreshed));\n          return;\n        }\n      }\n      console.warn('Could not refresh profile from Supabase');\n    } catch (err) {\n      console.error('Error refreshing profile:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [profile]);\n  return _jsxDEV(ProfileContext.Provider, {\n    value: {\n      profile,\n      updateProfile,\n      refreshProfile,\n      loadProfileFromDatabase,\n      isLoading,\n      setProfile\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 304,\n    columnNumber: 5\n  }, this);\n};\nexport const useProfile = () => {\n  const context = useContext(ProfileContext);\n  if (!context) {\n    throw new Error('useProfile must be used within ProfileProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useContext","useState","useCallback","useEffect","supabase","jsxDEV","_jsxDEV","ProfileContext","undefined","ProfileProvider","children","profile","setProfileState","name","email","phone","avatarUrl","role","isLoading","setIsLoading","initProfile","data","authData","error","authError","auth","getUser","user","userData","userError","from","select","eq","single","dbProfile","id","avatar_url","savedProfile","sessionStorage","getItem","JSON","parse","e","console","warn","err","setProfile","newProfile","setItem","stringify","loadProfileFromDatabase","userId","isNaN","Number","result","updateProfile","updates","updated","Object","assign","saveSuccess","update","log","Error","userEmail","commonUpdates","keys","length","tableName","query","roleError","refreshProfile","refreshed","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","useProfile","context"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/context/ProfileContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useCallback, useEffect } from 'react';\r\nimport { supabase } from '../lib/supabase';\r\n\r\ninterface UserProfile {\r\n  id?: number | string;\r\n  name: string;\r\n  email: string;\r\n  phone: string;\r\n  avatarUrl: string;\r\n  role?: 'Student' | 'Teacher' | 'Parent' | 'Admin' | 'Proprietor' | 'Inspector' | 'Exam Officer' | 'Compliance Officer';\r\n  supabaseId?: string;\r\n}\r\n\r\ninterface ProfileContextType {\r\n  profile: UserProfile;\r\n  updateProfile: (updates: Partial<UserProfile>) => Promise<void>;\r\n  refreshProfile: () => Promise<void>;\r\n  loadProfileFromDatabase: (userId?: number | string, email?: string) => Promise<void>;\r\n  isLoading: boolean;\r\n  setProfile: (profile: UserProfile) => void;\r\n}\r\n\r\nconst ProfileContext = createContext<ProfileContextType | undefined>(undefined);\r\n\r\nexport const ProfileProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [profile, setProfileState] = useState<UserProfile>({\r\n    name: 'Demo User',\r\n    email: 'user@school.com',\r\n    phone: '+234 801 234 5678',\r\n    avatarUrl: 'https://i.pravatar.cc/150?u=user',\r\n    role: 'Admin',\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // Load profile from Supabase on mount (one time)\r\n  useEffect(() => {\r\n    const initProfile = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // Try to get the logged-in user from Supabase Auth\r\n        const { data: authData, error: authError } = await supabase.auth.getUser();\r\n        if (authData?.user?.email) {\r\n          // Fetch user profile from users table by email\r\n          const { data: userData, error: userError } = await supabase\r\n            .from('users')\r\n            .select('id, name, email, avatar_url, role')\r\n            .eq('email', authData.user.email)\r\n            .single();\r\n\r\n          if (!userError && userData) {\r\n            const dbProfile: UserProfile = {\r\n              id: userData.id,\r\n              name: userData.name || 'Demo User',\r\n              email: userData.email,\r\n              phone: profile.phone, // Keep existing or fetch if added to DB\r\n              avatarUrl: userData.avatar_url || 'https://i.pravatar.cc/150?u=user',\r\n              role: (userData.role as any) || profile.role,\r\n            };\r\n            setProfileState(dbProfile);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Fallback: load from sessionStorage if DB not available\r\n        const savedProfile = sessionStorage.getItem('userProfile');\r\n        if (savedProfile) {\r\n          try {\r\n            setProfileState(JSON.parse(savedProfile));\r\n          } catch (e) {\r\n            console.warn('Could not parse saved profile:', e);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.warn('Error initializing profile from Supabase:', err);\r\n        // Use default or sessionStorage\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    initProfile();\r\n  }, []);\r\n\r\n  const setProfile = useCallback((newProfile: UserProfile) => {\r\n    setProfileState(newProfile);\r\n    // Also cache in sessionStorage\r\n    sessionStorage.setItem('userProfile', JSON.stringify(newProfile));\r\n  }, []);\r\n\r\n  const loadProfileFromDatabase = useCallback(async (userId?: number | string, email?: string) => {\r\n    setIsLoading(true);\r\n    try {\r\n      let userData = null;\r\n      let error = null;\r\n\r\n      if (userId && !isNaN(Number(userId))) {\r\n        const result = await supabase\r\n          .from('users')\r\n          .select('id, name, email, avatar_url, role')\r\n          .eq('id', Number(userId))\r\n          .single();\r\n        userData = result.data;\r\n        error = result.error;\r\n      } else if (email) {\r\n        const result = await supabase\r\n          .from('users')\r\n          .select('id, name, email, avatar_url, role')\r\n          .eq('email', email)\r\n          .single();\r\n        userData = result.data;\r\n        error = result.error;\r\n      }\r\n\r\n      if (!error && userData) {\r\n        const dbProfile: UserProfile = {\r\n          id: userData.id,\r\n          name: userData.name || profile.name,\r\n          email: userData.email,\r\n          phone: profile.phone,\r\n          avatarUrl: userData.avatar_url || profile.avatarUrl,\r\n          role: (userData.role as any) || profile.role,\r\n        };\r\n        setProfileState(dbProfile);\r\n        sessionStorage.setItem('userProfile', JSON.stringify(dbProfile));\r\n        return dbProfile;\r\n      } else {\r\n        console.warn('Could not load profile from database:', error);\r\n      }\r\n    } catch (err) {\r\n      console.error('Error loading profile from database:', err);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [profile]);\r\n\r\n  const updateProfile = useCallback(async (updates: Partial<UserProfile>) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const updated = { ...profile, ...updates };\r\n\r\n      // Save to Supabase `users` table (PRIMARY storage)\r\n      let saveSuccess = false;\r\n\r\n      if (updated.id && !isNaN(Number(updated.id))) {\r\n        const { error } = await supabase\r\n          .from('users')\r\n          .update({\r\n            name: updated.name,\r\n            email: updated.email,\r\n            avatar_url: updated.avatarUrl\r\n            // phone removed as it is not in users table\r\n          })\r\n          .eq('id', Number(updated.id));\r\n\r\n        if (error) {\r\n          console.error('Error saving profile to Supabase:', error);\r\n        } else {\r\n          saveSuccess = true;\r\n          console.log('Profile saved to Supabase successfully');\r\n        }\r\n      } else if (updated.email) {\r\n        const { error } = await supabase\r\n          .from('users')\r\n          .update({\r\n            name: updated.name,\r\n            avatar_url: updated.avatarUrl\r\n            // phone removed as it is not in users table\r\n          })\r\n          .eq('email', updated.email);\r\n\r\n        if (error) {\r\n          console.error('Error saving profile to Supabase:', error);\r\n        } else {\r\n          saveSuccess = true;\r\n          console.log('Profile saved to Supabase successfully');\r\n        }\r\n      }\r\n\r\n      if (!saveSuccess) {\r\n        throw new Error('Failed to save profile to Supabase');\r\n      }\r\n\r\n      // Update local state and cache after successful save\r\n      setProfileState(updated);\r\n      sessionStorage.setItem('userProfile', JSON.stringify(updated));\r\n\r\n      // ---------------------------------------------------------\r\n      // SECONDARY UPDATE: Sync with Role-Specific Tables\r\n      // ---------------------------------------------------------\r\n      if (updated.role) {\r\n        const userId = Number(updated.id);\r\n        const userEmail = updated.email;\r\n\r\n        // Common fields for secondary tables\r\n        const commonUpdates: any = {};\r\n        if (updates.name) commonUpdates.name = updates.name;\r\n        if (updates.avatarUrl) commonUpdates.avatar_url = updates.avatarUrl;\r\n\r\n        // Phone is only for Teacher and Parent\r\n        if (updates.phone && (updated.role === 'Teacher' || updated.role === 'Parent')) {\r\n          commonUpdates.phone = updates.phone;\r\n        }\r\n\r\n        if (Object.keys(commonUpdates).length > 0) {\r\n          let tableName = '';\r\n          if (updated.role === 'Student') tableName = 'students';\r\n          if (updated.role === 'Teacher') tableName = 'teachers';\r\n          if (updated.role === 'Parent') tableName = 'parents';\r\n\r\n          if (tableName) {\r\n            let query = supabase.from(tableName).update(commonUpdates);\r\n\r\n            // Try to match by user_id first, fallback to email\r\n            if (!isNaN(userId)) {\r\n              query = query.eq('user_id', userId);\r\n            } else if (userEmail) {\r\n              // Students table might not have email column in some schemas, \r\n              // but Teachers/Parents do. \r\n              if (tableName !== 'students') {\r\n                query = query.eq('email', userEmail);\r\n              } else {\r\n                // For students without ID, we can't reliably update purely by email \r\n                // if the student table doesn't have an email column (it's on the user).\r\n                // Skipping update if no ID for student.\r\n                console.warn('Cannot update student record without valid user_id');\r\n                return;\r\n              }\r\n            }\r\n\r\n            const { error: roleError } = await query;\r\n            if (roleError) {\r\n              console.error(`Error syncing profile to ${tableName} table:`, roleError);\r\n              // We don't throw here to avoid breaking the UI if specific table fails,\r\n              // since primary user table succeeded.\r\n            } else {\r\n              console.log(`Synced profile to ${tableName} successfully`);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error updating profile:', err);\r\n      throw err;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [profile]);\r\n\r\n  const refreshProfile = useCallback(async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      // Fetch latest profile from Supabase\r\n      if (profile.id && !isNaN(Number(profile.id))) {\r\n        const { data, error } = await supabase\r\n          .from('users')\r\n          .select('id, name, email, avatar_url, phone, role')\r\n          .eq('id', Number(profile.id))\r\n          .single();\r\n\r\n        if (!error && data) {\r\n          const refreshed: UserProfile = {\r\n            id: data.id,\r\n            name: data.name || profile.name,\r\n            email: data.email,\r\n            phone: data.phone || profile.phone,\r\n            avatarUrl: data.avatar_url || profile.avatarUrl,\r\n            role: (data.role as any) || profile.role,\r\n          };\r\n          setProfileState(refreshed);\r\n          sessionStorage.setItem('userProfile', JSON.stringify(refreshed));\r\n          return;\r\n        }\r\n      } else if (profile.email) {\r\n        const { data, error } = await supabase\r\n          .from('users')\r\n          .select('id, name, email, avatar_url, phone, role')\r\n          .eq('email', profile.email)\r\n          .single();\r\n\r\n        if (!error && data) {\r\n          const refreshed: UserProfile = {\r\n            id: data.id,\r\n            name: data.name || profile.name,\r\n            email: data.email,\r\n            phone: profile.phone,\r\n            avatarUrl: data.avatar_url || profile.avatarUrl,\r\n            role: (data.role as any) || profile.role,\r\n          };\r\n          setProfileState(refreshed);\r\n          sessionStorage.setItem('userProfile', JSON.stringify(refreshed));\r\n          return;\r\n        }\r\n      }\r\n\r\n      console.warn('Could not refresh profile from Supabase');\r\n    } catch (err) {\r\n      console.error('Error refreshing profile:', err);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [profile]);\r\n\r\n  return (\r\n    <ProfileContext.Provider value={{ profile, updateProfile, refreshProfile, loadProfileFromDatabase, isLoading, setProfile }}>\r\n      {children}\r\n    </ProfileContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useProfile = () => {\r\n  const context = useContext(ProfileContext);\r\n  if (!context) {\r\n    throw new Error('useProfile must be used within ProfileProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}