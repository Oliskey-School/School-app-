{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\teacher\\\\LessonPlannerScreen.tsx\";\nimport React, { useState, useCallback, useMemo, useEffect } from 'react';\nimport { getAIClient, SchemaType as Type } from '../../lib/ai';\nimport { toast } from 'react-hot-toast';\nimport { supabase } from '../../lib/supabase';\nimport { SparklesIcon, TrashIcon, PlusIcon, XCircleIcon } from '../../constants';\nconst HistoryIcon = ({\n  className\n}) => _jsxDEV(\"svg\", {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  className: `h - 6 w - 6 ${className || ''} `.trim(),\n  viewBox: \"0 0 24 24\",\n  strokeWidth: \"1.5\",\n  stroke: \"currentColor\",\n  fill: \"none\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  children: [_jsxDEV(\"path\", {\n    stroke: \"none\",\n    d: \"M0 0h24v24H0z\",\n    fill: \"none\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 274\n  }, this), _jsxDEV(\"path\", {\n    d: \"M12 8l0 4l2 2\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 326\n  }, this), _jsxDEV(\"path\", {\n    d: \"M3.05 11a9 9 0 1 1 .5 4m-3.55 -4a9 9 0 0 1 12.5 -5\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 352\n  }, this), _jsxDEV(\"path\", {\n    d: \"M3 4v4h4\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 10,\n    columnNumber: 415\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 10,\n  columnNumber: 64\n}, this);\nconst FolderIcon = ({\n  className\n}) => _jsxDEV(\"svg\", {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  className: `h - 6 w - 6 ${className || ''} `.trim(),\n  viewBox: \"0 0 24 24\",\n  strokeWidth: \"1.5\",\n  stroke: \"currentColor\",\n  fill: \"none\",\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\",\n  children: [_jsxDEV(\"path\", {\n    stroke: \"none\",\n    d: \"M0 0h24v24H0z\",\n    fill: \"none\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 11,\n    columnNumber: 273\n  }, this), _jsxDEV(\"path\", {\n    d: \"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 11,\n    columnNumber: 325\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 11,\n  columnNumber: 63\n}, this);\nimport { AILoadingOverlay } from '../ui/AILoadingOverlay';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SchemeInput = ({\n  scheme,\n  setScheme\n}) => {\n  const handleTopicChange = (weekIndex, value) => {\n    const newScheme = [...scheme];\n    newScheme[weekIndex].topic = value;\n    setScheme(newScheme);\n  };\n  const handleSubTopicChange = (weekIndex, subTopicIndex, value) => {\n    const newScheme = [...scheme];\n    newScheme[weekIndex].subTopics[subTopicIndex] = value;\n    setScheme(newScheme);\n  };\n  const addSubTopic = weekIndex => {\n    const newScheme = [...scheme];\n    newScheme[weekIndex].subTopics.push('');\n    setScheme(newScheme);\n  };\n  const removeSubTopic = (weekIndex, subTopicIndex) => {\n    const newScheme = [...scheme];\n    newScheme[weekIndex].subTopics.splice(subTopicIndex, 1);\n    setScheme(newScheme);\n  };\n  const addWeek = () => {\n    const newWeek = scheme.length > 0 ? Math.max(...scheme.map(s => s.week)) + 1 : 1;\n    setScheme([...scheme, {\n      week: newWeek,\n      topic: '',\n      subTopics: []\n    }]);\n  };\n  const removeWeek = indexToRemove => {\n    setScheme(scheme.filter((_, index) => index !== indexToRemove));\n  };\n  return _jsxDEV(\"div\", {\n    className: \"space-y-3\",\n    children: [scheme.map((entry, weekIndex) => _jsxDEV(\"div\", {\n      className: \"bg-gray-50/70 p-3 rounded-lg border border-gray-200\",\n      children: [_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2\",\n        children: [_jsxDEV(\"span\", {\n          className: \"font-bold text-gray-800\",\n          children: [entry.week, \".\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 25\n        }, this), _jsxDEV(\"input\", {\n          type: \"text\",\n          value: entry.topic,\n          onChange: e => handleTopicChange(weekIndex, e.target.value),\n          placeholder: \"Main Topic for the Week\",\n          className: \"w-full p-2 font-semibold border text-gray-800 bg-white border-gray-300 rounded-md focus:ring-1 focus:ring-gray-500\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 25\n        }, this), _jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: () => removeWeek(weekIndex),\n          className: \"p-1 text-gray-400 hover:text-red-500\",\n          \"aria-label\": `Remove Week ${entry.week} `,\n          children: _jsxDEV(TrashIcon, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 60,\n            columnNumber: 176\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 21\n      }, this), _jsxDEV(\"div\", {\n        className: \"pl-8 mt-2 space-y-2\",\n        children: [entry.subTopics.map((subTopic, subIndex) => _jsxDEV(\"div\", {\n          className: \"flex items-center gap-2\",\n          children: [_jsxDEV(\"span\", {\n            className: \"text-gray-400\",\n            children: \"-\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 33\n          }, this), _jsxDEV(\"input\", {\n            type: \"text\",\n            value: subTopic,\n            onChange: e => handleSubTopicChange(weekIndex, subIndex, e.target.value),\n            placeholder: \"Add a sub-topic or learning objective\",\n            className: \"w-full p-1.5 text-sm border bg-white text-gray-800 border-gray-300 rounded-md focus:ring-1 focus:ring-gray-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 66,\n            columnNumber: 33\n          }, this), _jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => removeSubTopic(weekIndex, subIndex),\n            className: \"p-1 text-gray-400 hover:text-red-500\",\n            \"aria-label\": `Remove sub - topic`,\n            children: _jsxDEV(XCircleIcon, {\n              className: \"w-5 h-5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 67,\n              columnNumber: 190\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 67,\n            columnNumber: 33\n          }, this)]\n        }, subIndex, true, {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 29\n        }, this)), _jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: () => addSubTopic(weekIndex),\n          className: \"flex items-center space-x-1 py-1 px-2 text-xs font-semibold text-gray-800 bg-gray-200 rounded-md hover:bg-gray-300\",\n          children: [_jsxDEV(PlusIcon, {\n            className: \"w-4 h-4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 213\n          }, this), _jsxDEV(\"span\", {\n            children: \"Add Sub-Topic\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 245\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 21\n      }, this)]\n    }, entry.week, true, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 17\n    }, this)), _jsxDEV(\"button\", {\n      type: \"button\",\n      onClick: addWeek,\n      className: \"mt-2 w-full flex items-center justify-center space-x-1 py-2 text-sm font-semibold text-gray-800 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-100 hover:border-gray-400\",\n      children: [_jsxDEV(PlusIcon, {\n        className: \"w-4 h-4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 251\n      }, this), _jsxDEV(\"span\", {\n        children: \"Add Week\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 283\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 9\n  }, this);\n};\nconst HistoryModal = ({\n  isOpen,\n  onClose,\n  history,\n  onLoad,\n  onClear\n}) => {\n  if (!isOpen) return null;\n  return _jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in\",\n    children: _jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[80vh] flex flex-col\",\n      children: [_jsxDEV(\"div\", {\n        className: \"p-4 border-b flex justify-between items-center\",\n        children: [_jsxDEV(\"h3\", {\n          className: \"text-lg font-bold text-gray-800\",\n          children: \"Load Scheme of Work\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 21\n        }, this), _jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"text-gray-400 hover:text-gray-600\",\n          children: _jsxDEV(XCircleIcon, {\n            className: \"w-7 h-7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 93\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"flex-grow p-4 space-y-2 overflow-y-auto\",\n        children: history.length > 0 ? history.map((entry, idx) => _jsxDEV(\"div\", {\n          className: \"p-3 bg-gray-50 rounded-lg flex items-center justify-between\",\n          children: [_jsxDEV(\"div\", {\n            children: [_jsxDEV(\"p\", {\n              className: \"font-bold text-gray-800\",\n              children: entry.subject\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 33\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-sm text-gray-600\",\n              children: entry.className\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 33\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-xs text-gray-400 mt-1\",\n              children: [\"Last saved: \", new Date(entry.lastUpdated).toLocaleString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 95,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 92,\n            columnNumber: 29\n          }, this), _jsxDEV(\"button\", {\n            onClick: () => onLoad(entry),\n            className: \"px-3 py-1.5 text-sm font-semibold bg-gray-800 text-white rounded-lg hover:bg-gray-900\",\n            children: \"Load\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 29\n          }, this)]\n        }, idx, true, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 25\n        }, this)) : _jsxDEV(\"p\", {\n          className: \"text-center text-gray-500 py-8\",\n          children: \"No saved history.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 26\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 9\n  }, this);\n};\nconst GeneratedHistoryModal = ({\n  isOpen,\n  onClose,\n  history,\n  onLoad,\n  onClear\n}) => {\n  if (!isOpen) return null;\n  return _jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in\",\n    children: _jsxDEV(\"div\", {\n      className: \"bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[80vh] flex flex-col\",\n      children: [_jsxDEV(\"div\", {\n        className: \"p-4 border-b flex justify-between items-center\",\n        children: [_jsxDEV(\"h3\", {\n          className: \"text-lg font-bold text-gray-800\",\n          children: \"Load Generated Plan\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 21\n        }, this), _jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"text-gray-400 hover:text-gray-600\",\n          children: _jsxDEV(XCircleIcon, {\n            className: \"w-7 h-7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 93\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"flex-grow p-4 space-y-2 overflow-y-auto\",\n        children: history.length > 0 ? history.map((entry, idx) => _jsxDEV(\"div\", {\n          className: \"p-3 bg-gray-50 rounded-lg flex items-center justify-between\",\n          children: [_jsxDEV(\"div\", {\n            children: [_jsxDEV(\"p\", {\n              className: \"font-bold text-gray-800\",\n              children: entry.subject\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 33\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-sm text-gray-600\",\n              children: entry.className\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 121,\n              columnNumber: 33\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-xs text-gray-400 mt-1\",\n              children: [\"Generated: \", new Date(entry.lastUpdated).toLocaleString()]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 122,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 119,\n            columnNumber: 29\n          }, this), _jsxDEV(\"button\", {\n            onClick: () => onLoad(entry),\n            className: \"px-3 py-1.5 text-sm font-semibold bg-purple-600 text-white rounded-lg hover:bg-purple-700\",\n            children: \"View\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 29\n          }, this)]\n        }, idx, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 25\n        }, this)) : _jsxDEV(\"p\", {\n          className: \"text-center text-gray-500 py-8\",\n          children: \"No saved generated plans.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 26\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 9\n  }, this);\n};\nconst LessonPlannerScreen = ({\n  navigateTo,\n  teacherId\n}) => {\n  const [subject, setSubject] = useState('');\n  const [className, setClassName] = useState('');\n  const [term1Scheme, setTerm1Scheme] = useState([]);\n  const [term2Scheme, setTerm2Scheme] = useState([]);\n  const [term3Scheme, setTerm3Scheme] = useState([]);\n  const [activeTerm, setActiveTerm] = useState('term1');\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [schemeHistory, setSchemeHistory] = useState([]);\n  const [generatedHistory, setGeneratedHistory] = useState([]);\n  const [isSchemeHistoryOpen, setIsSchemeHistoryOpen] = useState(false);\n  const [isGeneratedHistoryOpen, setIsGeneratedHistoryOpen] = useState(false);\n  const [toastMessage, setToastMessage] = useState('');\n  const effectiveTeacherId = teacherId || 2;\n  const fetchHistory = useCallback(async () => {\n    const {\n      data,\n      error\n    } = await supabase.from('generated_resources').select('*').eq('teacher_id', effectiveTeacherId).order('updated_at', {\n      ascending: false\n    });\n    if (error) {\n      console.error(\"Error fetching history:\", error);\n      return;\n    }\n    if (data) {\n      const schemes = data.filter(row => row.scheme_content).map(row => ({\n        subject: row.subject,\n        className: row.class_name,\n        term1Scheme: row.scheme_content.term1 || [],\n        term2Scheme: row.scheme_content.term2 || [],\n        term3Scheme: row.scheme_content.term3 || [],\n        lastUpdated: row.updated_at\n      }));\n      setSchemeHistory(schemes);\n      const generated = data.filter(row => row.lesson_plans_content).map(row => ({\n        subject: row.subject,\n        className: row.class_name,\n        lastUpdated: row.updated_at,\n        resources: row.lesson_plans_content\n      }));\n      setGeneratedHistory(generated);\n    }\n  }, [effectiveTeacherId]);\n  useEffect(() => {\n    fetchHistory();\n  }, [fetchHistory]);\n  const hasSchemeContent = useMemo(() => {\n    const checkScheme = scheme => scheme.some(week => week.topic.trim() !== '');\n    return checkScheme(term1Scheme) || checkScheme(term2Scheme) || checkScheme(term3Scheme);\n  }, [term1Scheme, term2Scheme, term3Scheme]);\n  const handleSaveScheme = useCallback(async () => {\n    if (!subject.trim() || !className.trim()) {\n      setToastMessage('Please enter Subject and Class Name to save.');\n      return;\n    }\n    const schemeData = {\n      term1: term1Scheme,\n      term2: term2Scheme,\n      term3: term3Scheme\n    };\n    const {\n      data: existing\n    } = await supabase.from('generated_resources').select('id').eq('teacher_id', effectiveTeacherId).eq('subject', subject).eq('class_name', className).maybeSingle();\n    let error;\n    if (existing) {\n      const {\n        error: updateError\n      } = await supabase.from('generated_resources').update({\n        scheme_content: schemeData,\n        updated_at: new Date().toISOString()\n      }).eq('id', existing.id);\n      error = updateError;\n    } else {\n      const {\n        error: insertError\n      } = await supabase.from('generated_resources').insert([{\n        teacher_id: effectiveTeacherId,\n        subject,\n        class_name: className,\n        term: 'All',\n        scheme_content: schemeData\n      }]);\n      error = insertError;\n    }\n    if (error) {\n      console.error(\"Error saving scheme:\", error);\n      toast.error('Failed to save scheme.');\n    } else {\n      toast.success('Scheme of work saved to database!');\n      fetchHistory();\n    }\n  }, [subject, className, term1Scheme, term2Scheme, term3Scheme, effectiveTeacherId, fetchHistory]);\n  const handleLoadFromSchemeHistory = useCallback(entry => {\n    setSubject(entry.subject);\n    setClassName(entry.className);\n    setTerm1Scheme(entry.term1Scheme);\n    setTerm2Scheme(entry.term2Scheme);\n    setTerm3Scheme(entry.term3Scheme);\n    setIsSchemeHistoryOpen(false);\n    toast.success(`Loaded scheme for ${entry.subject} - ${entry.className}.`);\n  }, []);\n  const handleClearSchemeHistory = useCallback(() => {\n    toast.error(\"Deleting all history is disabled in connected mode. You can overwrite entries by saving.\");\n  }, []);\n  const handleLoadFromGeneratedHistory = useCallback(entry => {\n    setIsGeneratedHistoryOpen(false);\n    navigateTo('lessonPlanDetail', `AI Plan: ${entry.subject} `, {\n      resources: entry.resources\n    });\n  }, [navigateTo]);\n  const handleClearGeneratedHistory = useCallback(() => {\n    toast.error(\"Deleting all history is disabled in connected mode.\");\n  }, []);\n  const schemes = {\n    term1: term1Scheme,\n    term2: term2Scheme,\n    term3: term3Scheme\n  };\n  const currentScheme = schemes[activeTerm];\n  const setCurrentScheme = {\n    term1: setTerm1Scheme,\n    term2: setTerm2Scheme,\n    term3: setTerm3Scheme\n  }[activeTerm];\n  const handleGenerate = async () => {\n    if (!subject.trim() || !className.trim() || !hasSchemeContent) {\n      toast.error(\"Please provide a subject, class name, and at least one topic in a term's scheme of work.\");\n      return;\n    }\n    setIsGenerating(true);\n    try {\n      const prompt = `As an expert curriculum designer for the Nigerian school system, generate a comprehensive lesson plan resource.\n            \n            Subject: ${subject}\n            Class: ${className}\n            \n            Here are the schemes of work provided by the user:\n            - First Term: ${JSON.stringify(term1Scheme)}\n            - Second Term: ${JSON.stringify(term2Scheme)}\n            - Third Term: ${JSON.stringify(term3Scheme)}\n\n            Task:\n            1. Analyze the topics provided for each term.\n            2. For each week in the scheme, generate:\n               - Specific Learning Objectives (at least 2-3)\n               - Recommended Teaching Resources (books, materials, digital tools)\n               - A brief Lesson Note guide.\n            3. If a term has no user-provided topics, suggest a standard curriculum for that term based on the Subject and Class level.\n\n            Output Format:\n            Return a JSON object with the following structure:\n            {\n                \"subject\": \"${subject}\",\n                \"className\": \"${className}\",\n                \"terms\": [\n                    {\n                        \"term\": \"First Term\",\n                        \"weeks\": [\n                            { \"week\": 1, \"topic\": \"...\", \"learningObjectives\": [\"...\"], \"resources\": [\"...\"] }\n                        ]\n                    },\n                    { \"term\": \"Second Term\", \"weeks\": [] },\n                    { \"term\": \"Third Term\", \"weeks\": [] }\n                ]\n            }`;\n      const ai = getAIClient(import.meta.env.VITE_GEMINI_API_KEY || '');\n      const history = [{\n        role: 'user',\n        parts: [{\n          text: 'You are an expert curriculum designer for the Nigerian school system.'\n        }]\n      }, {\n        role: 'model',\n        parts: [{\n          text: 'I am ready to help design the curriculum.'\n        }]\n      }, {\n        role: 'user',\n        parts: [{\n          text: prompt\n        }]\n      }];\n      const response = await ai.models.generateContent({\n        contents: history,\n        generationConfig: {\n          temperature: 0.7,\n          responseMimeType: \"application/json\",\n          responseSchema: {\n            type: Type.OBJECT,\n            properties: {\n              subject: {\n                type: Type.STRING\n              },\n              className: {\n                type: Type.STRING\n              },\n              terms: {\n                type: Type.ARRAY,\n                items: {\n                  type: Type.OBJECT,\n                  properties: {\n                    term: {\n                      type: Type.STRING\n                    },\n                    weeks: {\n                      type: Type.ARRAY,\n                      items: {\n                        type: Type.OBJECT,\n                        properties: {\n                          week: {\n                            type: Type.INTEGER\n                          },\n                          topic: {\n                            type: Type.STRING\n                          },\n                          learningObjectives: {\n                            type: Type.ARRAY,\n                            items: {\n                              type: Type.STRING\n                            }\n                          },\n                          resources: {\n                            type: Type.ARRAY,\n                            items: {\n                              type: Type.STRING\n                            }\n                          }\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      });\n      if (!response.text) throw new Error('No content returned from AI');\n      let raw = response.text;\n      if (!raw || raw.trim().startsWith('Error') || raw.trim().startsWith(\"I'm sorry\") || raw.trim().startsWith(\"I cannot\")) {\n        throw new Error(raw || \"AI returned an error message instead of content.\");\n      }\n      raw = raw.replace(/^```json/i, '').replace(/^```/, '').replace(/```$/, '').trim();\n      let resources;\n      try {\n        resources = JSON.parse(raw);\n      } catch (jsonError) {\n        console.error(\"AI JSON Parse Error. Raw output:\", raw);\n        throw new Error(\"The AI generated an invalid format. Please try again.\");\n      }\n      if (!resources || !resources.terms) {\n        throw new Error(\"AI returned a response, but it was empty or missing terms data.\");\n      }\n      resources.terms = resources.terms.map(term => {\n        let relevantScheme = [];\n        if (term.term?.toLowerCase().includes('first') || term.term?.includes('Term 1')) relevantScheme = term1Scheme;else if (term.term?.toLowerCase().includes('second') || term.term?.includes('Term 2')) relevantScheme = term2Scheme;else if (term.term?.toLowerCase().includes('third') || term.term?.includes('Term 3')) relevantScheme = term3Scheme;\n        if (relevantScheme.length === 0 && resources.terms.length === 1) {\n          if (activeTerm === 'term1') relevantScheme = term1Scheme;\n          if (activeTerm === 'term2') relevantScheme = term2Scheme;\n          if (activeTerm === 'term3') relevantScheme = term3Scheme;\n        }\n        return Object.assign({}, term, {\n          schemeOfWork: relevantScheme\n        });\n      });\n      const {\n        data: existing\n      } = await supabase.from('generated_resources').select('id').eq('teacher_id', effectiveTeacherId).eq('subject', resources.subject || subject).eq('class_name', resources.className || className).maybeSingle();\n      if (existing) {\n        await supabase.from('generated_resources').update({\n          lesson_plans_content: resources,\n          updated_at: new Date().toISOString()\n        }).eq('id', existing.id);\n      } else {\n        await supabase.from('generated_resources').insert([{\n          teacher_id: effectiveTeacherId,\n          subject: resources.subject || subject,\n          class_name: resources.className || className,\n          term: 'All',\n          lesson_plans_content: resources\n        }]);\n      }\n      fetchHistory();\n      navigateTo('lessonPlanDetail', `AI Plan: ${subject}`, {\n        resources\n      });\n    } catch (error) {\n      console.error(\"AI Generation Error:\", error);\n      const msg = error.message || '';\n      toast.error(`AI Connection Failed. Details:\\n${msg}`);\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-100 relative\",\n    children: [_jsxDEV(AILoadingOverlay, {\n      isVisible: isGenerating\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 453,\n      columnNumber: 13\n    }, this), _jsxDEV(\"main\", {\n      className: \"flex-grow p-4 space-y-5 overflow-y-auto pb-24\",\n      children: [_jsxDEV(\"div\", {\n        className: \"bg-gray-100 p-4 rounded-xl text-center border border-gray-200\",\n        children: [_jsxDEV(SparklesIcon, {\n          className: \"h-10 w-10 mx-auto text-gray-500 mb-2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 21\n        }, this), _jsxDEV(\"h3\", {\n          className: \"font-bold text-lg text-gray-800\",\n          children: \"AI Curriculum Co-Pilot\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 21\n        }, this), _jsxDEV(\"p\", {\n          className: \"text-sm text-gray-700\",\n          children: \"Input your termly topics and let AI build resources for your entire academic year.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 458,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"bg-white p-4 rounded-xl shadow-sm space-y-4\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [_jsxDEV(\"div\", {\n            className: \"flex-grow\",\n            children: [_jsxDEV(\"label\", {\n              htmlFor: \"subject\",\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"Subject\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 464,\n              columnNumber: 29\n            }, this), _jsxDEV(\"input\", {\n              id: \"subject\",\n              type: \"text\",\n              value: subject,\n              onChange: e => setSubject(e.target.value),\n              required: true,\n              className: \"w-full p-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 465,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"flex-grow\",\n            children: [_jsxDEV(\"label\", {\n              htmlFor: \"className\",\n              className: \"block text-sm font-medium text-gray-700 mb-1\",\n              children: \"Class Name\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 468,\n              columnNumber: 29\n            }, this), _jsxDEV(\"input\", {\n              id: \"className\",\n              type: \"text\",\n              value: className,\n              onChange: e => setClassName(e.target.value),\n              required: true,\n              className: \"w-full p-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 469,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 467,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 462,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"grid grid-cols-2 gap-3\",\n          children: [_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setIsSchemeHistoryOpen(true),\n            className: \"w-full flex items-center justify-center space-x-2 py-2 text-sm font-semibold text-gray-700 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-100 hover:border-gray-400\",\n            children: [_jsxDEV(HistoryIcon, {\n              className: \"w-4 h-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 29\n            }, this), _jsxDEV(\"span\", {\n              children: \"Load Scheme\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 475,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 473,\n            columnNumber: 25\n          }, this), _jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setIsGeneratedHistoryOpen(true),\n            className: \"w-full flex items-center justify-center space-x-2 py-2 text-sm font-semibold text-purple-700 border-2 border-dashed border-purple-300 rounded-lg hover:bg-purple-50 hover:border-purple-400\",\n            children: [_jsxDEV(FolderIcon, {\n              className: \"w-4 h-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 478,\n              columnNumber: 29\n            }, this), _jsxDEV(\"span\", {\n              children: \"Saved Plans\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 479,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"bg-white p-4 rounded-xl shadow-sm\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex space-x-1 bg-gray-200 p-1 rounded-lg mb-4\",\n          children: [_jsxDEV(\"button\", {\n            onClick: () => setActiveTerm('term1'),\n            className: `w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term1' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`,\n            children: \"First Term\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 486,\n            columnNumber: 25\n          }, this), _jsxDEV(\"button\", {\n            onClick: () => setActiveTerm('term2'),\n            className: `w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term2' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`,\n            children: \"Second Term\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 25\n          }, this), _jsxDEV(\"button\", {\n            onClick: () => setActiveTerm('term3'),\n            className: `w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term3' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`,\n            children: \"Third Term\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 488,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 485,\n          columnNumber: 21\n        }, this), _jsxDEV(SchemeInput, {\n          scheme: currentScheme,\n          setScheme: setCurrentScheme\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 490,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 13\n    }, this), _jsxDEV(\"footer\", {\n      className: \"p-4 bg-white/80 backdrop-blur-sm border-t border-gray-200 grid grid-cols-2 gap-3 sticky bottom-0\",\n      children: [_jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: handleSaveScheme,\n        className: \"w-full py-3 px-4 font-medium text-gray-800 bg-gray-200 rounded-lg shadow-sm hover:bg-gray-300\",\n        children: \"Save Scheme\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 495,\n        columnNumber: 17\n      }, this), _jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: handleGenerate,\n        disabled: isGenerating || !subject.trim() || !className.trim() || !hasSchemeContent,\n        className: \"w-full flex justify-center items-center space-x-2 py-3 px-4 font-medium text-white bg-gray-800 hover:bg-gray-900 disabled:bg-gray-400\",\n        children: [_jsxDEV(SparklesIcon, {\n          className: \"h-5 h-5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 21\n        }, this), _jsxDEV(\"span\", {\n          children: \"Generate Resources\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 501,\n          columnNumber: 57\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 496,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 494,\n      columnNumber: 13\n    }, this), _jsxDEV(HistoryModal, {\n      isOpen: isSchemeHistoryOpen,\n      onClose: () => setIsSchemeHistoryOpen(false),\n      history: schemeHistory,\n      onLoad: handleLoadFromSchemeHistory,\n      onClear: handleClearSchemeHistory\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 505,\n      columnNumber: 13\n    }, this), _jsxDEV(GeneratedHistoryModal, {\n      isOpen: isGeneratedHistoryOpen,\n      onClose: () => setIsGeneratedHistoryOpen(false),\n      history: generatedHistory,\n      onLoad: handleLoadFromGeneratedHistory,\n      onClear: handleClearGeneratedHistory\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 506,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 451,\n    columnNumber: 9\n  }, this);\n};\nexport default LessonPlannerScreen;","map":{"version":3,"names":["React","useState","useCallback","useMemo","useEffect","getAIClient","SchemaType","Type","toast","supabase","SparklesIcon","TrashIcon","PlusIcon","XCircleIcon","HistoryIcon","className","_jsxDEV","xmlns","trim","viewBox","strokeWidth","stroke","fill","strokeLinecap","strokeLinejoin","children","d","fileName","_jsxFileName","lineNumber","columnNumber","FolderIcon","AILoadingOverlay","jsxDEV","SchemeInput","scheme","setScheme","handleTopicChange","weekIndex","value","newScheme","topic","handleSubTopicChange","subTopicIndex","subTopics","addSubTopic","push","removeSubTopic","splice","addWeek","newWeek","length","Math","max","map","s","week","removeWeek","indexToRemove","filter","_","index","entry","type","onChange","e","target","placeholder","onClick","subTopic","subIndex","HistoryModal","isOpen","onClose","history","onLoad","onClear","idx","subject","Date","lastUpdated","toLocaleString","GeneratedHistoryModal","LessonPlannerScreen","navigateTo","teacherId","setSubject","setClassName","term1Scheme","setTerm1Scheme","term2Scheme","setTerm2Scheme","term3Scheme","setTerm3Scheme","activeTerm","setActiveTerm","isGenerating","setIsGenerating","schemeHistory","setSchemeHistory","generatedHistory","setGeneratedHistory","isSchemeHistoryOpen","setIsSchemeHistoryOpen","isGeneratedHistoryOpen","setIsGeneratedHistoryOpen","toastMessage","setToastMessage","effectiveTeacherId","fetchHistory","data","error","from","select","eq","order","ascending","console","schemes","row","scheme_content","class_name","term1","term2","term3","updated_at","generated","lesson_plans_content","resources","hasSchemeContent","checkScheme","some","handleSaveScheme","schemeData","existing","maybeSingle","updateError","update","toISOString","id","insertError","insert","teacher_id","term","success","handleLoadFromSchemeHistory","handleClearSchemeHistory","handleLoadFromGeneratedHistory","handleClearGeneratedHistory","currentScheme","setCurrentScheme","handleGenerate","prompt","JSON","stringify","ai","import","meta","env","VITE_GEMINI_API_KEY","role","parts","text","response","models","generateContent","contents","generationConfig","temperature","responseMimeType","responseSchema","OBJECT","properties","STRING","terms","ARRAY","items","weeks","INTEGER","learningObjectives","Error","raw","startsWith","replace","parse","jsonError","relevantScheme","toLowerCase","includes","Object","assign","schemeOfWork","msg","message","isVisible","htmlFor","required","disabled"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/teacher/LessonPlannerScreen.tsx"],"sourcesContent":["import React, { useState, useCallback, useMemo, useEffect } from 'react';\r\n// import { GoogleGenAI, Type } from \"@google/genai\"; // Removed in favor of lib/ai\r\nimport { getAIClient, AI_MODEL_NAME, AI_GENERATION_CONFIG, SchemaType as Type } from '../../lib/ai';\r\nimport { toast } from 'react-hot-toast';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { GeneratedResources, SchemeWeek, SavedScheme, HistoryEntry, GeneratedHistoryEntry } from '../../types';\r\nimport { AIIcon, SparklesIcon, TrashIcon, PlusIcon, XCircleIcon, CheckCircleIcon } from '../../constants';\r\n\r\nconst HistoryIcon = ({ className }: { className?: string }) => <svg xmlns=\"http://www.w3.org/2000/svg\" className={`h - 6 w - 6 ${className || ''} `.trim()} viewBox=\"0 0 24 24\" strokeWidth=\"1.5\" stroke=\"currentColor\" fill=\"none\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M12 8l0 4l2 2\" /><path d=\"M3.05 11a9 9 0 1 1 .5 4m-3.55 -4a9 9 0 0 1 12.5 -5\" /><path d=\"M3 4v4h4\" /></svg>;\r\nconst FolderIcon = ({ className }: { className?: string }) => <svg xmlns=\"http://www.w3.org/2000/svg\" className={`h - 6 w - 6 ${className || ''} `.trim()} viewBox=\"0 0 24 24\" strokeWidth=\"1.5\" stroke=\"currentColor\" fill=\"none\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path stroke=\"none\" d=\"M0 0h24v24H0z\" fill=\"none\" /><path d=\"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2\" /></svg>;\r\n\r\n\r\n// --- SUB-COMPONENTS ---\r\nimport { AILoadingOverlay } from '../ui/AILoadingOverlay';\r\n\r\n// GeneratingScreen removed in favor of AILoadingOverlay\r\n\r\nconst SchemeInput: React.FC<{ scheme: SchemeWeek[]; setScheme: React.Dispatch<React.SetStateAction<SchemeWeek[]>> }> = ({ scheme, setScheme }) => {\r\n    const handleTopicChange = (weekIndex: number, value: string) => {\r\n        const newScheme = [...scheme];\r\n        newScheme[weekIndex].topic = value;\r\n        setScheme(newScheme);\r\n    };\r\n\r\n    const handleSubTopicChange = (weekIndex: number, subTopicIndex: number, value: string) => {\r\n        const newScheme = [...scheme];\r\n        newScheme[weekIndex].subTopics[subTopicIndex] = value;\r\n        setScheme(newScheme);\r\n    };\r\n\r\n    const addSubTopic = (weekIndex: number) => {\r\n        const newScheme = [...scheme];\r\n        newScheme[weekIndex].subTopics.push('');\r\n        setScheme(newScheme);\r\n    };\r\n\r\n    const removeSubTopic = (weekIndex: number, subTopicIndex: number) => {\r\n        const newScheme = [...scheme];\r\n        newScheme[weekIndex].subTopics.splice(subTopicIndex, 1);\r\n        setScheme(newScheme);\r\n    };\r\n\r\n    const addWeek = () => {\r\n        const newWeek = scheme.length > 0 ? Math.max(...scheme.map(s => s.week)) + 1 : 1;\r\n        setScheme([...scheme, { week: newWeek, topic: '', subTopics: [] }]);\r\n    };\r\n\r\n    const removeWeek = (indexToRemove: number) => {\r\n        setScheme(scheme.filter((_, index) => index !== indexToRemove));\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-3\">\r\n            {scheme.map((entry, weekIndex) => (\r\n                <div key={entry.week} className=\"bg-gray-50/70 p-3 rounded-lg border border-gray-200\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"font-bold text-gray-800\">{entry.week}.</span>\r\n                        <input type=\"text\" value={entry.topic} onChange={(e) => handleTopicChange(weekIndex, e.target.value)} placeholder=\"Main Topic for the Week\" className=\"w-full p-2 font-semibold border text-gray-800 bg-white border-gray-300 rounded-md focus:ring-1 focus:ring-gray-500\" />\r\n                        <button type=\"button\" onClick={() => removeWeek(weekIndex)} className=\"p-1 text-gray-400 hover:text-red-500\" aria-label={`Remove Week ${entry.week} `}><TrashIcon className=\"w-5 h-5\" /></button>\r\n                    </div>\r\n                    <div className=\"pl-8 mt-2 space-y-2\">\r\n                        {entry.subTopics.map((subTopic, subIndex) => (\r\n                            <div key={subIndex} className=\"flex items-center gap-2\">\r\n                                <span className=\"text-gray-400\">-</span>\r\n                                <input type=\"text\" value={subTopic} onChange={(e) => handleSubTopicChange(weekIndex, subIndex, e.target.value)} placeholder=\"Add a sub-topic or learning objective\" className=\"w-full p-1.5 text-sm border bg-white text-gray-800 border-gray-300 rounded-md focus:ring-1 focus:ring-gray-500\" />\r\n                                <button type=\"button\" onClick={() => removeSubTopic(weekIndex, subIndex)} className=\"p-1 text-gray-400 hover:text-red-500\" aria-label={`Remove sub - topic`}><XCircleIcon className=\"w-5 h-5\" /></button>\r\n                            </div>\r\n                        ))}\r\n                        <button type=\"button\" onClick={() => addSubTopic(weekIndex)} className=\"flex items-center space-x-1 py-1 px-2 text-xs font-semibold text-gray-800 bg-gray-200 rounded-md hover:bg-gray-300\"><PlusIcon className=\"w-4 h-4\" /><span>Add Sub-Topic</span></button>\r\n                    </div>\r\n                </div>\r\n            ))}\r\n            <button type=\"button\" onClick={addWeek} className=\"mt-2 w-full flex items-center justify-center space-x-1 py-2 text-sm font-semibold text-gray-800 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-100 hover:border-gray-400\"><PlusIcon className=\"w-4 h-4\" /><span>Add Week</span></button>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst HistoryModal: React.FC<{ isOpen: boolean; onClose: () => void; history: HistoryEntry[]; onLoad: (entry: HistoryEntry) => void; onClear: () => void; }> = ({ isOpen, onClose, history, onLoad, onClear }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in\">\r\n            <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[80vh] flex flex-col\">\r\n                <div className=\"p-4 border-b flex justify-between items-center\">\r\n                    <h3 className=\"text-lg font-bold text-gray-800\">Load Scheme of Work</h3>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\"><XCircleIcon className=\"w-7 h-7\" /></button>\r\n                </div>\r\n                <div className=\"flex-grow p-4 space-y-2 overflow-y-auto\">\r\n                    {history.length > 0 ? history.map((entry, idx) => (\r\n                        <div key={idx} className=\"p-3 bg-gray-50 rounded-lg flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"font-bold text-gray-800\">{entry.subject}</p>\r\n                                <p className=\"text-sm text-gray-600\">{entry.className}</p>\r\n                                <p className=\"text-xs text-gray-400 mt-1\">Last saved: {new Date(entry.lastUpdated).toLocaleString()}</p>\r\n                            </div>\r\n                            <button onClick={() => onLoad(entry)} className=\"px-3 py-1.5 text-sm font-semibold bg-gray-800 text-white rounded-lg hover:bg-gray-900\">Load</button>\r\n                        </div>\r\n                    )) : <p className=\"text-center text-gray-500 py-8\">No saved history.</p>}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst GeneratedHistoryModal: React.FC<{ isOpen: boolean; onClose: () => void; history: GeneratedHistoryEntry[]; onLoad: (entry: GeneratedHistoryEntry) => void; onClear: () => void; }> = ({ isOpen, onClose, history, onLoad, onClear }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in\">\r\n            <div className=\"bg-white rounded-2xl shadow-xl w-full max-w-md max-h-[80vh] flex flex-col\">\r\n                <div className=\"p-4 border-b flex justify-between items-center\">\r\n                    <h3 className=\"text-lg font-bold text-gray-800\">Load Generated Plan</h3>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\"><XCircleIcon className=\"w-7 h-7\" /></button>\r\n                </div>\r\n                <div className=\"flex-grow p-4 space-y-2 overflow-y-auto\">\r\n                    {history.length > 0 ? history.map((entry, idx) => (\r\n                        <div key={idx} className=\"p-3 bg-gray-50 rounded-lg flex items-center justify-between\">\r\n                            <div>\r\n                                <p className=\"font-bold text-gray-800\">{entry.subject}</p>\r\n                                <p className=\"text-sm text-gray-600\">{entry.className}</p>\r\n                                <p className=\"text-xs text-gray-400 mt-1\">Generated: {new Date(entry.lastUpdated).toLocaleString()}</p>\r\n                            </div>\r\n                            <button onClick={() => onLoad(entry)} className=\"px-3 py-1.5 text-sm font-semibold bg-purple-600 text-white rounded-lg hover:bg-purple-700\">View</button>\r\n                        </div>\r\n                    )) : <p className=\"text-center text-gray-500 py-8\">No saved generated plans.</p>}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\n\r\n// --- MAIN COMPONENT ---\r\n\r\nconst LessonPlannerScreen: React.FC<{ navigateTo: (view: string, title: string, props?: any) => void; teacherId?: number | null; }> = ({ navigateTo, teacherId }) => {\r\n    const [subject, setSubject] = useState('');\r\n    const [className, setClassName] = useState('');\r\n    const [term1Scheme, setTerm1Scheme] = useState<SchemeWeek[]>([]);\r\n    const [term2Scheme, setTerm2Scheme] = useState<SchemeWeek[]>([]);\r\n    const [term3Scheme, setTerm3Scheme] = useState<SchemeWeek[]>([]);\r\n    const [activeTerm, setActiveTerm] = useState<'term1' | 'term2' | 'term3'>('term1');\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n    const [schemeHistory, setSchemeHistory] = useState<HistoryEntry[]>([]);\r\n    const [generatedHistory, setGeneratedHistory] = useState<GeneratedHistoryEntry[]>([]);\r\n    const [isSchemeHistoryOpen, setIsSchemeHistoryOpen] = useState(false);\r\n    const [isGeneratedHistoryOpen, setIsGeneratedHistoryOpen] = useState(false);\r\n    const [toastMessage, setToastMessage] = useState('');\r\n\r\n    const effectiveTeacherId = teacherId || 2; // Fallback to 2 only if no auth provided (dev mode)\r\n\r\n    const fetchHistory = useCallback(async () => {\r\n        const { data, error } = await supabase\r\n            .from('generated_resources')\r\n            .select('*')\r\n            .eq('teacher_id', effectiveTeacherId)\r\n            .order('updated_at', { ascending: false });\r\n\r\n        if (error) {\r\n            console.error(\"Error fetching history:\", error);\r\n            return;\r\n        }\r\n\r\n        if (data) {\r\n            const schemes: HistoryEntry[] = data\r\n                .filter(row => row.scheme_content)\r\n                .map(row => ({\r\n                    subject: row.subject,\r\n                    className: row.class_name,\r\n                    term1Scheme: row.scheme_content.term1 || [],\r\n                    term2Scheme: row.scheme_content.term2 || [],\r\n                    term3Scheme: row.scheme_content.term3 || [],\r\n                    lastUpdated: row.updated_at\r\n                }));\r\n            setSchemeHistory(schemes);\r\n\r\n            const generated: GeneratedHistoryEntry[] = data\r\n                .filter(row => row.lesson_plans_content)\r\n                .map(row => ({\r\n                    subject: row.subject,\r\n                    className: row.class_name,\r\n                    lastUpdated: row.updated_at,\r\n                    resources: row.lesson_plans_content // Assuming this matches GeneratedResources structure\r\n                }));\r\n            setGeneratedHistory(generated);\r\n        }\r\n    }, [effectiveTeacherId]);\r\n\r\n    useEffect(() => {\r\n        fetchHistory();\r\n    }, [fetchHistory]);\r\n\r\n    const hasSchemeContent = useMemo(() => {\r\n        const checkScheme = (scheme: SchemeWeek[]) => scheme.some(week => week.topic.trim() !== '');\r\n        return checkScheme(term1Scheme) || checkScheme(term2Scheme) || checkScheme(term3Scheme);\r\n    }, [term1Scheme, term2Scheme, term3Scheme]);\r\n\r\n    const handleSaveScheme = useCallback(async () => {\r\n        if (!subject.trim() || !className.trim()) {\r\n            setToastMessage('Please enter Subject and Class Name to save.');\r\n            return;\r\n        }\r\n\r\n        const schemeData = {\r\n            term1: term1Scheme,\r\n            term2: term2Scheme,\r\n            term3: term3Scheme\r\n        };\r\n\r\n        // Check availability first to decide update vs insert (or use upsert if constraint exists)\r\n        // We don't have a unique constraint on subject+class+teacher in the provided SQL schema,\r\n        // so upsert might duplicate if we rely on ID. We'll try to find an existing record first.\r\n        const { data: existing } = await supabase\r\n            .from('generated_resources')\r\n            .select('id')\r\n            .eq('teacher_id', effectiveTeacherId)\r\n            .eq('subject', subject)\r\n            .eq('class_name', className)\r\n            .maybeSingle();\r\n\r\n        let error;\r\n        if (existing) {\r\n            const { error: updateError } = await supabase\r\n                .from('generated_resources')\r\n                .update({\r\n                    scheme_content: schemeData,\r\n                    updated_at: new Date().toISOString()\r\n                })\r\n                .eq('id', existing.id);\r\n            error = updateError;\r\n        } else {\r\n            const { error: insertError } = await supabase\r\n                .from('generated_resources')\r\n                .insert([{\r\n                    teacher_id: effectiveTeacherId,\r\n                    subject,\r\n                    class_name: className,\r\n                    term: 'All', // Defaulting as we store all 3\r\n                    scheme_content: schemeData\r\n                }]);\r\n            error = insertError;\r\n        }\r\n\r\n        if (error) {\r\n            console.error(\"Error saving scheme:\", error);\r\n            toast.error('Failed to save scheme.');\r\n        } else {\r\n            toast.success('Scheme of work saved to database!');\r\n            fetchHistory(); // Refresh\r\n        }\r\n    }, [subject, className, term1Scheme, term2Scheme, term3Scheme, effectiveTeacherId, fetchHistory]);\r\n\r\n    const handleLoadFromSchemeHistory = useCallback((entry: HistoryEntry) => {\r\n        setSubject(entry.subject);\r\n        setClassName(entry.className);\r\n        setTerm1Scheme(entry.term1Scheme);\r\n        setTerm2Scheme(entry.term2Scheme);\r\n        setTerm3Scheme(entry.term3Scheme);\r\n        setIsSchemeHistoryOpen(false);\r\n        toast.success(`Loaded scheme for ${entry.subject} - ${entry.className}.`);\r\n    }, []);\r\n\r\n    const handleClearSchemeHistory = useCallback(() => {\r\n        // In DB mode, maybe we don't want to clear ALL, or maybe we do?\r\n        // Let's just alert that this feature is restricted for now or clear local state?\r\n        // Actually, let's skip implementing \"Clear All\" for database as it's dangerous.\r\n        toast.error(\"Deleting all history is disabled in connected mode. You can overwrite entries by saving.\");\r\n    }, []);\r\n\r\n    const handleLoadFromGeneratedHistory = useCallback((entry: GeneratedHistoryEntry) => {\r\n        setIsGeneratedHistoryOpen(false);\r\n        navigateTo('lessonPlanDetail', `AI Plan: ${entry.subject} `, { resources: entry.resources });\r\n    }, [navigateTo]);\r\n\r\n    const handleClearGeneratedHistory = useCallback(() => {\r\n        toast.error(\"Deleting all history is disabled in connected mode.\");\r\n    }, []);\r\n\r\n    const schemes = { term1: term1Scheme, term2: term2Scheme, term3: term3Scheme };\r\n    const currentScheme = schemes[activeTerm];\r\n    const setCurrentScheme = { term1: setTerm1Scheme, term2: setTerm2Scheme, term3: setTerm3Scheme }[activeTerm];\r\n\r\n    const handleGenerate = async () => {\r\n        if (!subject.trim() || !className.trim() || !hasSchemeContent) {\r\n            toast.error(\"Please provide a subject, class name, and at least one topic in a term's scheme of work.\");\r\n            return;\r\n        }\r\n\r\n        setIsGenerating(true);\r\n        try {\r\n            const prompt = `As an expert curriculum designer for the Nigerian school system, generate a comprehensive lesson plan resource.\r\n            \r\n            Subject: ${subject}\r\n            Class: ${className}\r\n            \r\n            Here are the schemes of work provided by the user:\r\n            - First Term: ${JSON.stringify(term1Scheme)}\r\n            - Second Term: ${JSON.stringify(term2Scheme)}\r\n            - Third Term: ${JSON.stringify(term3Scheme)}\r\n\r\n            Task:\r\n            1. Analyze the topics provided for each term.\r\n            2. For each week in the scheme, generate:\r\n               - Specific Learning Objectives (at least 2-3)\r\n               - Recommended Teaching Resources (books, materials, digital tools)\r\n               - A brief Lesson Note guide.\r\n            3. If a term has no user-provided topics, suggest a standard curriculum for that term based on the Subject and Class level.\r\n\r\n            Output Format:\r\n            Return a JSON object with the following structure:\r\n            {\r\n                \"subject\": \"${subject}\",\r\n                \"className\": \"${className}\",\r\n                \"terms\": [\r\n                    {\r\n                        \"term\": \"First Term\",\r\n                        \"weeks\": [\r\n                            { \"week\": 1, \"topic\": \"...\", \"learningObjectives\": [\"...\"], \"resources\": [\"...\"] }\r\n                        ]\r\n                    },\r\n                    { \"term\": \"Second Term\", \"weeks\": [] },\r\n                    { \"term\": \"Third Term\", \"weeks\": [] }\r\n                ]\r\n            }`;\r\n\r\n            // Use local Gemini client instead of Edge Function to avoid CORS/Deployment issues\r\n            const ai = getAIClient(import.meta.env.VITE_GEMINI_API_KEY || '');\r\n\r\n            // Construct the messages structure for chat\r\n            const history = [\r\n                { role: 'user', parts: [{ text: 'You are an expert curriculum designer for the Nigerian school system.' }] },\r\n                { role: 'model', parts: [{ text: 'I am ready to help design the curriculum.' }] },\r\n                { role: 'user', parts: [{ text: prompt }] }\r\n            ];\r\n\r\n            const response = await ai.models.generateContent({\r\n                contents: history,\r\n                generationConfig: {\r\n                    temperature: 0.7,\r\n                    responseMimeType: \"application/json\",\r\n                    responseSchema: {\r\n                        type: Type.OBJECT,\r\n                        properties: {\r\n                            subject: { type: Type.STRING },\r\n                            className: { type: Type.STRING },\r\n                            terms: {\r\n                                type: Type.ARRAY,\r\n                                items: {\r\n                                    type: Type.OBJECT,\r\n                                    properties: {\r\n                                        term: { type: Type.STRING },\r\n                                        weeks: {\r\n                                            type: Type.ARRAY,\r\n                                            items: {\r\n                                                type: Type.OBJECT,\r\n                                                properties: {\r\n                                                    week: { type: Type.INTEGER },\r\n                                                    topic: { type: Type.STRING },\r\n                                                    learningObjectives: { type: Type.ARRAY, items: { type: Type.STRING } },\r\n                                                    resources: { type: Type.ARRAY, items: { type: Type.STRING } }\r\n                                                }\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (!response.text) throw new Error('No content returned from AI');\r\n\r\n            let raw = response.text;\r\n\r\n            // Check for direct error messages from AI\r\n            if (!raw || raw.trim().startsWith('Error') || raw.trim().startsWith(\"I'm sorry\") || raw.trim().startsWith(\"I cannot\")) {\r\n                throw new Error(raw || \"AI returned an error message instead of content.\");\r\n            }\r\n\r\n            // Sanitize\r\n            raw = raw.replace(/^```json/i, '').replace(/^```/, '').replace(/```$/, '').trim();\r\n\r\n            let resources;\r\n            try {\r\n                resources = JSON.parse(raw);\r\n            } catch (jsonError) {\r\n                console.error(\"AI JSON Parse Error. Raw output:\", raw);\r\n                throw new Error(\"The AI generated an invalid format. Please try again.\");\r\n            }\r\n\r\n            if (!resources || !resources.terms) {\r\n                throw new Error(\"AI returned a response, but it was empty or missing terms data.\");\r\n            }\r\n\r\n            // Inject scheme data logic\r\n            resources.terms = resources.terms.map((term: any) => {\r\n                let relevantScheme: SchemeWeek[] = [];\r\n                if (term.term?.toLowerCase().includes('first') || term.term?.includes('Term 1')) relevantScheme = term1Scheme;\r\n                else if (term.term?.toLowerCase().includes('second') || term.term?.includes('Term 2')) relevantScheme = term2Scheme;\r\n                else if (term.term?.toLowerCase().includes('third') || term.term?.includes('Term 3')) relevantScheme = term3Scheme;\r\n\r\n                if (relevantScheme.length === 0 && resources.terms.length === 1) {\r\n                    if (activeTerm === 'term1') relevantScheme = term1Scheme;\r\n                    if (activeTerm === 'term2') relevantScheme = term2Scheme;\r\n                    if (activeTerm === 'term3') relevantScheme = term3Scheme;\r\n                }\r\n\r\n                return {\r\n                    ...term,\r\n                    schemeOfWork: relevantScheme\r\n                };\r\n            });\r\n\r\n            // Save to Database logic (Keep existing)\r\n            const { data: existing } = await supabase\r\n                .from('generated_resources')\r\n                .select('id')\r\n                .eq('teacher_id', effectiveTeacherId)\r\n                .eq('subject', resources.subject || subject)\r\n                .eq('class_name', resources.className || className)\r\n                .maybeSingle();\r\n\r\n            if (existing) {\r\n                await supabase.from('generated_resources').update({ lesson_plans_content: resources, updated_at: new Date().toISOString() }).eq('id', existing.id);\r\n            } else {\r\n                await supabase.from('generated_resources').insert([{\r\n                    teacher_id: effectiveTeacherId,\r\n                    subject: resources.subject || subject,\r\n                    class_name: resources.className || className,\r\n                    term: 'All',\r\n                    lesson_plans_content: resources\r\n                }]);\r\n            }\r\n\r\n            fetchHistory(); // Refresh history list\r\n            navigateTo('lessonPlanDetail', `AI Plan: ${subject}`, { resources });\r\n\r\n        } catch (error: any) {\r\n            console.error(\"AI Generation Error:\", error);\r\n            const msg = error.message || '';\r\n            toast.error(`AI Connection Failed. Details:\\n${msg}`);\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-100 relative\">\r\n            {/* AI Loading Overlay */}\r\n            <AILoadingOverlay isVisible={isGenerating} />\r\n            <main className=\"flex-grow p-4 space-y-5 overflow-y-auto pb-24\">\r\n                <div className=\"bg-gray-100 p-4 rounded-xl text-center border border-gray-200\">\r\n                    <SparklesIcon className=\"h-10 w-10 mx-auto text-gray-500 mb-2\" />\r\n                    <h3 className=\"font-bold text-lg text-gray-800\">AI Curriculum Co-Pilot</h3>\r\n                    <p className=\"text-sm text-gray-700\">Input your termly topics and let AI build resources for your entire academic year.</p>\r\n                </div>\r\n\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm space-y-4\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"flex-grow\">\r\n                            <label htmlFor=\"subject\" className=\"block text-sm font-medium text-gray-700 mb-1\">Subject</label>\r\n                            <input id=\"subject\" type=\"text\" value={subject} onChange={e => setSubject(e.target.value)} required className=\"w-full p-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg\" />\r\n                        </div>\r\n                        <div className=\"flex-grow\">\r\n                            <label htmlFor=\"className\" className=\"block text-sm font-medium text-gray-700 mb-1\">Class Name</label>\r\n                            <input id=\"className\" type=\"text\" value={className} onChange={e => setClassName(e.target.value)} required className=\"w-full p-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg\" />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-3\">\r\n                        <button type=\"button\" onClick={() => setIsSchemeHistoryOpen(true)} className=\"w-full flex items-center justify-center space-x-2 py-2 text-sm font-semibold text-gray-700 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-100 hover:border-gray-400\">\r\n                            <HistoryIcon className=\"w-4 h-4\" />\r\n                            <span>Load Scheme</span>\r\n                        </button>\r\n                        <button type=\"button\" onClick={() => setIsGeneratedHistoryOpen(true)} className=\"w-full flex items-center justify-center space-x-2 py-2 text-sm font-semibold text-purple-700 border-2 border-dashed border-purple-300 rounded-lg hover:bg-purple-50 hover:border-purple-400\">\r\n                            <FolderIcon className=\"w-4 h-4\" />\r\n                            <span>Saved Plans</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white p-4 rounded-xl shadow-sm\">\r\n                    <div className=\"flex space-x-1 bg-gray-200 p-1 rounded-lg mb-4\">\r\n                        <button onClick={() => setActiveTerm('term1')} className={`w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term1' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`}>First Term</button>\r\n                        <button onClick={() => setActiveTerm('term2')} className={`w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term2' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`}>Second Term</button>\r\n                        <button onClick={() => setActiveTerm('term3')} className={`w-1/3 py-2 text-sm font-semibold rounded-md ${activeTerm === 'term3' ? 'bg-white shadow text-gray-900' : 'text-gray-700'}`}>Third Term</button>\r\n                    </div>\r\n                    <SchemeInput scheme={currentScheme} setScheme={setCurrentScheme} />\r\n                </div>\r\n            </main>\r\n\r\n            <footer className=\"p-4 bg-white/80 backdrop-blur-sm border-t border-gray-200 grid grid-cols-2 gap-3 sticky bottom-0\">\r\n                <button type=\"button\" onClick={handleSaveScheme} className=\"w-full py-3 px-4 font-medium text-gray-800 bg-gray-200 rounded-lg shadow-sm hover:bg-gray-300\">Save Scheme</button>\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={handleGenerate}\r\n                    disabled={isGenerating || !subject.trim() || !className.trim() || !hasSchemeContent}\r\n                    className=\"w-full flex justify-center items-center space-x-2 py-3 px-4 font-medium text-white bg-gray-800 hover:bg-gray-900 disabled:bg-gray-400\">\r\n                    <SparklesIcon className=\"h-5 h-5\" /><span>Generate Resources</span>\r\n                </button>\r\n            </footer>\r\n\r\n            <HistoryModal isOpen={isSchemeHistoryOpen} onClose={() => setIsSchemeHistoryOpen(false)} history={schemeHistory} onLoad={handleLoadFromSchemeHistory} onClear={handleClearSchemeHistory} />\r\n            <GeneratedHistoryModal isOpen={isGeneratedHistoryOpen} onClose={() => setIsGeneratedHistoryOpen(false)} history={generatedHistory} onLoad={handleLoadFromGeneratedHistory} onClear={handleClearGeneratedHistory} />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default LessonPlannerScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}