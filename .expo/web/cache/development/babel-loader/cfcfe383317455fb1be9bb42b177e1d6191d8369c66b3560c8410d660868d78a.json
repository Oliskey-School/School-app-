{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\student\\\\NewMessageScreen.tsx\";\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { SearchIcon } from '../../constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst UserRow = ({\n  user,\n  onSelect\n}) => _jsxDEV(\"button\", {\n  onClick: onSelect,\n  className: \"w-full flex items-center p-3 space-x-4 text-left bg-white rounded-lg hover:bg-gray-50 transition-colors\",\n  children: [_jsxDEV(\"img\", {\n    src: user.avatarUrl || 'https://via.placeholder.com/150',\n    alt: user.name,\n    className: \"w-12 h-12 rounded-full object-cover\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 21,\n    columnNumber: 9\n  }, this), _jsxDEV(\"div\", {\n    className: \"flex-grow\",\n    children: [_jsxDEV(\"p\", {\n      className: \"font-bold text-gray-800\",\n      children: user.name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 13\n    }, this), _jsxDEV(\"p\", {\n      className: \"text-sm text-gray-500\",\n      children: user.subtitle\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 24,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 22,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 20,\n  columnNumber: 5\n}, this);\nconst StudentNewChatScreen = ({\n  navigateTo,\n  student\n}) => {\n  const [searchTerm, setSearchTerm] = useState('');\n  const [activeTab, setActiveTab] = useState('Teachers');\n  const [teachers, setTeachers] = useState([]);\n  const [classmates, setClassmates] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const fetchUsers = async () => {\n      setLoading(true);\n      setError(null);\n      try {\n        const {\n          data: teacherData\n        } = await supabase.from('users').select('id, name, avatar_url').eq('role', 'Teacher');\n        if (teacherData) {\n          setTeachers(teacherData.map(t => ({\n            id: t.id,\n            name: t.name,\n            avatarUrl: t.avatar_url,\n            subtitle: 'Teacher',\n            userType: 'Teacher'\n          })));\n        }\n        if (student) {\n          const {\n            data: studentData\n          } = await supabase.from('students').select(`\n                            grade, section,\n                            users!inner (id, name, avatar_url)\n                        `).eq('grade', student.grade).neq('user_id', student.id);\n          if (studentData) {\n            const mappedStudents = studentData.map(s => {\n              const u = Array.isArray(s.users) ? s.users[0] : s.users;\n              return {\n                id: u.id,\n                name: u.name,\n                avatarUrl: u.avatar_url,\n                subtitle: `Grade ${s.grade} ${s.section}`,\n                userType: 'Student'\n              };\n            });\n            setClassmates(mappedStudents);\n          }\n        }\n      } catch (e) {\n        console.error(\"Error fetching users\", e);\n        setError(\"Failed to load contacts. Please try again.\");\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchUsers();\n  }, [student]);\n  const filteredUsers = useMemo(() => {\n    const sourceList = activeTab === 'Teachers' ? teachers : classmates;\n    return sourceList.filter(user => user.name.toLowerCase().includes(searchTerm.toLowerCase()));\n  }, [searchTerm, activeTab, teachers, classmates]);\n  const handleSelectUser = async user => {\n    setError(null);\n    try {\n      const {\n        data: myRooms\n      } = await supabase.from('chat_participants').select('room_id').eq('user_id', student.id);\n      const myRoomIds = myRooms?.map(r => r.room_id) || [];\n      if (myRoomIds.length > 0) {\n        const {\n          data: commonRooms\n        } = await supabase.from('chat_participants').select('room_id, chat_rooms(type)').eq('user_id', user.id).in('room_id', myRoomIds);\n        const existingRoom = commonRooms?.find(r => r.chat_rooms?.type === 'direct');\n        if (existingRoom) {\n          navigateTo('chat', user.name, {\n            conversationId: existingRoom.room_id\n          });\n          return;\n        }\n      }\n      const {\n        data: newRoom,\n        error: createError\n      } = await supabase.from('chat_rooms').insert({\n        type: 'direct',\n        is_group: false,\n        creator_id: student.id\n      }).select().single();\n      if (createError || !newRoom) {\n        console.error('Error creating room:', createError);\n        setError(`Failed to start chat: ${createError?.message || 'Unknown error'}`);\n        return;\n      }\n      const {\n        error: partError\n      } = await supabase.from('chat_participants').insert([{\n        room_id: newRoom.id,\n        user_id: student.id,\n        role: 'member'\n      }, {\n        room_id: newRoom.id,\n        user_id: user.id,\n        role: 'member'\n      }]);\n      if (partError) {\n        console.error('Error adding participants:', partError);\n        setError(`Failed to add participants: ${partError.message}`);\n        return;\n      }\n      navigateTo('chat', user.name, {\n        conversationId: newRoom.id\n      });\n    } catch (e) {\n      console.error('Error starting chat:', e);\n      setError(e?.message || 'Failed to start chat. Please try again.');\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-100\",\n    children: [_jsxDEV(\"div\", {\n      className: \"p-4 bg-gray-100/80 backdrop-blur-sm sticky top-0 z-10 border-b border-gray-200\",\n      children: _jsxDEV(\"div\", {\n        className: \"relative\",\n        children: [_jsxDEV(\"span\", {\n          className: \"absolute inset-y-0 left-0 flex items-center pl-3\",\n          children: _jsxDEV(SearchIcon, {\n            className: \"text-gray-400 w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 21\n        }, this), _jsxDEV(\"input\", {\n          type: \"text\",\n          placeholder: `Search for a ${activeTab.slice(0, -1).toLowerCase()}...`,\n          value: searchTerm,\n          onChange: e => setSearchTerm(e.target.value),\n          className: \"w-full pl-10 pr-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 outline-none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }, this), error && _jsxDEV(\"div\", {\n      className: \"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg\",\n      children: _jsxDEV(\"p\", {\n        className: \"text-sm text-red-800\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 17\n    }, this), _jsxDEV(\"div\", {\n      className: \"px-4 bg-gray-100\",\n      children: _jsxDEV(\"div\", {\n        className: \"flex space-x-2 border-b border-gray-200\",\n        children: ['Teachers', 'Classmates'].map(tab => _jsxDEV(\"button\", {\n          onClick: () => setActiveTab(tab),\n          className: `px-4 py-2 text-sm font-semibold transition-colors ${activeTab === tab ? 'border-b-2 border-orange-500 text-orange-600' : 'text-gray-500 hover:text-gray-700'}`,\n          children: tab\n        }, tab, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 25\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }, this), _jsxDEV(\"main\", {\n      className: \"flex-grow p-4 space-y-2 overflow-y-auto\",\n      children: loading ? _jsxDEV(\"div\", {\n        className: \"text-center text-gray-400 mt-10\",\n        children: \"Loading users...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 21\n      }, this) : filteredUsers.length > 0 ? filteredUsers.map(user => _jsxDEV(UserRow, {\n        user: user,\n        onSelect: () => handleSelectUser(user)\n      }, user.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 25\n      }, this)) : _jsxDEV(\"p\", {\n        className: \"text-center text-gray-500 pt-8\",\n        children: [\"No \", activeTab.toLowerCase(), \" found.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 187,\n    columnNumber: 9\n  }, this);\n};\nexport default StudentNewChatScreen;","map":{"version":3,"names":["React","useState","useEffect","useMemo","supabase","SearchIcon","jsxDEV","_jsxDEV","UserRow","user","onSelect","onClick","className","children","src","avatarUrl","alt","name","fileName","_jsxFileName","lineNumber","columnNumber","subtitle","StudentNewChatScreen","navigateTo","student","searchTerm","setSearchTerm","activeTab","setActiveTab","teachers","setTeachers","classmates","setClassmates","loading","setLoading","error","setError","fetchUsers","data","teacherData","from","select","eq","map","t","id","avatar_url","userType","studentData","grade","neq","mappedStudents","s","u","Array","isArray","users","section","e","console","filteredUsers","sourceList","filter","toLowerCase","includes","handleSelectUser","myRooms","myRoomIds","r","room_id","length","commonRooms","in","existingRoom","find","chat_rooms","type","conversationId","newRoom","createError","insert","is_group","creator_id","single","message","partError","user_id","role","placeholder","slice","value","onChange","target","tab"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/student/NewMessageScreen.tsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\r\nimport { Student } from '../../types';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { SearchIcon } from '../../constants';\r\n\r\ntype UserListItem = {\r\n    id: number;\r\n    name: string;\r\n    avatarUrl: string;\r\n    subtitle: string;\r\n    userType: 'Student' | 'Teacher';\r\n};\r\n\r\ninterface StudentNewChatScreenProps {\r\n    navigateTo: (view: string, title: string, props: any) => void;\r\n    student: Student; // Passed from dashboard\r\n}\r\n\r\nconst UserRow: React.FC<{ user: UserListItem, onSelect: () => void }> = ({ user, onSelect }) => (\r\n    <button onClick={onSelect} className=\"w-full flex items-center p-3 space-x-4 text-left bg-white rounded-lg hover:bg-gray-50 transition-colors\">\r\n        <img src={user.avatarUrl || 'https://via.placeholder.com/150'} alt={user.name} className=\"w-12 h-12 rounded-full object-cover\" />\r\n        <div className=\"flex-grow\">\r\n            <p className=\"font-bold text-gray-800\">{user.name}</p>\r\n            <p className=\"text-sm text-gray-500\">{user.subtitle}</p>\r\n        </div>\r\n    </button>\r\n);\r\n\r\nconst StudentNewChatScreen: React.FC<StudentNewChatScreenProps> = ({ navigateTo, student }) => {\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [activeTab, setActiveTab] = useState<'Teachers' | 'Classmates'>('Teachers');\r\n    const [teachers, setTeachers] = useState<UserListItem[]>([]);\r\n    const [classmates, setClassmates] = useState<UserListItem[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        const fetchUsers = async () => {\r\n            setLoading(true);\r\n            setError(null);\r\n            try {\r\n                // Fetch Teachers\r\n                const { data: teacherData } = await supabase\r\n                    .from('users')\r\n                    .select('id, name, avatar_url')\r\n                    .eq('role', 'Teacher');\r\n\r\n                if (teacherData) {\r\n                    setTeachers(teacherData.map(t => ({\r\n                        id: t.id,\r\n                        name: t.name,\r\n                        avatarUrl: t.avatar_url,\r\n                        subtitle: 'Teacher',\r\n                        userType: 'Teacher'\r\n                    })));\r\n                }\r\n\r\n                // Fetch Classmates\r\n                if (student) {\r\n                    // Start with students table to filter by grade/section\r\n                    const { data: studentData } = await supabase\r\n                        .from('students')\r\n                        .select(`\r\n                            grade, section,\r\n                            users!inner (id, name, avatar_url)\r\n                        `)\r\n                        .eq('grade', student.grade)\r\n                        //.eq('section', student.section) // strict section matching? maybe just grade for now or both.\r\n                        .neq('user_id', student.id); // Exclude self\r\n\r\n                    if (studentData) {\r\n                        const mappedStudents: UserListItem[] = studentData.map((s: any) => {\r\n                            // users is single object due to !inner join on FK unique?\r\n                            // supabase-js might return array if 1:1 not enforced in types?\r\n                            // Let's safe access\r\n                            const u = Array.isArray(s.users) ? s.users[0] : s.users;\r\n                            return {\r\n                                id: u.id,\r\n                                name: u.name,\r\n                                avatarUrl: u.avatar_url,\r\n                                subtitle: `Grade ${s.grade} ${s.section}`,\r\n                                userType: 'Student'\r\n                            };\r\n                        });\r\n                        setClassmates(mappedStudents);\r\n                    }\r\n                }\r\n\r\n            } catch (e) {\r\n                console.error(\"Error fetching users\", e);\r\n                setError(\"Failed to load contacts. Please try again.\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchUsers();\r\n    }, [student]);\r\n\r\n    const filteredUsers = useMemo(() => {\r\n        const sourceList = activeTab === 'Teachers' ? teachers : classmates;\r\n        return sourceList.filter(user =>\r\n            user.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n        );\r\n    }, [searchTerm, activeTab, teachers, classmates]);\r\n\r\n    const handleSelectUser = async (user: UserListItem) => {\r\n        setError(null);\r\n        try {\r\n            // Check for existing direct chat\r\n            // 1. Get my rooms\r\n            const { data: myRooms } = await supabase\r\n                .from('chat_participants')\r\n                .select('room_id')\r\n                .eq('user_id', student.id);\r\n\r\n            const myRoomIds = myRooms?.map(r => r.room_id) || [];\r\n\r\n            if (myRoomIds.length > 0) {\r\n                // 2. Check if user is in any of these rooms which are direct\r\n                const { data: commonRooms } = await supabase\r\n                    .from('chat_participants')\r\n                    .select('room_id, chat_rooms(type)')\r\n                    .eq('user_id', user.id)\r\n                    .in('room_id', myRoomIds);\r\n\r\n                // Filter for 'direct' type from checking chat_rooms\r\n                // But we can't easily filter joined property in JS easily if structure is nested.\r\n                // Or use inner join filter.\r\n\r\n                // Let's try to query chat_rooms directly with participants check? Harder.\r\n                // Direct approach:\r\n                // Find a room where (user_id = me OR user_id = them) GROUP BY room_id HAVING count(*) = 2 AND type = 'direct'\r\n\r\n                // Simplest: Iterate found common rooms and check type if we fetched it.\r\n                // We fetched chat_rooms(type).\r\n\r\n                const existingRoom = commonRooms?.find((r: any) => r.chat_rooms?.type === 'direct');\r\n\r\n                if (existingRoom) {\r\n                    navigateTo('chat', user.name, { conversationId: existingRoom.room_id });\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Create new room\r\n            const { data: newRoom, error: createError } = await supabase\r\n                .from('chat_rooms')\r\n                .insert({\r\n                    type: 'direct',\r\n                    is_group: false,\r\n                    creator_id: student.id,\r\n                    // Name is often null for direct chats, or we can set it for easy debugging\r\n                })\r\n                .select()\r\n                .single();\r\n\r\n            if (createError || !newRoom) {\r\n                console.error('Error creating room:', createError);\r\n                setError(`Failed to start chat: ${createError?.message || 'Unknown error'}`);\r\n                return;\r\n            }\r\n\r\n            // ADD participants\r\n            const { error: partError } = await supabase\r\n                .from('chat_participants')\r\n                .insert([\r\n                    { room_id: newRoom.id, user_id: student.id, role: 'member' },\r\n                    { room_id: newRoom.id, user_id: user.id, role: 'member' }\r\n                ]);\r\n\r\n            if (partError) {\r\n                console.error('Error adding participants:', partError);\r\n                setError(`Failed to add participants: ${partError.message}`);\r\n                return;\r\n            }\r\n\r\n            navigateTo('chat', user.name, { conversationId: newRoom.id });\r\n\r\n        } catch (e: any) {\r\n            console.error('Error starting chat:', e);\r\n            setError(e?.message || 'Failed to start chat. Please try again.');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-100\">\r\n            <div className=\"p-4 bg-gray-100/80 backdrop-blur-sm sticky top-0 z-10 border-b border-gray-200\">\r\n                <div className=\"relative\">\r\n                    <span className=\"absolute inset-y-0 left-0 flex items-center pl-3\">\r\n                        <SearchIcon className=\"text-gray-400 w-5 h-5\" />\r\n                    </span>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder={`Search for a ${activeTab.slice(0, -1).toLowerCase()}...`}\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500 outline-none\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {error && (\r\n                <div className=\"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg\">\r\n                    <p className=\"text-sm text-red-800\">{error}</p>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"px-4 bg-gray-100\">\r\n                <div className=\"flex space-x-2 border-b border-gray-200\">\r\n                    {(['Teachers', 'Classmates'] as const).map(tab => (\r\n                        <button key={tab} onClick={() => setActiveTab(tab)}\r\n                            className={`px-4 py-2 text-sm font-semibold transition-colors ${activeTab === tab ? 'border-b-2 border-orange-500 text-orange-600' : 'text-gray-500 hover:text-gray-700'\r\n                                }`}>\r\n                            {tab}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <main className=\"flex-grow p-4 space-y-2 overflow-y-auto\">\r\n                {loading ? (\r\n                    <div className=\"text-center text-gray-400 mt-10\">Loading users...</div>\r\n                ) : filteredUsers.length > 0 ? (\r\n                    filteredUsers.map(user => (\r\n                        <UserRow key={user.id} user={user} onSelect={() => handleSelectUser(user)} />\r\n                    ))\r\n                ) : (\r\n                    <p className=\"text-center text-gray-500 pt-8\">No {activeTab.toLowerCase()} found.</p>\r\n                )}\r\n            </main>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StudentNewChatScreen;"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}