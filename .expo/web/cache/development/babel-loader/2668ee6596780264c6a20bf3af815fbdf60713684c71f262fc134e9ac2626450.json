{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\shared\\\\AIChatScreen.tsx\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { getAIClient } from '../../lib/ai';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport { CameraIcon, SendIcon, MicrophoneIcon, SparklesIcon, MapIcon, SearchIcon, PlayIcon, StopIcon, AIIcon } from '../../constants';\nimport { THEME_CONFIG } from '../../constants';\nimport Header from '../ui/Header';\nimport LiveSession from './LiveSession';\nimport MediaGenerator from './MediaGenerator';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst fileToGenerativePart = async file => {\n  const base64EncodedDataPromise = new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onloadend = () => resolve(reader.result.split(',')[1]);\n    reader.readAsDataURL(file);\n  });\n  return {\n    inlineData: {\n      data: await base64EncodedDataPromise,\n      mimeType: file.type\n    }\n  };\n};\nconst blobToBase64 = blob => {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onloadend = () => resolve(reader.result.split(',')[1]);\n    reader.readAsDataURL(blob);\n  });\n};\nconst AIChatScreen = ({\n  onBack,\n  dashboardType\n}) => {\n  const theme = THEME_CONFIG[dashboardType];\n  const [activeTab, setActiveTab] = useState('chat');\n  const [messages, setMessages] = useState([{\n    role: 'model',\n    text: \"Hello! I'm your enhanced AI assistant. Use the tabs below to switch between Chat, Live Voice, and Creative Studio.\"\n  }]);\n  const [inputText, setInputText] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [thinkingMode, setThinkingMode] = useState(false);\n  const [useGrounding, setUseGrounding] = useState('none');\n  const fileInputRef = useRef(null);\n  const chatContainerRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: true\n      });\n      const recorder = new MediaRecorder(stream);\n      const chunks = [];\n      recorder.ondataavailable = e => chunks.push(e.data);\n      recorder.onstop = async () => {\n        const audioBlob = new Blob(chunks, {\n          type: 'audio/wav'\n        });\n        const base64Audio = await blobToBase64(audioBlob);\n        handleTranscribe(base64Audio);\n      };\n      mediaRecorderRef.current = recorder;\n      recorder.start();\n      setIsRecording(true);\n    } catch (e) {\n      console.error(\"Mic error\", e);\n      toast.error(\"Could not access microphone.\");\n    }\n  };\n  const stopRecording = () => {\n    mediaRecorderRef.current?.stop();\n    setIsRecording(false);\n  };\n  const handleTranscribe = async base64Audio => {\n    setIsLoading(true);\n    try {\n      const ai = getAIClient();\n      const response = await ai.models.generateContent({\n        model: 'gemini-2.0-flash-exp',\n        contents: {\n          parts: [{\n            inlineData: {\n              mimeType: 'audio/wav',\n              data: base64Audio\n            }\n          }, {\n            text: \"Transcribe this audio accurately.\"\n          }]\n        }\n      });\n      if (response.text) {\n        setInputText(prev => (prev + \" \" + response.text).trim());\n      }\n    } catch (error) {\n      console.error(\"Transcription error\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const playTTS = async text => {\n    try {\n      const ai = getAIClient();\n      const response = await ai.models.generateContent({\n        model: 'gemini-2.0-flash-exp',\n        contents: {\n          parts: [{\n            text\n          }]\n        },\n        config: {\n          responseModalities: ['AUDIO'],\n          speechConfig: {\n            voiceConfig: {\n              prebuiltVoiceConfig: {\n                voiceName: 'Kore'\n              }\n            }\n          }\n        }\n      });\n      const audioData = response.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;\n      if (audioData) {\n        const audioBlob = await (await fetch(`data:audio/mp3;base64,${audioData}`)).blob();\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n        audio.play();\n      }\n    } catch (error) {\n      console.error(\"TTS Error\", error);\n    }\n  };\n  const handleSendMessage = async (text, attachment) => {\n    if (!text && !attachment) return;\n    setIsLoading(true);\n    setInputText('');\n    let userMsg = {\n      role: 'user',\n      text\n    };\n    if (attachment) {\n      userMsg.imageUrl = URL.createObjectURL(attachment);\n    }\n    setMessages(prev => [...prev, userMsg]);\n    try {\n      const ai = getAIClient();\n      let modelName = 'gemini-2.0-flash-exp';\n      let config = {};\n      let parts = [];\n      if (text) parts.push({\n        text\n      });\n      if (attachment) {\n        const filePart = await fileToGenerativePart(attachment);\n        parts.push(filePart);\n      }\n      if (thinkingMode) {}\n      if (useGrounding === 'search') {\n        config.tools = [{\n          googleSearch: {}\n        }];\n      } else if (useGrounding === 'maps') {\n        config.tools = [{\n          googleMaps: {}\n        }];\n      }\n      const response = await ai.models.generateContent({\n        model: modelName,\n        contents: {\n          parts\n        },\n        config: config\n      });\n      let responseText = response.text || \"No response generated.\";\n      const groundingChunks = response.candidates?.[0]?.groundingMetadata?.groundingChunks;\n      if (groundingChunks) {\n        const urls = groundingChunks.map(c => c.web?.uri || c.maps?.uri).filter(Boolean);\n        if (urls.length > 0) {\n          responseText += \"\\n\\n**Sources:**\\n\" + urls.map(u => `- ${u}`).join('\\n');\n        }\n      }\n      setMessages(prev => [...prev, {\n        role: 'model',\n        text: responseText\n      }]);\n    } catch (error) {\n      console.error(\"Chat Error\", error);\n      setMessages(prev => [...prev, {\n        role: 'model',\n        text: `Error: ${error.message}`\n      }]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  useEffect(() => {\n    chatContainerRef.current?.scrollTo({\n      top: chatContainerRef.current.scrollHeight,\n      behavior: 'smooth'\n    });\n  }, [messages]);\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-100\",\n    children: [_jsxDEV(Header, {\n      title: \"AI Assistant\",\n      avatarUrl: `https://i.pravatar.cc/150?u=${dashboardType.toLowerCase()}`,\n      bgColor: theme.mainBg,\n      onBack: onBack\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }, this), _jsxDEV(\"div\", {\n      className: \"flex bg-white shadow-sm z-10\",\n      children: [{\n        id: 'chat',\n        label: 'Smart Chat',\n        icon: AIIcon\n      }, {\n        id: 'live',\n        label: 'Live Voice',\n        icon: MicrophoneIcon\n      }, {\n        id: 'create',\n        label: 'Creative Studio',\n        icon: SparklesIcon\n      }].map(tab => _jsxDEV(\"button\", {\n        onClick: () => setActiveTab(tab.id),\n        className: `flex-1 py-3 flex items-center justify-center space-x-2 border-b-4 transition-colors ${activeTab === tab.id ? `border-${theme.iconColor.split('-')[1]}-500 text-gray-800` : 'border-transparent text-gray-500 hover:bg-gray-50'}`,\n        children: [_jsxDEV(tab.icon, {\n          className: \"w-5 h-5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 25\n        }, this), _jsxDEV(\"span\", {\n          className: \"font-medium text-sm hidden sm:inline\",\n          children: tab.label\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 25\n        }, this)]\n      }, tab.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }, this), _jsxDEV(\"div\", {\n      className: \"flex-grow overflow-hidden relative bg-gray-50\",\n      children: [activeTab === 'live' && _jsxDEV(LiveSession, {\n        onClose: () => setActiveTab('chat')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 42\n      }, this), activeTab === 'create' && _jsxDEV(MediaGenerator, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 44\n      }, this), activeTab === 'chat' && _jsxDEV(\"div\", {\n        className: \"flex flex-col h-full\",\n        children: [_jsxDEV(\"div\", {\n          ref: chatContainerRef,\n          className: \"flex-grow overflow-y-auto p-4 space-y-4 pb-32\",\n          style: {\n            backgroundImage: \"url('https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg')\",\n            backgroundRepeat: 'repeat',\n            backgroundSize: '400px'\n          },\n          children: [messages.map((msg, index) => _jsxDEV(\"div\", {\n            className: `flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`,\n            children: _jsxDEV(\"div\", {\n              className: `max-w-[85%] rounded-2xl p-3 shadow-sm relative ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-br-none' : 'bg-white text-gray-800 rounded-bl-none'}`,\n              children: [msg.imageUrl && _jsxDEV(\"img\", {\n                src: msg.imageUrl,\n                alt: \"Upload\",\n                className: \"rounded-lg mb-2 max-h-48 object-cover\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 248,\n                columnNumber: 58\n              }, this), _jsxDEV(\"div\", {\n                className: `prose prose-sm max-w-none ${msg.role === 'user' ? 'prose-invert' : ''}`,\n                children: _jsxDEV(ReactMarkdown, {\n                  remarkPlugins: [remarkGfm],\n                  children: msg.text\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 250,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 249,\n                columnNumber: 41\n              }, this), msg.role === 'model' && _jsxDEV(\"button\", {\n                onClick: () => playTTS(msg.text),\n                className: \"absolute -bottom-3 -right-3 p-1.5 bg-gray-200 rounded-full hover:bg-gray-300 shadow-sm text-gray-600\",\n                children: _jsxDEV(PlayIcon, {\n                  className: \"w-3 h-3\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 254,\n                  columnNumber: 49\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 45\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 37\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 33\n          }, this)), isLoading && _jsxDEV(\"div\", {\n            className: \"flex justify-start\",\n            children: _jsxDEV(\"div\", {\n              className: \"bg-white p-3 rounded-2xl rounded-bl-none shadow-sm\",\n              children: _jsxDEV(\"div\", {\n                className: \"flex space-x-1\",\n                children: [_jsxDEV(\"div\", {\n                  className: \"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 169\n                }, this), _jsxDEV(\"div\", {\n                  className: \"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-75\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 240\n                }, this), _jsxDEV(\"div\", {\n                  className: \"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-150\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 261,\n                  columnNumber: 320\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 137\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 69\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 25\n        }, this), _jsxDEV(\"div\", {\n          className: \"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3\",\n          children: [_jsxDEV(\"div\", {\n            className: \"flex space-x-2 overflow-x-auto pb-2 mb-1 no-scrollbar\",\n            children: [_jsxDEV(\"button\", {\n              onClick: () => setThinkingMode(!thinkingMode),\n              className: `flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${thinkingMode ? 'bg-purple-100 text-purple-700 border-purple-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`,\n              children: [_jsxDEV(SparklesIcon, {\n                className: \"w-3 h-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 37\n              }, this), \" \", _jsxDEV(\"span\", {\n                children: \"Deep Thinker\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 74\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 33\n            }, this), _jsxDEV(\"button\", {\n              onClick: () => setUseGrounding(useGrounding === 'search' ? 'none' : 'search'),\n              className: `flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${useGrounding === 'search' ? 'bg-blue-100 text-blue-700 border-blue-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`,\n              children: [_jsxDEV(SearchIcon, {\n                className: \"w-3 h-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 37\n              }, this), \" \", _jsxDEV(\"span\", {\n                children: \"Web Search\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 72\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 272,\n              columnNumber: 33\n            }, this), _jsxDEV(\"button\", {\n              onClick: () => setUseGrounding(useGrounding === 'maps' ? 'none' : 'maps'),\n              className: `flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${useGrounding === 'maps' ? 'bg-green-100 text-green-700 border-green-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`,\n              children: [_jsxDEV(MapIcon, {\n                className: \"w-3 h-3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 276,\n                columnNumber: 37\n              }, this), \" \", _jsxDEV(\"span\", {\n                children: \"Maps\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 276,\n                columnNumber: 69\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 29\n          }, this), _jsxDEV(\"div\", {\n            className: \"flex items-end space-x-2\",\n            children: [_jsxDEV(\"input\", {\n              type: \"file\",\n              ref: fileInputRef,\n              className: \"hidden\",\n              accept: \"image/*\",\n              onChange: e => e.target.files?.[0] && handleSendMessage(\"\", e.target.files[0])\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 282,\n              columnNumber: 33\n            }, this), _jsxDEV(\"button\", {\n              onClick: () => fileInputRef.current?.click(),\n              className: \"p-2 text-gray-500 hover:bg-gray-100 rounded-full\",\n              children: _jsxDEV(CameraIcon, {\n                className: \"w-6 h-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 283,\n                columnNumber: 148\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 283,\n              columnNumber: 33\n            }, this), _jsxDEV(\"div\", {\n              className: \"flex-grow bg-gray-100 rounded-2xl flex items-center px-3 py-2\",\n              children: _jsxDEV(\"textarea\", {\n                value: inputText,\n                onChange: e => setInputText(e.target.value),\n                placeholder: \"Ask anything...\",\n                className: \"bg-transparent w-full outline-none resize-none text-sm max-h-24\",\n                rows: 1,\n                onKeyDown: e => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage(inputText);\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 286,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 33\n            }, this), inputText ? _jsxDEV(\"button\", {\n              onClick: () => handleSendMessage(inputText),\n              className: `p-3 rounded-full text-white shadow-md ${theme.mainBg}`,\n              children: _jsxDEV(SendIcon, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 297,\n                columnNumber: 158\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 37\n            }, this) : _jsxDEV(\"button\", {\n              onClick: isRecording ? stopRecording : startRecording,\n              className: `p-3 rounded-full shadow-md ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'}`,\n              children: isRecording ? _jsxDEV(StopIcon, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 300,\n                columnNumber: 56\n              }, this) : _jsxDEV(MicrophoneIcon, {\n                className: \"w-5 h-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 300,\n                columnNumber: 91\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 209,\n    columnNumber: 9\n  }, this);\n};\nexport default AIChatScreen;","map":{"version":3,"names":["React","useState","useEffect","useRef","toast","getAIClient","ReactMarkdown","remarkGfm","CameraIcon","SendIcon","MicrophoneIcon","SparklesIcon","MapIcon","SearchIcon","PlayIcon","StopIcon","AIIcon","THEME_CONFIG","Header","LiveSession","MediaGenerator","jsxDEV","_jsxDEV","fileToGenerativePart","file","base64EncodedDataPromise","Promise","resolve","reader","FileReader","onloadend","result","split","readAsDataURL","inlineData","data","mimeType","type","blobToBase64","blob","AIChatScreen","onBack","dashboardType","theme","activeTab","setActiveTab","messages","setMessages","role","text","inputText","setInputText","isLoading","setIsLoading","isRecording","setIsRecording","thinkingMode","setThinkingMode","useGrounding","setUseGrounding","fileInputRef","chatContainerRef","mediaRecorderRef","startRecording","stream","navigator","mediaDevices","getUserMedia","audio","recorder","MediaRecorder","chunks","ondataavailable","e","push","onstop","audioBlob","Blob","base64Audio","handleTranscribe","current","start","console","error","stopRecording","stop","ai","response","models","generateContent","model","contents","parts","prev","trim","playTTS","config","responseModalities","speechConfig","voiceConfig","prebuiltVoiceConfig","voiceName","audioData","candidates","content","fetch","audioUrl","URL","createObjectURL","Audio","play","handleSendMessage","attachment","userMsg","imageUrl","modelName","filePart","tools","googleSearch","googleMaps","responseText","groundingChunks","groundingMetadata","urls","map","c","web","uri","maps","filter","Boolean","length","u","join","message","scrollTo","top","scrollHeight","behavior","className","children","title","avatarUrl","toLowerCase","bgColor","mainBg","fileName","_jsxFileName","lineNumber","columnNumber","id","label","icon","tab","onClick","iconColor","onClose","ref","style","backgroundImage","backgroundRepeat","backgroundSize","msg","index","src","alt","remarkPlugins","accept","onChange","target","files","click","value","placeholder","rows","onKeyDown","key","shiftKey","preventDefault"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/shared/AIChatScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { getAIClient, AI_MODEL_NAME } from '../../lib/ai';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport remarkGfm from 'remark-gfm';\r\nimport { CameraIcon, SendIcon, MicrophoneIcon, SparklesIcon, VideoIcon, PhotoIcon, BriefcaseIcon, MapIcon, SearchIcon, PlayIcon, StopIcon, AIIcon } from '../../constants';\r\nimport { THEME_CONFIG } from '../../constants';\r\nimport { DashboardType } from '../../types';\r\nimport Header from '../ui/Header';\r\nimport LiveSession from './LiveSession';\r\nimport MediaGenerator from './MediaGenerator';\r\n\r\ninterface Message {\r\n    role: 'user' | 'model';\r\n    text: string;\r\n    imageUrl?: string;\r\n    audioData?: string; // Base64 encoded\r\n}\r\n\r\ninterface AIChatScreenProps {\r\n    onBack: () => void;\r\n    dashboardType: DashboardType;\r\n}\r\n\r\n// --- Helper Functions ---\r\nconst fileToGenerativePart = async (file: File) => {\r\n    const base64EncodedDataPromise = new Promise<string>((resolve) => {\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => resolve((reader.result as string).split(',')[1]);\r\n        reader.readAsDataURL(file);\r\n    });\r\n    return {\r\n        inlineData: { data: await base64EncodedDataPromise, mimeType: file.type },\r\n    };\r\n};\r\n\r\nconst blobToBase64 = (blob: Blob): Promise<string> => {\r\n    return new Promise((resolve) => {\r\n        const reader = new FileReader();\r\n        reader.onloadend = () => resolve((reader.result as string).split(',')[1]);\r\n        reader.readAsDataURL(blob);\r\n    });\r\n};\r\n\r\n// --- Main Component ---\r\nconst AIChatScreen: React.FC<AIChatScreenProps> = ({ onBack, dashboardType }) => {\r\n    const theme = THEME_CONFIG[dashboardType];\r\n    const [activeTab, setActiveTab] = useState<'chat' | 'live' | 'create'>('chat');\r\n\r\n    // Chat State\r\n    const [messages, setMessages] = useState<Message[]>([\r\n        { role: 'model', text: \"Hello! I'm your enhanced AI assistant. Use the tabs below to switch between Chat, Live Voice, and Creative Studio.\" }\r\n    ]);\r\n    const [inputText, setInputText] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n\r\n    // Chat Settings\r\n    const [thinkingMode, setThinkingMode] = useState(false);\r\n    const [useGrounding, setUseGrounding] = useState<'none' | 'search' | 'maps'>('none');\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const chatContainerRef = useRef<HTMLDivElement>(null);\r\n    const mediaRecorderRef = useRef<MediaRecorder | null>(null);\r\n\r\n    // --- Audio Recording & Transcription ---\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            const recorder = new MediaRecorder(stream);\r\n            const chunks: Blob[] = [];\r\n\r\n            recorder.ondataavailable = (e) => chunks.push(e.data);\r\n            recorder.onstop = async () => {\r\n                const audioBlob = new Blob(chunks, { type: 'audio/wav' });\r\n                const base64Audio = await blobToBase64(audioBlob);\r\n                handleTranscribe(base64Audio);\r\n            };\r\n\r\n            mediaRecorderRef.current = recorder;\r\n            recorder.start();\r\n            setIsRecording(true);\r\n        } catch (e) {\r\n            console.error(\"Mic error\", e);\r\n            toast.error(\"Could not access microphone.\");\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        mediaRecorderRef.current?.stop();\r\n        setIsRecording(false);\r\n    };\r\n\r\n    const handleTranscribe = async (base64Audio: string) => {\r\n        setIsLoading(true);\r\n        try {\r\n            const ai = getAIClient();\r\n            const response = await ai.models.generateContent({\r\n                model: 'gemini-2.0-flash-exp', // Efficient for transcription\r\n                contents: {\r\n                    parts: [\r\n                        { inlineData: { mimeType: 'audio/wav', data: base64Audio } },\r\n                        { text: \"Transcribe this audio accurately.\" }\r\n                    ]\r\n                }\r\n            });\r\n            if (response.text) {\r\n                setInputText(prev => (prev + \" \" + response.text).trim());\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Transcription error\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // --- TTS Playback ---\r\n    const playTTS = async (text: string) => {\r\n        try {\r\n            const ai = getAIClient();\r\n            const response = await ai.models.generateContent({\r\n                model: 'gemini-2.0-flash-exp',\r\n                contents: { parts: [{ text }] },\r\n                config: { responseModalities: ['AUDIO'], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: 'Kore' } } } }\r\n            });\r\n\r\n            const audioData = (response.candidates?.[0]?.content?.parts?.[0] as any)?.inlineData?.data;\r\n            if (audioData) {\r\n                const audioBlob = await (await fetch(`data:audio/mp3;base64,${audioData}`)).blob();\r\n                const audioUrl = URL.createObjectURL(audioBlob);\r\n                const audio = new Audio(audioUrl);\r\n                audio.play();\r\n            }\r\n        } catch (error) {\r\n            console.error(\"TTS Error\", error);\r\n        }\r\n    };\r\n\r\n    // --- Main Chat Logic ---\r\n    const handleSendMessage = async (text: string, attachment?: File) => {\r\n        if (!text && !attachment) return;\r\n\r\n        setIsLoading(true);\r\n        setInputText('');\r\n\r\n        let userMsg: Message = { role: 'user', text };\r\n        if (attachment) {\r\n            userMsg.imageUrl = URL.createObjectURL(attachment);\r\n        }\r\n        setMessages(prev => [...prev, userMsg]);\r\n\r\n        try {\r\n            const ai = getAIClient();\r\n            let modelName = 'gemini-2.0-flash-exp'; // Standardize on single model\r\n            let config: any = {};\r\n            let parts: any[] = [];\r\n\r\n            if (text) parts.push({ text });\r\n            if (attachment) {\r\n                const filePart = await fileToGenerativePart(attachment);\r\n                parts.push(filePart);\r\n            }\r\n\r\n            if (thinkingMode) {\r\n                // Gemini 2.0 Flash is capable, but we can just prompt it to think step-by-step if needed\r\n                // or just leave it as is. Configuration specific to 1.5-pro (thinkingBudget) might not apply or be needed.\r\n                // We'll just stick to the requested single model.\r\n            }\r\n\r\n            if (useGrounding === 'search') {\r\n                config.tools = [{ googleSearch: {} }];\r\n            } else if (useGrounding === 'maps') {\r\n                config.tools = [{ googleMaps: {} }];\r\n            }\r\n\r\n            const response = await ai.models.generateContent({\r\n                model: modelName,\r\n                contents: { parts },\r\n                config: config\r\n            });\r\n\r\n            // Handle Grounding Metadata (URLs)\r\n            let responseText = response.text || \"No response generated.\";\r\n            const groundingChunks = (response.candidates?.[0] as any)?.groundingMetadata?.groundingChunks;\r\n            if (groundingChunks) {\r\n                const urls = groundingChunks.map((c: any) => c.web?.uri || c.maps?.uri).filter(Boolean);\r\n                if (urls.length > 0) {\r\n                    responseText += \"\\n\\n**Sources:**\\n\" + urls.map((u: string) => `- ${u}`).join('\\n');\r\n                }\r\n            }\r\n\r\n            setMessages(prev => [...prev, { role: 'model', text: responseText }]);\r\n\r\n        } catch (error: any) {\r\n            console.error(\"Chat Error\", error);\r\n            setMessages(prev => [...prev, { role: 'model', text: `Error: ${error.message}` }]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        chatContainerRef.current?.scrollTo({ top: chatContainerRef.current.scrollHeight, behavior: 'smooth' });\r\n    }, [messages]);\r\n\r\n    // --- Render ---\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-100\">\r\n            <Header\r\n                title=\"AI Assistant\"\r\n                avatarUrl={`https://i.pravatar.cc/150?u=${dashboardType.toLowerCase()}`}\r\n                bgColor={theme.mainBg}\r\n                onBack={onBack}\r\n            />\r\n\r\n            {/* Mode Tabs */}\r\n            <div className=\"flex bg-white shadow-sm z-10\">\r\n                {[\r\n                    { id: 'chat', label: 'Smart Chat', icon: AIIcon },\r\n                    { id: 'live', label: 'Live Voice', icon: MicrophoneIcon },\r\n                    { id: 'create', label: 'Creative Studio', icon: SparklesIcon },\r\n                ].map(tab => (\r\n                    <button\r\n                        key={tab.id}\r\n                        onClick={() => setActiveTab(tab.id as any)}\r\n                        className={`flex-1 py-3 flex items-center justify-center space-x-2 border-b-4 transition-colors ${activeTab === tab.id ? `border-${theme.iconColor.split('-')[1]}-500 text-gray-800` : 'border-transparent text-gray-500 hover:bg-gray-50'\r\n                            }`}\r\n                    >\r\n                        <tab.icon className=\"w-5 h-5\" />\r\n                        <span className=\"font-medium text-sm hidden sm:inline\">{tab.label}</span>\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            <div className=\"flex-grow overflow-hidden relative bg-gray-50\">\r\n                {activeTab === 'live' && <LiveSession onClose={() => setActiveTab('chat')} />}\r\n\r\n                {activeTab === 'create' && <MediaGenerator />}\r\n\r\n                {activeTab === 'chat' && (\r\n                    <div className=\"flex flex-col h-full\">\r\n                        {/* Chat Messages */}\r\n                        <div ref={chatContainerRef} className=\"flex-grow overflow-y-auto p-4 space-y-4 pb-32\" style={{ backgroundImage: \"url('https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg')\", backgroundRepeat: 'repeat', backgroundSize: '400px' }}>\r\n                            {messages.map((msg, index) => (\r\n                                <div key={index} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>\r\n                                    <div className={`max-w-[85%] rounded-2xl p-3 shadow-sm relative ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-br-none' : 'bg-white text-gray-800 rounded-bl-none'}`}>\r\n                                        {msg.imageUrl && <img src={msg.imageUrl} alt=\"Upload\" className=\"rounded-lg mb-2 max-h-48 object-cover\" />}\r\n                                        <div className={`prose prose-sm max-w-none ${msg.role === 'user' ? 'prose-invert' : ''}`}>\r\n                                            <ReactMarkdown remarkPlugins={[remarkGfm]}>{msg.text}</ReactMarkdown>\r\n                                        </div>\r\n                                        {msg.role === 'model' && (\r\n                                            <button onClick={() => playTTS(msg.text)} className=\"absolute -bottom-3 -right-3 p-1.5 bg-gray-200 rounded-full hover:bg-gray-300 shadow-sm text-gray-600\">\r\n                                                <PlayIcon className=\"w-3 h-3\" />\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                            {isLoading && (\r\n                                <div className=\"flex justify-start\"><div className=\"bg-white p-3 rounded-2xl rounded-bl-none shadow-sm\"><div className=\"flex space-x-1\"><div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\"></div><div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-75\"></div><div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-150\"></div></div></div></div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Chat Controls & Input */}\r\n                        <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-3\">\r\n                            {/* Tool Toggles */}\r\n                            <div className=\"flex space-x-2 overflow-x-auto pb-2 mb-1 no-scrollbar\">\r\n                                <button onClick={() => setThinkingMode(!thinkingMode)} className={`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${thinkingMode ? 'bg-purple-100 text-purple-700 border-purple-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`}>\r\n                                    <SparklesIcon className=\"w-3 h-3\" /> <span>Deep Thinker</span>\r\n                                </button>\r\n                                <button onClick={() => setUseGrounding(useGrounding === 'search' ? 'none' : 'search')} className={`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${useGrounding === 'search' ? 'bg-blue-100 text-blue-700 border-blue-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`}>\r\n                                    <SearchIcon className=\"w-3 h-3\" /> <span>Web Search</span>\r\n                                </button>\r\n                                <button onClick={() => setUseGrounding(useGrounding === 'maps' ? 'none' : 'maps')} className={`flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold border transition-colors ${useGrounding === 'maps' ? 'bg-green-100 text-green-700 border-green-300' : 'bg-gray-50 text-gray-600 border-gray-200'}`}>\r\n                                    <MapIcon className=\"w-3 h-3\" /> <span>Maps</span>\r\n                                </button>\r\n                            </div>\r\n\r\n                            {/* Input Bar */}\r\n                            <div className=\"flex items-end space-x-2\">\r\n                                <input type=\"file\" ref={fileInputRef} className=\"hidden\" accept=\"image/*\" onChange={(e) => e.target.files?.[0] && handleSendMessage(\"\", e.target.files[0])} />\r\n                                <button onClick={() => fileInputRef.current?.click()} className=\"p-2 text-gray-500 hover:bg-gray-100 rounded-full\"><CameraIcon className=\"w-6 h-6\" /></button>\r\n\r\n                                <div className=\"flex-grow bg-gray-100 rounded-2xl flex items-center px-3 py-2\">\r\n                                    <textarea\r\n                                        value={inputText}\r\n                                        onChange={e => setInputText(e.target.value)}\r\n                                        placeholder=\"Ask anything...\"\r\n                                        className=\"bg-transparent w-full outline-none resize-none text-sm max-h-24\"\r\n                                        rows={1}\r\n                                        onKeyDown={e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(inputText); } }}\r\n                                    />\r\n                                </div>\r\n\r\n                                {inputText ? (\r\n                                    <button onClick={() => handleSendMessage(inputText)} className={`p-3 rounded-full text-white shadow-md ${theme.mainBg}`}><SendIcon className=\"w-5 h-5\" /></button>\r\n                                ) : (\r\n                                    <button onClick={isRecording ? stopRecording : startRecording} className={`p-3 rounded-full shadow-md ${isRecording ? 'bg-red-500 text-white animate-pulse' : 'bg-gray-200 text-gray-600 hover:bg-gray-300'}`}>\r\n                                        {isRecording ? <StopIcon className=\"w-5 h-5\" /> : <MicrophoneIcon className=\"w-5 h-5\" />}\r\n                                    </button>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AIChatScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}