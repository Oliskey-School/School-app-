{"ast":null,"code":"import { supabase } from '../lib/supabase';\nclass RealtimeService {\n  channels = [];\n  constructor() {}\n  static getInstance() {\n    if (!RealtimeService.instance) {\n      RealtimeService.instance = new RealtimeService();\n    }\n    return RealtimeService.instance;\n  }\n  subscribeToNotifications(userId, onNotification) {\n    const channel = supabase.channel(`notifications:${userId}`).on('postgres_changes', {\n      event: 'INSERT',\n      schema: 'public',\n      table: 'notifications',\n      filter: `user_id=eq.${userId}`\n    }, payload => {\n      console.log('New notification received:', payload);\n      onNotification(payload.new);\n    }).subscribe(status => {\n      if (status === 'SUBSCRIBED') {\n        console.log(`Subscribed to notifications for user ${userId}`);\n      }\n    });\n    this.channels.push(channel);\n    return channel;\n  }\n  subscribeToAnnouncements(onAnnouncement) {\n    const channel = supabase.channel('global_announcements').on('postgres_changes', {\n      event: 'INSERT',\n      schema: 'public',\n      table: 'announcements'\n    }, payload => {\n      onAnnouncement(payload.new);\n    }).subscribe();\n    this.channels.push(channel);\n    return channel;\n  }\n  unsubscribeAll() {\n    this.channels.forEach(channel => {\n      supabase.removeChannel(channel);\n    });\n    this.channels = [];\n  }\n}\nexport const realtimeService = RealtimeService.getInstance();","map":{"version":3,"names":["supabase","RealtimeService","channels","constructor","getInstance","instance","subscribeToNotifications","userId","onNotification","channel","on","event","schema","table","filter","payload","console","log","new","subscribe","status","push","subscribeToAnnouncements","onAnnouncement","unsubscribeAll","forEach","removeChannel","realtimeService"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/services/RealtimeService.ts"],"sourcesContent":["import { supabase } from '../lib/supabase';\r\nimport { RealtimeChannel } from '@supabase/supabase-js';\r\n\r\ntype NotificationCallback = (payload: any) => void;\r\n\r\nclass RealtimeService {\r\n    private channels: RealtimeChannel[] = [];\r\n    private static instance: RealtimeService;\r\n\r\n    private constructor() { }\r\n\r\n    public static getInstance(): RealtimeService {\r\n        if (!RealtimeService.instance) {\r\n            RealtimeService.instance = new RealtimeService();\r\n        }\r\n        return RealtimeService.instance;\r\n    }\r\n\r\n    /**\r\n     * Subscribe to notifications for a specific user\r\n     * @param userId The ID of the user (can be string UUID or number)\r\n     * @param onNotification Callback function when a notification is received\r\n     */\r\n    public subscribeToNotifications(userId: string | number, onNotification: NotificationCallback) {\r\n        // Note: In Postgres, row level security usually filters this, \r\n        // but we can also filter by column in the channel subscription if valid\r\n        const channel = supabase\r\n            .channel(`notifications:${userId}`)\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: 'INSERT',\r\n                    schema: 'public',\r\n                    table: 'notifications',\r\n                    filter: `user_id=eq.${userId}`\r\n                },\r\n                (payload) => {\r\n                    console.log('New notification received:', payload);\r\n                    onNotification(payload.new);\r\n                }\r\n            )\r\n            .subscribe((status) => {\r\n                if (status === 'SUBSCRIBED') {\r\n                    console.log(`Subscribed to notifications for user ${userId}`);\r\n                }\r\n            });\r\n\r\n        this.channels.push(channel);\r\n        return channel;\r\n    }\r\n\r\n    /**\r\n     * Subscribe to global announcements\r\n     */\r\n    public subscribeToAnnouncements(onAnnouncement: NotificationCallback) {\r\n        const channel = supabase\r\n            .channel('global_announcements')\r\n            .on(\r\n                'postgres_changes',\r\n                {\r\n                    event: 'INSERT',\r\n                    schema: 'public',\r\n                    table: 'announcements' // Assuming there is an announcements table\r\n                },\r\n                (payload) => {\r\n                    onAnnouncement(payload.new);\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        this.channels.push(channel);\r\n        return channel;\r\n    }\r\n\r\n    // Note: For chat specifically, we often need to subscribe to specific rooms.\r\n    // We'll leave that to a specialized ChatService or expand this later.\r\n    // For now, we rely on the 'notifications' table for high-level alerts.\r\n\r\n    public unsubscribeAll() {\r\n        this.channels.forEach(channel => {\r\n            supabase.removeChannel(channel);\r\n        });\r\n        this.channels = [];\r\n    }\r\n}\r\n\r\nexport const realtimeService = RealtimeService.getInstance();\r\n"],"mappings":"AAAA,SAASA,QAAQ,QAAQ,iBAAiB;AAK1C,MAAMC,eAAe,CAAC;EACVC,QAAQ,GAAsB,EAAE;EAGhCC,WAAWA,CAAA,EAAG,CAAE;EAExB,OAAcC,WAAWA,CAAA,EAAoB;IACzC,IAAI,CAACH,eAAe,CAACI,QAAQ,EAAE;MAC3BJ,eAAe,CAACI,QAAQ,GAAG,IAAIJ,eAAe,CAAC,CAAC;IACpD;IACA,OAAOA,eAAe,CAACI,QAAQ;EACnC;EAOOC,wBAAwBA,CAACC,MAAuB,EAAEC,cAAoC,EAAE;IAG3F,MAAMC,OAAO,GAAGT,QAAQ,CACnBS,OAAO,CAAC,iBAAiBF,MAAM,EAAE,CAAC,CAClCG,EAAE,CACC,kBAAkB,EAClB;MACIC,KAAK,EAAE,QAAQ;MACfC,MAAM,EAAE,QAAQ;MAChBC,KAAK,EAAE,eAAe;MACtBC,MAAM,EAAE,cAAcP,MAAM;IAChC,CAAC,EACAQ,OAAO,IAAK;MACTC,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEF,OAAO,CAAC;MAClDP,cAAc,CAACO,OAAO,CAACG,GAAG,CAAC;IAC/B,CACJ,CAAC,CACAC,SAAS,CAAEC,MAAM,IAAK;MACnB,IAAIA,MAAM,KAAK,YAAY,EAAE;QACzBJ,OAAO,CAACC,GAAG,CAAC,wCAAwCV,MAAM,EAAE,CAAC;MACjE;IACJ,CAAC,CAAC;IAEN,IAAI,CAACL,QAAQ,CAACmB,IAAI,CAACZ,OAAO,CAAC;IAC3B,OAAOA,OAAO;EAClB;EAKOa,wBAAwBA,CAACC,cAAoC,EAAE;IAClE,MAAMd,OAAO,GAAGT,QAAQ,CACnBS,OAAO,CAAC,sBAAsB,CAAC,CAC/BC,EAAE,CACC,kBAAkB,EAClB;MACIC,KAAK,EAAE,QAAQ;MACfC,MAAM,EAAE,QAAQ;MAChBC,KAAK,EAAE;IACX,CAAC,EACAE,OAAO,IAAK;MACTQ,cAAc,CAACR,OAAO,CAACG,GAAG,CAAC;IAC/B,CACJ,CAAC,CACAC,SAAS,CAAC,CAAC;IAEhB,IAAI,CAACjB,QAAQ,CAACmB,IAAI,CAACZ,OAAO,CAAC;IAC3B,OAAOA,OAAO;EAClB;EAMOe,cAAcA,CAAA,EAAG;IACpB,IAAI,CAACtB,QAAQ,CAACuB,OAAO,CAAChB,OAAO,IAAI;MAC7BT,QAAQ,CAAC0B,aAAa,CAACjB,OAAO,CAAC;IACnC,CAAC,CAAC;IACF,IAAI,CAACP,QAAQ,GAAG,EAAE;EACtB;AACJ;AAEA,OAAO,MAAMyB,eAAe,GAAG1B,eAAe,CAACG,WAAW,CAAC,CAAC","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}