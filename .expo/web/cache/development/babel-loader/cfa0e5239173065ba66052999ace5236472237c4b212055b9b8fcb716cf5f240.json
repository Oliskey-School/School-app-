{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\student\\\\QuizPlayerScreen.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { CheckCircleIcon, XCircleIcon, ClockIcon } from '../../constants';\nimport { toast } from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst QuizPlayerScreen = ({\n  quizId,\n  handleBack,\n  title\n}) => {\n  const [quiz, setQuiz] = useState(null);\n  const [questions, setQuestions] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswerId, setSelectedAnswerId] = useState(null);\n  const [score, setScore] = useState(0);\n  const [isFinished, setIsFinished] = useState(false);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [timeLeft, setTimeLeft] = useState(null);\n  const [focusViolations, setFocusViolations] = useState(0);\n  useEffect(() => {\n    fetchQuizDetails();\n  }, [quizId]);\n  useEffect(() => {\n    if (!timeLeft || isFinished || loading) return;\n    if (timeLeft <= 0) {\n      finishQuiz(true);\n      return;\n    }\n    const timer = setInterval(() => {\n      setTimeLeft(prev => prev !== null ? prev - 1 : null);\n    }, 1000);\n    return () => clearInterval(timer);\n  }, [timeLeft, isFinished, loading]);\n  useEffect(() => {\n    if (isFinished || loading) return;\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        setFocusViolations(prev => {\n          const newVal = prev + 1;\n          if (newVal <= 3) {\n            toast.error(`⚠️ Warning: Playing elsewhere? Focus violation ${newVal}/3 recorded.`);\n          } else {\n            toast.error(`⚠️ Multiple violations detected. Exam flagged.`);\n          }\n          return newVal;\n        });\n      }\n    };\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n  }, [isFinished, loading]);\n  const [answersLog, setAnswersLog] = useState({});\n  const fetchQuizDetails = async () => {\n    try {\n      const {\n        data: examData,\n        error: examError\n      } = await supabase.from('cbt_exams').select('*').eq('id', quizId).single();\n      if (examError) {\n        console.error(\"Error loading CBT exam:\", examError);\n        throw examError;\n      }\n      setQuiz({\n        id: examData.id,\n        title: examData.title,\n        durationMinutes: examData.duration_minutes,\n        subject: 'Exam',\n        questions: []\n      });\n      if (examData.duration_minutes) {\n        setTimeLeft(examData.duration_minutes * 60);\n      }\n      const {\n        data: cbtQuestions,\n        error: qError\n      } = await supabase.from('cbt_questions').select('*').eq('cbt_exam_id', quizId);\n      if (qError) throw qError;\n      const mappedQuestions = (cbtQuestions || []).map(q => ({\n        id: q.id,\n        text: q.question_text,\n        type: 'MCQ',\n        points: q.marks || 1,\n        options: [{\n          id: 'A',\n          text: q.option_a,\n          isCorrect: q.correct_option === 'A'\n        }, {\n          id: 'B',\n          text: q.option_b,\n          isCorrect: q.correct_option === 'B'\n        }, {\n          id: 'C',\n          text: q.option_c,\n          isCorrect: q.correct_option === 'C'\n        }, {\n          id: 'D',\n          text: q.option_d,\n          isCorrect: q.correct_option === 'D'\n        }]\n      }));\n      let loadedQuestions = mappedQuestions;\n      for (let i = loadedQuestions.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [loadedQuestions[i], loadedQuestions[j]] = [loadedQuestions[j], loadedQuestions[i]];\n      }\n      setQuestions(loadedQuestions);\n    } catch (err) {\n      console.error('Error fetching quiz details:', err);\n      toast.error('Failed to load quiz');\n      handleBack();\n    } finally {\n      setLoading(false);\n    }\n  };\n  const handleAnswerSelect = optionId => {\n    setSelectedAnswerId(optionId);\n    const currentQ = questions[currentQuestionIndex];\n    setAnswersLog(prev => Object.assign({}, prev, {\n      [currentQ.id]: optionId\n    }));\n  };\n  const finishQuiz = async (autoSubmit = false) => {\n    setIsFinished(true);\n    if (autoSubmit) {\n      toast('Time is up! Submitting automatically.', {\n        icon: '⏰'\n      });\n    }\n    setIsSubmitting(true);\n    try {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) throw new Error(\"Not authenticated\");\n      const {\n        data: student\n      } = await supabase.from('students').select('id').eq('user_id', user.id).single();\n      if (!student) throw new Error(\"Student profile not found\");\n      let finalScore = 0;\n      const submissionAnswers = questions.map(q => {\n        const selected = answersLog[q.id];\n        const correctOpt = q.options?.find(o => o.isCorrect);\n        const isCorrect = correctOpt?.id === selected;\n        if (isCorrect) finalScore += q.points || 1;\n        return {\n          questionId: q.id,\n          selectedOption: selected || null,\n          isCorrect\n        };\n      });\n      setScore(finalScore);\n      const submissionData = {\n        cbt_exam_id: quizId,\n        student_id: student.id,\n        score: finalScore,\n        answers: submissionAnswers,\n        status: 'Graded',\n        submitted_at: new Date().toISOString()\n      };\n      const {\n        error\n      } = await supabase.from('cbt_submissions').insert(submissionData);\n      if (error) {\n        console.error('Error saving quiz result:', error);\n        toast.error('Failed to save result. Please screenshot this page.');\n      } else {\n        toast.success('Exam submitted successfully!');\n      }\n    } catch (err) {\n      console.error(\"Quiz submission error:\", err);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  const formatTime = seconds => {\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m}:${s < 10 ? '0' : ''}${s}`;\n  };\n  if (loading) {\n    return _jsxDEV(\"div\", {\n      className: \"flex justify-center items-center h-full bg-gray-50\",\n      children: _jsxDEV(\"div\", {\n        className: \"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }, this);\n  }\n  if (!quiz || questions.length === 0) {\n    return _jsxDEV(\"div\", {\n      className: \"flex flex-col items-center justify-center h-full text-center p-6 bg-gray-50\",\n      children: [_jsxDEV(\"p\", {\n        className: \"text-gray-500 mb-4\",\n        children: \"Quiz not found or has no questions.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this), _jsxDEV(\"button\", {\n        onClick: handleBack,\n        className: \"text-blue-600 hover:underline\",\n        children: \"Go Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 7\n    }, this);\n  }\n  if (isFinished) {\n    const percentage = Math.round(score / questions.length * 100);\n    const totalPoints = questions.reduce((acc, q) => acc + (q.points || 1), 0);\n    const earnedPoints = Math.round(score / questions.length * totalPoints);\n    return _jsxDEV(\"div\", {\n      className: \"p-6 flex flex-col items-center justify-center h-full text-center bg-gray-50 animate-fade-in\",\n      children: [_jsxDEV(\"div\", {\n        className: \"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6\",\n        children: _jsxDEV(CheckCircleIcon, {\n          className: \"w-10 h-10 text-green-600\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this), _jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold text-gray-800\",\n        children: \"Quiz Complete!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this), _jsxDEV(\"p\", {\n        className: \"text-5xl font-bold my-6 text-orange-500\",\n        children: [percentage, \"%\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }, this), _jsxDEV(\"div\", {\n        className: \"bg-white p-4 rounded-xl shadow-sm w-full max-w-sm mb-6 space-y-2\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex justify-between text-gray-600\",\n          children: [_jsxDEV(\"span\", {\n            children: \"Correct Answers\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 13\n          }, this), _jsxDEV(\"span\", {\n            className: \"font-bold text-gray-800\",\n            children: [score, \" / \", questions.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 264,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 11\n        }, this), _jsxDEV(\"div\", {\n          className: \"flex justify-between text-gray-600\",\n          children: [_jsxDEV(\"span\", {\n            children: \"Points Earned\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this), _jsxDEV(\"span\", {\n            className: \"font-bold text-green-600\",\n            children: [\"+\", earnedPoints, \" XP\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }, this), focusViolations > 0 && _jsxDEV(\"div\", {\n          className: \"flex justify-between text-red-500 mt-2 pt-2 border-t border-gray-100\",\n          children: [_jsxDEV(\"span\", {\n            className: \"flex items-center\",\n            children: [_jsxDEV(XCircleIcon, {\n              className: \"w-4 h-4 mr-1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 272,\n              columnNumber: 51\n            }, this), \" Focus Violations\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 15\n          }, this), _jsxDEV(\"span\", {\n            className: \"font-bold\",\n            children: focusViolations\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), _jsxDEV(\"button\", {\n        onClick: handleBack,\n        className: \"w-full max-w-sm px-6 py-3 bg-orange-500 text-white font-bold rounded-xl shadow-lg hover:bg-orange-600 transition-transform active:scale-95\",\n        children: \"Back to Assessments\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 7\n    }, this);\n  }\n  const currentQuestion = questions[currentQuestionIndex];\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50\",\n    children: [_jsxDEV(\"div\", {\n      className: \"p-4 border-b bg-white sticky top-0 z-10 transition-colors duration-300\",\n      children: [_jsxDEV(\"div\", {\n        className: \"flex justify-between items-center mb-3\",\n        children: [_jsxDEV(\"h3\", {\n          className: \"font-bold text-gray-700 truncate max-w-[150px]\",\n          children: quiz.title\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 11\n        }, this), _jsxDEV(\"div\", {\n          className: \"flex items-center space-x-2\",\n          children: [timeLeft !== null && _jsxDEV(\"div\", {\n            className: `flex items-center text-xs font-bold px-3 py-1.5 rounded-lg transition-colors ${timeLeft < 60 ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-orange-50 text-orange-600'}`,\n            children: [_jsxDEV(ClockIcon, {\n              className: \"w-4 h-4 mr-1.5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 17\n            }, this), _jsxDEV(\"span\", {\n              children: formatTime(timeLeft)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 15\n          }, this), _jsxDEV(\"div\", {\n            className: \"flex items-center text-xs text-gray-500 bg-gray-100 px-2 py-1.5 rounded-lg\",\n            children: _jsxDEV(\"span\", {\n              children: [currentQuestionIndex + 1, \"/\", questions.length]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 303,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), _jsxDEV(\"div\", {\n        className: \"w-full bg-gray-200 rounded-full h-2\",\n        children: _jsxDEV(\"div\", {\n          className: \"bg-orange-500 h-2 rounded-full transition-all duration-300\",\n          style: {\n            width: `${(currentQuestionIndex + 1) / questions.length * 100}%`\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 7\n    }, this), _jsxDEV(\"main\", {\n      className: \"flex-grow p-4 md:p-6 overflow-y-auto flex flex-col max-w-2xl mx-auto w-full\",\n      children: [focusViolations > 0 && !isFinished && _jsxDEV(\"div\", {\n        className: \"mb-4 bg-red-50 border border-red-200 p-2 rounded-lg flex items-center text-red-700 text-xs font-bold animate-bounce\",\n        children: [_jsxDEV(XCircleIcon, {\n          className: \"w-4 h-4 mr-2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 13\n        }, this), \"Focus Lost Detected! (\", focusViolations, \")\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 11\n      }, this), _jsxDEV(\"div\", {\n        className: \"flex-grow\",\n        children: [_jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6\",\n          children: [_jsxDEV(\"span\", {\n            className: \"text-xs font-bold text-blue-500 uppercase tracking-wide mb-2 block\",\n            children: [\"Question \", currentQuestionIndex + 1]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 13\n          }, this), _jsxDEV(\"h3\", {\n            className: \"text-xl font-bold text-gray-800 leading-snug\",\n            children: currentQuestion.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 13\n          }, this), currentQuestion.type === 'Theory' && _jsxDEV(\"p\", {\n            className: \"mt-2 text-sm text-gray-400 italic\",\n            children: \"This is a theory question. Please write your answer in your notebook.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 11\n        }, this), _jsxDEV(\"div\", {\n          className: \"space-y-3\",\n          children: [currentQuestion.options && currentQuestion.options.map(option => {\n            const isSelected = selectedAnswerId === option.id;\n            const showFeedback = selectedAnswerId !== null;\n            const isCorrect = option.isCorrect;\n            let cardClass = 'bg-white border-gray-200 hover:bg-gray-50 hover:border-gray-300';\n            let icon = null;\n            if (showFeedback) {\n              if (isSelected) {\n                cardClass = 'bg-orange-50 border-orange-500 ring-1 ring-orange-500';\n              } else {\n                cardClass = 'bg-gray-50 opacity-50 border-gray-100';\n              }\n            }\n            return _jsxDEV(\"button\", {\n              onClick: () => handleAnswerSelect(option.id),\n              disabled: selectedAnswerId !== null,\n              className: `w-full p-4 rounded-xl border-2 text-left font-semibold text-gray-700 transition-all flex justify-between items-center ${cardClass} shadow-sm`,\n              children: [_jsxDEV(\"span\", {\n                children: option.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 19\n              }, this), isSelected && _jsxDEV(\"div\", {\n                className: \"w-4 h-4 bg-orange-500 rounded-full\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 362,\n                columnNumber: 34\n              }, this)]\n            }, option.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 354,\n              columnNumber: 17\n            }, this);\n          }), currentQuestion.type === 'Theory' && _jsxDEV(\"div\", {\n            className: \"bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-yellow-800 text-sm\",\n            children: \"Theory questions are not auto-graded in this mode. Tap 'Next' to continue.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 9\n      }, this), _jsxDEV(\"div\", {\n        className: \"mt-6 pt-4 border-t border-gray-100 sticky bottom-0 bg-gray-50 pb-2\",\n        children: _jsxDEV(\"button\", {\n          onClick: handleNext,\n          disabled: selectedAnswerId === null && currentQuestion.type !== 'Theory',\n          className: \"w-full py-4 px-6 font-bold text-white bg-orange-600 rounded-xl shadow-lg hover:bg-orange-700 hover:shadow-xl active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none disabled:active:scale-100\",\n          children: currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Quiz'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 375,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 288,\n    columnNumber: 5\n  }, this);\n};\nexport default QuizPlayerScreen;","map":{"version":3,"names":["React","useState","useEffect","supabase","CheckCircleIcon","XCircleIcon","ClockIcon","toast","jsxDEV","_jsxDEV","QuizPlayerScreen","quizId","handleBack","title","quiz","setQuiz","questions","setQuestions","loading","setLoading","currentQuestionIndex","setCurrentQuestionIndex","selectedAnswerId","setSelectedAnswerId","score","setScore","isFinished","setIsFinished","isSubmitting","setIsSubmitting","timeLeft","setTimeLeft","focusViolations","setFocusViolations","fetchQuizDetails","finishQuiz","timer","setInterval","prev","clearInterval","handleVisibilityChange","document","hidden","newVal","error","addEventListener","removeEventListener","answersLog","setAnswersLog","data","examData","examError","from","select","eq","single","console","id","durationMinutes","duration_minutes","subject","cbtQuestions","qError","mappedQuestions","map","q","text","question_text","type","points","marks","options","option_a","isCorrect","correct_option","option_b","option_c","option_d","loadedQuestions","i","length","j","Math","floor","random","err","handleAnswerSelect","optionId","currentQ","Object","assign","autoSubmit","icon","user","auth","getUser","Error","student","finalScore","submissionAnswers","selected","correctOpt","find","o","questionId","selectedOption","submissionData","cbt_exam_id","student_id","answers","status","submitted_at","Date","toISOString","insert","success","formatTime","seconds","m","s","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","percentage","round","totalPoints","reduce","acc","earnedPoints","currentQuestion","style","width","option","isSelected","showFeedback","cardClass","disabled","handleNext"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/student/QuizPlayerScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { Quiz, Question, QuestionOption } from '../../types';\r\nimport { CheckCircleIcon, XCircleIcon, ClockIcon } from '../../constants';\r\nimport { toast } from 'react-hot-toast';\r\n\r\ninterface QuizPlayerScreenProps {\r\n  quizId: number;\r\n  handleBack: () => void;\r\n  title?: string; // Optional title passed from nav\r\n}\r\n\r\nconst QuizPlayerScreen: React.FC<QuizPlayerScreenProps> = ({ quizId, handleBack, title }) => {\r\n  const [quiz, setQuiz] = useState<Quiz | null>(null);\r\n  const [questions, setQuestions] = useState<Question[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\r\n  const [selectedAnswerId, setSelectedAnswerId] = useState<string | null>(null);\r\n  const [score, setScore] = useState(0);\r\n  const [isFinished, setIsFinished] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Integrity State\r\n  const [timeLeft, setTimeLeft] = useState<number | null>(null); // in seconds\r\n  const [focusViolations, setFocusViolations] = useState(0);\r\n\r\n  useEffect(() => {\r\n    fetchQuizDetails();\r\n  }, [quizId]);\r\n\r\n  // Timer Logic\r\n  useEffect(() => {\r\n    if (!timeLeft || isFinished || loading) return;\r\n\r\n    if (timeLeft <= 0) {\r\n      finishQuiz(true); // Auto-submit\r\n      return;\r\n    }\r\n\r\n    const timer = setInterval(() => {\r\n      setTimeLeft(prev => (prev !== null ? prev - 1 : null));\r\n    }, 1000);\r\n\r\n    return () => clearInterval(timer);\r\n  }, [timeLeft, isFinished, loading]);\r\n\r\n  // Focus Mode Logic (Anti-Cheat)\r\n  useEffect(() => {\r\n    if (isFinished || loading) return;\r\n\r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        setFocusViolations(prev => {\r\n          const newVal = prev + 1;\r\n          if (newVal <= 3) {\r\n            toast.error(`⚠️ Warning: Playing elsewhere? Focus violation ${newVal}/3 recorded.`);\r\n          } else {\r\n            toast.error(`⚠️ Multiple violations detected. Exam flagged.`);\r\n          }\r\n          return newVal;\r\n        });\r\n      }\r\n    };\r\n\r\n    document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n    return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n  }, [isFinished, loading]);\r\n\r\n  // New State for detailed answers\r\n  const [answersLog, setAnswersLog] = useState<Record<string, string>>({}); // questionId -> optionId\r\n\r\n  // ... (inside useEffect)\r\n\r\n  const fetchQuizDetails = async () => {\r\n    try {\r\n      // 1. Fetch Exam Details (CBT Schema)\r\n      const { data: examData, error: examError } = await supabase\r\n        .from('cbt_exams')\r\n        .select('*')\r\n        .eq('id', quizId)\r\n        .single();\r\n\r\n      if (examError) {\r\n        console.error(\"Error loading CBT exam:\", examError);\r\n        // Fallback to legacy quiz table if not found? \r\n        // For now, assume unification.\r\n        throw examError;\r\n      }\r\n\r\n      setQuiz({\r\n        id: examData.id,\r\n        title: examData.title,\r\n        durationMinutes: examData.duration_minutes,\r\n        subject: 'Exam', // Or fetch from relation\r\n        questions: []\r\n      } as any);\r\n\r\n      if (examData.duration_minutes) {\r\n        setTimeLeft(examData.duration_minutes * 60);\r\n      }\r\n\r\n      // 2. Fetch Questions (CBT Schema)\r\n      const { data: cbtQuestions, error: qError } = await supabase\r\n        .from('cbt_questions')\r\n        .select('*')\r\n        .eq('cbt_exam_id', quizId);\r\n\r\n      if (qError) throw qError;\r\n\r\n      // Map CBT questions to UI format\r\n      const mappedQuestions: Question[] = (cbtQuestions || []).map((q: any) => ({\r\n        id: q.id,\r\n        text: q.question_text,\r\n        type: 'MCQ', // Excel upload implies MCQ usually\r\n        points: q.marks || 1,\r\n        options: [\r\n          { id: 'A', text: q.option_a, isCorrect: q.correct_option === 'A' },\r\n          { id: 'B', text: q.option_b, isCorrect: q.correct_option === 'B' },\r\n          { id: 'C', text: q.option_c, isCorrect: q.correct_option === 'C' },\r\n          { id: 'D', text: q.option_d, isCorrect: q.correct_option === 'D' },\r\n        ]\r\n      }));\r\n\r\n      // Randomization\r\n      let loadedQuestions = mappedQuestions;\r\n      for (let i = loadedQuestions.length - 1; i > 0; i--) {\r\n        const j = Math.floor(Math.random() * (i + 1));\r\n        [loadedQuestions[i], loadedQuestions[j]] = [loadedQuestions[j], loadedQuestions[i]];\r\n      }\r\n\r\n      setQuestions(loadedQuestions);\r\n\r\n    } catch (err: any) {\r\n      console.error('Error fetching quiz details:', err);\r\n      toast.error('Failed to load quiz');\r\n      handleBack();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAnswerSelect = (optionId: string) => {\r\n    // Allow changing answer if not locked? Actually, for CBT, usually we select and can submit later?\r\n    // But adhering to previous flow: instant feedback/lock? \r\n    // User request: \"student will have to answer the question in real time\"\r\n    // \"only teacher... can see the score\".\r\n    // This suggests NO immediate feedback on correct/wrong.\r\n    // So I should REMOVE immediate grading feedback in the UI for Security.\r\n\r\n    setSelectedAnswerId(optionId);\r\n\r\n    // Log for final submission\r\n    const currentQ = questions[currentQuestionIndex];\r\n    setAnswersLog(prev => ({\r\n      ...prev,\r\n      [currentQ.id]: optionId\r\n    }));\r\n\r\n    // Calculate score silently? Or just on submit.\r\n    // Better to calculate on submit to avoid state drift.\r\n  };\r\n\r\n  // ...\r\n\r\n  const finishQuiz = async (autoSubmit = false) => {\r\n    setIsFinished(true);\r\n    if (autoSubmit) {\r\n      toast('Time is up! Submitting automatically.', { icon: '⏰' });\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const { data: student } = await supabase.from('students').select('id').eq('user_id', user.id).single();\r\n      if (!student) throw new Error(\"Student profile not found\");\r\n\r\n      // Calculate Score Final\r\n      let finalScore = 0;\r\n      const submissionAnswers = questions.map(q => {\r\n        const selected = answersLog[q.id];\r\n        const correctOpt = q.options?.find(o => o.isCorrect);\r\n        const isCorrect = correctOpt?.id === selected;\r\n        if (isCorrect) finalScore += (q.points || 1);\r\n\r\n        return {\r\n          questionId: q.id,\r\n          selectedOption: selected || null,\r\n          isCorrect\r\n        };\r\n      });\r\n\r\n      // Override local score state with final calculation\r\n      setScore(finalScore);\r\n\r\n      const submissionData = {\r\n        cbt_exam_id: quizId,\r\n        student_id: student.id,\r\n        score: finalScore,\r\n        answers: submissionAnswers, // Store detailed JSON\r\n        status: 'Graded',\r\n        submitted_at: new Date().toISOString()\r\n      };\r\n\r\n      const { error } = await supabase.from('cbt_submissions').insert(submissionData);\r\n\r\n      if (error) {\r\n        console.error('Error saving quiz result:', error);\r\n        toast.error('Failed to save result. Please screenshot this page.');\r\n      } else {\r\n        toast.success('Exam submitted successfully!');\r\n      }\r\n\r\n    } catch (err) {\r\n      console.error(\"Quiz submission error:\", err);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n\r\n  const formatTime = (seconds: number) => {\r\n    const m = Math.floor(seconds / 60);\r\n    const s = seconds % 60;\r\n    return `${m}:${s < 10 ? '0' : ''}${s}`;\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex justify-center items-center h-full bg-gray-50\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!quiz || questions.length === 0) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center h-full text-center p-6 bg-gray-50\">\r\n        <p className=\"text-gray-500 mb-4\">Quiz not found or has no questions.</p>\r\n        <button onClick={handleBack} className=\"text-blue-600 hover:underline\">Go Back</button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isFinished) {\r\n    const percentage = Math.round((score / questions.length) * 100);\r\n    const totalPoints = questions.reduce((acc, q) => acc + (q.points || 1), 0);\r\n    const earnedPoints = Math.round((score / questions.length) * totalPoints);\r\n\r\n    return (\r\n      <div className=\"p-6 flex flex-col items-center justify-center h-full text-center bg-gray-50 animate-fade-in\">\r\n        <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-6\">\r\n          <CheckCircleIcon className=\"w-10 h-10 text-green-600\" />\r\n        </div>\r\n        <h2 className=\"text-2xl font-bold text-gray-800\">Quiz Complete!</h2>\r\n        <p className=\"text-5xl font-bold my-6 text-orange-500\">{percentage}%</p>\r\n\r\n        <div className=\"bg-white p-4 rounded-xl shadow-sm w-full max-w-sm mb-6 space-y-2\">\r\n          <div className=\"flex justify-between text-gray-600\">\r\n            <span>Correct Answers</span>\r\n            <span className=\"font-bold text-gray-800\">{score} / {questions.length}</span>\r\n          </div>\r\n          <div className=\"flex justify-between text-gray-600\">\r\n            <span>Points Earned</span>\r\n            <span className=\"font-bold text-green-600\">+{earnedPoints} XP</span>\r\n          </div>\r\n          {focusViolations > 0 && (\r\n            <div className=\"flex justify-between text-red-500 mt-2 pt-2 border-t border-gray-100\">\r\n              <span className=\"flex items-center\"><XCircleIcon className=\"w-4 h-4 mr-1\" /> Focus Violations</span>\r\n              <span className=\"font-bold\">{focusViolations}</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <button onClick={handleBack} className=\"w-full max-w-sm px-6 py-3 bg-orange-500 text-white font-bold rounded-xl shadow-lg hover:bg-orange-600 transition-transform active:scale-95\">\r\n          Back to Assessments\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const currentQuestion = questions[currentQuestionIndex];\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-gray-50\">\r\n      {/* Header / Progress */}\r\n      <div className=\"p-4 border-b bg-white sticky top-0 z-10 transition-colors duration-300\">\r\n        <div className=\"flex justify-between items-center mb-3\">\r\n          <h3 className=\"font-bold text-gray-700 truncate max-w-[150px]\">{quiz.title}</h3>\r\n\r\n          <div className=\"flex items-center space-x-2\">\r\n            {timeLeft !== null && (\r\n              <div className={`flex items-center text-xs font-bold px-3 py-1.5 rounded-lg transition-colors ${timeLeft < 60 ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-orange-50 text-orange-600'}`}>\r\n                <ClockIcon className=\"w-4 h-4 mr-1.5\" />\r\n                <span>{formatTime(timeLeft)}</span>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex items-center text-xs text-gray-500 bg-gray-100 px-2 py-1.5 rounded-lg\">\r\n              <span>{currentQuestionIndex + 1}/{questions.length}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n          <div\r\n            className=\"bg-orange-500 h-2 rounded-full transition-all duration-300\"\r\n            style={{ width: `${((currentQuestionIndex + 1) / questions.length) * 100}%` }}\r\n          ></div>\r\n        </div>\r\n      </div>\r\n\r\n      <main className=\"flex-grow p-4 md:p-6 overflow-y-auto flex flex-col max-w-2xl mx-auto w-full\">\r\n        {focusViolations > 0 && !isFinished && (\r\n          <div className=\"mb-4 bg-red-50 border border-red-200 p-2 rounded-lg flex items-center text-red-700 text-xs font-bold animate-bounce\">\r\n            <XCircleIcon className=\"w-4 h-4 mr-2\" />\r\n            Focus Lost Detected! ({focusViolations})\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex-grow\">\r\n          <div className=\"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6\">\r\n            <span className=\"text-xs font-bold text-blue-500 uppercase tracking-wide mb-2 block\">Question {currentQuestionIndex + 1}</span>\r\n            <h3 className=\"text-xl font-bold text-gray-800 leading-snug\">{currentQuestion.text}</h3>\r\n            {currentQuestion.type === 'Theory' && (\r\n              <p className=\"mt-2 text-sm text-gray-400 italic\">This is a theory question. Please write your answer in your notebook.</p>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"space-y-3\">\r\n            {currentQuestion.options && currentQuestion.options.map((option) => {\r\n              const isSelected = selectedAnswerId === option.id;\r\n              // Only show correct/wrong feedback AFTER selection\r\n              const showFeedback = selectedAnswerId !== null;\r\n              const isCorrect = option.isCorrect;\r\n\r\n              let cardClass = 'bg-white border-gray-200 hover:bg-gray-50 hover:border-gray-300';\r\n              let icon = null;\r\n\r\n              if (showFeedback) {\r\n                // SECURE MODE: Do not show correct/wrong feedback\r\n                // Just show selected state\r\n                if (isSelected) {\r\n                  cardClass = 'bg-orange-50 border-orange-500 ring-1 ring-orange-500';\r\n                  // icon = <CheckCircleIcon className=\"text-orange-600 w-6 h-6\" />; // Maybe just a checkmark to show selected?\r\n                } else {\r\n                  cardClass = 'bg-gray-50 opacity-50 border-gray-100';\r\n                }\r\n              }\r\n\r\n              return (\r\n                <button\r\n                  key={option.id}\r\n                  onClick={() => handleAnswerSelect(option.id)}\r\n                  // allow changing answer? The previous logic disabled it. \r\n                  disabled={selectedAnswerId !== null}\r\n                  className={`w-full p-4 rounded-xl border-2 text-left font-semibold text-gray-700 transition-all flex justify-between items-center ${cardClass} shadow-sm`}\r\n                >\r\n                  <span>{option.text}</span>\r\n                  {isSelected && <div className=\"w-4 h-4 bg-orange-500 rounded-full\" />}\r\n                </button>\r\n              );\r\n            })}\r\n\r\n            {currentQuestion.type === 'Theory' && (\r\n              <div className=\"bg-yellow-50 p-4 rounded-xl border border-yellow-200 text-yellow-800 text-sm\">\r\n                Theory questions are not auto-graded in this mode. Tap 'Next' to continue.\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mt-6 pt-4 border-t border-gray-100 sticky bottom-0 bg-gray-50 pb-2\">\r\n          <button\r\n            onClick={handleNext}\r\n            disabled={selectedAnswerId === null && currentQuestion.type !== 'Theory'} // Theory allows skip for now, MCQ requires answer\r\n            className=\"w-full py-4 px-6 font-bold text-white bg-orange-600 rounded-xl shadow-lg hover:bg-orange-700 hover:shadow-xl active:scale-95 transition-all disabled:opacity-50 disabled:shadow-none disabled:active:scale-100\"\r\n          >\r\n            {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Quiz'}\r\n          </button>\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QuizPlayerScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}