{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\admin\\\\AddStudentScreen.tsx\";\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon } from '../../constants';\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\nimport { createUserAccount, sendVerificationEmail } from '../../lib/auth';\nimport CredentialsModal from '../ui/CredentialsModal';\nimport { mockStudents, mockParents } from '../../data';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AddStudentScreen = ({\n  studentToEdit,\n  forceUpdate,\n  handleBack\n}) => {\n  const [selectedImage, setSelectedImage] = useState(null);\n  const [fullName, setFullName] = useState('');\n  const [gender, setGender] = useState('');\n  const [birthday, setBirthday] = useState('');\n  const [className, setClassName] = useState('');\n  const [section, setSection] = useState('');\n  const [department, setDepartment] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [showCredentialsModal, setShowCredentialsModal] = useState(false);\n  const [credentials, setCredentials] = useState(null);\n  const [guardianName, setGuardianName] = useState('');\n  const [guardianPhone, setGuardianPhone] = useState('');\n  const [guardianEmail, setGuardianEmail] = useState('');\n  const grade = useMemo(() => {\n    const match = className.match(/\\d+/);\n    return match ? parseInt(match[0], 10) : 0;\n  }, [className]);\n  useEffect(() => {\n    if (studentToEdit) {\n      setSelectedImage(studentToEdit.avatarUrl);\n      setFullName(studentToEdit.name);\n      setBirthday(studentToEdit.birthday || '');\n      setClassName(`Grade ${studentToEdit.grade} `);\n      setSection(studentToEdit.section);\n      setDepartment(studentToEdit.department || '');\n      const fetchGuardian = async () => {\n        if (isSupabaseConfigured) {\n          try {\n            const {\n              data,\n              error\n            } = await supabase.from('parent_children').select(`\nparents(\n    name,\n    email,\n    phone\n)\n                            `).eq('student_id', studentToEdit.id).maybeSingle();\n            if (!error && data && data.parents) {\n              const p = Array.isArray(data.parents) ? data.parents[0] : data.parents;\n              if (p) {\n                setGuardianName(p.name || '');\n                setGuardianEmail(p.email || '');\n                setGuardianPhone(p.phone || '');\n              }\n            }\n          } catch (err) {\n            console.error(\"Error fetching guardian:\", err);\n          }\n        } else {\n          const parent = mockParents.find(p => p.childIds?.includes(studentToEdit.id));\n          if (parent) {\n            setGuardianName(parent.name);\n            setGuardianEmail(parent.email);\n            setGuardianPhone(parent.phone);\n          }\n        }\n      };\n      fetchGuardian();\n    }\n  }, [studentToEdit]);\n  const handleImageChange = event => {\n    if (event.target.files && event.target.files[0]) {\n      const file = event.target.files[0];\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setSelectedImage(reader.result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setIsLoading(true);\n    try {\n      const gEmail = guardianEmail.trim().toLowerCase();\n      const gName = guardianName.trim();\n      if (gName && !gEmail) {\n        toast.error(\"Guardian Email is required to create or link guardian details.\");\n        setIsLoading(false);\n        return;\n      }\n      let generatedEmail = `${fullName.toLowerCase().replace(/\\s+/g, '.')} @student.school.com`;\n      const avatarUrl = selectedImage || `https://i.pravatar.cc/150?u=${fullName.replace(' ', '')}`;\n      if (!isSupabaseConfigured) {\n        if (studentToEdit) {\n          const index = mockStudents.findIndex(s => s.id === studentToEdit.id);\n          if (index !== -1) {\n            mockStudents[index] = Object.assign({}, mockStudents[index], {\n              name: fullName,\n              grade,\n              section,\n              department: department || undefined,\n              birthday: birthday || undefined,\n              avatarUrl: avatarUrl\n            });\n          }\n          toast.success('Student updated successfully (Mock Mode - Session Only)');\n        } else {\n          const newId = mockStudents.length > 0 ? Math.max(...mockStudents.map(s => s.id)) + 1 : 1;\n          const newStudent = {\n            id: newId,\n            name: fullName,\n            email: generatedEmail,\n            avatarUrl: avatarUrl,\n            grade: grade,\n            section: section,\n            department: department || undefined,\n            attendanceStatus: 'Present',\n            birthday: birthday || undefined,\n            academicPerformance: [],\n            behaviorNotes: []\n          };\n          mockStudents.push(newStudent);\n          let successMessage = `Student account created for ${fullName}.\\nCredentials: ${generatedEmail.split('@')[0]} / password123\\n\\n`;\n          if (gEmail && gName) {\n            const existingParent = mockParents.find(p => p.email === gEmail);\n            if (existingParent) {\n              if (!existingParent.childIds) existingParent.childIds = [];\n              if (!existingParent.childIds.includes(newId)) {\n                existingParent.childIds.push(newId);\n              }\n              successMessage += `Linked to existing guardian: ${existingParent.name}.\\nNotification sent to ${gEmail}.`;\n            } else {\n              const newParentId = mockParents.length > 0 ? Math.max(...mockParents.map(p => p.id)) + 1 : 1;\n              mockParents.push({\n                id: newParentId,\n                name: gName,\n                email: gEmail,\n                phone: guardianPhone,\n                avatarUrl: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`,\n                childIds: [newId]\n              });\n              successMessage += `New Guardian account created for ${gName}.\\nCredentials sent to ${gEmail}.`;\n            }\n          } else {\n            successMessage += \"No guardian linked.\";\n          }\n          toast.success(successMessage);\n          setCredentials({\n            username: generatedEmail.split('@')[0],\n            password: 'password123',\n            email: generatedEmail\n          });\n          setShowCredentialsModal(true);\n          setIsLoading(false);\n          return;\n        }\n        forceUpdate();\n        handleBack();\n        return;\n      }\n      if (studentToEdit) {\n        const {\n          error: updateError\n        } = await supabase.from('students').update({\n          name: fullName,\n          grade,\n          section,\n          department: department || null,\n          birthday: birthday || null,\n          avatar_url: avatarUrl\n        }).eq('id', studentToEdit.id);\n        if (updateError) throw updateError;\n        let guardianMessage = '';\n        if (gEmail && gName) {\n          try {\n            const {\n              data: existingUser\n            } = await supabase.from('users').select('id, name, email').eq('email', gEmail).maybeSingle();\n            let parentIdToLink = null;\n            let parentNameForMsg = gName;\n            if (existingUser) {\n              const {\n                data: existingParent\n              } = await supabase.from('parents').select('id').eq('user_id', existingUser.id).maybeSingle();\n              if (existingParent) {\n                parentIdToLink = existingParent.id;\n              } else {\n                const {\n                  data: newProfile,\n                  error: profileErr\n                } = await supabase.from('parents').insert([{\n                  user_id: existingUser.id,\n                  name: gName,\n                  email: gEmail,\n                  phone: guardianPhone || null,\n                  avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n                }]).select().single();\n                if (profileErr) throw profileErr;\n                parentIdToLink = newProfile.id;\n              }\n            } else {\n              const {\n                data: newUser,\n                error: uErr\n              } = await supabase.from('users').insert([{\n                email: gEmail,\n                name: gName,\n                role: 'Parent',\n                avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n              }]).select().single();\n              if (uErr) throw uErr;\n              const {\n                data: newParent,\n                error: pErr\n              } = await supabase.from('parents').insert([{\n                user_id: newUser.id,\n                name: gName,\n                email: gEmail,\n                phone: guardianPhone || null,\n                avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n              }]).select().single();\n              if (pErr) throw pErr;\n              parentIdToLink = newParent.id;\n              await createUserAccount(gName, 'Parent', gEmail, newUser.id);\n              await sendVerificationEmail(gName, gEmail, 'School App Account Created');\n              guardianMessage += `\\nNew Guardian account created for ${gName}.`;\n            }\n            if (parentIdToLink) {\n              const {\n                data: link\n              } = await supabase.from('parent_children').select('*').eq('parent_id', parentIdToLink).eq('student_id', studentToEdit.id).maybeSingle();\n              if (!link) {\n                await supabase.from('parent_children').insert({\n                  parent_id: parentIdToLink,\n                  student_id: studentToEdit.id\n                });\n                guardianMessage += `\\nLinked to guardian: ${parentNameForMsg}.`;\n              }\n            }\n          } catch (gErr) {\n            console.error('Error updating guardian:', gErr);\n            guardianMessage += `\\nError updating guardian: ${gErr.message || 'Unknown error'}`;\n          }\n        }\n        toast.success(`Student updated successfully!${guardianMessage}`);\n      } else {\n        const authResult = await createUserAccount(fullName, 'Student', generatedEmail);\n        if (authResult.error) {\n          if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\n            toast.error(`Student with email ${generatedEmail} is already registered. Please check the name or email format.`);\n          } else {\n            toast.error('Failed to create account: ' + authResult.error);\n          }\n          setIsLoading(false);\n          return;\n        }\n        const {\n          data: newUserData,\n          error: userError\n        } = await supabase.from('users').insert([{\n          email: generatedEmail,\n          name: fullName,\n          role: 'Student',\n          avatar_url: avatarUrl\n        }]).select().single();\n        if (userError) {\n          throw userError;\n        }\n        const userData = newUserData;\n        const {\n          error: studentError\n        } = await supabase.from('students').insert([{\n          user_id: userData.id,\n          name: fullName,\n          avatar_url: avatarUrl,\n          grade: grade,\n          section: section,\n          department: department || null,\n          birthday: birthday || null,\n          attendance_status: 'Present'\n        }]);\n        if (studentError) throw studentError;\n        const {\n          data: studentData,\n          error: fetchStudentError\n        } = await supabase.from('students').select('id').eq('user_id', userData.id).single();\n        if (fetchStudentError) throw fetchStudentError;\n        console.log('Student credentials created successfully.');\n        const emailResult = await sendVerificationEmail(fullName, generatedEmail, 'School App');\n        if (!emailResult.success) {\n          console.warn('Warning: Email verification notification failed:', emailResult.error);\n        }\n        let parentAuthDetails = null;\n        if (gEmail && gName) {\n          try {\n            const {\n              data: existingUser\n            } = await supabase.from('users').select('id, name, email').eq('email', gEmail).maybeSingle();\n            let parentIdToLink = null;\n            if (existingUser) {\n              const {\n                data: existingParent\n              } = await supabase.from('parents').select('id').eq('user_id', existingUser.id).maybeSingle();\n              if (existingParent) {\n                parentIdToLink = existingParent.id;\n              } else {\n                const {\n                  data: newProfile,\n                  error: profileErr\n                } = await supabase.from('parents').insert([{\n                  user_id: existingUser.id,\n                  name: gName,\n                  email: gEmail,\n                  phone: guardianPhone || null,\n                  avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n                }]).select().single();\n                if (!profileErr) parentIdToLink = newProfile.id;\n              }\n            } else {\n              const {\n                data: newUser,\n                error: uErr\n              } = await supabase.from('users').insert([{\n                email: gEmail,\n                name: gName,\n                role: 'Parent',\n                avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n              }]).select().single();\n              if (!uErr) {\n                const {\n                  data: newParent,\n                  error: pErr\n                } = await supabase.from('parents').insert([{\n                  user_id: newUser.id,\n                  name: gName,\n                  email: gEmail,\n                  phone: guardianPhone || null,\n                  avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\n                }]).select().single();\n                if (!pErr) {\n                  parentIdToLink = newParent.id;\n                  const pAuth = await createUserAccount(gName, 'Parent', gEmail, newUser.id);\n                  await sendVerificationEmail(gName, gEmail, 'School App Account Created');\n                  parentAuthDetails = {\n                    userName: gName,\n                    username: pAuth.username,\n                    password: pAuth.password,\n                    email: gEmail,\n                    userType: 'Parent'\n                  };\n                }\n              }\n            }\n            if (parentIdToLink) {\n              await supabase.from('parent_children').insert({\n                parent_id: parentIdToLink,\n                student_id: studentData.id\n              });\n              if (existingUser) {\n                toast.success(`Linked to existing guardian: ${gName}.`, {\n                  duration: 4000\n                });\n                await sendVerificationEmail(gName, gEmail, 'Student Added');\n              }\n            }\n          } catch (gErr) {\n            console.error(\"Error processing guardian:\", gErr);\n            toast.error(\"Student created, but failed to link Guardian: \" + gErr.message);\n          }\n        }\n        setCredentials({\n          username: authResult.username,\n          password: authResult.password,\n          email: generatedEmail,\n          secondary: parentAuthDetails || undefined\n        });\n        setShowCredentialsModal(true);\n        setIsLoading(false);\n        return;\n      }\n      forceUpdate();\n      handleBack();\n    } catch (error) {\n      console.error('Error saving student:', error);\n      toast.error('Failed to save student: ' + (error.message || 'Unknown error'));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50\",\n    children: [_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"flex-grow flex flex-col\",\n      children: [_jsxDEV(\"main\", {\n        className: \"flex-grow p-4 space-y-6 overflow-y-auto\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex justify-center\",\n          children: _jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [_jsxDEV(\"div\", {\n              className: \"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\",\n              children: selectedImage ? _jsxDEV(\"img\", {\n                src: selectedImage,\n                alt: \"Student\",\n                className: \"w-full h-full rounded-full object-cover\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 540,\n                columnNumber: 37\n              }, this) : _jsxDEV(UserIcon, {\n                className: \"w-12 h-12 text-gray-400\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 542,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 538,\n              columnNumber: 29\n            }, this), _jsxDEV(\"label\", {\n              htmlFor: \"photo-upload\",\n              className: \"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\",\n              children: [_jsxDEV(CameraIcon, {\n                className: \"text-white h-4 w-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 546,\n                columnNumber: 33\n              }, this), _jsxDEV(\"input\", {\n                id: \"photo-upload\",\n                name: \"photo-upload\",\n                type: \"file\",\n                className: \"sr-only\",\n                accept: \"image/*\",\n                onChange: handleImageChange\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 547,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 545,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"grid grid-cols-1 lg:grid-cols-2 gap-6\",\n          children: [_jsxDEV(\"div\", {\n            className: \"space-y-4\",\n            children: [_jsxDEV(\"div\", {\n              className: \"p-2 bg-sky-100 rounded-lg\",\n              children: _jsxDEV(\"h3\", {\n                className: \"font-bold text-sky-800\",\n                children: \"Student Information\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 556,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 555,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              className: \"bg-white p-4 rounded-lg shadow-sm space-y-4\",\n              children: [_jsxDEV(\"div\", {\n                children: [_jsxDEV(\"label\", {\n                  htmlFor: \"fullName\",\n                  className: \"block text-sm font-medium text-gray-700 mb-1\",\n                  children: \"Full Name\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 560,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  className: \"relative\",\n                  children: [_jsxDEV(\"span\", {\n                    className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\",\n                    children: _jsxDEV(UserIcon, {\n                      className: \"w-5 h-5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 562,\n                      columnNumber: 122\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 562,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"input\", {\n                    type: \"text\",\n                    name: \"fullName\",\n                    id: \"fullName\",\n                    value: fullName,\n                    onChange: e => setFullName(e.target.value),\n                    className: \"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    placeholder: \"Adebayo Adewale\",\n                    required: true\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 563,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 561,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 559,\n                columnNumber: 33\n              }, this), _jsxDEV(\"div\", {\n                className: \"grid grid-cols-2 gap-4\",\n                children: [_jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"label\", {\n                    htmlFor: \"gender\",\n                    className: \"block text-sm font-medium text-gray-700 mb-1\",\n                    children: \"Gender\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 568,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"select\", {\n                    id: \"gender\",\n                    name: \"gender\",\n                    value: gender,\n                    onChange: e => setGender(e.target.value),\n                    className: \"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    children: [_jsxDEV(\"option\", {\n                      value: \"\",\n                      children: \"Select Gender...\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 570,\n                      columnNumber: 45\n                    }, this), _jsxDEV(\"option\", {\n                      children: \"Male\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 571,\n                      columnNumber: 45\n                    }, this), _jsxDEV(\"option\", {\n                      children: \"Female\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 572,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 569,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 567,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"label\", {\n                    htmlFor: \"birthday\",\n                    className: \"block text-sm font-medium text-gray-700 mb-1\",\n                    children: \"Date of Birth\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 576,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"input\", {\n                    type: \"date\",\n                    name: \"birthday\",\n                    id: \"birthday\",\n                    value: birthday,\n                    onChange: e => setBirthday(e.target.value),\n                    className: \"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    placeholder: \"Date of Birth\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 577,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 575,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 566,\n                columnNumber: 33\n              }, this), _jsxDEV(\"div\", {\n                className: \"grid grid-cols-2 gap-4\",\n                children: [_jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"label\", {\n                    htmlFor: \"class\",\n                    className: \"block text-sm font-medium text-gray-700 mb-1\",\n                    children: \"Class\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 582,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"select\", {\n                    id: \"class\",\n                    name: \"class\",\n                    value: className,\n                    onChange: e => setClassName(e.target.value),\n                    className: \"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    required: true,\n                    children: [_jsxDEV(\"option\", {\n                      value: \"\",\n                      children: \"Select Class...\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 584,\n                      columnNumber: 45\n                    }, this), [...Array(12).keys()].map(i => _jsxDEV(\"option\", {\n                      value: `Grade ${i + 1}`,\n                      children: [\"Grade \", i + 1]\n                    }, i + 1, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 585,\n                      columnNumber: 77\n                    }, this))]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 583,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 581,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  children: [_jsxDEV(\"label\", {\n                    htmlFor: \"section\",\n                    className: \"block text-sm font-medium text-gray-700 mb-1\",\n                    children: \"Section\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 589,\n                    columnNumber: 41\n                  }, this), _jsxDEV(\"select\", {\n                    id: \"section\",\n                    name: \"section\",\n                    value: section,\n                    onChange: e => setSection(e.target.value),\n                    className: \"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    required: true,\n                    children: [_jsxDEV(\"option\", {\n                      value: \"\",\n                      children: \"Select Section...\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 591,\n                      columnNumber: 45\n                    }, this), _jsxDEV(\"option\", {\n                      children: \"A\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 592,\n                      columnNumber: 45\n                    }, this), _jsxDEV(\"option\", {\n                      children: \"B\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 593,\n                      columnNumber: 45\n                    }, this), _jsxDEV(\"option\", {\n                      children: \"C\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 594,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 590,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 588,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 580,\n                columnNumber: 33\n              }, this), grade >= 10 && _jsxDEV(\"div\", {\n                children: [_jsxDEV(\"label\", {\n                  htmlFor: \"department\",\n                  className: \"block text-sm font-medium text-gray-700 mb-1\",\n                  children: \"Department\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 600,\n                  columnNumber: 41\n                }, this), _jsxDEV(\"select\", {\n                  id: \"department\",\n                  name: \"department\",\n                  value: department,\n                  onChange: e => setDepartment(e.target.value),\n                  className: \"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                  children: [_jsxDEV(\"option\", {\n                    value: \"\",\n                    children: \"Select Department...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 602,\n                    columnNumber: 45\n                  }, this), _jsxDEV(\"option\", {\n                    value: \"Science\",\n                    children: \"Science\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 603,\n                    columnNumber: 45\n                  }, this), _jsxDEV(\"option\", {\n                    value: \"Commercial\",\n                    children: \"Commercial\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 604,\n                    columnNumber: 45\n                  }, this), _jsxDEV(\"option\", {\n                    value: \"Arts\",\n                    children: \"Arts\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 605,\n                    columnNumber: 45\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 601,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 599,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 558,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 554,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"space-y-4\",\n            children: [_jsxDEV(\"div\", {\n              className: \"p-2 bg-green-100 rounded-lg\",\n              children: _jsxDEV(\"h3\", {\n                className: \"font-bold text-green-800\",\n                children: \"Guardian Information\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 615,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 614,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              className: \"bg-white p-4 rounded-lg shadow-sm space-y-4\",\n              children: [_jsxDEV(\"div\", {\n                children: [_jsxDEV(\"label\", {\n                  htmlFor: \"guardianName\",\n                  className: \"block text-sm font-medium text-gray-700 mb-1\",\n                  children: \"Guardian's Name\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 619,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  className: \"relative\",\n                  children: [_jsxDEV(\"span\", {\n                    className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\",\n                    children: _jsxDEV(UserIcon, {\n                      className: \"w-5 h-5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 620,\n                      columnNumber: 144\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 620,\n                    columnNumber: 63\n                  }, this), _jsxDEV(\"input\", {\n                    type: \"text\",\n                    name: \"guardianName\",\n                    id: \"guardianName\",\n                    value: guardianName,\n                    onChange: e => setGuardianName(e.target.value),\n                    className: \"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    placeholder: \"Mr. Adewale\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 620,\n                    columnNumber: 183\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 620,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 618,\n                columnNumber: 33\n              }, this), _jsxDEV(\"div\", {\n                children: [_jsxDEV(\"label\", {\n                  htmlFor: \"guardianPhone\",\n                  className: \"block text-sm font-medium text-gray-700 mb-1\",\n                  children: \"Guardian's Phone\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 623,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  className: \"relative\",\n                  children: [_jsxDEV(\"span\", {\n                    className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\",\n                    children: _jsxDEV(PhoneIcon, {\n                      className: \"w-5 h-5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 624,\n                      columnNumber: 144\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 624,\n                    columnNumber: 63\n                  }, this), _jsxDEV(\"input\", {\n                    type: \"tel\",\n                    name: \"guardianPhone\",\n                    id: \"guardianPhone\",\n                    value: guardianPhone,\n                    onChange: e => setGuardianPhone(e.target.value),\n                    className: \"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    placeholder: \"+234 801 234 5678\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 624,\n                    columnNumber: 184\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 624,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 622,\n                columnNumber: 33\n              }, this), _jsxDEV(\"div\", {\n                children: [_jsxDEV(\"label\", {\n                  htmlFor: \"guardianEmail\",\n                  className: \"block text-sm font-medium text-gray-700 mb-1\",\n                  children: \"Guardian's Email\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 627,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"div\", {\n                  className: \"relative\",\n                  children: [_jsxDEV(\"span\", {\n                    className: \"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\",\n                    children: _jsxDEV(MailIcon, {\n                      className: \"w-5 h-5\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 628,\n                      columnNumber: 144\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 628,\n                    columnNumber: 63\n                  }, this), _jsxDEV(\"input\", {\n                    type: \"email\",\n                    name: \"guardianEmail\",\n                    id: \"guardianEmail\",\n                    value: guardianEmail,\n                    onChange: e => setGuardianEmail(e.target.value),\n                    className: \"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\",\n                    placeholder: \"guardian@example.com\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 628,\n                    columnNumber: 183\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 628,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 626,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 617,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 613,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 552,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 534,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"p-4 mt-auto bg-gray-50\",\n        children: _jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: isLoading,\n          className: `w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors`,\n          children: isLoading ? 'Saving...' : studentToEdit ? 'Update Student' : 'Save Student'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 533,\n      columnNumber: 13\n    }, this), credentials && _jsxDEV(CredentialsModal, {\n      isOpen: showCredentialsModal,\n      userName: fullName,\n      username: credentials.username,\n      password: credentials.password,\n      email: credentials.email,\n      userType: \"Student\",\n      secondaryCredentials: credentials.secondary,\n      onClose: () => {\n        setShowCredentialsModal(false);\n        forceUpdate();\n        handleBack();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 649,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 532,\n    columnNumber: 9\n  }, this);\n};\nexport default AddStudentScreen;","map":{"version":3,"names":["React","useState","useEffect","useMemo","toast","CameraIcon","UserIcon","MailIcon","PhoneIcon","supabase","isSupabaseConfigured","createUserAccount","sendVerificationEmail","CredentialsModal","mockStudents","mockParents","jsxDEV","_jsxDEV","AddStudentScreen","studentToEdit","forceUpdate","handleBack","selectedImage","setSelectedImage","fullName","setFullName","gender","setGender","birthday","setBirthday","className","setClassName","section","setSection","department","setDepartment","isLoading","setIsLoading","showCredentialsModal","setShowCredentialsModal","credentials","setCredentials","guardianName","setGuardianName","guardianPhone","setGuardianPhone","guardianEmail","setGuardianEmail","grade","match","parseInt","avatarUrl","name","fetchGuardian","data","error","from","select","eq","id","maybeSingle","parents","p","Array","isArray","email","phone","err","console","parent","find","childIds","includes","handleImageChange","event","target","files","file","reader","FileReader","onloadend","result","readAsDataURL","handleSubmit","e","preventDefault","gEmail","trim","toLowerCase","gName","generatedEmail","replace","index","findIndex","s","Object","assign","undefined","success","newId","length","Math","max","map","newStudent","attendanceStatus","academicPerformance","behaviorNotes","push","successMessage","split","existingParent","newParentId","username","password","updateError","update","avatar_url","guardianMessage","existingUser","parentIdToLink","parentNameForMsg","newProfile","profileErr","insert","user_id","single","newUser","uErr","role","newParent","pErr","link","parent_id","student_id","gErr","message","authResult","newUserData","userError","userData","studentError","attendance_status","studentData","fetchStudentError","log","emailResult","warn","parentAuthDetails","pAuth","userName","userType","duration","secondary","children","onSubmit","src","alt","fileName","_jsxFileName","lineNumber","columnNumber","htmlFor","type","accept","onChange","value","placeholder","required","keys","i","disabled","isOpen","secondaryCredentials","onClose"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/admin/AddStudentScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useEffect, useMemo } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { CameraIcon, UserIcon, MailIcon, PhoneIcon } from '../../constants';\r\nimport { Student, Department } from '../../types';\r\nimport { supabase, isSupabaseConfigured } from '../../lib/supabase';\r\nimport { createUserAccount, generateUsername, generatePassword, sendVerificationEmail, checkEmailExists } from '../../lib/auth';\r\nimport CredentialsModal from '../ui/CredentialsModal';\r\nimport { mockStudents, mockParents } from '../../data';\r\n\r\ninterface AddStudentScreenProps {\r\n    studentToEdit?: Student;\r\n    forceUpdate: () => void;\r\n    handleBack: () => void;\r\n}\r\n\r\nconst AddStudentScreen: React.FC<AddStudentScreenProps> = ({ studentToEdit, forceUpdate, handleBack }) => {\r\n    const [selectedImage, setSelectedImage] = useState<string | null>(null);\r\n    const [fullName, setFullName] = useState('');\r\n    const [gender, setGender] = useState('');\r\n    const [birthday, setBirthday] = useState('');\r\n    const [className, setClassName] = useState('');\r\n    const [section, setSection] = useState('');\r\n    const [department, setDepartment] = useState<Department | ''>('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [showCredentialsModal, setShowCredentialsModal] = useState(false);\r\n    const [credentials, setCredentials] = useState<{\r\n        username: string;\r\n        password: string;\r\n        email: string;\r\n        secondary?: {\r\n            userName: string;\r\n            username: string;\r\n            password: string;\r\n            email: string;\r\n            userType: string;\r\n        };\r\n    } | null>(null);\r\n\r\n    const [guardianName, setGuardianName] = useState('');\r\n    const [guardianPhone, setGuardianPhone] = useState('');\r\n    const [guardianEmail, setGuardianEmail] = useState('');\r\n\r\n    const grade = useMemo(() => {\r\n        const match = className.match(/\\d+/);\r\n        return match ? parseInt(match[0], 10) : 0;\r\n    }, [className]);\r\n\r\n    useEffect(() => {\r\n        if (studentToEdit) {\r\n            setSelectedImage(studentToEdit.avatarUrl);\r\n            setFullName(studentToEdit.name);\r\n            setBirthday(studentToEdit.birthday || '');\r\n            setClassName(`Grade ${studentToEdit.grade} `);\r\n            setSection(studentToEdit.section);\r\n            setDepartment(studentToEdit.department || '');\r\n\r\n            // Fetch Guardian Info\r\n            const fetchGuardian = async () => {\r\n                if (isSupabaseConfigured) {\r\n                    try {\r\n                        const { data, error } = await supabase\r\n                            .from('parent_children')\r\n                            .select(`\r\nparents(\r\n    name,\r\n    email,\r\n    phone\r\n)\r\n                            `)\r\n                            .eq('student_id', studentToEdit.id)\r\n                            .maybeSingle();\r\n\r\n                        if (!error && data && data.parents) {\r\n                            // Supabase returns the joined resource. Typescript might view it as array or object.\r\n                            // In a singular select like this from a join table, it's usually an object if the FK is correct.\r\n                            const p: any = Array.isArray(data.parents) ? data.parents[0] : data.parents;\r\n                            if (p) {\r\n                                setGuardianName(p.name || '');\r\n                                setGuardianEmail(p.email || '');\r\n                                setGuardianPhone(p.phone || '');\r\n                            }\r\n                        }\r\n                    } catch (err) {\r\n                        console.error(\"Error fetching guardian:\", err);\r\n                    }\r\n                } else {\r\n                    // Mock Mode Lookup\r\n                    const parent = mockParents.find(p => p.childIds?.includes(studentToEdit.id));\r\n                    if (parent) {\r\n                        setGuardianName(parent.name);\r\n                        setGuardianEmail(parent.email);\r\n                        setGuardianPhone(parent.phone);\r\n                    }\r\n                }\r\n            };\r\n            fetchGuardian();\r\n        }\r\n    }, [studentToEdit]);\r\n\r\n    const handleImageChange = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (event.target.files && event.target.files[0]) {\r\n            const file = event.target.files[0];\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => {\r\n                setSelectedImage(reader.result as string);\r\n            };\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            // Normalize inputs\r\n            const gEmail = guardianEmail.trim().toLowerCase();\r\n            const gName = guardianName.trim();\r\n\r\n            if (gName && !gEmail) {\r\n                toast.error(\"Guardian Email is required to create or link guardian details.\");\r\n                setIsLoading(false);\r\n                return;\r\n            }\r\n\r\n            // Generate email for the student\r\n            let generatedEmail = `${fullName.toLowerCase().replace(/\\s+/g, '.')} @student.school.com`;\r\n            const avatarUrl = selectedImage || `https://i.pravatar.cc/150?u=${fullName.replace(' ', '')}`;\r\n\r\n            // MOCK MODE HANDLING\r\n            if (!isSupabaseConfigured) {\r\n                if (studentToEdit) {\r\n                    // Update existing mock student\r\n                    const index = mockStudents.findIndex(s => s.id === studentToEdit.id);\r\n                    if (index !== -1) {\r\n                        mockStudents[index] = {\r\n                            ...mockStudents[index],\r\n                            name: fullName,\r\n                            grade,\r\n                            section,\r\n                            department: department || undefined,\r\n                            birthday: birthday || undefined,\r\n                            avatarUrl: avatarUrl\r\n                        };\r\n                    }\r\n                    toast.success('Student updated successfully (Mock Mode - Session Only)');\r\n                } else {\r\n                    // Create new mock student\r\n                    const newId = mockStudents.length > 0 ? Math.max(...mockStudents.map(s => s.id)) + 1 : 1;\r\n                    const newStudent = {\r\n                        id: newId,\r\n                        name: fullName,\r\n                        email: generatedEmail,\r\n                        avatarUrl: avatarUrl,\r\n                        grade: grade,\r\n                        section: section,\r\n                        department: department || undefined,\r\n                        attendanceStatus: 'Present' as const,\r\n                        birthday: birthday || undefined,\r\n                        academicPerformance: [], // Empty for now\r\n                        behaviorNotes: []\r\n                    };\r\n                    mockStudents.push(newStudent);\r\n\r\n                    let successMessage = `Student account created for ${fullName}.\\nCredentials: ${generatedEmail.split('@')[0]} / password123\\n\\n`;\r\n\r\n                    // Handle Guardian in Mock Mode\r\n                    if (gEmail && gName) {\r\n                        const existingParent = mockParents.find(p => p.email === gEmail);\r\n                        if (existingParent) {\r\n                            // Link to existing parent\r\n                            if (!existingParent.childIds) existingParent.childIds = [];\r\n                            if (!existingParent.childIds.includes(newId)) {\r\n                                existingParent.childIds.push(newId);\r\n                            }\r\n                            successMessage += `Linked to existing guardian: ${existingParent.name}.\\nNotification sent to ${gEmail}.`;\r\n                        } else {\r\n                            // Create new parent\r\n                            const newParentId = mockParents.length > 0 ? Math.max(...mockParents.map(p => p.id)) + 1 : 1;\r\n                            mockParents.push({\r\n                                id: newParentId,\r\n                                name: gName,\r\n                                email: gEmail,\r\n                                phone: guardianPhone,\r\n                                avatarUrl: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`,\r\n                                childIds: [newId]\r\n                            });\r\n                            successMessage += `New Guardian account created for ${gName}.\\nCredentials sent to ${gEmail}.`;\r\n                        }\r\n                    } else {\r\n                        successMessage += \"No guardian linked.\";\r\n                    }\r\n\r\n                    toast.success(successMessage);\r\n\r\n                    // Simulate credentials generation for display\r\n                    setCredentials({\r\n                        username: generatedEmail.split('@')[0],\r\n                        password: 'password123',\r\n                        email: generatedEmail\r\n                    });\r\n                    // We show the modal for the Student's credentials\r\n                    setShowCredentialsModal(true);\r\n                    setIsLoading(false);\r\n                    return; // Don't close immediately, wait for modal\r\n                }\r\n                forceUpdate();\r\n                handleBack();\r\n                return;\r\n            }\r\n\r\n            if (studentToEdit) {\r\n                // UPDATE MODE - Update existing student in Supabase\r\n                const { error: updateError } = await supabase\r\n                    .from('students')\r\n                    .update({\r\n                        name: fullName,\r\n                        grade,\r\n                        section,\r\n                        department: department || null,\r\n                        birthday: birthday || null,\r\n                        avatar_url: avatarUrl\r\n                    })\r\n                    .eq('id', studentToEdit.id);\r\n\r\n                if (updateError) throw updateError;\r\n\r\n                let guardianMessage = '';\r\n\r\n                // --- GUARDIAN HANDLING FOR UPDATE ---\r\n                if (gEmail && gName) {\r\n                    try {\r\n                        // 1. Check if User exists first (to handle cases where User exists but Parent profile doesn't)\r\n                        const { data: existingUser } = await supabase\r\n                            .from('users')\r\n                            .select('id, name, email')\r\n                            .eq('email', gEmail)\r\n                            .maybeSingle();\r\n\r\n                        let parentIdToLink: number | null = null;\r\n                        let parentNameForMsg = gName;\r\n\r\n                        if (existingUser) {\r\n                            // User exists. Check if Parent profile exists.\r\n                            const { data: existingParent } = await supabase\r\n                                .from('parents')\r\n                                .select('id')\r\n                                .eq('user_id', existingUser.id)\r\n                                .maybeSingle();\r\n\r\n                            if (existingParent) {\r\n                                parentIdToLink = existingParent.id;\r\n                                // Update phone/name if needed? Optional.\r\n                            } else {\r\n                                // User exists, create Parent profile\r\n                                const { data: newProfile, error: profileErr } = await supabase\r\n                                    .from('parents')\r\n                                    .insert([{\r\n                                        user_id: existingUser.id,\r\n                                        name: gName,\r\n                                        email: gEmail,\r\n                                        phone: guardianPhone || null,\r\n                                        avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                    }])\r\n                                    .select()\r\n                                    .single();\r\n\r\n                                if (profileErr) throw profileErr;\r\n                                parentIdToLink = newProfile.id;\r\n                            }\r\n                        } else {\r\n                            // Create Fresh User & Parent\r\n                            const { data: newUser, error: uErr } = await supabase\r\n                                .from('users')\r\n                                .insert([{\r\n                                    email: gEmail,\r\n                                    name: gName,\r\n                                    role: 'Parent',\r\n                                    avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                }])\r\n                                .select()\r\n                                .single();\r\n\r\n                            if (uErr) throw uErr;\r\n\r\n                            const { data: newParent, error: pErr } = await supabase\r\n                                .from('parents')\r\n                                .insert([{\r\n                                    user_id: newUser.id,\r\n                                    name: gName,\r\n                                    email: gEmail,\r\n                                    phone: guardianPhone || null,\r\n                                    avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                }])\r\n                                .select()\r\n                                .single();\r\n\r\n                            if (pErr) throw pErr;\r\n                            parentIdToLink = newParent.id;\r\n\r\n                            // Create Auth\r\n                            await createUserAccount(gName, 'Parent', gEmail, newUser.id);\r\n                            await sendVerificationEmail(gName, gEmail, 'School App Account Created');\r\n                            guardianMessage += `\\nNew Guardian account created for ${gName}.`;\r\n                        }\r\n\r\n                        // 2. Link if we have a Parent ID\r\n                        if (parentIdToLink) {\r\n                            // Check if already linked\r\n                            const { data: link } = await supabase\r\n                                .from('parent_children')\r\n                                .select('*')\r\n                                .eq('parent_id', parentIdToLink)\r\n                                .eq('student_id', studentToEdit.id)\r\n                                .maybeSingle();\r\n\r\n                            if (!link) {\r\n                                await supabase.from('parent_children').insert({\r\n                                    parent_id: parentIdToLink,\r\n                                    student_id: studentToEdit.id\r\n                                });\r\n                                guardianMessage += `\\nLinked to guardian: ${parentNameForMsg}.`;\r\n                            }\r\n                        }\r\n\r\n                    } catch (gErr: any) {\r\n                        console.error('Error updating guardian:', gErr);\r\n                        guardianMessage += `\\nError updating guardian: ${gErr.message || 'Unknown error'}`;\r\n                    }\r\n                }\r\n\r\n                toast.success(`Student updated successfully!${guardianMessage}`);\r\n            } else {\r\n                // CREATE MODE\r\n\r\n                // 1. Create Login Credentials (Auth User) FIRST\r\n                // This validates email uniqueness in Supabase Auth immediately.\r\n\r\n                const authResult = await createUserAccount(fullName, 'Student', generatedEmail);\r\n\r\n                if (authResult.error) {\r\n                    if (authResult.error.includes('already registered') || authResult.error.includes('duplicate')) {\r\n                        toast.error(`Student with email ${generatedEmail} is already registered. Please check the name or email format.`);\r\n                    } else {\r\n                        toast.error('Failed to create account: ' + authResult.error);\r\n                    }\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n\r\n                // 2. Create User account (Legacy Table)\r\n\r\n                const { data: newUserData, error: userError } = await supabase\r\n                    .from('users')\r\n                    .insert([{\r\n                        email: generatedEmail,\r\n                        name: fullName,\r\n                        role: 'Student',\r\n                        avatar_url: avatarUrl\r\n                    }])\r\n                    .select()\r\n                    .single();\r\n\r\n                if (userError) {\r\n                    // Potentially rollback Auth user here in a real production app\r\n                    throw userError;\r\n                }\r\n\r\n                const userData = newUserData;\r\n\r\n                // 3. Create Student Profile\r\n                const { error: studentError } = await supabase\r\n                    .from('students')\r\n                    .insert([{\r\n                        user_id: userData.id,\r\n                        name: fullName,\r\n                        avatar_url: avatarUrl,\r\n                        grade: grade,\r\n                        section: section,\r\n                        department: department || null,\r\n                        birthday: birthday || null,\r\n                        attendance_status: 'Present'\r\n                    }]);\r\n                if (studentError) throw studentError;\r\n\r\n                // Fetch the student ID for linking\r\n                const { data: studentData, error: fetchStudentError } = await supabase\r\n                    .from('students')\r\n                    .select('id')\r\n                    .eq('user_id', userData.id)\r\n                    .single();\r\n\r\n                if (fetchStudentError) throw fetchStudentError;\r\n\r\n                // 4. (Auth was already created at start)\r\n                // We just log it now.\r\n                console.log('Student credentials created successfully.');\r\n\r\n\r\n                // 5. Send verification email (Student)\r\n                const emailResult = await sendVerificationEmail(fullName, generatedEmail, 'School App');\r\n                if (!emailResult.success) {\r\n                    console.warn('Warning: Email verification notification failed:', emailResult.error);\r\n                }\r\n\r\n                // --- GUARDIAN ACCOUNT AUTOMATION ---\r\n                let parentAuthDetails = null;\r\n\r\n                if (gEmail && gName) {\r\n                    try {\r\n                        const { data: existingUser } = await supabase\r\n                            .from('users')\r\n                            .select('id, name, email')\r\n                            .eq('email', gEmail)\r\n                            .maybeSingle();\r\n\r\n                        let parentIdToLink: number | null = null;\r\n\r\n                        if (existingUser) {\r\n                            // User exists, find/create Parent\r\n                            const { data: existingParent } = await supabase\r\n                                .from('parents')\r\n                                .select('id')\r\n                                .eq('user_id', existingUser.id)\r\n                                .maybeSingle();\r\n\r\n                            if (existingParent) {\r\n                                parentIdToLink = existingParent.id;\r\n                            } else {\r\n                                // Create Parent Profile for existing User\r\n                                const { data: newProfile, error: profileErr } = await supabase\r\n                                    .from('parents')\r\n                                    .insert([{\r\n                                        user_id: existingUser.id,\r\n                                        name: gName,\r\n                                        email: gEmail,\r\n                                        phone: guardianPhone || null,\r\n                                        avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                    }])\r\n                                    .select()\r\n                                    .single();\r\n\r\n                                if (!profileErr) parentIdToLink = newProfile.id;\r\n                            }\r\n                        } else {\r\n                            // Create New User & Parent\r\n                            const { data: newUser, error: uErr } = await supabase\r\n                                .from('users')\r\n                                .insert([{\r\n                                    email: gEmail,\r\n                                    name: gName,\r\n                                    role: 'Parent',\r\n                                    avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                }])\r\n                                .select()\r\n                                .single();\r\n\r\n                            if (!uErr) {\r\n                                const { data: newParent, error: pErr } = await supabase\r\n                                    .from('parents')\r\n                                    .insert([{\r\n                                        user_id: newUser.id,\r\n                                        name: gName,\r\n                                        email: gEmail,\r\n                                        phone: guardianPhone || null,\r\n                                        avatar_url: `https://i.pravatar.cc/150?u=${gName.replace(' ', '')}`\r\n                                    }])\r\n                                    .select()\r\n                                    .single();\r\n\r\n                                if (!pErr) {\r\n                                    parentIdToLink = newParent.id;\r\n                                    // Create Auth & Send Email\r\n                                    const pAuth = await createUserAccount(gName, 'Parent', gEmail, newUser.id);\r\n                                    await sendVerificationEmail(gName, gEmail, 'School App Account Created');\r\n\r\n                                    // Capture for Modal\r\n                                    parentAuthDetails = {\r\n                                        userName: gName,\r\n                                        username: pAuth.username,\r\n                                        password: pAuth.password,\r\n                                        email: gEmail,\r\n                                        userType: 'Parent'\r\n                                    };\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        if (parentIdToLink) {\r\n                            await supabase.from('parent_children').insert({\r\n                                parent_id: parentIdToLink,\r\n                                student_id: studentData.id\r\n                            });\r\n                            if (existingUser) {\r\n                                toast.success(`Linked to existing guardian: ${gName}.`, { duration: 4000 });\r\n                                await sendVerificationEmail(gName, gEmail, 'Student Added');\r\n                            }\r\n                        }\r\n\r\n                    } catch (gErr) {\r\n                        console.error(\"Error processing guardian:\", gErr);\r\n                        toast.error(\"Student created, but failed to link Guardian: \" + (gErr as any).message);\r\n                    }\r\n                }\r\n                // -----------------------------------\r\n\r\n                // Show credentials modal instead of alert\r\n                setCredentials({\r\n                    username: authResult.username,\r\n                    password: authResult.password,\r\n                    email: generatedEmail,\r\n                    secondary: parentAuthDetails || undefined\r\n                });\r\n                setShowCredentialsModal(true);\r\n                setIsLoading(false);\r\n                return; // Wait for modal close\r\n            }\r\n\r\n            // Trigger parent component to refresh data from Supabase\r\n            forceUpdate();\r\n            handleBack();\r\n        } catch (error: any) {\r\n            console.error('Error saving student:', error);\r\n            toast.error('Failed to save student: ' + (error.message || 'Unknown error'));\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-50\">\r\n            <form onSubmit={handleSubmit} className=\"flex-grow flex flex-col\">\r\n                <main className=\"flex-grow p-4 space-y-6 overflow-y-auto\">\r\n                    {/* Photo Upload */}\r\n                    <div className=\"flex justify-center\">\r\n                        <div className=\"relative\">\r\n                            <div className=\"w-28 h-28 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                {selectedImage ? (\r\n                                    <img src={selectedImage} alt=\"Student\" className=\"w-full h-full rounded-full object-cover\" />\r\n                                ) : (\r\n                                    <UserIcon className=\"w-12 h-12 text-gray-400\" />\r\n                                )}\r\n                            </div>\r\n                            <label htmlFor=\"photo-upload\" className=\"absolute bottom-0 right-0 bg-sky-500 p-2 rounded-full border-2 border-white cursor-pointer hover:bg-sky-600\">\r\n                                <CameraIcon className=\"text-white h-4 w-4\" />\r\n                                <input id=\"photo-upload\" name=\"photo-upload\" type=\"file\" className=\"sr-only\" accept=\"image/*\" onChange={handleImageChange} />\r\n                            </label>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                        {/* Student Information Section */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"p-2 bg-sky-100 rounded-lg\">\r\n                                <h3 className=\"font-bold text-sky-800\">Student Information</h3>\r\n                            </div>\r\n                            <div className=\"bg-white p-4 rounded-lg shadow-sm space-y-4\">\r\n                                <div>\r\n                                    <label htmlFor=\"fullName\" className=\"block text-sm font-medium text-gray-700 mb-1\">Full Name</label>\r\n                                    <div className=\"relative\">\r\n                                        <span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\"><UserIcon className=\"w-5 h-5\" /></span>\r\n                                        <input type=\"text\" name=\"fullName\" id=\"fullName\" value={fullName} onChange={e => setFullName(e.target.value)} className=\"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder=\"Adebayo Adewale\" required />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700 mb-1\">Gender</label>\r\n                                        <select id=\"gender\" name=\"gender\" value={gender} onChange={e => setGender(e.target.value)} className=\"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\">\r\n                                            <option value=\"\">Select Gender...</option>\r\n                                            <option>Male</option>\r\n                                            <option>Female</option>\r\n                                        </select>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label htmlFor=\"birthday\" className=\"block text-sm font-medium text-gray-700 mb-1\">Date of Birth</label>\r\n                                        <input type=\"date\" name=\"birthday\" id=\"birthday\" value={birthday} onChange={e => setBirthday(e.target.value)} className=\"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder=\"Date of Birth\" />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <div>\r\n                                        <label htmlFor=\"class\" className=\"block text-sm font-medium text-gray-700 mb-1\">Class</label>\r\n                                        <select id=\"class\" name=\"class\" value={className} onChange={e => setClassName(e.target.value)} className=\"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" required>\r\n                                            <option value=\"\">Select Class...</option>\r\n                                            {[...Array(12).keys()].map(i => <option key={i + 1} value={`Grade ${i + 1}`}>Grade {i + 1}</option>)}\r\n                                        </select>\r\n                                    </div>\r\n                                    <div>\r\n                                        <label htmlFor=\"section\" className=\"block text-sm font-medium text-gray-700 mb-1\">Section</label>\r\n                                        <select id=\"section\" name=\"section\" value={section} onChange={e => setSection(e.target.value)} className=\"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" required>\r\n                                            <option value=\"\">Select Section...</option>\r\n                                            <option>A</option>\r\n                                            <option>B</option>\r\n                                            <option>C</option>\r\n                                        </select>\r\n                                    </div>\r\n                                </div>\r\n                                {grade >= 10 && (\r\n                                    <div>\r\n                                        <label htmlFor=\"department\" className=\"block text-sm font-medium text-gray-700 mb-1\">Department</label>\r\n                                        <select id=\"department\" name=\"department\" value={department} onChange={e => setDepartment(e.target.value as Department | '')} className=\"w-full px-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\">\r\n                                            <option value=\"\">Select Department...</option>\r\n                                            <option value=\"Science\">Science</option>\r\n                                            <option value=\"Commercial\">Commercial</option>\r\n                                            <option value=\"Arts\">Arts</option>\r\n                                        </select>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Guardian Information Section */}\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"p-2 bg-green-100 rounded-lg\">\r\n                                <h3 className=\"font-bold text-green-800\">Guardian Information</h3>\r\n                            </div>\r\n                            <div className=\"bg-white p-4 rounded-lg shadow-sm space-y-4\">\r\n                                <div>\r\n                                    <label htmlFor=\"guardianName\" className=\"block text-sm font-medium text-gray-700 mb-1\">Guardian's Name</label>\r\n                                    <div className=\"relative\"><span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\"><UserIcon className=\"w-5 h-5\" /></span><input type=\"text\" name=\"guardianName\" id=\"guardianName\" value={guardianName} onChange={e => setGuardianName(e.target.value)} className=\"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder=\"Mr. Adewale\" /></div>\r\n                                </div>\r\n                                <div>\r\n                                    <label htmlFor=\"guardianPhone\" className=\"block text-sm font-medium text-gray-700 mb-1\">Guardian's Phone</label>\r\n                                    <div className=\"relative\"><span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\"><PhoneIcon className=\"w-5 h-5\" /></span><input type=\"tel\" name=\"guardianPhone\" id=\"guardianPhone\" value={guardianPhone} onChange={e => setGuardianPhone(e.target.value)} className=\"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder=\"+234 801 234 5678\" /></div>\r\n                                </div>\r\n                                <div>\r\n                                    <label htmlFor=\"guardianEmail\" className=\"block text-sm font-medium text-gray-700 mb-1\">Guardian's Email</label>\r\n                                    <div className=\"relative\"><span className=\"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400\"><MailIcon className=\"w-5 h-5\" /></span><input type=\"email\" name=\"guardianEmail\" id=\"guardianEmail\" value={guardianEmail} onChange={e => setGuardianEmail(e.target.value)} className=\"w-full pl-10 pr-3 py-3 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500\" placeholder=\"guardian@example.com\" /></div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </main>\r\n\r\n                {/* Action Button */}\r\n                <div className=\"p-4 mt-auto bg-gray-50\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isLoading}\r\n                        className={`w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white ${isLoading ? 'bg-gray-400' : 'bg-sky-500 hover:bg-sky-600'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition-colors`}\r\n                    >\r\n                        {isLoading ? 'Saving...' : (studentToEdit ? 'Update Student' : 'Save Student')}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n\r\n            {/* Credentials Modal */}\r\n            {credentials && (\r\n                <CredentialsModal\r\n                    isOpen={showCredentialsModal}\r\n                    userName={fullName}\r\n                    username={credentials.username}\r\n                    password={credentials.password}\r\n                    email={credentials.email}\r\n                    userType=\"Student\"\r\n                    secondaryCredentials={credentials.secondary}\r\n                    onClose={() => {\r\n                        setShowCredentialsModal(false);\r\n                        forceUpdate();\r\n                        handleBack();\r\n                    }}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AddStudentScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}