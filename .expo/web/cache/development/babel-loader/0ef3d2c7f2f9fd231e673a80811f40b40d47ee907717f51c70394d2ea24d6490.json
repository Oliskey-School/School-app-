{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\payments\\\\FlutterwaveWrapper.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { initializeTransaction, verifyTransaction } from '../../lib/payments';\nimport { supabase } from '../../lib/supabase';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const FlutterwaveWrapper = ({\n  fee,\n  email,\n  phone,\n  name,\n  onSuccess,\n  onClose\n}) => {\n  const [loading, setLoading] = useState(false);\n  const [scriptLoaded, setScriptLoaded] = useState(false);\n  useEffect(() => {\n    const existingScript = document.getElementById('flutterwaveCheckout');\n    if (!existingScript) {\n      const script = document.createElement('script');\n      script.src = 'https://checkout.flutterwave.com/v3.js';\n      script.id = 'flutterwaveCheckout';\n      script.async = true;\n      script.onload = () => setScriptLoaded(true);\n      document.body.appendChild(script);\n    } else {\n      setScriptLoaded(true);\n    }\n  }, []);\n  const handlePaymentClick = async () => {\n    if (!scriptLoaded || !window.FlutterwaveCheckout) {\n      toast('Payment system is loading. Please try again in a moment.');\n      return;\n    }\n    if (!email || email.trim() === '') {\n      toast.error('Email is required for payment. Please update your profile.');\n      return;\n    }\n    setLoading(true);\n    const publicKey = import.meta.env.VITE_FLUTTERWAVE_PUBLIC_KEY;\n    if (!publicKey || publicKey === '' || publicKey === 'your_flutterwave_public_key_here') {\n      setLoading(false);\n      toast.error('Payment gateway not configured. Please contact administrator.');\n      console.error('Flutterwave public key not configured in environment variables');\n      return;\n    }\n    const txRef = `FLW-${Date.now()}-${fee.id}`;\n    try {\n      await initializeTransaction(fee.id, fee.studentId, fee.amount, txRef, 'Flutterwave');\n      window.FlutterwaveCheckout({\n        public_key: publicKey,\n        tx_ref: txRef,\n        amount: fee.amount,\n        currency: 'NGN',\n        payment_options: 'card,mobilemoney,ussd,banktransfer',\n        customer: {\n          email: email.trim(),\n          phone_number: phone || '0000000000',\n          name: name || 'Parent'\n        },\n        customizations: {\n          title: 'School Fee Payment',\n          description: fee.title,\n          logo: 'https://your-school-logo.png'\n        },\n        callback: async response => {\n          console.log('Flutterwave response:', response);\n          if (response.status === 'successful' || response.status === 'completed') {\n            try {\n              await verifyTransaction(txRef);\n              const {\n                data: transaction\n              } = await supabase.from('transactions').select('id').eq('reference', txRef).single();\n              if (transaction?.id) {\n                const {\n                  sendPaymentConfirmation\n                } = await import('../../lib/payment-notifications');\n                await sendPaymentConfirmation({\n                  transactionId: transaction.id\n                });\n              }\n              toast.success('Payment successful!');\n              if (onSuccess) onSuccess();\n            } catch (error) {\n              console.error('Error processing payment:', error);\n              toast.error('Payment completed but verification failed. Please contact support.');\n            }\n          } else {\n            toast.error('Payment was not completed. Please try again.');\n          }\n          setLoading(false);\n        },\n        onclose: () => {\n          console.log('Payment modal closed');\n          if (onClose) onClose();\n          setLoading(false);\n        }\n      });\n    } catch (error) {\n      console.error('Flutterwave initialization error:', error);\n      setLoading(false);\n      toast.error('Failed to initialize payment. Please try again or contact support.');\n    }\n  };\n  return _jsxDEV(\"button\", {\n    onClick: handlePaymentClick,\n    disabled: loading || !scriptLoaded,\n    className: \"hidden\",\n    id: `flutterwave-btn-${fee.id}`,\n    children: loading ? 'Processing...' : 'Pay with Flutterwave'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 9\n  }, this);\n};","map":{"version":3,"names":["React","useState","useEffect","toast","initializeTransaction","verifyTransaction","supabase","jsxDEV","_jsxDEV","FlutterwaveWrapper","fee","email","phone","name","onSuccess","onClose","loading","setLoading","scriptLoaded","setScriptLoaded","existingScript","document","getElementById","script","createElement","src","id","async","onload","body","appendChild","handlePaymentClick","window","FlutterwaveCheckout","trim","error","publicKey","import","meta","env","VITE_FLUTTERWAVE_PUBLIC_KEY","console","txRef","Date","now","studentId","amount","public_key","tx_ref","currency","payment_options","customer","phone_number","customizations","title","description","logo","callback","response","log","status","data","transaction","from","select","eq","single","sendPaymentConfirmation","transactionId","success","onclose","onClick","disabled","className","children","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/payments/FlutterwaveWrapper.tsx"],"sourcesContent":["/**\r\n * Flutterwave Payment Wrapper Component\r\n * Uses Flutterwave Inline SDK (no npm package required)\r\n */\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { Fee } from '../../types';\r\nimport { initializeTransaction, verifyTransaction } from '../../lib/payments';\r\nimport { supabase } from '../../lib/supabase';\r\n\r\ninterface FlutterwaveWrapperProps {\r\n    fee: Fee;\r\n    email: string;\r\n    phone: string;\r\n    name: string;\r\n    onSuccess?: () => void;\r\n    onClose?: () => void;\r\n}\r\n\r\n// Declare FlutterwaveCheckout type for TypeScript\r\ndeclare global {\r\n    interface Window {\r\n        FlutterwaveCheckout: any;\r\n    }\r\n}\r\n\r\nexport const FlutterwaveWrapper: React.FC<FlutterwaveWrapperProps> = ({\r\n    fee,\r\n    email,\r\n    phone,\r\n    name,\r\n    onSuccess,\r\n    onClose\r\n}) => {\r\n    const [loading, setLoading] = useState(false);\r\n    const [scriptLoaded, setScriptLoaded] = useState(false);\r\n\r\n    // Load Flutterwave SDK script\r\n    useEffect(() => {\r\n        const existingScript = document.getElementById('flutterwaveCheckout');\r\n\r\n        if (!existingScript) {\r\n            const script = document.createElement('script');\r\n            script.src = 'https://checkout.flutterwave.com/v3.js';\r\n            script.id = 'flutterwaveCheckout';\r\n            script.async = true;\r\n            script.onload = () => setScriptLoaded(true);\r\n            document.body.appendChild(script);\r\n        } else {\r\n            setScriptLoaded(true);\r\n        }\r\n    }, []);\r\n\r\n    const handlePaymentClick = async () => {\r\n        if (!scriptLoaded || !window.FlutterwaveCheckout) {\r\n            toast('Payment system is loading. Please try again in a moment.');\r\n            return;\r\n        }\r\n\r\n        // Validate required customer data\r\n        if (!email || email.trim() === '') {\r\n            toast.error('Email is required for payment. Please update your profile.');\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n\r\n        // Get Flutterwave public key from environment\r\n        const publicKey = import.meta.env.VITE_FLUTTERWAVE_PUBLIC_KEY;\r\n\r\n        // Check if public key is configured\r\n        if (!publicKey || publicKey === '' || publicKey === 'your_flutterwave_public_key_here') {\r\n            setLoading(false);\r\n            toast.error('Payment gateway not configured. Please contact administrator.');\r\n            console.error('Flutterwave public key not configured in environment variables');\r\n            return;\r\n        }\r\n\r\n        const txRef = `FLW-${Date.now()}-${fee.id}`;\r\n\r\n        try {\r\n            // Create pending transaction\r\n            await initializeTransaction(\r\n                fee.id,\r\n                fee.studentId,\r\n                fee.amount,\r\n                txRef,\r\n                'Flutterwave'\r\n            );\r\n\r\n            // Initialize Flutterwave payment with validated data\r\n            window.FlutterwaveCheckout({\r\n                public_key: publicKey,\r\n                tx_ref: txRef,\r\n                amount: fee.amount,\r\n                currency: 'NGN',\r\n                payment_options: 'card,mobilemoney,ussd,banktransfer',\r\n                customer: {\r\n                    email: email.trim(),\r\n                    phone_number: phone || '0000000000',\r\n                    name: name || 'Parent',\r\n                },\r\n                customizations: {\r\n                    title: 'School Fee Payment',\r\n                    description: fee.title,\r\n                    logo: 'https://your-school-logo.png', // Replace with your logo\r\n                },\r\n                callback: async (response: any) => {\r\n                    console.log('Flutterwave response:', response);\r\n\r\n                    if (response.status === 'successful' || response.status === 'completed') {\r\n                        try {\r\n                            // Verify transaction\r\n                            await verifyTransaction(txRef);\r\n\r\n                            // Send payment confirmation\r\n                            const { data: transaction } = await supabase\r\n                                .from('transactions')\r\n                                .select('id')\r\n                                .eq('reference', txRef)\r\n                                .single();\r\n\r\n                            if (transaction?.id) {\r\n                                const { sendPaymentConfirmation } = await import('../../lib/payment-notifications');\r\n                                await sendPaymentConfirmation({ transactionId: transaction.id });\r\n                            }\r\n\r\n                            toast.success('Payment successful!');\r\n                            if (onSuccess) onSuccess();\r\n                        } catch (error) {\r\n                            console.error('Error processing payment:', error);\r\n                            toast.error('Payment completed but verification failed. Please contact support.');\r\n                        }\r\n                    } else {\r\n                        toast.error('Payment was not completed. Please try again.');\r\n                    }\r\n\r\n                    setLoading(false);\r\n                },\r\n                onclose: () => {\r\n                    console.log('Payment modal closed');\r\n                    if (onClose) onClose();\r\n                    setLoading(false);\r\n                },\r\n            });\r\n        } catch (error) {\r\n            console.error('Flutterwave initialization error:', error);\r\n            setLoading(false);\r\n            toast.error('Failed to initialize payment. Please try again or contact support.');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <button\r\n            onClick={handlePaymentClick}\r\n            disabled={loading || !scriptLoaded}\r\n            className=\"hidden\"\r\n            id={`flutterwave-btn-${fee.id}`}\r\n        >\r\n            {loading ? 'Processing...' : 'Pay with Flutterwave'}\r\n        </button>\r\n    );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}