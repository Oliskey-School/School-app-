{"ast":null,"code":"import { useEffect, useState } from 'react';\nimport { supabase } from './supabase';\nexport function useRealtime(tableName, selectQuery = '*', orderBy, ascending = true) {\n  const [data, setData] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    let channel;\n    const fetchData = async () => {\n      try {\n        setLoading(true);\n        let query = supabase.from(tableName).select(selectQuery);\n        if (orderBy) {\n          query = query.order(orderBy, {\n            ascending\n          });\n        }\n        const {\n          data: initialData,\n          error: fetchError\n        } = await query;\n        if (fetchError) {\n          throw fetchError;\n        }\n        setData(initialData);\n      } catch (err) {\n        console.error(`Error fetching ${tableName}:`, err);\n        setError(err.message || 'Failed to fetch data');\n      } finally {\n        setLoading(false);\n      }\n    };\n    const setupSubscription = () => {\n      channel = supabase.channel(`public:${tableName}`).on('postgres_changes', {\n        event: '*',\n        schema: 'public',\n        table: tableName\n      }, payload => {\n        if (payload.eventType === 'INSERT') {\n          setData(prev => [...prev, payload.new]);\n        } else if (payload.eventType === 'UPDATE') {\n          setData(prev => prev.map(item => item.id === payload.new.id ? payload.new : item));\n        } else if (payload.eventType === 'DELETE') {\n          setData(prev => prev.filter(item => item.id !== payload.old.id));\n        }\n      }).subscribe();\n    };\n    fetchData().then(() => {\n      setupSubscription();\n    });\n    return () => {\n      if (channel) {\n        supabase.removeChannel(channel);\n      }\n    };\n  }, [tableName, selectQuery, orderBy, ascending]);\n  return {\n    data,\n    loading,\n    error\n  };\n}","map":{"version":3,"names":["useEffect","useState","supabase","useRealtime","tableName","selectQuery","orderBy","ascending","data","setData","loading","setLoading","error","setError","channel","fetchData","query","from","select","order","initialData","fetchError","err","console","message","setupSubscription","on","event","schema","table","payload","eventType","prev","new","map","item","id","filter","old","subscribe","then","removeChannel"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/useRealtime.ts"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { supabase } from './supabase';\r\nimport { RealtimeChannel } from '@supabase/supabase-js';\r\n\r\n/**\r\n * A custom hook to fetch data from a table and subscribe to real-time changes.\r\n * @param tableName The name of the table to listen to (e.g., 'students', 'classes')\r\n * @param selectQuery The columns to select (default: '*')\r\n * @param orderBy The column to order by (optional)\r\n * @param ascending Order direction (default: true)\r\n */\r\nexport function useRealtime<T>(\r\n    tableName: string,\r\n    selectQuery: string = '*',\r\n    orderBy?: string,\r\n    ascending: boolean = true\r\n) {\r\n    const [data, setData] = useState<T[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        let channel: RealtimeChannel;\r\n\r\n        const fetchData = async () => {\r\n            try {\r\n                setLoading(true);\r\n                let query = supabase.from(tableName).select(selectQuery);\r\n\r\n                if (orderBy) {\r\n                    query = query.order(orderBy, { ascending });\r\n                }\r\n\r\n                const { data: initialData, error: fetchError } = await query;\r\n\r\n                if (fetchError) {\r\n                    throw fetchError;\r\n                }\r\n\r\n                setData(initialData as T[]);\r\n            } catch (err: any) {\r\n                console.error(`Error fetching ${tableName}:`, err);\r\n                setError(err.message || 'Failed to fetch data');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        const setupSubscription = () => {\r\n            channel = supabase\r\n                .channel(`public:${tableName}`)\r\n                .on(\r\n                    'postgres_changes',\r\n                    { event: '*', schema: 'public', table: tableName },\r\n                    (payload) => {\r\n                        // console.log('Realtime update:', payload);\r\n\r\n                        // Handle different event types\r\n                        if (payload.eventType === 'INSERT') {\r\n                            setData((prev) => [...prev, payload.new as T]);\r\n                        } else if (payload.eventType === 'UPDATE') {\r\n                            setData((prev) =>\r\n                                prev.map((item: any) =>\r\n                                    item.id === payload.new.id ? payload.new : item\r\n                                ) as T[]\r\n                            );\r\n                        } else if (payload.eventType === 'DELETE') {\r\n                            setData((prev) =>\r\n                                prev.filter((item: any) => item.id !== payload.old.id)\r\n                            );\r\n                        }\r\n                    }\r\n                )\r\n                .subscribe();\r\n        };\r\n\r\n        fetchData().then(() => {\r\n            setupSubscription();\r\n        });\r\n\r\n        return () => {\r\n            if (channel) {\r\n                supabase.removeChannel(channel);\r\n            }\r\n        };\r\n    }, [tableName, selectQuery, orderBy, ascending]);\r\n\r\n    return { data, loading, error };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}