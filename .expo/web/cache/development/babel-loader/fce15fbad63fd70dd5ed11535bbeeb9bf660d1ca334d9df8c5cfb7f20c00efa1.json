{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\admin\\\\TimetableGeneratorScreen.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { getAIClient, SchemaType as Type } from '../../lib/ai';\nimport { SparklesIcon, TrashIcon, PlusIcon, XCircleIcon, ChevronRightIcon, CalendarIcon, UserGroupIcon, ClockIcon, EditIcon } from '../../constants';\nimport { supabase } from '../../lib/supabase';\nimport { checkTimetableExists, fetchTimetableForClass, fetchTeachers } from '../../lib/database';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GeneratingScreen = () => _jsxDEV(\"div\", {\n  className: \"absolute inset-0 bg-white/80 backdrop-blur-md flex flex-col items-center justify-center z-50 animate-fade-in\",\n  children: [_jsxDEV(\"div\", {\n    className: \"relative\",\n    children: [_jsxDEV(\"div\", {\n      className: \"absolute inset-0 bg-indigo-500 rounded-full blur-xl opacity-20 animate-pulse\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 13\n    }, this), _jsxDEV(SparklesIcon, {\n      className: \"w-16 h-16 text-indigo-600 animate-spin-slow relative z-10\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 24,\n    columnNumber: 9\n  }, this), _jsxDEV(\"h3\", {\n    className: \"text-2xl font-bold mt-6 text-gray-800 tracking-tight\",\n    children: \"Crafting Schedule...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 28,\n    columnNumber: 9\n  }, this), _jsxDEV(\"p\", {\n    className: \"text-gray-500 mt-2 text-center max-w-sm px-4\",\n    children: \"Our AI is analyzing constraints, balancing teacher loads, and optimizing the timetable for Class success.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 29,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 23,\n  columnNumber: 5\n}, this);\nconst TagInput = ({\n  tags,\n  setTags,\n  placeholder\n}) => {\n  const [input, setInput] = useState('');\n  const handleAddTag = () => {\n    const newTag = input.trim();\n    if (newTag && !tags.includes(newTag)) {\n      setTags([...tags, newTag]);\n      setInput('');\n    }\n  };\n  const handleRemoveTag = tagToRemove => {\n    setTags(tags.filter(tag => tag !== tagToRemove));\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' || e.key === ',') {\n      e.preventDefault();\n      handleAddTag();\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-wrap items-center gap-2 p-3 border border-gray-200 rounded-xl bg-gray-50/50 focus-within:bg-white focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 transition-all min-h-[50px]\",\n    children: [tags.map(tag => _jsxDEV(\"span\", {\n      className: \"flex items-center gap-1.5 pl-3 pr-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-full group\",\n      children: [tag, _jsxDEV(\"button\", {\n        type: \"button\",\n        onClick: () => handleRemoveTag(tag),\n        className: \"p-0.5 text-indigo-400 hover:text-indigo-600 hover:bg-indigo-200 rounded-full transition-colors\",\n        children: _jsxDEV(XCircleIcon, {\n          className: \"w-3.5 h-3.5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 61,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 21\n      }, this)]\n    }, tag, true, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 17\n    }, this)), _jsxDEV(\"input\", {\n      type: \"text\",\n      value: input,\n      onChange: e => setInput(e.target.value),\n      onKeyDown: handleKeyDown,\n      onBlur: handleAddTag,\n      placeholder: tags.length === 0 ? placeholder : '',\n      className: \"flex-grow bg-transparent p-1 text-sm focus:outline-none min-w-[120px] placeholder:text-gray-400 text-gray-700\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 9\n  }, this);\n};\nconst TimetableGeneratorScreen = ({\n  navigateTo\n}) => {\n  const [className, setClassName] = useState('');\n  const [classes, setClasses] = useState([]);\n  const [isLoadingClasses, setIsLoadingClasses] = useState(true);\n  const [showClassPicker, setShowClassPicker] = useState(false);\n  const [existingTimetableFound, setExistingTimetableFound] = useState(false);\n  const [isLoadingExisting, setIsLoadingExisting] = useState(false);\n  const [teachers, setTeachers] = useState([{\n    name: 'Mr. Adeoye',\n    subjects: ['Mathematics']\n  }, {\n    name: 'Mrs. Akintola',\n    subjects: ['English']\n  }, {\n    name: 'Dr. Bello',\n    subjects: ['Basic Technology']\n  }, {\n    name: 'Ms. Sani',\n    subjects: ['Basic Science']\n  }]);\n  const [subjectPeriods, setSubjectPeriods] = useState([{\n    name: 'Mathematics',\n    periods: 5\n  }, {\n    name: 'English',\n    periods: 5\n  }, {\n    name: 'Basic Science',\n    periods: 4\n  }, {\n    name: 'Basic Technology',\n    periods: 4\n  }, {\n    name: 'Social Studies',\n    periods: 3\n  }]);\n  const [customRules, setCustomRules] = useState(\"Fridays must end early, after the 6th period.\\nNo double periods for any subject.\");\n  const [isGenerating, setIsGenerating] = useState(false);\n  useEffect(() => {\n    const fetchClasses = async () => {\n      setIsLoadingClasses(true);\n      try {\n        const {\n          data,\n          error\n        } = await supabase.from('classes').select('id, subject, grade, section, department').order('grade', {\n          ascending: true\n        }).order('section', {\n          ascending: true\n        });\n        if (error) {\n          console.error('Supabase error:', error);\n          throw error;\n        }\n        if (data) {\n          const {\n            getGradeDisplayName\n          } = await import('../../lib/schoolSystem');\n          const uniqueClassesMap = new Map();\n          data.forEach(cls => {\n            const gradeName = getGradeDisplayName(cls.grade);\n            let displayName = `${gradeName} - Section ${cls.section}`;\n            if (cls.department && cls.grade >= 10) {\n              displayName += ` (${cls.department})`;\n            }\n            const key = `${cls.grade}-${cls.section}-${cls.department || ''}`;\n            if (!uniqueClassesMap.has(key)) {\n              uniqueClassesMap.set(key, {\n                id: cls.id,\n                name: displayName,\n                grade: cls.grade,\n                section: cls.section\n              });\n            }\n          });\n          const formattedClasses = Array.from(uniqueClassesMap.values());\n          setClasses(formattedClasses);\n          if (formattedClasses.length > 0 && !className) {\n            setClassName(formattedClasses[0].name);\n          }\n        }\n      } catch (error) {\n        console.error('Error fetching classes:', error);\n        toast.error('Failed to load classes.');\n      } finally {\n        setIsLoadingClasses(false);\n      }\n    };\n    fetchClasses();\n  }, []);\n  useEffect(() => {\n    const checkExistence = () => {\n      if (className) {\n        checkTimetableExists(className).then(exists => {\n          setExistingTimetableFound(exists);\n        });\n      }\n    };\n    checkExistence();\n    const channel = supabase.channel(`timetable_check_${className}`).on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'timetable'\n    }, payload => {\n      checkExistence();\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [className]);\n  const handleLoadExisting = async () => {\n    setIsLoadingExisting(true);\n    try {\n      const data = await fetchTimetableForClass(className);\n      const dbTeachers = await fetchTeachers();\n      const timetableMap = {};\n      const teacherAssignmentsMap = {};\n      const subjectsSet = new Set();\n      const getTeacherName = id => {\n        const t = dbTeachers.find(dt => dt.id === id);\n        return t ? t.name : 'Unknown Teacher';\n      };\n      data.forEach(entry => {\n        const PERIODS = [{\n          name: 'Period 1',\n          start: '09:00'\n        }, {\n          name: 'Period 2',\n          start: '09:45'\n        }, {\n          name: 'Period 3',\n          start: '10:30'\n        }, {\n          name: 'Period 4',\n          start: '11:30'\n        }, {\n          name: 'Period 5',\n          start: '12:15'\n        }, {\n          name: 'Period 6',\n          start: '13:45'\n        }, {\n          name: 'Period 7',\n          start: '14:30'\n        }, {\n          name: 'Period 8',\n          start: '15:15'\n        }];\n        const period = PERIODS.find(p => p.start === entry.start_time);\n        if (period) {\n          const key = `${entry.day}-${period.name}`;\n          timetableMap[key] = entry.subject;\n          subjectsSet.add(entry.subject);\n          if (entry.teacher_id) {\n            teacherAssignmentsMap[key] = getTeacherName(entry.teacher_id);\n          }\n        }\n      });\n      const timetableData = {\n        className,\n        subjects: Array.from(subjectsSet),\n        timetable: timetableMap,\n        teacherAssignments: teacherAssignmentsMap,\n        suggestions: [],\n        teacherLoad: [],\n        status: data.length > 0 ? data[0].status : 'Draft',\n        teachers: dbTeachers.map(t => ({\n          name: t.name,\n          subjects: t.subjects\n        }))\n      };\n      navigateTo('timetableEditor', 'Edit Timetable', {\n        timetableData: timetableData\n      });\n    } catch (error) {\n      console.error(\"Error loading existing timetable:\", error);\n      toast.error(\"Failed to load existing timetable.\");\n    } finally {\n      setIsLoadingExisting(false);\n    }\n  };\n  const handleGenerate = async () => {\n    setIsGenerating(true);\n    try {\n      const ai = getAIClient(import.meta.env.VITE_GEMINI_API_KEY || '');\n      const prompt = `\n                You are an expert school administrator. Generate a balanced weekly timetable for:\n                - Class: ${className}\n                - Teachers & Subjects: ${JSON.stringify(teachers)}\n                - Subject weekly period requirements: ${JSON.stringify(subjectPeriods)}\n                - Rules: ${customRules}\n\n                The periods are named 'Period 1' through 'Period 8'. Days are Monday to Friday.\n                \n                IMPORTANT: For 'timetable' and 'teacherAssignments', you MUST return an array of objects, not a direct map. Each object must have a 'slot' key (e.g., 'Monday-Period 1') and a corresponding 'subject' or 'teacher' key.\n                \n                Generate the timetable and associated data according to the provided JSON schema.\n                Ensure all teacher assignments are filled and the teacher load is calculated correctly.\n            `;\n      const responseSchema = {\n        type: Type.OBJECT,\n        properties: {\n          className: {\n            type: Type.STRING\n          },\n          subjects: {\n            type: Type.ARRAY,\n            items: {\n              type: Type.STRING\n            }\n          },\n          timetable: {\n            type: Type.ARRAY,\n            description: \"List of all class periods and their assigned subjects.\",\n            items: {\n              type: Type.OBJECT,\n              properties: {\n                slot: {\n                  type: Type.STRING,\n                  description: \"The time slot in 'Day-Period Name' format (e.g., 'Monday-Period 1').\"\n                },\n                subject: {\n                  type: Type.STRING,\n                  description: \"The subject assigned to this slot.\"\n                }\n              },\n              required: [\"slot\", \"subject\"]\n            }\n          },\n          teacherAssignments: {\n            type: Type.ARRAY,\n            description: \"List of all class periods and their assigned teachers.\",\n            items: {\n              type: Type.OBJECT,\n              properties: {\n                slot: {\n                  type: Type.STRING,\n                  description: \"The time slot in 'Day-Period Name' format.\"\n                },\n                teacher: {\n                  type: Type.STRING,\n                  description: \"The teacher assigned to this slot.\"\n                }\n              },\n              required: [\"slot\", \"teacher\"]\n            }\n          },\n          suggestions: {\n            type: Type.ARRAY,\n            items: {\n              type: Type.STRING\n            },\n            description: \"Provide suggestions for improving the timetable or pointing out any constraint violations.\"\n          },\n          teacherLoad: {\n            type: Type.ARRAY,\n            items: {\n              type: Type.OBJECT,\n              properties: {\n                teacherName: {\n                  type: Type.STRING\n                },\n                totalPeriods: {\n                  type: Type.INTEGER\n                }\n              },\n              required: [\"teacherName\", \"totalPeriods\"]\n            }\n          }\n        },\n        required: [\"className\", \"subjects\", \"timetable\", \"teacherAssignments\", \"suggestions\", \"teacherLoad\"]\n      };\n      const response = await ai.models.generateContent({\n        model: 'gemini-2.0-flash',\n        contents: prompt,\n        config: {\n          responseMimeType: \"application/json\",\n          responseSchema: responseSchema\n        }\n      });\n      let rawData;\n      try {\n        const text = response.text.trim();\n        if (text.startsWith(\"Error\") || text.startsWith(\"AI Error\") || text.includes(\"I'm having trouble\")) {\n          throw new Error(text);\n        }\n        const jsonText = text.replace(/```json/g, '').replace(/```/g, '').trim();\n        rawData = JSON.parse(jsonText);\n      } catch (parseError) {\n        console.error(\"Failed to parse AI response:\", response.text);\n        throw new Error(\"The AI generated an invalid schedule format. Please try again.\");\n      }\n      const timetableMap = rawData.timetable.reduce((acc, item) => {\n        acc[item.slot] = item.subject;\n        return acc;\n      }, {});\n      const teacherAssignmentsMap = rawData.teacherAssignments.reduce((acc, item) => {\n        acc[item.slot] = item.teacher;\n        return acc;\n      }, {});\n      const timetableData = Object.assign({}, rawData, {\n        timetable: timetableMap,\n        teacherAssignments: teacherAssignmentsMap,\n        teachers: teachers\n      });\n      navigateTo('timetableEditor', 'Edit Timetable', {\n        timetableData: Object.assign({}, timetableData, {\n          status: 'Draft'\n        })\n      });\n    } catch (error) {\n      console.error(\"Timetable generation error:\", error);\n      const errorMessage = error.message || \"An unknown error occurred.\";\n      if (errorMessage.includes(\"API Key\")) {\n        toast.error(\"Configuration Error: API Key is missing.\");\n      } else {\n        toast.error(errorMessage.length < 100 ? errorMessage : \"AI generation failed. Please simplify constraints and try again.\");\n      }\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n  const handleAddTeacher = () => setTeachers([...teachers, {\n    name: '',\n    subjects: []\n  }]);\n  const handleRemoveTeacher = index => setTeachers(teachers.filter((_, i) => i !== index));\n  const handleTeacherChange = (index, field, value) => {\n    const newTeachers = [...teachers];\n    newTeachers[index][field] = value;\n    setTeachers(newTeachers);\n  };\n  const handleAddSubjectPeriod = () => setSubjectPeriods([...subjectPeriods, {\n    name: '',\n    periods: 1\n  }]);\n  const handleRemoveSubjectPeriod = index => setSubjectPeriods(subjectPeriods.filter((_, i) => i !== index));\n  const handleSubjectPeriodChange = (index, field, value) => {\n    const newSubjects = [...subjectPeriods];\n    newSubjects[index][field] = value;\n    setSubjectPeriods(newSubjects);\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50/50 relative\",\n    children: [isGenerating && _jsxDEV(GeneratingScreen, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 30\n    }, this), _jsxDEV(\"main\", {\n      className: \"flex-grow p-4 md:p-8 space-y-8 overflow-y-auto pb-32\",\n      children: [_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-4 mb-4\",\n        children: [_jsxDEV(\"div\", {\n          className: \"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-2xl shadow-lg shadow-indigo-200\",\n          children: _jsxDEV(CalendarIcon, {\n            className: \"w-8 h-8 text-white\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          children: [_jsxDEV(\"h1\", {\n            className: \"text-2xl font-bold text-gray-900 tracking-tight\",\n            children: \"AI Timetable Creator\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 25\n          }, this), _jsxDEV(\"p\", {\n            className: \"text-gray-500\",\n            children: \"Intelligent scheduling optimized for your school.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 lg:grid-cols-2 gap-6\",\n        children: [_jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_25px_-5px_rgba(0,0,0,0.1),0_10px_10px_-5px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50\",\n          children: [_jsxDEV(\"h3\", {\n            className: \"text-lg font-bold text-gray-800 mb-6 flex items-center gap-3\",\n            children: [_jsxDEV(\"span\", {\n              className: \"bg-indigo-100 text-indigo-700 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\",\n              children: \"1\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 430,\n              columnNumber: 29\n            }, this), \"Target Class\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => setShowClassPicker(!showClassPicker),\n              className: `w-full p-4 text-left border rounded-2xl flex items-center justify-between group transition-all duration-200 ${showClassPicker ? 'border-indigo-500 ring-4 ring-indigo-500/10 bg-white shadow-md' : 'border-gray-200 bg-gray-50 hover:bg-white hover:border-gray-300'}`,\n              children: [_jsxDEV(\"div\", {\n                className: \"flex items-center gap-3\",\n                children: [_jsxDEV(UserGroupIcon, {\n                  className: `w-5 h-5 ${className ? 'text-indigo-600' : 'text-gray-400'}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 445,\n                  columnNumber: 37\n                }, this), _jsxDEV(\"span\", {\n                  className: className ? 'text-gray-900 font-bold text-base' : 'text-gray-400 font-medium',\n                  children: isLoadingClasses ? 'Loading classes...' : className || 'Select a class'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 446,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 444,\n                columnNumber: 33\n              }, this), _jsxDEV(ChevronRightIcon, {\n                className: `w-5 h-5 text-gray-400 transition-transform duration-300 ${showClassPicker ? 'rotate-90 text-indigo-500' : 'group-hover:text-gray-600'}`\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 450,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 29\n            }, this), showClassPicker && _jsxDEV(\"div\", {\n              className: \"absolute z-20 mt-2 w-full bg-white border border-gray-100 rounded-2xl shadow-2xl shadow-indigo-900/10 max-h-80 overflow-y-auto animate-slide-in-up origin-top p-2\",\n              children: isLoadingClasses ? _jsxDEV(\"div\", {\n                className: \"p-8 text-center text-gray-500\",\n                children: [_jsxDEV(\"div\", {\n                  className: \"animate-spin rounded-full h-6 w-6 border-2 border-indigo-500 border-t-transparent mx-auto mb-2\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 458,\n                  columnNumber: 45\n                }, this), _jsxDEV(\"p\", {\n                  className: \"text-xs font-medium\",\n                  children: \"Loading...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 459,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 41\n              }, this) : classes.length === 0 ? _jsxDEV(\"div\", {\n                className: \"p-6 text-center text-gray-500\",\n                children: _jsxDEV(\"p\", {\n                  className: \"font-bold text-gray-800 text-sm\",\n                  children: \"No classes found\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 463,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 41\n              }, this) : _jsxDEV(\"div\", {\n                className: \"space-y-1\",\n                children: classes.map(cls => _jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => {\n                    setClassName(cls.name);\n                    setShowClassPicker(false);\n                  },\n                  className: `w-full px-4 py-3 text-left rounded-xl transition-all flex items-center justify-between group ${className === cls.name ? 'bg-indigo-50 text-indigo-700' : 'text-gray-700 hover:bg-gray-50'}`,\n                  children: [_jsxDEV(\"div\", {\n                    children: [_jsxDEV(\"p\", {\n                      className: \"font-bold text-sm tracking-tight\",\n                      children: cls.name\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 481,\n                      columnNumber: 57\n                    }, this), _jsxDEV(\"p\", {\n                      className: \"text-[10px] text-gray-400 font-medium uppercase mt-0.5 group-hover:text-gray-500 tracking-wide\",\n                      children: [\"Grade \", cls.grade, \" \\u2022 Section \", cls.section]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 482,\n                      columnNumber: 57\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 480,\n                    columnNumber: 53\n                  }, this), className === cls.name && _jsxDEV(CheckCircleIcon, {\n                    className: \"w-5 h-5 text-indigo-600\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 485,\n                    columnNumber: 57\n                  }, this)]\n                }, cls.id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 468,\n                  columnNumber: 49\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 466,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 25\n          }, this), existingTimetableFound && _jsxDEV(\"div\", {\n            className: \"mt-4 p-4 bg-indigo-50 border border-indigo-100 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4 animate-slide-in-up\",\n            children: [_jsxDEV(\"div\", {\n              className: \"flex items-center gap-3\",\n              children: [_jsxDEV(\"div\", {\n                className: \"w-10 h-10 rounded-full bg-white border border-indigo-100 flex items-center justify-center flex-shrink-0\",\n                children: _jsxDEV(CalendarIcon, {\n                  className: \"w-5 h-5 text-indigo-600\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 500,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 37\n              }, this), _jsxDEV(\"div\", {\n                children: [_jsxDEV(\"h4\", {\n                  className: \"font-bold text-gray-800 text-sm\",\n                  children: \"Timetable Exists\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 503,\n                  columnNumber: 41\n                }, this), _jsxDEV(\"p\", {\n                  className: \"text-xs text-gray-500\",\n                  children: \"A timetable is already saved for this class.\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 504,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 502,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 498,\n              columnNumber: 33\n            }, this), _jsxDEV(\"button\", {\n              onClick: handleLoadExisting,\n              disabled: isLoadingExisting,\n              className: \"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center gap-2 whitespace-nowrap w-full sm:w-auto justify-center disabled:opacity-70\",\n              children: [isLoadingExisting ? _jsxDEV(\"div\", {\n                className: \"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 513,\n                columnNumber: 41\n              }, this) : _jsxDEV(EditIcon, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 515,\n                columnNumber: 41\n              }, this), \"Edit Existing\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 507,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_25px_-5px_rgba(0,0,0,0.1),0_10px_10px_-5px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 flex flex-col\",\n          children: [_jsxDEV(\"h3\", {\n            className: \"text-lg font-bold text-gray-800 mb-4 flex items-center gap-3\",\n            children: [_jsxDEV(\"span\", {\n              className: \"bg-pink-100 text-pink-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\",\n              children: \"4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 526,\n              columnNumber: 29\n            }, this), \"Rules & Constraints\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 525,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"flex-grow flex flex-col\",\n            children: [_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-400 mb-3 ml-1\",\n              children: \"Instruct the AI on specific school policies.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 29\n            }, this), _jsxDEV(\"textarea\", {\n              value: customRules,\n              onChange: e => setCustomRules(e.target.value),\n              className: \"flex-grow w-full p-4 text-gray-700 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 outline-none transition-all placeholder:text-gray-400 resize-none text-sm leading-relaxed min-h-[140px]\",\n              placeholder: \"e.g. No math after lunch...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 531,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 529,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-2 gap-6\",\n        children: [_jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 col-span-1 md:col-span-2\",\n          children: [_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center mb-6\",\n            children: [_jsxDEV(\"h3\", {\n              className: \"text-lg font-bold text-gray-800 flex items-center gap-3\",\n              children: [_jsxDEV(\"span\", {\n                className: \"bg-emerald-100 text-emerald-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\",\n                children: \"2\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 546,\n                columnNumber: 33\n              }, this), \"Faculty & Subjects\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 545,\n              columnNumber: 29\n            }, this), _jsxDEV(\"span\", {\n              className: \"text-xs font-bold text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100\",\n              children: [teachers.length, \" Teachers\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 549,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 544,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"grid grid-cols-1 lg:grid-cols-2 gap-4\",\n            children: [teachers.map((teacher, index) => _jsxDEV(\"div\", {\n              className: \"p-4 bg-gray-50/50 border border-gray-200 rounded-2xl space-y-4 relative transition-all hover:bg-white hover:border-emerald-200 hover:shadow-lg hover:shadow-emerald-900/5 group\",\n              children: [_jsxDEV(\"div\", {\n                className: \"flex items-center gap-3\",\n                children: [_jsxDEV(\"div\", {\n                  className: \"w-8 h-8 flex-shrink-0 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold text-sm shadow-sm border border-emerald-200\",\n                  children: index + 1\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 556,\n                  columnNumber: 41\n                }, this), _jsxDEV(\"input\", {\n                  type: \"text\",\n                  value: teacher.name,\n                  onChange: e => handleTeacherChange(index, 'name', e.target.value),\n                  placeholder: \"Teacher Name\",\n                  className: \"flex-1 p-2 bg-transparent text-gray-800 font-bold placeholder:text-gray-400 placeholder:font-normal focus:outline-none border-b-2 border-transparent focus:border-emerald-500 transition-all\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 559,\n                  columnNumber: 41\n                }, this), _jsxDEV(\"button\", {\n                  onClick: () => handleRemoveTeacher(index),\n                  className: \"p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all opacity-0 group-hover:opacity-100\",\n                  children: _jsxDEV(TrashIcon, {\n                    className: \"w-4 h-4\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 570,\n                    columnNumber: 45\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 555,\n                columnNumber: 37\n              }, this), _jsxDEV(\"div\", {\n                className: \"pl-14\",\n                children: _jsxDEV(TagInput, {\n                  tags: teacher.subjects,\n                  setTags: newSubjects => handleTeacherChange(index, 'subjects', newSubjects),\n                  placeholder: \"Type subject...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 575,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 574,\n                columnNumber: 37\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 554,\n              columnNumber: 33\n            }, this)), _jsxDEV(\"button\", {\n              onClick: handleAddTeacher,\n              className: \"p-6 border-2 border-dashed border-gray-200 rounded-2xl hover:bg-gray-50 hover:border-emerald-300 hover:text-emerald-600 transition-all flex flex-col items-center justify-center gap-2 text-gray-400 font-bold group min-h-[140px]\",\n              children: [_jsxDEV(\"div\", {\n                className: \"w-10 h-10 rounded-full bg-gray-100 group-hover:bg-emerald-100 group-hover:text-emerald-600 flex items-center justify-center transition-colors\",\n                children: _jsxDEV(PlusIcon, {\n                  className: \"w-5 h-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 589,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 588,\n                columnNumber: 33\n              }, this), _jsxDEV(\"span\", {\n                children: \"Add Teacher\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 591,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 584,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 552,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 543,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 col-span-1 md:col-span-2\",\n          children: [_jsxDEV(\"div\", {\n            className: \"mb-6\",\n            children: [_jsxDEV(\"h3\", {\n              className: \"text-lg font-bold text-gray-800 flex items-center gap-3\",\n              children: [_jsxDEV(\"span\", {\n                className: \"bg-orange-100 text-orange-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\",\n                children: \"3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 600,\n                columnNumber: 33\n              }, this), \"Subject Distribution\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 29\n            }, this), _jsxDEV(\"p\", {\n              className: \"text-xs text-gray-400 mt-1 ml-11\",\n              children: \"Sessions per week for each subject.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 598,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\",\n            children: [subjectPeriods.map((subject, index) => _jsxDEV(\"div\", {\n              className: \"flex items-center gap-2 p-2 pr-3 bg-gray-50 rounded-xl border border-gray-100 focus-within:ring-2 focus-within:ring-orange-500/20 focus-within:border-orange-400 transition-all hover:bg-white hover:shadow-sm group\",\n              children: [_jsxDEV(\"div\", {\n                className: \"w-8 h-8 rounded-lg bg-orange-50 border border-orange-100 text-orange-400 flex flex-shrink-0 items-center justify-center font-bold text-xs\",\n                children: index + 1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 609,\n                columnNumber: 37\n              }, this), _jsxDEV(\"input\", {\n                type: \"text\",\n                value: subject.name,\n                onChange: e => handleSubjectPeriodChange(index, 'name', e.target.value),\n                placeholder: \"Subject\",\n                className: \"flex-grow w-full bg-transparent font-semibold text-gray-700 outline-none text-sm placeholder:font-normal\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 612,\n                columnNumber: 37\n              }, this), _jsxDEV(\"div\", {\n                className: \"flex items-center gap-1 bg-white rounded-lg border border-gray-200 px-2 py-1 shadow-sm\",\n                children: [_jsxDEV(ClockIcon, {\n                  className: \"w-3 h-3 text-gray-400\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 620,\n                  columnNumber: 41\n                }, this), _jsxDEV(\"input\", {\n                  type: \"number\",\n                  min: \"1\",\n                  value: subject.periods,\n                  onChange: e => handleSubjectPeriodChange(index, 'periods', parseInt(e.target.value, 10) || 1),\n                  className: \"w-6 text-center font-bold text-gray-800 outline-none bg-transparent text-sm\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 621,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 619,\n                columnNumber: 37\n              }, this), _jsxDEV(\"button\", {\n                onClick: () => handleRemoveSubjectPeriod(index),\n                className: \"p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\",\n                children: _jsxDEV(TrashIcon, {\n                  className: \"w-3.5 h-3.5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 629,\n                  columnNumber: 190\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 629,\n                columnNumber: 37\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 608,\n              columnNumber: 33\n            }, this)), _jsxDEV(\"button\", {\n              onClick: handleAddSubjectPeriod,\n              className: \"h-full min-h-[50px] border-2 border-dashed border-gray-200 text-gray-400 font-bold rounded-xl hover:bg-orange-50 hover:border-orange-300 hover:text-orange-600 transition-all flex items-center justify-center gap-2 text-sm\",\n              children: [_jsxDEV(PlusIcon, {\n                className: \"w-4 h-4\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 636,\n                columnNumber: 33\n              }, this), _jsxDEV(\"span\", {\n                children: \"Add Subject\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 637,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 632,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 606,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 541,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 13\n    }, this), _jsxDEV(\"footer\", {\n      className: \"p-4 bg-white/80 backdrop-blur-xl border-t border-gray-200 sticky bottom-0 z-30\",\n      children: _jsxDEV(\"div\", {\n        className: \"max-w-4xl mx-auto\",\n        children: _jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: handleGenerate,\n          disabled: isGenerating,\n          className: \"w-full flex justify-center items-center space-x-3 py-4 px-6 font-bold text-lg text-white bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700 hover:from-indigo-500 hover:via-purple-500 hover:to-indigo-600 active:scale-[0.99] disabled:opacity-70 disabled:grayscale rounded-2xl shadow-xl shadow-indigo-500/20 hover:shadow-indigo-500/30 transition-all duration-300 border border-white/20\",\n          children: [_jsxDEV(SparklesIcon, {\n            className: `w-6 h-6 ${isGenerating ? 'animate-spin' : 'animate-pulse'}`\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 653,\n            columnNumber: 25\n          }, this), _jsxDEV(\"span\", {\n            children: isGenerating ? 'Generating Magic...' : 'Generate Optimized Timetable'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 654,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 647,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 646,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 645,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 411,\n    columnNumber: 9\n  }, this);\n};\nconst CheckCircleIcon = ({\n  className\n}) => _jsxDEV(\"svg\", {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  fill: \"none\",\n  viewBox: \"0 0 24 24\",\n  strokeWidth: 2,\n  stroke: \"currentColor\",\n  className: className,\n  children: _jsxDEV(\"path\", {\n    strokeLinecap: \"round\",\n    strokeLinejoin: \"round\",\n    d: \"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 665,\n    columnNumber: 9\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 664,\n  columnNumber: 5\n}, this);\nexport default TimetableGeneratorScreen;","map":{"version":3,"names":["React","useState","useEffect","toast","getAIClient","SchemaType","Type","SparklesIcon","TrashIcon","PlusIcon","XCircleIcon","ChevronRightIcon","CalendarIcon","UserGroupIcon","ClockIcon","EditIcon","supabase","checkTimetableExists","fetchTimetableForClass","fetchTeachers","jsxDEV","_jsxDEV","GeneratingScreen","className","children","fileName","_jsxFileName","lineNumber","columnNumber","TagInput","tags","setTags","placeholder","input","setInput","handleAddTag","newTag","trim","includes","handleRemoveTag","tagToRemove","filter","tag","handleKeyDown","e","key","preventDefault","map","type","onClick","value","onChange","target","onKeyDown","onBlur","length","TimetableGeneratorScreen","navigateTo","setClassName","classes","setClasses","isLoadingClasses","setIsLoadingClasses","showClassPicker","setShowClassPicker","existingTimetableFound","setExistingTimetableFound","isLoadingExisting","setIsLoadingExisting","teachers","setTeachers","name","subjects","subjectPeriods","setSubjectPeriods","periods","customRules","setCustomRules","isGenerating","setIsGenerating","fetchClasses","data","error","from","select","order","ascending","console","getGradeDisplayName","uniqueClassesMap","Map","forEach","cls","gradeName","grade","displayName","section","department","has","set","id","formattedClasses","Array","values","checkExistence","then","exists","channel","on","event","schema","table","payload","subscribe","removeChannel","handleLoadExisting","dbTeachers","timetableMap","teacherAssignmentsMap","subjectsSet","Set","getTeacherName","t","find","dt","entry","PERIODS","start","period","p","start_time","day","subject","add","teacher_id","timetableData","timetable","teacherAssignments","suggestions","teacherLoad","status","handleGenerate","ai","import","meta","env","VITE_GEMINI_API_KEY","prompt","JSON","stringify","responseSchema","OBJECT","properties","STRING","ARRAY","items","description","slot","required","teacher","teacherName","totalPeriods","INTEGER","response","models","generateContent","model","contents","config","responseMimeType","rawData","text","startsWith","Error","jsonText","replace","parse","parseError","reduce","acc","item","Object","assign","errorMessage","message","handleAddTeacher","handleRemoveTeacher","index","_","i","handleTeacherChange","field","newTeachers","handleAddSubjectPeriod","handleRemoveSubjectPeriod","handleSubjectPeriodChange","newSubjects","CheckCircleIcon","disabled","min","parseInt","xmlns","fill","viewBox","strokeWidth","stroke","strokeLinecap","strokeLinejoin","d"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/admin/TimetableGeneratorScreen.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { toast } from 'react-hot-toast';\r\nimport { getAIClient, AI_MODEL_NAME, SchemaType as Type } from '../../lib/ai';\r\nimport { AIIcon, SparklesIcon, TrashIcon, PlusIcon, XCircleIcon, ChevronRightIcon, CalendarIcon, UserGroupIcon, BookOpenIcon, ClockIcon, EditIcon } from '../../constants';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { checkTimetableExists, fetchTimetableForClass, fetchTeachers } from '../../lib/database';\r\n\r\n// --- TYPES ---\r\ninterface TeacherInfo {\r\n    name: string;\r\n    subjects: string[];\r\n}\r\ninterface SubjectPeriod {\r\n    name: string;\r\n    periods: number;\r\n}\r\ninterface TimetableGeneratorScreenProps {\r\n    navigateTo: (view: string, title: string, props: any) => void;\r\n}\r\n\r\n// --- SUB-COMPONENTS ---\r\nconst GeneratingScreen: React.FC = () => (\r\n    <div className=\"absolute inset-0 bg-white/80 backdrop-blur-md flex flex-col items-center justify-center z-50 animate-fade-in\">\r\n        <div className=\"relative\">\r\n            <div className=\"absolute inset-0 bg-indigo-500 rounded-full blur-xl opacity-20 animate-pulse\"></div>\r\n            <SparklesIcon className=\"w-16 h-16 text-indigo-600 animate-spin-slow relative z-10\" />\r\n        </div>\r\n        <h3 className=\"text-2xl font-bold mt-6 text-gray-800 tracking-tight\">Crafting Schedule...</h3>\r\n        <p className=\"text-gray-500 mt-2 text-center max-w-sm px-4\">Our AI is analyzing constraints, balancing teacher loads, and optimizing the timetable for Class success.</p>\r\n    </div>\r\n);\r\n\r\nconst TagInput: React.FC<{ tags: string[]; setTags: (newTags: string[]) => void; placeholder: string }> = ({ tags, setTags, placeholder }) => {\r\n    const [input, setInput] = useState('');\r\n\r\n    const handleAddTag = () => {\r\n        const newTag = input.trim();\r\n        if (newTag && !tags.includes(newTag)) {\r\n            setTags([...tags, newTag]);\r\n            setInput('');\r\n        }\r\n    };\r\n\r\n    const handleRemoveTag = (tagToRemove: string) => {\r\n        setTags(tags.filter(tag => tag !== tagToRemove));\r\n    };\r\n\r\n    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n        if (e.key === 'Enter' || e.key === ',') {\r\n            e.preventDefault();\r\n            handleAddTag();\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-wrap items-center gap-2 p-3 border border-gray-200 rounded-xl bg-gray-50/50 focus-within:bg-white focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 transition-all min-h-[50px]\">\r\n            {tags.map(tag => (\r\n                <span key={tag} className=\"flex items-center gap-1.5 pl-3 pr-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-full group\">\r\n                    {tag}\r\n                    <button type=\"button\" onClick={() => handleRemoveTag(tag)} className=\"p-0.5 text-indigo-400 hover:text-indigo-600 hover:bg-indigo-200 rounded-full transition-colors\">\r\n                        <XCircleIcon className=\"w-3.5 h-3.5\" />\r\n                    </button>\r\n                </span>\r\n            ))}\r\n            <input\r\n                type=\"text\"\r\n                value={input}\r\n                onChange={e => setInput(e.target.value)}\r\n                onKeyDown={handleKeyDown}\r\n                onBlur={handleAddTag}\r\n                placeholder={tags.length === 0 ? placeholder : ''}\r\n                className=\"flex-grow bg-transparent p-1 text-sm focus:outline-none min-w-[120px] placeholder:text-gray-400 text-gray-700\"\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- MAIN COMPONENT ---\r\nconst TimetableGeneratorScreen: React.FC<TimetableGeneratorScreenProps> = ({ navigateTo }) => {\r\n    const [className, setClassName] = useState('');\r\n    const [classes, setClasses] = useState<{ id: string; name: string; grade: number; section: string; }[]>([]);\r\n    const [isLoadingClasses, setIsLoadingClasses] = useState(true);\r\n    const [showClassPicker, setShowClassPicker] = useState(false);\r\n\r\n    // Existing timetable state\r\n    const [existingTimetableFound, setExistingTimetableFound] = useState(false);\r\n    const [isLoadingExisting, setIsLoadingExisting] = useState(false);\r\n\r\n    const [teachers, setTeachers] = useState<TeacherInfo[]>([\r\n        { name: 'Mr. Adeoye', subjects: ['Mathematics'] },\r\n        { name: 'Mrs. Akintola', subjects: ['English'] },\r\n        { name: 'Dr. Bello', subjects: ['Basic Technology'] },\r\n        { name: 'Ms. Sani', subjects: ['Basic Science'] },\r\n    ]);\r\n    const [subjectPeriods, setSubjectPeriods] = useState<SubjectPeriod[]>([\r\n        { name: 'Mathematics', periods: 5 },\r\n        { name: 'English', periods: 5 },\r\n        { name: 'Basic Science', periods: 4 },\r\n        { name: 'Basic Technology', periods: 4 },\r\n        { name: 'Social Studies', periods: 3 },\r\n    ]);\r\n    const [customRules, setCustomRules] = useState(\"Fridays must end early, after the 6th period.\\nNo double periods for any subject.\");\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n\r\n    // Fetch classes from database\r\n    useEffect(() => {\r\n        const fetchClasses = async () => {\r\n            setIsLoadingClasses(true);\r\n            try {\r\n                const { data, error } = await supabase\r\n                    .from('classes')\r\n                    .select('id, subject, grade, section, department')\r\n                    .order('grade', { ascending: true })\r\n                    .order('section', { ascending: true });\r\n\r\n                if (error) {\r\n                    console.error('Supabase error:', error);\r\n                    throw error;\r\n                }\r\n\r\n                if (data) {\r\n                    // Import the helper function\r\n                    const { getGradeDisplayName } = await import('../../lib/schoolSystem');\r\n\r\n                    const uniqueClassesMap = new Map();\r\n\r\n                    data.forEach((cls: any) => {\r\n                        const gradeName = getGradeDisplayName(cls.grade);\r\n                        let displayName = `${gradeName} - Section ${cls.section}`;\r\n\r\n                        // Add department for SSS classes\r\n                        if (cls.department && cls.grade >= 10) {\r\n                            displayName += ` (${cls.department})`;\r\n                        }\r\n\r\n                        // Use a composite key to ensure uniqueness\r\n                        const key = `${cls.grade}-${cls.section}-${cls.department || ''}`;\r\n\r\n                        if (!uniqueClassesMap.has(key)) {\r\n                            uniqueClassesMap.set(key, {\r\n                                id: cls.id,\r\n                                name: displayName,\r\n                                grade: cls.grade,\r\n                                section: cls.section,\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    const formattedClasses = Array.from(uniqueClassesMap.values());\r\n                    setClasses(formattedClasses);\r\n\r\n                    // Set first class as default if available\r\n                    if (formattedClasses.length > 0 && !className) {\r\n                        setClassName(formattedClasses[0].name);\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.error('Error fetching classes:', error);\r\n                toast.error('Failed to load classes.');\r\n            } finally {\r\n                setIsLoadingClasses(false);\r\n            }\r\n        };\r\n\r\n        fetchClasses();\r\n    }, []);\r\n\r\n    // Check for existing timetable when className changes\r\n    // Check for existing timetable when className changes\r\n    useEffect(() => {\r\n        const checkExistence = () => {\r\n            if (className) {\r\n                checkTimetableExists(className).then(exists => {\r\n                    setExistingTimetableFound(exists);\r\n                });\r\n            }\r\n        };\r\n\r\n        checkExistence();\r\n\r\n        const channel = supabase.channel(`timetable_check_${className}`)\r\n            .on('postgres_changes', { event: '*', schema: 'public', table: 'timetable' }, (payload) => {\r\n                // Ideally filter by payload.new.class_name or payload.old.class_name if possible,\r\n                // but for now, just re-check if ANY timetable change happens.\r\n                // Optimally we would inspect payload, but Supabase realtime payloads might be partial.\r\n                checkExistence();\r\n            })\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [className]);\r\n\r\n    const handleLoadExisting = async () => {\r\n        setIsLoadingExisting(true);\r\n        try {\r\n            const data = await fetchTimetableForClass(className);\r\n            const dbTeachers = await fetchTeachers();\r\n\r\n            // Reconstruct timetable map\r\n            const timetableMap: { [key: string]: string } = {};\r\n            const teacherAssignmentsMap: { [key: string]: string } = {};\r\n            const subjectsSet = new Set<string>();\r\n\r\n            // Helper to find teacher name\r\n            const getTeacherName = (id: number) => {\r\n                const t = dbTeachers.find(dt => dt.id === id);\r\n                return t ? t.name : 'Unknown Teacher';\r\n            };\r\n\r\n            data.forEach((entry) => {\r\n                // Map database format to UI format: \"Monday-Period 1\"\r\n                // Assuming entry has day, start_time/end_time in periods format\r\n                // We need to map time to Period Name or use logic\r\n                // Simple mapping based on index or time for now, or just use stored values if we align schema.\r\n                // Since we store strict starts, we can match.\r\n\r\n                const PERIODS = [\r\n                    { name: 'Period 1', start: '09:00' },\r\n                    { name: 'Period 2', start: '09:45' },\r\n                    { name: 'Period 3', start: '10:30' },\r\n                    { name: 'Period 4', start: '11:30' },\r\n                    { name: 'Period 5', start: '12:15' },\r\n                    { name: 'Period 6', start: '13:45' },\r\n                    { name: 'Period 7', start: '14:30' },\r\n                    { name: 'Period 8', start: '15:15' },\r\n                ];\r\n\r\n                const period = PERIODS.find(p => p.start === entry.start_time);\r\n                if (period) {\r\n                    const key = `${entry.day}-${period.name}`;\r\n                    timetableMap[key] = entry.subject;\r\n                    subjectsSet.add(entry.subject);\r\n\r\n                    if (entry.teacher_id) {\r\n                        teacherAssignmentsMap[key] = getTeacherName(entry.teacher_id);\r\n                    }\r\n                }\r\n            });\r\n\r\n            const timetableData = {\r\n                className,\r\n                subjects: Array.from(subjectsSet),\r\n                timetable: timetableMap,\r\n                teacherAssignments: teacherAssignmentsMap,\r\n                suggestions: [],\r\n                teacherLoad: [],\r\n                status: data.length > 0 ? data[0].status : 'Draft',\r\n                teachers: dbTeachers.map(t => ({ name: t.name, subjects: t.subjects }))\r\n            };\r\n\r\n            // mockSavedTimetable.current = timetableData; // Removed mock dependency\r\n            navigateTo('timetableEditor', 'Edit Timetable', { timetableData: timetableData });\r\n\r\n        } catch (error) {\r\n            console.error(\"Error loading existing timetable:\", error);\r\n            toast.error(\"Failed to load existing timetable.\");\r\n        } finally {\r\n            setIsLoadingExisting(false);\r\n        }\r\n    };\r\n\r\n    const handleGenerate = async () => {\r\n        setIsGenerating(true);\r\n        // ... (existing generation logic) ...\r\n        try {\r\n            const ai = getAIClient(import.meta.env.VITE_GEMINI_API_KEY || '');\r\n            const prompt = `\r\n                You are an expert school administrator. Generate a balanced weekly timetable for:\r\n                - Class: ${className}\r\n                - Teachers & Subjects: ${JSON.stringify(teachers)}\r\n                - Subject weekly period requirements: ${JSON.stringify(subjectPeriods)}\r\n                - Rules: ${customRules}\r\n\r\n                The periods are named 'Period 1' through 'Period 8'. Days are Monday to Friday.\r\n                \r\n                IMPORTANT: For 'timetable' and 'teacherAssignments', you MUST return an array of objects, not a direct map. Each object must have a 'slot' key (e.g., 'Monday-Period 1') and a corresponding 'subject' or 'teacher' key.\r\n                \r\n                Generate the timetable and associated data according to the provided JSON schema.\r\n                Ensure all teacher assignments are filled and the teacher load is calculated correctly.\r\n            `;\r\n\r\n            const responseSchema = {\r\n                type: Type.OBJECT,\r\n                properties: {\r\n                    className: { type: Type.STRING },\r\n                    subjects: { type: Type.ARRAY, items: { type: Type.STRING } },\r\n                    timetable: {\r\n                        type: Type.ARRAY,\r\n                        description: \"List of all class periods and their assigned subjects.\",\r\n                        items: {\r\n                            type: Type.OBJECT,\r\n                            properties: {\r\n                                slot: { type: Type.STRING, description: \"The time slot in 'Day-Period Name' format (e.g., 'Monday-Period 1').\" },\r\n                                subject: { type: Type.STRING, description: \"The subject assigned to this slot.\" }\r\n                            },\r\n                            required: [\"slot\", \"subject\"]\r\n                        }\r\n                    },\r\n                    teacherAssignments: {\r\n                        type: Type.ARRAY,\r\n                        description: \"List of all class periods and their assigned teachers.\",\r\n                        items: {\r\n                            type: Type.OBJECT,\r\n                            properties: {\r\n                                slot: { type: Type.STRING, description: \"The time slot in 'Day-Period Name' format.\" },\r\n                                teacher: { type: Type.STRING, description: \"The teacher assigned to this slot.\" }\r\n                            },\r\n                            required: [\"slot\", \"teacher\"]\r\n                        }\r\n                    },\r\n                    suggestions: {\r\n                        type: Type.ARRAY,\r\n                        items: { type: Type.STRING },\r\n                        description: \"Provide suggestions for improving the timetable or pointing out any constraint violations.\"\r\n                    },\r\n                    teacherLoad: {\r\n                        type: Type.ARRAY,\r\n                        items: {\r\n                            type: Type.OBJECT,\r\n                            properties: {\r\n                                teacherName: { type: Type.STRING },\r\n                                totalPeriods: { type: Type.INTEGER }\r\n                            },\r\n                            required: [\"teacherName\", \"totalPeriods\"]\r\n                        }\r\n                    }\r\n                },\r\n                required: [\"className\", \"subjects\", \"timetable\", \"teacherAssignments\", \"suggestions\", \"teacherLoad\"]\r\n            };\r\n\r\n            const response = await ai.models.generateContent({\r\n                model: 'gemini-2.0-flash',\r\n                contents: prompt,\r\n                config: {\r\n                    responseMimeType: \"application/json\",\r\n                    responseSchema: responseSchema\r\n                }\r\n            });\r\n\r\n            let rawData;\r\n            try {\r\n                const text = response.text.trim();\r\n                // Safety check: if AI returns a plain error message instead of JSON\r\n                if (text.startsWith(\"Error\") || text.startsWith(\"AI Error\") || text.includes(\"I'm having trouble\")) {\r\n                    throw new Error(text);\r\n                }\r\n\r\n                // specific cleanup for potential markdown code blocks\r\n                const jsonText = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n                rawData = JSON.parse(jsonText);\r\n            } catch (parseError) {\r\n                console.error(\"Failed to parse AI response:\", response.text);\r\n                throw new Error(\"The AI generated an invalid schedule format. Please try again.\");\r\n            }\r\n\r\n            // Transform arrays to maps for the editor component\r\n            const timetableMap = rawData.timetable.reduce((acc: { [key: string]: string }, item: { slot: string; subject: string }) => {\r\n                acc[item.slot] = item.subject;\r\n                return acc;\r\n            }, {});\r\n\r\n            const teacherAssignmentsMap = rawData.teacherAssignments.reduce((acc: { [key: string]: string }, item: { slot: string; teacher: string }) => {\r\n                acc[item.slot] = item.teacher;\r\n                return acc;\r\n            }, {});\r\n\r\n            const timetableData = {\r\n                ...rawData,\r\n                timetable: timetableMap,\r\n                teacherAssignments: teacherAssignmentsMap,\r\n                // Pass full teacher objects for reference\r\n                teachers: teachers\r\n            };\r\n\r\n            // mockSavedTimetable.current = { ...timetableData, status: 'Draft' };\r\n            navigateTo('timetableEditor', 'Edit Timetable', { timetableData: { ...timetableData, status: 'Draft' } });\r\n\r\n        } catch (error: any) {\r\n            console.error(\"Timetable generation error:\", error);\r\n            const errorMessage = error.message || \"An unknown error occurred.\";\r\n\r\n            if (errorMessage.includes(\"API Key\")) {\r\n                toast.error(\"Configuration Error: API Key is missing.\");\r\n            } else {\r\n                toast.error(errorMessage.length < 100 ? errorMessage : \"AI generation failed. Please simplify constraints and try again.\");\r\n            }\r\n        } finally {\r\n            setIsGenerating(false);\r\n        }\r\n    };\r\n\r\n    const handleAddTeacher = () => setTeachers([...teachers, { name: '', subjects: [] }]);\r\n    const handleRemoveTeacher = (index: number) => setTeachers(teachers.filter((_, i) => i !== index));\r\n    const handleTeacherChange = (index: number, field: 'name' | 'subjects', value: string | string[]) => {\r\n        const newTeachers = [...teachers];\r\n        (newTeachers[index] as any)[field] = value;\r\n        setTeachers(newTeachers);\r\n    };\r\n\r\n    const handleAddSubjectPeriod = () => setSubjectPeriods([...subjectPeriods, { name: '', periods: 1 }]);\r\n    const handleRemoveSubjectPeriod = (index: number) => setSubjectPeriods(subjectPeriods.filter((_, i) => i !== index));\r\n    const handleSubjectPeriodChange = (index: number, field: 'name' | 'periods', value: string | number) => {\r\n        const newSubjects = [...subjectPeriods];\r\n        (newSubjects[index] as any)[field] = value;\r\n        setSubjectPeriods(newSubjects);\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-50/50 relative\">\r\n            {isGenerating && <GeneratingScreen />}\r\n            <main className=\"flex-grow p-4 md:p-8 space-y-8 overflow-y-auto pb-32\">\r\n\r\n                {/* Header Section */}\r\n                <div className=\"flex items-center space-x-4 mb-4\">\r\n                    <div className=\"bg-gradient-to-br from-indigo-500 to-purple-600 p-3 rounded-2xl shadow-lg shadow-indigo-200\">\r\n                        <CalendarIcon className=\"w-8 h-8 text-white\" />\r\n                    </div>\r\n                    <div>\r\n                        <h1 className=\"text-2xl font-bold text-gray-900 tracking-tight\">AI Timetable Creator</h1>\r\n                        <p className=\"text-gray-500\">Intelligent scheduling optimized for your school.</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                    {/* STEP 1: CLASS SELECTION */}\r\n                    <div className=\"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_25px_-5px_rgba(0,0,0,0.1),0_10px_10px_-5px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50\">\r\n                        <h3 className=\"text-lg font-bold text-gray-800 mb-6 flex items-center gap-3\">\r\n                            <span className=\"bg-indigo-100 text-indigo-700 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\">1</span>\r\n                            Target Class\r\n                        </h3>\r\n\r\n\r\n                        <div className=\"relative\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setShowClassPicker(!showClassPicker)}\r\n                                className={`w-full p-4 text-left border rounded-2xl flex items-center justify-between group transition-all duration-200 ${showClassPicker\r\n                                    ? 'border-indigo-500 ring-4 ring-indigo-500/10 bg-white shadow-md'\r\n                                    : 'border-gray-200 bg-gray-50 hover:bg-white hover:border-gray-300'\r\n                                    }`}\r\n                            >\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <UserGroupIcon className={`w-5 h-5 ${className ? 'text-indigo-600' : 'text-gray-400'}`} />\r\n                                    <span className={className ? 'text-gray-900 font-bold text-base' : 'text-gray-400 font-medium'}>\r\n                                        {isLoadingClasses ? 'Loading classes...' : (className || 'Select a class')}\r\n                                    </span>\r\n                                </div>\r\n                                <ChevronRightIcon className={`w-5 h-5 text-gray-400 transition-transform duration-300 ${showClassPicker ? 'rotate-90 text-indigo-500' : 'group-hover:text-gray-600'}`} />\r\n                            </button>\r\n\r\n                            {/* Class Picker Dropdown */}\r\n                            {showClassPicker && (\r\n                                <div className=\"absolute z-20 mt-2 w-full bg-white border border-gray-100 rounded-2xl shadow-2xl shadow-indigo-900/10 max-h-80 overflow-y-auto animate-slide-in-up origin-top p-2\">\r\n                                    {isLoadingClasses ? (\r\n                                        <div className=\"p-8 text-center text-gray-500\">\r\n                                            <div className=\"animate-spin rounded-full h-6 w-6 border-2 border-indigo-500 border-t-transparent mx-auto mb-2\"></div>\r\n                                            <p className=\"text-xs font-medium\">Loading...</p>\r\n                                        </div>\r\n                                    ) : classes.length === 0 ? (\r\n                                        <div className=\"p-6 text-center text-gray-500\">\r\n                                            <p className=\"font-bold text-gray-800 text-sm\">No classes found</p>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"space-y-1\">\r\n                                            {classes.map((cls) => (\r\n                                                <button\r\n                                                    key={cls.id}\r\n                                                    type=\"button\"\r\n                                                    onClick={() => {\r\n                                                        setClassName(cls.name);\r\n                                                        setShowClassPicker(false);\r\n                                                    }}\r\n                                                    className={`w-full px-4 py-3 text-left rounded-xl transition-all flex items-center justify-between group ${className === cls.name\r\n                                                        ? 'bg-indigo-50 text-indigo-700'\r\n                                                        : 'text-gray-700 hover:bg-gray-50'\r\n                                                        }`}\r\n                                                >\r\n                                                    <div>\r\n                                                        <p className=\"font-bold text-sm tracking-tight\">{cls.name}</p>\r\n                                                        <p className=\"text-[10px] text-gray-400 font-medium uppercase mt-0.5 group-hover:text-gray-500 tracking-wide\">Grade {cls.grade}  Section {cls.section}</p>\r\n                                                    </div>\r\n                                                    {className === cls.name && (\r\n                                                        <CheckCircleIcon className=\"w-5 h-5 text-indigo-600\" />\r\n                                                    )}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Existing Timetable Alert */}\r\n                        {existingTimetableFound && (\r\n                            <div className=\"mt-4 p-4 bg-indigo-50 border border-indigo-100 rounded-2xl flex flex-col sm:flex-row items-center justify-between gap-4 animate-slide-in-up\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-10 h-10 rounded-full bg-white border border-indigo-100 flex items-center justify-center flex-shrink-0\">\r\n                                        <CalendarIcon className=\"w-5 h-5 text-indigo-600\" />\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 className=\"font-bold text-gray-800 text-sm\">Timetable Exists</h4>\r\n                                        <p className=\"text-xs text-gray-500\">A timetable is already saved for this class.</p>\r\n                                    </div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={handleLoadExisting}\r\n                                    disabled={isLoadingExisting}\r\n                                    className=\"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-bold rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center gap-2 whitespace-nowrap w-full sm:w-auto justify-center disabled:opacity-70\"\r\n                                >\r\n                                    {isLoadingExisting ? (\r\n                                        <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n                                    ) : (\r\n                                        <EditIcon className=\"w-4 h-4\" />\r\n                                    )}\r\n                                    Edit Existing\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* STEP 4: CUSTOM RULES */}\r\n                    <div className=\"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] hover:shadow-[0_8px_25px_-5px_rgba(0,0,0,0.1),0_10px_10px_-5px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 flex flex-col\">\r\n                        <h3 className=\"text-lg font-bold text-gray-800 mb-4 flex items-center gap-3\">\r\n                            <span className=\"bg-pink-100 text-pink-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\">4</span>\r\n                            Rules & Constraints\r\n                        </h3>\r\n                        <div className=\"flex-grow flex flex-col\">\r\n                            <p className=\"text-xs text-gray-400 mb-3 ml-1\">Instruct the AI on specific school policies.</p>\r\n                            <textarea\r\n                                value={customRules}\r\n                                onChange={e => setCustomRules(e.target.value)}\r\n                                className=\"flex-grow w-full p-4 text-gray-700 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-pink-500/20 focus:border-pink-500 outline-none transition-all placeholder:text-gray-400 resize-none text-sm leading-relaxed min-h-[140px]\"\r\n                                placeholder=\"e.g. No math after lunch...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    {/* STEP 2: TEACHERS */}\r\n                    <div className=\"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 col-span-1 md:col-span-2\">\r\n                        <div className=\"flex justify-between items-center mb-6\">\r\n                            <h3 className=\"text-lg font-bold text-gray-800 flex items-center gap-3\">\r\n                                <span className=\"bg-emerald-100 text-emerald-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\">2</span>\r\n                                Faculty & Subjects\r\n                            </h3>\r\n                            <span className=\"text-xs font-bold text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100\">{teachers.length} Teachers</span>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4\">\r\n                            {teachers.map((teacher, index) => (\r\n                                <div key={index} className=\"p-4 bg-gray-50/50 border border-gray-200 rounded-2xl space-y-4 relative transition-all hover:bg-white hover:border-emerald-200 hover:shadow-lg hover:shadow-emerald-900/5 group\">\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className=\"w-8 h-8 flex-shrink-0 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold text-sm shadow-sm border border-emerald-200\">\r\n                                            {index + 1}\r\n                                        </div>\r\n                                        <input\r\n                                            type=\"text\"\r\n                                            value={teacher.name}\r\n                                            onChange={e => handleTeacherChange(index, 'name', e.target.value)}\r\n                                            placeholder=\"Teacher Name\"\r\n                                            className=\"flex-1 p-2 bg-transparent text-gray-800 font-bold placeholder:text-gray-400 placeholder:font-normal focus:outline-none border-b-2 border-transparent focus:border-emerald-500 transition-all\"\r\n                                        />\r\n                                        <button\r\n                                            onClick={() => handleRemoveTeacher(index)}\r\n                                            className=\"p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-xl transition-all opacity-0 group-hover:opacity-100\"\r\n                                        >\r\n                                            <TrashIcon className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    <div className=\"pl-14\">\r\n                                        <TagInput\r\n                                            tags={teacher.subjects}\r\n                                            setTags={(newSubjects) => handleTeacherChange(index, 'subjects', newSubjects)}\r\n                                            placeholder=\"Type subject...\"\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n\r\n                            <button\r\n                                onClick={handleAddTeacher}\r\n                                className=\"p-6 border-2 border-dashed border-gray-200 rounded-2xl hover:bg-gray-50 hover:border-emerald-300 hover:text-emerald-600 transition-all flex flex-col items-center justify-center gap-2 text-gray-400 font-bold group min-h-[140px]\"\r\n                            >\r\n                                <div className=\"w-10 h-10 rounded-full bg-gray-100 group-hover:bg-emerald-100 group-hover:text-emerald-600 flex items-center justify-center transition-colors\">\r\n                                    <PlusIcon className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <span>Add Teacher</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* STEP 3: SUBJECT LOAD */}\r\n                    <div className=\"bg-white p-6 rounded-3xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] transition-all duration-300 border border-gray-100/50 col-span-1 md:col-span-2\">\r\n                        <div className=\"mb-6\">\r\n                            <h3 className=\"text-lg font-bold text-gray-800 flex items-center gap-3\">\r\n                                <span className=\"bg-orange-100 text-orange-600 w-8 h-8 rounded-xl flex items-center justify-center text-sm font-bold shadow-sm\">3</span>\r\n                                Subject Distribution\r\n                            </h3>\r\n                            <p className=\"text-xs text-gray-400 mt-1 ml-11\">Sessions per week for each subject.</p>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3\">\r\n                            {subjectPeriods.map((subject, index) => (\r\n                                <div key={index} className=\"flex items-center gap-2 p-2 pr-3 bg-gray-50 rounded-xl border border-gray-100 focus-within:ring-2 focus-within:ring-orange-500/20 focus-within:border-orange-400 transition-all hover:bg-white hover:shadow-sm group\">\r\n                                    <div className=\"w-8 h-8 rounded-lg bg-orange-50 border border-orange-100 text-orange-400 flex flex-shrink-0 items-center justify-center font-bold text-xs\">\r\n                                        {index + 1}\r\n                                    </div>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        value={subject.name}\r\n                                        onChange={e => handleSubjectPeriodChange(index, 'name', e.target.value)}\r\n                                        placeholder=\"Subject\"\r\n                                        className=\"flex-grow w-full bg-transparent font-semibold text-gray-700 outline-none text-sm placeholder:font-normal\"\r\n                                    />\r\n                                    <div className=\"flex items-center gap-1 bg-white rounded-lg border border-gray-200 px-2 py-1 shadow-sm\">\r\n                                        <ClockIcon className=\"w-3 h-3 text-gray-400\" />\r\n                                        <input\r\n                                            type=\"number\"\r\n                                            min=\"1\"\r\n                                            value={subject.periods}\r\n                                            onChange={e => handleSubjectPeriodChange(index, 'periods', parseInt(e.target.value, 10) || 1)}\r\n                                            className=\"w-6 text-center font-bold text-gray-800 outline-none bg-transparent text-sm\"\r\n                                        />\r\n                                    </div>\r\n                                    <button onClick={() => handleRemoveSubjectPeriod(index)} className=\"p-1.5 text-gray-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors\"><TrashIcon className=\"w-3.5 h-3.5\" /></button>\r\n                                </div>\r\n                            ))}\r\n                            <button\r\n                                onClick={handleAddSubjectPeriod}\r\n                                className=\"h-full min-h-[50px] border-2 border-dashed border-gray-200 text-gray-400 font-bold rounded-xl hover:bg-orange-50 hover:border-orange-300 hover:text-orange-600 transition-all flex items-center justify-center gap-2 text-sm\"\r\n                            >\r\n                                <PlusIcon className=\"w-4 h-4\" />\r\n                                <span>Add Subject</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n            </main>\r\n\r\n            <footer className=\"p-4 bg-white/80 backdrop-blur-xl border-t border-gray-200 sticky bottom-0 z-30\">\r\n                <div className=\"max-w-4xl mx-auto\">\r\n                    <button\r\n                        type=\"button\"\r\n                        onClick={handleGenerate}\r\n                        disabled={isGenerating}\r\n                        className=\"w-full flex justify-center items-center space-x-3 py-4 px-6 font-bold text-lg text-white bg-gradient-to-r from-indigo-600 via-purple-600 to-indigo-700 hover:from-indigo-500 hover:via-purple-500 hover:to-indigo-600 active:scale-[0.99] disabled:opacity-70 disabled:grayscale rounded-2xl shadow-xl shadow-indigo-500/20 hover:shadow-indigo-500/30 transition-all duration-300 border border-white/20\"\r\n                    >\r\n                        <SparklesIcon className={`w-6 h-6 ${isGenerating ? 'animate-spin' : 'animate-pulse'}`} />\r\n                        <span>{isGenerating ? 'Generating Magic...' : 'Generate Optimized Timetable'}</span>\r\n                    </button>\r\n                </div>\r\n            </footer>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Simple icon wrapper if needed for specific icons not in constants\r\nconst CheckCircleIcon = ({ className }: { className?: string }) => (\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={2} stroke=\"currentColor\" className={className}>\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n    </svg>\r\n);\r\n\r\nexport default TimetableGeneratorScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}