{"ast":null,"code":"import { supabase } from './supabase';\nexport async function fetchStudents() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('students').select('*').order('grade', {\n      ascending: false\n    });\n    if (error) throw error;\n    return (data || []).map(s => ({\n      id: s.id,\n      name: s.name,\n      email: s.email || '',\n      avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\n      grade: s.grade,\n      section: s.section,\n      department: s.department,\n      attendanceStatus: s.attendance_status || 'Absent',\n      birthday: s.birthday\n    }));\n  } catch (err) {\n    console.error('Error fetching students:', err);\n    return [];\n  }\n}\nexport async function fetchStudentById(id) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('students').select('*').eq('id', id).single();\n    if (error) throw error;\n    if (!data) return null;\n    return {\n      id: data.id,\n      name: data.name,\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\n      grade: data.grade,\n      section: data.section,\n      department: data.department,\n      attendanceStatus: data.attendance_status || 'Absent',\n      birthday: data.birthday,\n      email: data.email || ''\n    };\n  } catch (err) {\n    console.error('Error fetching student:', err);\n    return null;\n  }\n}\nexport async function fetchStudentByEmail(email) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('students').select('*').eq('email', email).single();\n    if (error) throw error;\n    if (!data) return null;\n    return {\n      id: data.id,\n      name: data.name,\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\n      grade: data.grade,\n      section: data.section,\n      department: data.department,\n      attendanceStatus: data.attendance_status || 'Absent',\n      birthday: data.birthday,\n      email: data.email || ''\n    };\n  } catch (err) {\n    console.error('Error fetching student by email:', err);\n    return null;\n  }\n}\nexport async function fetchStudentsByClass(grade, section) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('students').select('*').eq('grade', grade).eq('section', section).order('name', {\n      ascending: true\n    });\n    if (error) throw error;\n    return (data || []).map(s => ({\n      id: s.id,\n      name: s.name,\n      email: s.email || '',\n      avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\n      grade: s.grade,\n      section: s.section,\n      department: s.department,\n      attendanceStatus: s.attendance_status || 'Absent',\n      birthday: s.birthday\n    }));\n  } catch (err) {\n    console.error(`Error fetching students for Grade ${grade} - ${section}:`, err);\n    return [];\n  }\n}\nexport async function fetchClassSubjects(grade, section) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('classes').select('subject').eq('grade', grade).eq('section', section);\n    if (error) throw error;\n    return Array.from(new Set((data || []).map(c => c.subject)));\n  } catch (err) {\n    console.error('Error fetching student subjects:', err);\n    return [];\n  }\n}\nexport async function createStudent(studentData) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('students').insert({\n      user_id: studentData.userId,\n      name: studentData.name,\n      email: studentData.email,\n      grade: studentData.grade,\n      section: studentData.section,\n      department: studentData.department,\n      birthday: studentData.birthday,\n      avatar_url: studentData.avatarUrl,\n      attendance_status: 'Absent',\n      created_at: new Date().toISOString()\n    }).select().single();\n    if (error) throw error;\n    return {\n      id: data.id,\n      name: data.name,\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\n      grade: data.grade,\n      section: data.section,\n      department: data.department,\n      attendanceStatus: data.attendance_status || 'Absent',\n      birthday: data.birthday,\n      email: data.email || ''\n    };\n  } catch (err) {\n    console.error('Error creating student:', err);\n    return null;\n  }\n}\nexport async function updateStudent(id, updates) {\n  try {\n    const dbUpdates = {};\n    if (updates.name !== undefined) dbUpdates.name = updates.name;\n    if (updates.email !== undefined) dbUpdates.email = updates.email;\n    if (updates.grade !== undefined) dbUpdates.grade = updates.grade;\n    if (updates.section !== undefined) dbUpdates.section = updates.section;\n    if (updates.department !== undefined) dbUpdates.department = updates.department;\n    if (updates.birthday !== undefined) dbUpdates.birthday = updates.birthday;\n    if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\n    if (updates.attendanceStatus !== undefined) dbUpdates.attendance_status = updates.attendanceStatus;\n    const {\n      error\n    } = await supabase.from('students').update(dbUpdates).eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error updating student:', err);\n    return false;\n  }\n}\nexport async function deleteStudent(id) {\n  try {\n    const {\n      error\n    } = await supabase.from('students').delete().eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error deleting student:', err);\n    return false;\n  }\n}\nexport async function fetchTeachers() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('teachers').select(`\n        *,\n        teacher_subjects(subject),\n        teacher_classes(class_name)\n      `);\n    if (error) throw error;\n    return (data || []).map(t => ({\n      id: t.id,\n      name: t.name,\n      avatarUrl: t.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\n      email: t.email,\n      phone: t.phone || '',\n      status: t.status || 'Active',\n      subjects: (t.teacher_subjects || []).map(s => s.subject),\n      classes: (t.teacher_classes || []).map(c => c.class_name)\n    }));\n  } catch (err) {\n    console.error('Error fetching teachers:', err);\n    return [];\n  }\n}\nexport async function fetchTeacherById(id) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('teachers').select(`\n        *,\n        teacher_subjects(subject),\n        teacher_classes(class_name)\n      `).eq('id', id).single();\n    if (error) throw error;\n    if (!data) return null;\n    return {\n      id: data.id,\n      name: data.name,\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\n      email: data.email,\n      phone: data.phone || '',\n      status: data.status || 'Active',\n      subjects: (data.teacher_subjects || []).map(s => s.subject),\n      classes: (data.teacher_classes || []).map(c => c.class_name)\n    };\n  } catch (err) {\n    console.error('Error fetching teacher:', err);\n    return null;\n  }\n}\nexport async function createTeacher(teacherData) {\n  try {\n    const {\n      data: teacher,\n      error: teacherError\n    } = await supabase.from('teachers').insert({\n      name: teacherData.name,\n      email: teacherData.email,\n      phone: teacherData.phone,\n      avatar_url: teacherData.avatarUrl,\n      status: 'Active',\n      created_at: new Date().toISOString()\n    }).select().single();\n    if (teacherError) throw teacherError;\n    if (teacherData.subjects && teacherData.subjects.length > 0) {\n      const subjectInserts = teacherData.subjects.map(subject => ({\n        teacher_id: teacher.id,\n        subject\n      }));\n      await supabase.from('teacher_subjects').insert(subjectInserts);\n    }\n    if (teacherData.classes && teacherData.classes.length > 0) {\n      const classInserts = teacherData.classes.map(className => ({\n        teacher_id: teacher.id,\n        class_name: className\n      }));\n      await supabase.from('teacher_classes').insert(classInserts);\n    }\n    return {\n      id: teacher.id,\n      name: teacher.name,\n      avatarUrl: teacher.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\n      email: teacher.email,\n      phone: teacher.phone || '',\n      status: teacher.status || 'Active',\n      subjects: teacherData.subjects || [],\n      classes: teacherData.classes || []\n    };\n  } catch (err) {\n    console.error('Error creating teacher:', err);\n    return null;\n  }\n}\nexport async function updateTeacher(id, updates) {\n  try {\n    const dbUpdates = {};\n    if (updates.name !== undefined) dbUpdates.name = updates.name;\n    if (updates.email !== undefined) dbUpdates.email = updates.email;\n    if (updates.phone !== undefined) dbUpdates.phone = updates.phone;\n    if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\n    if (updates.status !== undefined) dbUpdates.status = updates.status;\n    if (Object.keys(dbUpdates).length > 0) {\n      const {\n        error\n      } = await supabase.from('teachers').update(dbUpdates).eq('id', id);\n      if (error) throw error;\n    }\n    if (updates.subjects !== undefined) {\n      await supabase.from('teacher_subjects').delete().eq('teacher_id', id);\n      if (updates.subjects.length > 0) {\n        const subjectInserts = updates.subjects.map(subject => ({\n          teacher_id: id,\n          subject\n        }));\n        await supabase.from('teacher_subjects').insert(subjectInserts);\n      }\n    }\n    if (updates.classes !== undefined) {\n      await supabase.from('teacher_classes').delete().eq('teacher_id', id);\n      if (updates.classes.length > 0) {\n        const classInserts = updates.classes.map(className => ({\n          teacher_id: id,\n          class_name: className\n        }));\n        await supabase.from('teacher_classes').insert(classInserts);\n      }\n    }\n    return true;\n  } catch (err) {\n    console.error('Error updating teacher:', err);\n    return false;\n  }\n}\nexport async function deleteTeacher(id) {\n  try {\n    await supabase.from('teacher_subjects').delete().eq('teacher_id', id);\n    await supabase.from('teacher_classes').delete().eq('teacher_id', id);\n    const {\n      error\n    } = await supabase.from('teachers').delete().eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error deleting teacher:', err);\n    return false;\n  }\n}\nexport async function fetchParents() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('parents').select(`\n        *,\n        parent_children(student_id)\n      `);\n    if (error) throw error;\n    return (data || []).map(p => ({\n      id: p.id,\n      name: p.name,\n      email: p.email,\n      phone: p.phone || '',\n      avatarUrl: p.avatar_url || 'https://i.pravatar.cc/150?u=parent',\n      childIds: (p.parent_children || []).map(c => c.student_id)\n    }));\n  } catch (err) {\n    console.error('Error fetching parents:', err);\n    return [];\n  }\n}\nexport async function fetchParentByEmail(email) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('parents').select(`\n        *,\n        parent_children(student_id)\n      `).eq('email', email).single();\n    if (error) throw error;\n    if (!data) return null;\n    return {\n      id: data.id,\n      name: data.name,\n      email: data.email,\n      phone: data.phone || '',\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\n      childIds: (data.parent_children || []).map(c => c.student_id)\n    };\n  } catch (err) {\n    console.error('Error fetching parent by email:', err);\n    return null;\n  }\n}\nexport async function fetchParentByUserId(userId) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('parents').select(`\n        *,\n        parent_children(student_id)\n      `).eq('user_id', userId).single();\n    if (error) throw error;\n    if (!data) return null;\n    return {\n      id: data.id,\n      name: data.name,\n      email: data.email,\n      phone: data.phone || '',\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\n      childIds: (data.parent_children || []).map(c => c.student_id)\n    };\n  } catch (err) {\n    console.error('Error fetching parent by user id:', err);\n    return null;\n  }\n}\nexport async function fetchChildrenForParent(parentId) {\n  try {\n    const {\n      data: relations,\n      error: relError\n    } = await supabase.from('parent_children').select('student_id').eq('parent_id', parentId);\n    if (relError) throw relError;\n    if (!relations || relations.length === 0) return [];\n    const studentIds = relations.map(r => r.student_id);\n    const {\n      data: students,\n      error: stuError\n    } = await supabase.from('students').select('*').in('id', studentIds);\n    if (stuError) throw stuError;\n    return (students || []).map(s => ({\n      id: s.id,\n      name: s.name,\n      email: s.email || '',\n      avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\n      grade: s.grade,\n      section: s.section,\n      department: s.department,\n      attendanceStatus: s.attendance_status || 'Absent',\n      birthday: s.birthday\n    }));\n  } catch (err) {\n    console.error('Error fetching children for parent:', err);\n    return [];\n  }\n}\nexport async function fetchParentsForStudent(studentId) {\n  try {\n    const {\n      data: relations,\n      error: relError\n    } = await supabase.from('parent_children').select('parent_id').eq('student_id', studentId);\n    if (relError) throw relError;\n    if (!relations || relations.length === 0) return [];\n    const parentIds = relations.map(r => r.parent_id);\n    const {\n      data: parents,\n      error: parError\n    } = await supabase.from('parents').select('*').in('id', parentIds);\n    if (parError) throw parError;\n    return (parents || []).map(p => ({\n      id: p.id,\n      name: p.name,\n      email: p.email,\n      phone: p.phone || '',\n      avatarUrl: p.avatar_url || 'https://i.pravatar.cc/150?u=parent',\n      childIds: []\n    }));\n  } catch (err) {\n    console.error('Error fetching parents for student:', err);\n    return [];\n  }\n}\nexport async function createParent(parentData) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('parents').insert({\n      name: parentData.name,\n      email: parentData.email,\n      phone: parentData.phone,\n      avatar_url: parentData.avatarUrl,\n      created_at: new Date().toISOString()\n    }).select().single();\n    if (error) throw error;\n    if (parentData.childIds && parentData.childIds.length > 0) {\n      const linkInserts = parentData.childIds.map(studentId => ({\n        parent_id: data.id,\n        student_id: studentId\n      }));\n      await supabase.from('parent_children').insert(linkInserts);\n    }\n    return {\n      id: data.id,\n      name: data.name,\n      email: data.email,\n      phone: data.phone || '',\n      avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\n      childIds: parentData.childIds || []\n    };\n  } catch (err) {\n    console.error('Error creating parent:', err);\n    return null;\n  }\n}\nexport async function updateParent(id, updates) {\n  try {\n    const dbUpdates = {};\n    if (updates.name !== undefined) dbUpdates.name = updates.name;\n    if (updates.email !== undefined) dbUpdates.email = updates.email;\n    if (updates.phone !== undefined) dbUpdates.phone = updates.phone;\n    if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\n    if (Object.keys(dbUpdates).length > 0) {\n      const {\n        error\n      } = await supabase.from('parents').update(dbUpdates).eq('id', id);\n      if (error) throw error;\n    }\n    if (updates.childIds !== undefined) {\n      await supabase.from('parent_children').delete().eq('parent_id', id);\n      if (updates.childIds.length > 0) {\n        const linkInserts = updates.childIds.map(studentId => ({\n          parent_id: id,\n          student_id: studentId\n        }));\n        await supabase.from('parent_children').insert(linkInserts);\n      }\n    }\n    return true;\n  } catch (err) {\n    console.error('Error updating parent:', err);\n    return false;\n  }\n}\nexport async function deleteParent(id) {\n  try {\n    await supabase.from('parent_children').delete().eq('parent_id', id);\n    const {\n      error\n    } = await supabase.from('parents').delete().eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error deleting parent:', err);\n    return false;\n  }\n}\nexport async function fetchNotices() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('notices').select('*').order('timestamp', {\n      ascending: false\n    });\n    if (error) throw error;\n    return (data || []).map(n => ({\n      id: n.id,\n      title: n.title,\n      content: n.content,\n      timestamp: n.timestamp,\n      category: n.category,\n      isPinned: n.is_pinned || false,\n      audience: n.audience || ['all']\n    }));\n  } catch (err) {\n    console.error('Error fetching notices:', err);\n    return [];\n  }\n}\nexport async function createNotice(noticeData) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('notices').insert({\n      title: noticeData.title,\n      content: noticeData.content,\n      category: noticeData.category,\n      is_pinned: noticeData.isPinned || false,\n      audience: noticeData.audience || ['all'],\n      timestamp: new Date().toISOString()\n    }).select().single();\n    if (error) throw error;\n    return {\n      id: data.id,\n      title: data.title,\n      content: data.content,\n      timestamp: data.timestamp,\n      category: data.category,\n      isPinned: data.is_pinned || false,\n      audience: data.audience || ['all']\n    };\n  } catch (err) {\n    console.error('Error creating notice:', err);\n    return null;\n  }\n}\nexport async function updateNotice(id, updates) {\n  try {\n    const dbUpdates = {};\n    if (updates.title !== undefined) dbUpdates.title = updates.title;\n    if (updates.content !== undefined) dbUpdates.content = updates.content;\n    if (updates.category !== undefined) dbUpdates.category = updates.category;\n    if (updates.isPinned !== undefined) dbUpdates.is_pinned = updates.isPinned;\n    if (updates.audience !== undefined) dbUpdates.audience = updates.audience;\n    const {\n      error\n    } = await supabase.from('notices').update(dbUpdates).eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error updating notice:', err);\n    return false;\n  }\n}\nexport async function deleteNotice(id) {\n  try {\n    const {\n      error\n    } = await supabase.from('notices').delete().eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error deleting notice:', err);\n    return false;\n  }\n}\nexport async function fetchClasses() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('classes').select('*').order('grade', {\n      ascending: false\n    });\n    if (error) throw error;\n    return (data || []).map(c => ({\n      id: c.id,\n      subject: c.subject,\n      grade: c.grade,\n      section: c.section,\n      department: c.department,\n      studentCount: c.student_count || 0\n    }));\n  } catch (err) {\n    console.error('Error fetching classes:', err);\n    return [];\n  }\n}\nexport async function fetchAssignments() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('assignments').select('*').order('due_date', {\n      ascending: true\n    });\n    if (error) throw error;\n    return (data || []).map(a => ({\n      id: a.id,\n      title: a.title,\n      description: a.description,\n      className: a.class_name,\n      subject: a.subject,\n      dueDate: a.due_date,\n      totalStudents: a.total_students || 0,\n      submissionsCount: a.submissions_count || 0\n    }));\n  } catch (err) {\n    console.error('Error fetching assignments:', err);\n    return [];\n  }\n}\nexport async function createAssignment(assignmentData) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('assignments').insert({\n      title: assignmentData.title,\n      description: assignmentData.description,\n      class_name: assignmentData.className,\n      subject: assignmentData.subject,\n      due_date: assignmentData.dueDate,\n      created_at: new Date().toISOString()\n    }).select().single();\n    if (error) throw error;\n    return {\n      id: data.id,\n      title: data.title,\n      description: data.description,\n      className: data.class_name,\n      subject: data.subject,\n      dueDate: data.due_date,\n      totalStudents: data.total_students || 0,\n      submissionsCount: data.submissions_count || 0\n    };\n  } catch (err) {\n    console.error('Error creating assignment:', err);\n    return null;\n  }\n}\nexport async function updateAssignment(id, updates) {\n  try {\n    const dbUpdates = {};\n    if (updates.title !== undefined) dbUpdates.title = updates.title;\n    if (updates.description !== undefined) dbUpdates.description = updates.description;\n    if (updates.className !== undefined) dbUpdates.class_name = updates.className;\n    if (updates.subject !== undefined) dbUpdates.subject = updates.subject;\n    if (updates.dueDate !== undefined) dbUpdates.due_date = updates.dueDate;\n    const {\n      error\n    } = await supabase.from('assignments').update(dbUpdates).eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error updating assignment:', err);\n    return false;\n  }\n}\nexport async function deleteAssignment(id) {\n  try {\n    const {\n      error\n    } = await supabase.from('assignments').delete().eq('id', id);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error deleting assignment:', err);\n    return false;\n  }\n}\nexport async function fetchExams() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('exams').select('*').order('date', {\n      ascending: true\n    });\n    if (error) throw error;\n    return (data || []).map(e => ({\n      id: e.id,\n      type: e.type,\n      date: e.date,\n      time: e.time,\n      className: e.class_name,\n      subject: e.subject,\n      isPublished: e.is_published || false,\n      teacherId: e.teacher_id\n    }));\n  } catch (err) {\n    console.error('Error fetching exams:', err);\n    return [];\n  }\n}\nexport async function fetchStudentFees(studentId) {\n  try {\n    let query = supabase.from('student_fees').select('*');\n    if (studentId) {\n      query = query.eq('student_id', studentId);\n    }\n    const {\n      data,\n      error\n    } = await query.order('due_date', {\n      ascending: true\n    });\n    if (error) throw error;\n    return (data || []).map(f => ({\n      id: f.id,\n      studentId: f.student_id,\n      totalFee: f.total_fee,\n      paidAmount: f.paid_amount,\n      status: f.status,\n      dueDate: f.due_date,\n      title: f.title,\n      term: f.term\n    }));\n  } catch (err) {\n    console.error('Error fetching student fees:', err);\n    return [];\n  }\n}\nexport async function createFeeRecord(feeData) {\n  try {\n    const {\n      error\n    } = await supabase.from('student_fees').insert({\n      student_id: feeData.studentId,\n      total_fee: feeData.amount,\n      title: feeData.title,\n      due_date: feeData.dueDate,\n      term: feeData.term || 'Term 1',\n      status: feeData.status || 'Unpaid'\n    });\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error creating fee record:', err);\n    return false;\n  }\n}\nexport async function updateFeeStatus(feeId, status, amountPaid) {\n  try {\n    const updates = {\n      status\n    };\n    if (amountPaid !== undefined) {\n      updates.paid_amount = amountPaid;\n      updates.payment_date = new Date().toISOString();\n    }\n    const {\n      error\n    } = await supabase.from('student_fees').update(updates).eq('id', feeId);\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error updating fee status:', err);\n    return false;\n  }\n}\nexport async function saveAttendanceRecords(records) {\n  try {\n    const inserts = records.map(r => ({\n      student_id: r.studentId,\n      date: r.date,\n      status: r.status,\n      class_name: r.className\n    }));\n    const {\n      error\n    } = await supabase.from('student_attendance').upsert(inserts, {\n      onConflict: 'student_id,date',\n      ignoreDuplicates: false\n    });\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error saving attendance records:', err);\n    return false;\n  }\n}\nexport async function fetchAttendanceForClass(className, date) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('student_attendance').select('*').eq('class_name', className).eq('date', date);\n    if (error) throw error;\n    return data || [];\n  } catch (err) {\n    console.error('Error fetching attendance:', err);\n    return [];\n  }\n}\nexport async function checkSupabaseConnection() {\n  try {\n    const {\n      error\n    } = await supabase.from('students').select('id').limit(1);\n    if (error) {\n      console.error('Supabase connection check failed:', error.message);\n      return false;\n    }\n    console.log('âœ… Supabase connected successfully');\n    return true;\n  } catch (err) {\n    console.error('Supabase connection exception:', err);\n    return false;\n  }\n}\nexport async function fetchTimetableForClass(className) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('timetable').select('*').eq('class_name', className);\n    if (error) throw error;\n    return data || [];\n  } catch (err) {\n    console.error('Error fetching timetable:', err);\n    return [];\n  }\n}\nexport async function checkTimetableExists(className) {\n  try {\n    const {\n      count,\n      error\n    } = await supabase.from('timetable').select('*', {\n      count: 'exact',\n      head: true\n    }).eq('class_name', className);\n    if (error) throw error;\n    return (count || 0) > 0;\n  } catch (err) {\n    return false;\n  }\n}\nexport async function createNotification(params) {\n  try {\n    const {\n      error\n    } = await supabase.from('notifications').insert({\n      user_id: params.userId,\n      category: params.category,\n      title: params.title,\n      summary: params.summary,\n      student_id: params.studentId,\n      related_id: params.relatedId,\n      is_read: false,\n      timestamp: new Date().toISOString()\n    });\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error creating notification:', err);\n    return false;\n  }\n}\nexport async function notifyClass(className, title, summary) {\n  const gradeMatch = className.match(/Grade\\s+(\\d+)([A-Za-z0-9]+)/);\n  if (gradeMatch) {\n    const grade = parseInt(gradeMatch[1]);\n    const section = gradeMatch[2];\n    const students = await fetchStudentsByClass(grade, section);\n    for (const student of students) {\n      await createNotification({\n        studentId: student.id,\n        category: 'Timetable',\n        title,\n        summary\n      });\n    }\n  }\n}\nexport async function fetchTeachersByClass(className) {\n  return fetchTeachers();\n}\nexport function createDataRefreshCallback(callback) {\n  return callback;\n}\nexport async function fetchAnalyticsMetrics() {\n  try {\n    const stats = {\n      performance: [],\n      fees: {\n        paid: 0,\n        overdue: 0,\n        unpaid: 0,\n        total: 0\n      },\n      workload: [],\n      attendance: [],\n      enrollment: []\n    };\n    const {\n      data: scores\n    } = await supabase.from('academic_performance').select('score');\n    if (scores && scores.length > 0) {\n      let excellent = 0,\n        good = 0,\n        average = 0,\n        poor = 0;\n      scores.forEach(s => {\n        if (s.score >= 90) excellent++;else if (s.score >= 70) good++;else if (s.score >= 50) average++;else poor++;\n      });\n      const total = scores.length;\n      stats.performance = [{\n        label: 'Excellent',\n        value: Math.round(excellent / total * 100),\n        a11yLabel: `${Math.round(excellent / total * 100)}% Excellent`\n      }, {\n        label: 'Good',\n        value: Math.round(good / total * 100),\n        a11yLabel: `${Math.round(good / total * 100)}% Good`\n      }, {\n        label: 'Average',\n        value: Math.round(average / total * 100),\n        a11yLabel: `${Math.round(average / total * 100)}% Average`\n      }, {\n        label: 'Poor',\n        value: Math.round(poor / total * 100),\n        a11yLabel: `${Math.round(poor / total * 100)}% Poor`\n      }];\n    } else {\n      stats.performance = [{\n        label: 'Excellent',\n        value: 25,\n        a11yLabel: '25% Excellent'\n      }, {\n        label: 'Good',\n        value: 45,\n        a11yLabel: '45% Good'\n      }, {\n        label: 'Average',\n        value: 20,\n        a11yLabel: '20% Average'\n      }, {\n        label: 'Poor',\n        value: 10,\n        a11yLabel: '10% Poor'\n      }];\n    }\n    const {\n      data: fees\n    } = await supabase.from('student_fees').select('status');\n    if (fees && fees.length > 0) {\n      let paid = 0,\n        overdue = 0,\n        unpaid = 0;\n      fees.forEach(f => {\n        const s = f.status.toLowerCase();\n        if (s === 'paid') paid++;else if (s === 'overdue') overdue++;else unpaid++;\n      });\n      stats.fees = {\n        paid: Math.round(paid / fees.length * 100),\n        overdue: Math.round(overdue / fees.length * 100),\n        unpaid: Math.round(unpaid / fees.length * 100),\n        total: fees.length\n      };\n    } else {\n      stats.fees = {\n        paid: 75,\n        overdue: 15,\n        unpaid: 10,\n        total: 100\n      };\n    }\n    const {\n      data: timetable\n    } = await supabase.from('timetable').select('teacher');\n    if (timetable && timetable.length > 0) {\n      const counts = {};\n      timetable.forEach(t => {\n        if (t.teacher) counts[t.teacher] = (counts[t.teacher] || 0) + 1;\n      });\n      stats.workload = Object.entries(counts).map(([label, value]) => ({\n        label: label.split(' ').pop() || label,\n        value\n      })).sort((a, b) => b.value - a.value).slice(0, 5);\n    } else {\n      stats.workload = [{\n        label: 'Mr. A',\n        value: 12\n      }, {\n        label: 'Ms. B',\n        value: 10\n      }, {\n        label: 'Mr. C',\n        value: 15\n      }, {\n        label: 'Ms. D',\n        value: 8\n      }, {\n        label: 'Mr. E',\n        value: 11\n      }];\n    }\n    const {\n      data: studentsData\n    } = await supabase.from('students').select('created_at');\n    if (studentsData) {\n      const yearCounts = {};\n      studentsData.forEach(s => {\n        const year = new Date(s.created_at).getFullYear();\n        yearCounts[year] = (yearCounts[year] || 0) + 1;\n      });\n      stats.enrollment = Object.entries(yearCounts).map(([year, count]) => ({\n        year: parseInt(year),\n        count\n      })).sort((a, b) => a.year - b.year).slice(-5);\n    }\n    const d = new Date();\n    d.setDate(d.getDate() - 7);\n    const {\n      data: attendance\n    } = await supabase.from('student_attendance').select('date, status').gte('date', d.toISOString().split('T')[0]);\n    if (attendance && attendance.length > 0) {\n      const dailyStats = {};\n      attendance.forEach(r => {\n        if (!dailyStats[r.date]) dailyStats[r.date] = {\n          total: 0,\n          present: 0\n        };\n        dailyStats[r.date].total++;\n        if (r.status === 'Present') dailyStats[r.date].present++;\n      });\n      const sortedKeys = Object.keys(dailyStats).sort();\n      stats.attendance = sortedKeys.map(k => Math.round(dailyStats[k].present / dailyStats[k].total * 100));\n    } else {\n      stats.attendance = [88, 92, 90, 95, 94, 96, 95];\n    }\n    return stats;\n  } catch (err) {\n    console.error(\"Error fetching analytics metrics:\", err);\n    return null;\n  }\n}\nexport async function fetchStudentAssignments(studentId, grade, section) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('assignments').select('*').order('due_date', {\n      ascending: true\n    });\n    if (error) throw error;\n    return (data || []).map(a => ({\n      id: a.id,\n      title: a.title,\n      subject: a.subject,\n      teacher: 'Unknown',\n      dueDate: a.due_date,\n      status: 'Pending',\n      grade: a.grade || 0,\n      description: a.description,\n      className: a.class_name || 'General',\n      totalStudents: a.total_students || 0,\n      submissionsCount: a.submissions_count || 0\n    }));\n  } catch (err) {\n    console.error('Error fetching student assignments:', err);\n    return [];\n  }\n}\nexport async function fetchStudentAttendanceStats(studentId) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('student_attendance').select('status').eq('student_id', studentId);\n    if (error) throw error;\n    if (!data || data.length === 0) return {\n      percentage: 100\n    };\n    const presentOrLate = data.filter(r => ['Present', 'Late'].includes(r.status)).length;\n    const percentage = Math.round(presentOrLate / data.length * 100);\n    return {\n      percentage\n    };\n  } catch (err) {\n    console.error('Error fetching attendance stats:', err);\n    return {\n      percentage: 0\n    };\n  }\n}\nexport async function fetchStudentFeeSummary(studentId) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('student_fees').select('*').eq('student_id', studentId);\n    if (error) throw error;\n    if (!data || data.length === 0) return null;\n    const totalFee = data.reduce((sum, r) => sum + (Number(r.total_fee) || 0), 0);\n    const paidAmount = data.reduce((sum, r) => sum + (Number(r.paid_amount) || 0), 0);\n    const latestDue = data.sort((a, b) => new Date(b.due_date).getTime() - new Date(a.due_date).getTime())[0]?.due_date;\n    const status = paidAmount >= totalFee ? 'Paid' : 'Overdue';\n    return {\n      totalFee,\n      paidAmount,\n      status,\n      dueDate: latestDue\n    };\n  } catch (err) {\n    console.error('Error fetching student fee summary:', err);\n    return null;\n  }\n}\nexport async function fetchCurricula() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('curricula').select('*').order('name');\n    if (error) throw error;\n    return data || [];\n  } catch (err) {\n    console.error('Error fetching curricula:', err);\n    return [];\n  }\n}\nexport async function fetchSubjects(curriculumId, gradeLevel) {\n  try {\n    let query = supabase.from('subjects').select('id, name, code, category, curriculum_id, grade_level, school_id').order('name');\n    if (curriculumId) {\n      query = query.eq('curriculum_id', curriculumId);\n    }\n    if (gradeLevel) {\n      query = query.eq('grade_level', gradeLevel);\n    }\n    const {\n      data,\n      error\n    } = await query;\n    if (error) throw error;\n    return (data || []).map(s => ({\n      id: s.id,\n      name: s.name,\n      code: s.code,\n      category: s.category,\n      curriculumId: s.curriculum_id,\n      gradeLevel: s.grade_level,\n      schoolId: s.school_id\n    }));\n  } catch (err) {\n    console.error('Error fetching subjects:', err);\n    return [];\n  }\n}\nexport async function fetchLessonNotes(teacherId, subjectId) {\n  try {\n    let query = supabase.from('lesson_notes').select('*').order('created_at', {\n      ascending: false\n    });\n    if (teacherId) query = query.eq('teacher_id', teacherId);\n    if (subjectId) query = query.eq('subject_id', subjectId);\n    const {\n      data,\n      error\n    } = await query;\n    if (error) throw error;\n    return (data || []).map(note => ({\n      id: note.id,\n      teacherId: note.teacher_id,\n      subjectId: note.subject_id,\n      classId: note.class_id,\n      week: note.week,\n      term: note.term,\n      title: note.title,\n      content: note.content,\n      fileUrl: note.file_url,\n      status: note.status,\n      adminFeedback: note.admin_feedback,\n      createdAt: note.created_at\n    }));\n  } catch (err) {\n    console.error('Error fetching lesson notes:', err);\n    return [];\n  }\n}\nexport async function createLessonNote(noteData) {\n  try {\n    const {\n      error\n    } = await supabase.from('lesson_notes').insert({\n      teacher_id: noteData.teacherId,\n      subject_id: noteData.subjectId,\n      class_id: noteData.classId,\n      week: noteData.week,\n      term: noteData.term,\n      title: noteData.title,\n      content: noteData.content,\n      file_url: noteData.fileUrl,\n      status: 'Pending'\n    });\n    if (error) throw error;\n    return true;\n  } catch (err) {\n    console.error('Error creating lesson note:', err);\n    return false;\n  }\n}\nexport async function fetchCBTExams(teacherId, isPublished) {\n  try {\n    let query = supabase.from('cbt_exams').select('*').order('created_at', {\n      ascending: false\n    });\n    if (teacherId) query = query.eq('teacher_id', teacherId);\n    if (isPublished !== undefined) query = query.eq('is_published', isPublished);\n    const {\n      data,\n      error\n    } = await query;\n    if (error) throw error;\n    return (data || []).map(exam => ({\n      id: exam.id,\n      title: exam.title,\n      subjectId: exam.subject_id,\n      classGrade: exam.class_grade,\n      curriculumId: exam.curriculum_id,\n      durationMinutes: exam.duration_minutes,\n      totalQuestions: exam.total_questions,\n      isPublished: exam.is_published,\n      teacherId: exam.teacher_id,\n      createdAt: exam.created_at\n    }));\n  } catch (err) {\n    console.error('Error fetching CBT exams:', err);\n    return [];\n  }\n}\nexport async function fetchCBTQuestions(examId) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('cbt_questions').select('*').eq('exam_id', examId).order('id');\n    if (error) throw error;\n    return (data || []).map(q => ({\n      id: q.id,\n      examId: q.exam_id,\n      questionText: q.question_text,\n      questionType: q.question_type,\n      options: q.options,\n      correctOption: q.correct_option,\n      points: q.points\n    }));\n  } catch (err) {\n    console.error('Error fetching CBT questions:', err);\n    return [];\n  }\n}\nexport async function fetchSchools() {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('schools').select('id, name').order('name');\n    if (error) throw error;\n    return data || [];\n  } catch (err) {\n    console.error('Error fetching schools:', err);\n    return [];\n  }\n}\nexport async function fetchStudentSubjects(studentId) {\n  try {\n    const {\n      data: student,\n      error: sErr\n    } = await supabase.from('students').select('grade, section').eq('id', studentId).single();\n    if (sErr || !student) return [];\n    const {\n      data: classes,\n      error: cErr\n    } = await supabase.from('classes').select('subject').eq('grade', student.grade).eq('section', student.section);\n    if (cErr) return [];\n    return classes.map(c => ({\n      name: c.subject\n    }));\n  } catch (e) {\n    return [];\n  }\n}\nexport async function fetchReportCard(studentId, term, session) {\n  try {\n    const {\n      data,\n      error\n    } = await supabase.from('report_cards').select(`\n                *,\n                report_card_records(*)\n            `).eq('student_id', studentId).eq('term', term).eq('session', session).single();\n    if (error) {\n      if (error.code === 'PGRST116') return null;\n      throw error;\n    }\n    if (!data) return null;\n    return {\n      term: data.term,\n      session: data.session,\n      status: data.status,\n      attendance: data.attendance || {\n        total: 0,\n        present: 0,\n        absent: 0,\n        late: 0\n      },\n      skills: data.skills || {},\n      psychomotor: data.psychomotor || {},\n      teacherComment: data.teacher_comment || '',\n      principalComment: data.principal_comment || '',\n      academicRecords: (data.report_card_records || []).map(r => ({\n        subject: r.subject,\n        ca: r.ca,\n        exam: r.exam,\n        total: r.total,\n        grade: r.grade,\n        remark: r.remark\n      }))\n    };\n  } catch (err) {\n    console.error('Error fetching report card:', err);\n    return null;\n  }\n}\nexport async function upsertReportCard(studentId, reportCard) {\n  try {\n    const {\n      data: rcData,\n      error: rcError\n    } = await supabase.from('report_cards').upsert({\n      student_id: studentId,\n      term: reportCard.term,\n      session: reportCard.session,\n      status: reportCard.status,\n      attendance: reportCard.attendance,\n      skills: reportCard.skills,\n      psychomotor: reportCard.psychomotor,\n      teacher_comment: reportCard.teacherComment,\n      principal_comment: reportCard.principalComment,\n      updated_at: new Date().toISOString()\n    }, {\n      onConflict: 'student_id, term, session'\n    }).select().single();\n    if (rcError) throw rcError;\n    const reportCardId = rcData.id;\n    await supabase.from('report_card_records').delete().eq('report_card_id', reportCardId);\n    const records = reportCard.academicRecords.map(rec => ({\n      report_card_id: reportCardId,\n      subject: rec.subject,\n      ca: rec.ca,\n      exam: rec.exam,\n      total: rec.total,\n      grade: rec.grade,\n      remark: rec.remark\n    }));\n    if (records.length > 0) {\n      const {\n        error: recordsError\n      } = await supabase.from('report_card_records').insert(records);\n      if (recordsError) throw recordsError;\n    }\n    for (const rec of reportCard.academicRecords) {\n      const score = typeof rec.total === 'number' ? rec.total : parseFloat(rec.total) || 0;\n      await supabase.from('academic_performance').upsert({\n        student_id: studentId,\n        subject: rec.subject,\n        term: reportCard.term,\n        session: reportCard.session || '2023/2024',\n        score: score,\n        grade: rec.grade,\n        remark: rec.remark,\n        ca_score: rec.ca,\n        exam_score: rec.exam,\n        last_updated: new Date().toISOString()\n      }, {\n        onConflict: 'student_id, subject, term, session'\n      });\n    }\n    return true;\n  } catch (err) {\n    console.error('Error upserting report card:', err);\n    return false;\n  }\n}","map":{"version":3,"names":["supabase","fetchStudents","data","error","from","select","order","ascending","map","s","id","name","email","avatarUrl","avatar_url","grade","section","department","attendanceStatus","attendance_status","birthday","err","console","fetchStudentById","eq","single","fetchStudentByEmail","fetchStudentsByClass","fetchClassSubjects","Array","Set","c","subject","createStudent","studentData","insert","user_id","userId","created_at","Date","toISOString","updateStudent","updates","dbUpdates","undefined","update","deleteStudent","delete","fetchTeachers","t","phone","status","subjects","teacher_subjects","classes","teacher_classes","class_name","fetchTeacherById","createTeacher","teacherData","teacher","teacherError","length","subjectInserts","teacher_id","classInserts","className","updateTeacher","Object","keys","deleteTeacher","fetchParents","p","childIds","parent_children","student_id","fetchParentByEmail","fetchParentByUserId","fetchChildrenForParent","parentId","relations","relError","studentIds","r","students","stuError","in","fetchParentsForStudent","studentId","parentIds","parent_id","parents","parError","createParent","parentData","linkInserts","updateParent","deleteParent","fetchNotices","n","title","content","timestamp","category","isPinned","is_pinned","audience","createNotice","noticeData","updateNotice","deleteNotice","fetchClasses","studentCount","student_count","fetchAssignments","a","description","dueDate","due_date","totalStudents","total_students","submissionsCount","submissions_count","createAssignment","assignmentData","updateAssignment","deleteAssignment","fetchExams","e","type","date","time","isPublished","is_published","teacherId","fetchStudentFees","query","f","totalFee","total_fee","paidAmount","paid_amount","term","createFeeRecord","feeData","amount","updateFeeStatus","feeId","amountPaid","payment_date","saveAttendanceRecords","records","inserts","upsert","onConflict","ignoreDuplicates","fetchAttendanceForClass","checkSupabaseConnection","limit","message","log","fetchTimetableForClass","checkTimetableExists","count","head","createNotification","params","summary","related_id","relatedId","is_read","notifyClass","gradeMatch","match","parseInt","student","fetchTeachersByClass","createDataRefreshCallback","callback","fetchAnalyticsMetrics","stats","performance","fees","paid","overdue","unpaid","total","workload","attendance","enrollment","scores","excellent","good","average","poor","forEach","score","label","value","Math","round","a11yLabel","toLowerCase","timetable","counts","entries","split","pop","sort","b","slice","studentsData","yearCounts","year","getFullYear","d","setDate","getDate","gte","dailyStats","present","sortedKeys","k","fetchStudentAssignments","fetchStudentAttendanceStats","percentage","presentOrLate","filter","includes","fetchStudentFeeSummary","reduce","sum","Number","latestDue","getTime","fetchCurricula","fetchSubjects","curriculumId","gradeLevel","code","curriculum_id","grade_level","schoolId","school_id","fetchLessonNotes","subjectId","note","subject_id","classId","class_id","week","fileUrl","file_url","adminFeedback","admin_feedback","createdAt","createLessonNote","noteData","fetchCBTExams","exam","classGrade","class_grade","durationMinutes","duration_minutes","totalQuestions","total_questions","fetchCBTQuestions","examId","q","exam_id","questionText","question_text","questionType","question_type","options","correctOption","correct_option","points","fetchSchools","fetchStudentSubjects","sErr","cErr","fetchReportCard","session","absent","late","skills","psychomotor","teacherComment","teacher_comment","principalComment","principal_comment","academicRecords","report_card_records","ca","remark","upsertReportCard","reportCard","rcData","rcError","updated_at","reportCardId","rec","report_card_id","recordsError","parseFloat","ca_score","exam_score","last_updated"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/database.ts"],"sourcesContent":["import { supabase } from './supabase';\r\nimport {\r\n    Student,\r\n    Teacher,\r\n    Parent,\r\n    Notice,\r\n    ClassInfo,\r\n    Assignment,\r\n    Exam,\r\n    Conversation,\r\n    Message,\r\n    ReportCard\r\n} from '../types';\r\n\r\n/**\r\n * Complete Database Service for School Management System\r\n * All data fetching happens here - NO mock data!\r\n */\r\n\r\n// ============================================\r\n// STUDENTS\r\n// ============================================\r\n\r\nexport async function fetchStudents(): Promise<Student[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('students')\r\n            .select('*')\r\n            .order('grade', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((s: any) => ({\r\n            id: s.id,\r\n            name: s.name,\r\n            email: s.email || '',\r\n            avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: s.grade,\r\n            section: s.section,\r\n            department: s.department,\r\n            attendanceStatus: s.attendance_status || 'Absent',\r\n            birthday: s.birthday\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching students:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchStudentById(id: number): Promise<Student | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('students')\r\n            .select('*')\r\n            .eq('id', id)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        if (!data) return null;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: data.grade,\r\n            section: data.section,\r\n            department: data.department,\r\n            attendanceStatus: data.attendance_status || 'Absent',\r\n            birthday: data.birthday,\r\n            email: data.email || ''\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching student:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function fetchStudentByEmail(email: string): Promise<Student | null> {\r\n    try {\r\n        // Students might not always have an email column in simple schemas, \r\n        // but assuming they do based on Login auth.\r\n        const { data, error } = await supabase\r\n            .from('students')\r\n            .select('*')\r\n            .eq('email', email)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        if (!data) return null;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: data.grade,\r\n            section: data.section,\r\n            department: data.department,\r\n            attendanceStatus: data.attendance_status || 'Absent',\r\n            birthday: data.birthday,\r\n            email: data.email || ''\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching student by email:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function fetchStudentsByClass(grade: number, section: string): Promise<Student[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('students')\r\n            .select('*')\r\n            .eq('grade', grade)\r\n            .eq('section', section)\r\n            .order('name', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((s: any) => ({\r\n            id: s.id,\r\n            name: s.name,\r\n            email: s.email || '',\r\n            avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: s.grade,\r\n            section: s.section,\r\n            department: s.department,\r\n            attendanceStatus: s.attendance_status || 'Absent',\r\n            birthday: s.birthday\r\n        }));\r\n    } catch (err) {\r\n        console.error(`Error fetching students for Grade ${grade} - ${section}:`, err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchClassSubjects(grade: number, section: string): Promise<string[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('classes')\r\n            .select('subject')\r\n            .eq('grade', grade)\r\n            .eq('section', section);\r\n\r\n        if (error) throw error;\r\n\r\n        // Return unique subjects\r\n        return Array.from(new Set((data || []).map((c: any) => c.subject)));\r\n    } catch (err) {\r\n        console.error('Error fetching student subjects:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createStudent(studentData: {\r\n    name: string;\r\n    email?: string;\r\n    grade: number;\r\n    section: string;\r\n    department?: string;\r\n    birthday?: string;\r\n    avatarUrl?: string;\r\n    userId?: number | string;\r\n}): Promise<Student | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('students')\r\n            .insert({\r\n                user_id: studentData.userId,\r\n                name: studentData.name,\r\n                email: studentData.email,\r\n                grade: studentData.grade,\r\n                section: studentData.section,\r\n                department: studentData.department,\r\n                birthday: studentData.birthday,\r\n                avatar_url: studentData.avatarUrl,\r\n                attendance_status: 'Absent',\r\n                created_at: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: data.grade,\r\n            section: data.section,\r\n            department: data.department,\r\n            attendanceStatus: data.attendance_status || 'Absent',\r\n            birthday: data.birthday,\r\n            email: data.email || ''\r\n        };\r\n    } catch (err) {\r\n        console.error('Error creating student:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateStudent(id: number, updates: Partial<{\r\n    name: string;\r\n    email: string;\r\n    grade: number;\r\n    section: string;\r\n    department: string;\r\n    birthday: string;\r\n    avatarUrl: string;\r\n    attendanceStatus: string;\r\n}>): Promise<boolean> {\r\n    try {\r\n        const dbUpdates: any = {};\r\n        if (updates.name !== undefined) dbUpdates.name = updates.name;\r\n        if (updates.email !== undefined) dbUpdates.email = updates.email;\r\n        if (updates.grade !== undefined) dbUpdates.grade = updates.grade;\r\n        if (updates.section !== undefined) dbUpdates.section = updates.section;\r\n        if (updates.department !== undefined) dbUpdates.department = updates.department;\r\n        if (updates.birthday !== undefined) dbUpdates.birthday = updates.birthday;\r\n        if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\r\n        if (updates.attendanceStatus !== undefined) dbUpdates.attendance_status = updates.attendanceStatus;\r\n\r\n        const { error } = await supabase\r\n            .from('students')\r\n            .update(dbUpdates)\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating student:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function deleteStudent(id: number): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('students')\r\n            .delete()\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error deleting student:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n// ============================================\r\n// TEACHERS\r\n// ============================================\r\n\r\nexport async function fetchTeachers(): Promise<Teacher[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('teachers')\r\n            .select(`\r\n        *,\r\n        teacher_subjects(subject),\r\n        teacher_classes(class_name)\r\n      `);\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((t: any) => ({\r\n            id: t.id,\r\n            name: t.name,\r\n            avatarUrl: t.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\r\n            email: t.email,\r\n            phone: t.phone || '',\r\n            status: t.status || 'Active',\r\n            subjects: (t.teacher_subjects || []).map((s: any) => s.subject),\r\n            classes: (t.teacher_classes || []).map((c: any) => c.class_name)\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching teachers:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchTeacherById(id: number): Promise<Teacher | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('teachers')\r\n            .select(`\r\n        *,\r\n        teacher_subjects(subject),\r\n        teacher_classes(class_name)\r\n      `)\r\n            .eq('id', id)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        if (!data) return null;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\r\n            email: data.email,\r\n            phone: data.phone || '',\r\n            status: data.status || 'Active',\r\n            subjects: (data.teacher_subjects || []).map((s: any) => s.subject),\r\n            classes: (data.teacher_classes || []).map((c: any) => c.class_name)\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching teacher:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function createTeacher(teacherData: {\r\n    name: string;\r\n    email: string;\r\n    phone?: string;\r\n    subjects?: string[];\r\n    classes?: string[];\r\n    avatarUrl?: string;\r\n}): Promise<Teacher | null> {\r\n    try {\r\n        // Insert teacher first\r\n        const { data: teacher, error: teacherError } = await supabase\r\n            .from('teachers')\r\n            .insert({\r\n                name: teacherData.name,\r\n                email: teacherData.email,\r\n                phone: teacherData.phone,\r\n                avatar_url: teacherData.avatarUrl,\r\n                status: 'Active',\r\n                created_at: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (teacherError) throw teacherError;\r\n\r\n        // Insert subjects if provided\r\n        if (teacherData.subjects && teacherData.subjects.length > 0) {\r\n            const subjectInserts = teacherData.subjects.map(subject => ({\r\n                teacher_id: teacher.id,\r\n                subject\r\n            }));\r\n            await supabase.from('teacher_subjects').insert(subjectInserts);\r\n        }\r\n\r\n        // Insert classes if provided\r\n        if (teacherData.classes && teacherData.classes.length > 0) {\r\n            const classInserts = teacherData.classes.map(className => ({\r\n                teacher_id: teacher.id,\r\n                class_name: className\r\n            }));\r\n            await supabase.from('teacher_classes').insert(classInserts);\r\n        }\r\n\r\n        return {\r\n            id: teacher.id,\r\n            name: teacher.name,\r\n            avatarUrl: teacher.avatar_url || 'https://i.pravatar.cc/150?u=teacher',\r\n            email: teacher.email,\r\n            phone: teacher.phone || '',\r\n            status: teacher.status || 'Active',\r\n            subjects: teacherData.subjects || [],\r\n            classes: teacherData.classes || []\r\n        };\r\n    } catch (err) {\r\n        console.error('Error creating teacher:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateTeacher(id: number, updates: Partial<{\r\n    name: string;\r\n    email: string;\r\n    phone: string;\r\n    avatarUrl: string;\r\n    status: string;\r\n    subjects: string[];\r\n    classes: string[];\r\n}>): Promise<boolean> {\r\n    try {\r\n        // Update teacher basic info\r\n        const dbUpdates: any = {};\r\n        if (updates.name !== undefined) dbUpdates.name = updates.name;\r\n        if (updates.email !== undefined) dbUpdates.email = updates.email;\r\n        if (updates.phone !== undefined) dbUpdates.phone = updates.phone;\r\n        if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\r\n        if (updates.status !== undefined) dbUpdates.status = updates.status;\r\n\r\n        if (Object.keys(dbUpdates).length > 0) {\r\n            const { error } = await supabase\r\n                .from('teachers')\r\n                .update(dbUpdates)\r\n                .eq('id', id);\r\n            if (error) throw error;\r\n        }\r\n\r\n        // Update subjects if provided\r\n        if (updates.subjects !== undefined) {\r\n            // Delete existing\r\n            await supabase.from('teacher_subjects').delete().eq('teacher_id', id);\r\n            // Insert new\r\n            if (updates.subjects.length > 0) {\r\n                const subjectInserts = updates.subjects.map(subject => ({\r\n                    teacher_id: id,\r\n                    subject\r\n                }));\r\n                await supabase.from('teacher_subjects').insert(subjectInserts);\r\n            }\r\n        }\r\n\r\n        // Update classes if provided\r\n        if (updates.classes !== undefined) {\r\n            // Delete existing\r\n            await supabase.from('teacher_classes').delete().eq('teacher_id', id);\r\n            // Insert new\r\n            if (updates.classes.length > 0) {\r\n                const classInserts = updates.classes.map(className => ({\r\n                    teacher_id: id,\r\n                    class_name: className\r\n                }));\r\n                await supabase.from('teacher_classes').insert(classInserts);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating teacher:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function deleteTeacher(id: number): Promise<boolean> {\r\n    try {\r\n        // Delete related records first (cascade should handle this, but being explicit)\r\n        await supabase.from('teacher_subjects').delete().eq('teacher_id', id);\r\n        await supabase.from('teacher_classes').delete().eq('teacher_id', id);\r\n\r\n        // Delete teacher\r\n        const { error } = await supabase\r\n            .from('teachers')\r\n            .delete()\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error deleting teacher:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n// ============================================\r\n// PARENTS\r\n// ============================================\r\n\r\nexport async function fetchParents(): Promise<Parent[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('parents')\r\n            .select(`\r\n        *,\r\n        parent_children(student_id)\r\n      `);\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((p: any) => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            email: p.email,\r\n            phone: p.phone || '',\r\n            avatarUrl: p.avatar_url || 'https://i.pravatar.cc/150?u=parent',\r\n            childIds: (p.parent_children || []).map((c: any) => c.student_id)\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching parents:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchParentByEmail(email: string): Promise<Parent | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('parents')\r\n            .select(`\r\n        *,\r\n        parent_children(student_id)\r\n      `)\r\n            .eq('email', email)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        if (!data) return null;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            email: data.email,\r\n            phone: data.phone || '',\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\r\n            childIds: (data.parent_children || []).map((c: any) => c.student_id)\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching parent by email:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function fetchParentByUserId(userId: number | string): Promise<Parent | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('parents')\r\n            .select(`\r\n        *,\r\n        parent_children(student_id)\r\n      `)\r\n            .eq('user_id', userId)\r\n            .single();\r\n\r\n        if (error) throw error;\r\n        if (!data) return null;\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            email: data.email,\r\n            phone: data.phone || '',\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\r\n            childIds: (data.parent_children || []).map((c: any) => c.student_id)\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching parent by user id:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function fetchChildrenForParent(parentId: number): Promise<Student[]> {\r\n    try {\r\n        // 1. Get student IDs\r\n        const { data: relations, error: relError } = await supabase\r\n            .from('parent_children')\r\n            .select('student_id')\r\n            .eq('parent_id', parentId);\r\n\r\n        if (relError) throw relError;\r\n        if (!relations || relations.length === 0) return [];\r\n\r\n        const studentIds = relations.map((r: any) => r.student_id);\r\n\r\n        // 2. Fetch students\r\n        const { data: students, error: stuError } = await supabase\r\n            .from('students')\r\n            .select('*')\r\n            .in('id', studentIds);\r\n\r\n        if (stuError) throw stuError;\r\n\r\n        return (students || []).map((s: any) => ({\r\n            id: s.id,\r\n            name: s.name,\r\n            email: s.email || '',\r\n            avatarUrl: s.avatar_url || 'https://i.pravatar.cc/150',\r\n            grade: s.grade,\r\n            section: s.section,\r\n            department: s.department,\r\n            attendanceStatus: s.attendance_status || 'Absent',\r\n            birthday: s.birthday\r\n        }));\r\n\r\n    } catch (err) {\r\n        console.error('Error fetching children for parent:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchParentsForStudent(studentId: number): Promise<Parent[]> {\r\n    try {\r\n        // 1. Get parent IDs\r\n        const { data: relations, error: relError } = await supabase\r\n            .from('parent_children')\r\n            .select('parent_id')\r\n            .eq('student_id', studentId);\r\n\r\n        if (relError) throw relError;\r\n        if (!relations || relations.length === 0) return [];\r\n\r\n        const parentIds = relations.map((r: any) => r.parent_id);\r\n\r\n        // 2. Fetch parents\r\n        const { data: parents, error: parError } = await supabase\r\n            .from('parents')\r\n            .select('*')\r\n            .in('id', parentIds);\r\n\r\n        if (parError) throw parError;\r\n\r\n        return (parents || []).map((p: any) => ({\r\n            id: p.id,\r\n            name: p.name,\r\n            email: p.email,\r\n            phone: p.phone || '',\r\n            avatarUrl: p.avatar_url || 'https://i.pravatar.cc/150?u=parent',\r\n            childIds: [] // We don't necessarily need child IDs here, or we could fetch them if needed\r\n        }));\r\n\r\n    } catch (err) {\r\n        console.error('Error fetching parents for student:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createParent(parentData: {\r\n    name: string;\r\n    email: string;\r\n    phone?: string;\r\n    childIds?: number[];\r\n    avatarUrl?: string;\r\n}): Promise<Parent | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('parents')\r\n            .insert({\r\n                name: parentData.name,\r\n                email: parentData.email,\r\n                phone: parentData.phone,\r\n                avatar_url: parentData.avatarUrl,\r\n                created_at: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        // Link children if provided\r\n        if (parentData.childIds && parentData.childIds.length > 0) {\r\n            const linkInserts = parentData.childIds.map(studentId => ({\r\n                parent_id: data.id,\r\n                student_id: studentId\r\n            }));\r\n            await supabase.from('parent_children').insert(linkInserts);\r\n        }\r\n\r\n        return {\r\n            id: data.id,\r\n            name: data.name,\r\n            email: data.email,\r\n            phone: data.phone || '',\r\n            avatarUrl: data.avatar_url || 'https://i.pravatar.cc/150?u=parent',\r\n            childIds: parentData.childIds || []\r\n        };\r\n    } catch (err) {\r\n        console.error('Error creating parent:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateParent(id: number, updates: Partial<{\r\n    name: string;\r\n    email: string;\r\n    phone: string;\r\n    avatarUrl: string;\r\n    childIds: number[];\r\n}>): Promise<boolean> {\r\n    try {\r\n        const dbUpdates: any = {};\r\n        if (updates.name !== undefined) dbUpdates.name = updates.name;\r\n        if (updates.email !== undefined) dbUpdates.email = updates.email;\r\n        if (updates.phone !== undefined) dbUpdates.phone = updates.phone;\r\n        if (updates.avatarUrl !== undefined) dbUpdates.avatar_url = updates.avatarUrl;\r\n\r\n        if (Object.keys(dbUpdates).length > 0) {\r\n            const { error } = await supabase\r\n                .from('parents')\r\n                .update(dbUpdates)\r\n                .eq('id', id);\r\n            if (error) throw error;\r\n        }\r\n\r\n        // Update child links if provided\r\n        if (updates.childIds !== undefined) {\r\n            await supabase.from('parent_children').delete().eq('parent_id', id);\r\n            if (updates.childIds.length > 0) {\r\n                const linkInserts = updates.childIds.map(studentId => ({\r\n                    parent_id: id,\r\n                    student_id: studentId\r\n                }));\r\n                await supabase.from('parent_children').insert(linkInserts);\r\n            }\r\n        }\r\n\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating parent:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function deleteParent(id: number): Promise<boolean> {\r\n    try {\r\n        await supabase.from('parent_children').delete().eq('parent_id', id);\r\n        const { error } = await supabase\r\n            .from('parents')\r\n            .delete()\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error deleting parent:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// NOTICES & ANNOUNCEMENTS\r\n// ============================================\r\n\r\nexport async function fetchNotices(): Promise<Notice[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('notices')\r\n            .select('*')\r\n            .order('timestamp', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((n: any) => ({\r\n            id: n.id,\r\n            title: n.title,\r\n            content: n.content,\r\n            timestamp: n.timestamp,\r\n            category: n.category,\r\n            isPinned: n.is_pinned || false,\r\n            audience: n.audience || ['all']\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching notices:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createNotice(noticeData: {\r\n    title: string;\r\n    content: string;\r\n    category: string;\r\n    isPinned?: boolean;\r\n    audience?: string[];\r\n}): Promise<Notice | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('notices')\r\n            .insert({\r\n                title: noticeData.title,\r\n                content: noticeData.content,\r\n                category: noticeData.category,\r\n                is_pinned: noticeData.isPinned || false,\r\n                audience: noticeData.audience || ['all'],\r\n                timestamp: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return {\r\n            id: data.id,\r\n            title: data.title,\r\n            content: data.content,\r\n            timestamp: data.timestamp,\r\n            category: data.category,\r\n            isPinned: data.is_pinned || false,\r\n            audience: data.audience || ['all']\r\n        };\r\n    } catch (err) {\r\n        console.error('Error creating notice:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateNotice(id: number, updates: Partial<{\r\n    title: string;\r\n    content: string;\r\n    category: string;\r\n    isPinned: boolean;\r\n    audience: string[];\r\n}>): Promise<boolean> {\r\n    try {\r\n        const dbUpdates: any = {};\r\n        if (updates.title !== undefined) dbUpdates.title = updates.title;\r\n        if (updates.content !== undefined) dbUpdates.content = updates.content;\r\n        if (updates.category !== undefined) dbUpdates.category = updates.category;\r\n        if (updates.isPinned !== undefined) dbUpdates.is_pinned = updates.isPinned;\r\n        if (updates.audience !== undefined) dbUpdates.audience = updates.audience;\r\n\r\n        const { error } = await supabase\r\n            .from('notices')\r\n            .update(dbUpdates)\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating notice:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function deleteNotice(id: number): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('notices')\r\n            .delete()\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error deleting notice:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// CLASSES\r\n// ============================================\r\n\r\nexport async function fetchClasses(): Promise<ClassInfo[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('classes')\r\n            .select('*')\r\n            .order('grade', { ascending: false });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((c: any) => ({\r\n            id: c.id,\r\n            subject: c.subject,\r\n            grade: c.grade,\r\n            section: c.section,\r\n            department: c.department,\r\n            studentCount: c.student_count || 0\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching classes:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ============================================\r\n// ASSIGNMENTS\r\n// ============================================\r\n\r\nexport async function fetchAssignments(): Promise<Assignment[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('assignments')\r\n            .select('*')\r\n            .order('due_date', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((a: any) => ({\r\n            id: a.id,\r\n            title: a.title,\r\n            description: a.description,\r\n            className: a.class_name,\r\n            subject: a.subject,\r\n            dueDate: a.due_date,\r\n            totalStudents: a.total_students || 0,\r\n            submissionsCount: a.submissions_count || 0\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching assignments:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createAssignment(assignmentData: {\r\n    title: string;\r\n    description: string;\r\n    className: string;\r\n    subject: string;\r\n    dueDate: string;\r\n}): Promise<Assignment | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('assignments')\r\n            .insert({\r\n                title: assignmentData.title,\r\n                description: assignmentData.description,\r\n                class_name: assignmentData.className,\r\n                subject: assignmentData.subject,\r\n                due_date: assignmentData.dueDate,\r\n                created_at: new Date().toISOString()\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (error) throw error;\r\n\r\n        return {\r\n            id: data.id,\r\n            title: data.title,\r\n            description: data.description,\r\n            className: data.class_name,\r\n            subject: data.subject,\r\n            dueDate: data.due_date,\r\n            totalStudents: data.total_students || 0,\r\n            submissionsCount: data.submissions_count || 0\r\n        };\r\n    } catch (err) {\r\n        console.error('Error creating assignment:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function updateAssignment(id: number, updates: Partial<{\r\n    title: string;\r\n    description: string;\r\n    className: string;\r\n    subject: string;\r\n    dueDate: string;\r\n}>): Promise<boolean> {\r\n    try {\r\n        const dbUpdates: any = {};\r\n        if (updates.title !== undefined) dbUpdates.title = updates.title;\r\n        if (updates.description !== undefined) dbUpdates.description = updates.description;\r\n        if (updates.className !== undefined) dbUpdates.class_name = updates.className;\r\n        if (updates.subject !== undefined) dbUpdates.subject = updates.subject;\r\n        if (updates.dueDate !== undefined) dbUpdates.due_date = updates.dueDate;\r\n\r\n        const { error } = await supabase\r\n            .from('assignments')\r\n            .update(dbUpdates)\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating assignment:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function deleteAssignment(id: number): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('assignments')\r\n            .delete()\r\n            .eq('id', id);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error deleting assignment:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// EXAMS\r\n// ============================================\r\n\r\nexport async function fetchExams(): Promise<Exam[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('exams')\r\n            .select('*')\r\n            .order('date', { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((e: any) => ({\r\n            id: e.id,\r\n            type: e.type,\r\n            date: e.date,\r\n            time: e.time,\r\n            className: e.class_name,\r\n            subject: e.subject,\r\n            isPublished: e.is_published || false,\r\n            teacherId: e.teacher_id\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching exams:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\n//============================================\r\n// FEE MANAGEMENT\r\n// ============================================\r\n\r\nexport async function fetchStudentFees(studentId?: number): Promise<any[]> {\r\n    try {\r\n        let query = supabase.from('student_fees').select('*');\r\n\r\n        if (studentId) {\r\n            query = query.eq('student_id', studentId);\r\n        }\r\n\r\n        const { data, error } = await query.order('due_date', { ascending: true });\r\n\r\n        if (error) throw error;\r\n        return (data || []).map((f: any) => ({\r\n            id: f.id,\r\n            studentId: f.student_id,\r\n            totalFee: f.total_fee,\r\n            paidAmount: f.paid_amount,\r\n            status: f.status,\r\n            dueDate: f.due_date,\r\n            title: f.title,\r\n            term: f.term\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching student fees:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createFeeRecord(feeData: {\r\n    studentId: number;\r\n    amount: number;\r\n    title: string;\r\n    dueDate: string;\r\n    term?: string;\r\n    status?: string;\r\n}): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('student_fees')\r\n            .insert({\r\n                student_id: feeData.studentId,\r\n                total_fee: feeData.amount,\r\n                title: feeData.title,\r\n                due_date: feeData.dueDate,\r\n                term: feeData.term || 'Term 1',\r\n                status: feeData.status || 'Unpaid'\r\n            });\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error creating fee record:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function updateFeeStatus(feeId: number, status: string, amountPaid?: number): Promise<boolean> {\r\n    try {\r\n        const updates: any = { status };\r\n        if (amountPaid !== undefined) {\r\n            updates.paid_amount = amountPaid;\r\n            updates.payment_date = new Date().toISOString();\r\n        }\r\n\r\n        const { error } = await supabase\r\n            .from('student_fees')\r\n            .update(updates)\r\n            .eq('id', feeId);\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error updating fee status:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// ATTENDANCE OPERATIONS\r\n// ============================================\r\n\r\nexport async function saveAttendanceRecords(records: Array<{\r\n    studentId: number;\r\n    date: string;\r\n    status: string;\r\n    className?: string;\r\n}>): Promise<boolean> {\r\n    try {\r\n        const inserts = records.map(r => ({\r\n            student_id: r.studentId,\r\n            date: r.date,\r\n            status: r.status,\r\n            class_name: r.className\r\n        }));\r\n\r\n        // Use upsert to update existing or insert new\r\n        const { error } = await supabase\r\n            .from('student_attendance')\r\n            .upsert(inserts, {\r\n                onConflict: 'student_id,date',\r\n                ignoreDuplicates: false\r\n            });\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error saving attendance records:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\nexport async function fetchAttendanceForClass(className: string, date: string): Promise<any[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('student_attendance')\r\n            .select('*')\r\n            .eq('class_name', className)\r\n            .eq('date', date);\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n    } catch (err) {\r\n        console.error('Error fetching attendance:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ============================================\r\n// CONNECTION CHECK\r\n// ============================================\r\n\r\nexport async function checkSupabaseConnection(): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase.from('students').select('id').limit(1);\r\n        if (error) {\r\n            console.error('Supabase connection check failed:', error.message);\r\n            return false;\r\n        }\r\n        console.log('âœ… Supabase connected successfully');\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Supabase connection exception:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// TIMETABLE\r\n// ============================================\r\n\r\nexport async function fetchTimetableForClass(className: string): Promise<any[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('timetable')\r\n            .select('*')\r\n            .eq('class_name', className);\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n    } catch (err) {\r\n        console.error('Error fetching timetable:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function checkTimetableExists(className: string): Promise<boolean> {\r\n    try {\r\n        const { count, error } = await supabase\r\n            .from('timetable')\r\n            .select('*', { count: 'exact', head: true })\r\n            .eq('class_name', className);\r\n\r\n        if (error) throw error;\r\n        return (count || 0) > 0;\r\n    } catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// NOTIFICATIONS\r\n// ============================================\r\n\r\nexport interface CreateNotificationParams {\r\n    userId?: number; // Optional if targeting specific user\r\n    studentId?: number; // Optional if targeting specific student\r\n    category: string;\r\n    title: string;\r\n    summary: string;\r\n    relatedId?: number;\r\n}\r\n\r\nexport async function createNotification(params: CreateNotificationParams): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('notifications')\r\n            .insert({\r\n                user_id: params.userId,\r\n                category: params.category,\r\n                title: params.title,\r\n                summary: params.summary,\r\n                student_id: params.studentId,\r\n                related_id: params.relatedId,\r\n                is_read: false,\r\n                timestamp: new Date().toISOString()\r\n            });\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error creating notification:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Notify all students in a class\r\n */\r\nexport async function notifyClass(className: string, title: string, summary: string) {\r\n    // 1. Parse grade/section from className (e.g. \"Grade 10A (Science)\")\r\n    // This is a rough parser, assuming format \"Grade X...\"\r\n    const gradeMatch = className.match(/Grade\\s+(\\d+)([A-Za-z0-9]+)/);\r\n\r\n    if (gradeMatch) {\r\n        const grade = parseInt(gradeMatch[1]);\r\n        const section = gradeMatch[2]; // e.g. \"A\"\r\n\r\n        // 2. Fetch students\r\n        const students = await fetchStudentsByClass(grade, section);\r\n\r\n        // 3. Create notifications\r\n        // Ideally prompt backend to do this, but loop here for MVP\r\n        for (const student of students) {\r\n            await createNotification({\r\n                studentId: student.id,\r\n                category: 'Timetable',\r\n                title,\r\n                summary\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Fetch teachers associated with a class\r\n */\r\nexport async function fetchTeachersByClass(className: string): Promise<Teacher[]> {\r\n    // This assumes we have a way to link teachers.\r\n    // For now, we can fetch all teachers and filter if we had that link.\r\n    // Or we rely on the timetable itself to find teachers.\r\n    return fetchTeachers();\r\n}\r\n\r\n// ============================================\r\n// HELPER: Refresh Data After Changes\r\n// ============================================\r\n\r\n/**\r\n * Call this after creating/updating/deleting data to trigger UI refresh\r\n */\r\nexport function createDataRefreshCallback(callback: () => void) {\r\n    return callback;\r\n}\r\n\r\n// ============================================\r\n// ANALYTICS\r\n// ============================================\r\n\r\nexport async function fetchAnalyticsMetrics() {\r\n    try {\r\n        const stats = {\r\n            performance: [] as { label: string, value: number, a11yLabel: string }[],\r\n            fees: { paid: 0, overdue: 0, unpaid: 0, total: 0 },\r\n            workload: [] as { label: string, value: number }[],\r\n            attendance: [] as number[], // Last 7 days %\r\n            enrollment: [] as { year: number, count: number }[]\r\n        };\r\n\r\n        // 1. Performance Data\r\n        const { data: scores } = await supabase.from('academic_performance').select('score');\r\n        if (scores && scores.length > 0) {\r\n            let excellent = 0, good = 0, average = 0, poor = 0;\r\n            scores.forEach((s: any) => {\r\n                if (s.score >= 90) excellent++;\r\n                else if (s.score >= 70) good++;\r\n                else if (s.score >= 50) average++;\r\n                else poor++;\r\n            });\r\n            const total = scores.length;\r\n            stats.performance = [\r\n                { label: 'Excellent', value: Math.round((excellent / total) * 100), a11yLabel: `${Math.round((excellent / total) * 100)}% Excellent` },\r\n                { label: 'Good', value: Math.round((good / total) * 100), a11yLabel: `${Math.round((good / total) * 100)}% Good` },\r\n                { label: 'Average', value: Math.round((average / total) * 100), a11yLabel: `${Math.round((average / total) * 100)}% Average` },\r\n                { label: 'Poor', value: Math.round((poor / total) * 100), a11yLabel: `${Math.round((poor / total) * 100)}% Poor` },\r\n            ];\r\n        } else {\r\n            // Mock fallback if empty\r\n            stats.performance = [\r\n                { label: 'Excellent', value: 25, a11yLabel: '25% Excellent' },\r\n                { label: 'Good', value: 45, a11yLabel: '45% Good' },\r\n                { label: 'Average', value: 20, a11yLabel: '20% Average' },\r\n                { label: 'Poor', value: 10, a11yLabel: '10% Poor' },\r\n            ];\r\n        }\r\n\r\n        // 2. Fee Compliance\r\n        const { data: fees } = await supabase.from('student_fees').select('status');\r\n        if (fees && fees.length > 0) {\r\n            let paid = 0, overdue = 0, unpaid = 0;\r\n            fees.forEach((f: any) => {\r\n                const s = f.status.toLowerCase();\r\n                if (s === 'paid') paid++;\r\n                else if (s === 'overdue') overdue++;\r\n                else unpaid++;\r\n            });\r\n            stats.fees = {\r\n                paid: Math.round((paid / fees.length) * 100),\r\n                overdue: Math.round((overdue / fees.length) * 100),\r\n                unpaid: Math.round((unpaid / fees.length) * 100),\r\n                total: fees.length\r\n            };\r\n        } else {\r\n            stats.fees = { paid: 75, overdue: 15, unpaid: 10, total: 100 };\r\n        }\r\n\r\n        // 3. Teacher Workload (from timetable)\r\n        const { data: timetable } = await supabase.from('timetable').select('teacher');\r\n        if (timetable && timetable.length > 0) {\r\n            const counts: { [key: string]: number } = {};\r\n            timetable.forEach((t: any) => {\r\n                if (t.teacher) counts[t.teacher] = (counts[t.teacher] || 0) + 1;\r\n            });\r\n            stats.workload = Object.entries(counts)\r\n                .map(([label, value]) => ({ label: label.split(' ').pop() || label, value })) // Use last name\r\n                .sort((a, b) => b.value - a.value)\r\n                .slice(0, 5); // Top 5\r\n        } else {\r\n            stats.workload = [\r\n                { label: 'Mr. A', value: 12 }, { label: 'Ms. B', value: 10 }, { label: 'Mr. C', value: 15 }, { label: 'Ms. D', value: 8 }, { label: 'Mr. E', value: 11 }\r\n            ];\r\n        }\r\n\r\n        // 4. Enrollment\r\n        const { data: studentsData } = await supabase.from('students').select('created_at');\r\n        if (studentsData) {\r\n            const yearCounts: { [year: number]: number } = {};\r\n            studentsData.forEach((s: any) => {\r\n                const year = new Date(s.created_at).getFullYear();\r\n                yearCounts[year] = (yearCounts[year] || 0) + 1;\r\n            });\r\n            stats.enrollment = Object.entries(yearCounts)\r\n                .map(([year, count]) => ({ year: parseInt(year), count }))\r\n                .sort((a, b) => a.year - b.year)\r\n                .slice(-5);\r\n        }\r\n\r\n        // 5. Attendance Trend (Last 7 Days)\r\n        // Harder to aggregate via simple Select, so we might need raw SQL or generic fallback.\r\n        // For MVP, if we don't have enough data, we use mock.\r\n        // Let's try to fetch all attendance for last 7 days.\r\n        const d = new Date();\r\n        d.setDate(d.getDate() - 7);\r\n        const { data: attendance } = await supabase\r\n            .from('student_attendance')\r\n            .select('date, status')\r\n            .gte('date', d.toISOString().split('T')[0]);\r\n\r\n        if (attendance && attendance.length > 0) {\r\n            const dailyStats: { [key: string]: { total: number, present: number } } = {};\r\n            attendance.forEach((r: any) => {\r\n                if (!dailyStats[r.date]) dailyStats[r.date] = { total: 0, present: 0 };\r\n                dailyStats[r.date].total++;\r\n                if (r.status === 'Present') dailyStats[r.date].present++;\r\n            });\r\n            // Sort by date key\r\n            const sortedKeys = Object.keys(dailyStats).sort();\r\n            stats.attendance = sortedKeys.map(k => Math.round((dailyStats[k].present / dailyStats[k].total) * 100));\r\n        } else {\r\n            stats.attendance = [88, 92, 90, 95, 94, 96, 95];\r\n        }\r\n\r\n        return stats;\r\n\r\n    } catch (err) {\r\n        console.error(\"Error fetching analytics metrics:\", err);\r\n        return null;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// PARENT DASHBOARD HELPERS\r\n// ============================================\r\n\r\nexport async function fetchStudentAssignments(studentId: number, grade: number, section: string): Promise<Assignment[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('assignments')\r\n            .select('*')\r\n            .order('due_date', { ascending: true }); // Simple fetch for now, can refine filter later\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map((a: any) => ({\r\n            id: a.id,\r\n            title: a.title,\r\n            subject: a.subject,\r\n            teacher: 'Unknown',\r\n            dueDate: a.due_date,\r\n            status: 'Pending',\r\n            grade: a.grade || 0,\r\n            description: a.description,\r\n            className: a.class_name || 'General',\r\n            totalStudents: a.total_students || 0,\r\n            submissionsCount: a.submissions_count || 0\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching student assignments:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchStudentAttendanceStats(studentId: number): Promise<{ percentage: number }> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('student_attendance')\r\n            .select('status')\r\n            .eq('student_id', studentId);\r\n\r\n        if (error) throw error;\r\n\r\n        if (!data || data.length === 0) return { percentage: 100 };\r\n\r\n        const presentOrLate = data.filter((r: any) => ['Present', 'Late'].includes(r.status)).length;\r\n        const percentage = Math.round((presentOrLate / data.length) * 100);\r\n\r\n        return { percentage };\r\n    } catch (err) {\r\n        console.error('Error fetching attendance stats:', err);\r\n        return { percentage: 0 };\r\n    }\r\n}\r\n\r\nexport async function fetchStudentFeeSummary(studentId: number): Promise<{ totalFee: number; paidAmount: number; status: string; dueDate?: string } | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('student_fees')\r\n            .select('*')\r\n            .eq('student_id', studentId);\r\n\r\n        if (error) throw error;\r\n\r\n        if (!data || data.length === 0) return null;\r\n\r\n        const totalFee = data.reduce((sum: number, r: any) => sum + (Number(r.total_fee) || 0), 0);\r\n        const paidAmount = data.reduce((sum: number, r: any) => sum + (Number(r.paid_amount) || 0), 0);\r\n        const latestDue = data.sort((a: any, b: any) => new Date(b.due_date).getTime() - new Date(a.due_date).getTime())[0]?.due_date;\r\n\r\n        const status = paidAmount >= totalFee ? 'Paid' : 'Overdue';\r\n\r\n        return {\r\n            totalFee,\r\n            paidAmount,\r\n            status,\r\n            dueDate: latestDue\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching student fee summary:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\n// ============================================\r\n// FEATURE EXPANSION: CURRICULUM & SUBJECTS\r\n// ============================================\r\n\r\nexport async function fetchCurricula(): Promise<any[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('curricula')\r\n            .select('*')\r\n            .order('name');\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n    } catch (err) {\r\n        console.error('Error fetching curricula:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchSubjects(curriculumId?: number, gradeLevel?: string): Promise<any[]> {\r\n    try {\r\n        let query = supabase\r\n            .from('subjects')\r\n            .select('id, name, code, category, curriculum_id, grade_level, school_id')\r\n            .order('name');\r\n\r\n        if (curriculumId) {\r\n            query = query.eq('curriculum_id', curriculumId);\r\n        }\r\n        if (gradeLevel) {\r\n            query = query.eq('grade_level', gradeLevel);\r\n        }\r\n\r\n        const { data, error } = await query;\r\n        if (error) throw error;\r\n\r\n        return (data || []).map(s => ({\r\n            id: s.id,\r\n            name: s.name,\r\n            code: s.code,\r\n            category: s.category,\r\n            curriculumId: s.curriculum_id,\r\n            gradeLevel: s.grade_level,\r\n            schoolId: s.school_id\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching subjects:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ============================================\r\n// FEATURE EXPANSION: LESSON NOTES\r\n// ============================================\r\n\r\nexport async function fetchLessonNotes(teacherId?: number, subjectId?: number): Promise<any[]> {\r\n    try {\r\n        let query = supabase\r\n            .from('lesson_notes')\r\n            .select('*')\r\n            .order('created_at', { ascending: false });\r\n\r\n        if (teacherId) query = query.eq('teacher_id', teacherId);\r\n        if (subjectId) query = query.eq('subject_id', subjectId);\r\n\r\n        const { data, error } = await query;\r\n        if (error) throw error;\r\n\r\n        return (data || []).map(note => ({\r\n            id: note.id,\r\n            teacherId: note.teacher_id,\r\n            subjectId: note.subject_id,\r\n            classId: note.class_id,\r\n            week: note.week,\r\n            term: note.term,\r\n            title: note.title,\r\n            content: note.content,\r\n            fileUrl: note.file_url,\r\n            status: note.status,\r\n            adminFeedback: note.admin_feedback,\r\n            createdAt: note.created_at\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching lesson notes:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function createLessonNote(noteData: {\r\n    teacherId: number;\r\n    subjectId: number;\r\n    classId: number;\r\n    week: number;\r\n    term: string;\r\n    title: string;\r\n    content: string;\r\n    fileUrl?: string;\r\n}): Promise<boolean> {\r\n    try {\r\n        const { error } = await supabase\r\n            .from('lesson_notes')\r\n            .insert({\r\n                teacher_id: noteData.teacherId,\r\n                subject_id: noteData.subjectId,\r\n                class_id: noteData.classId,\r\n                week: noteData.week,\r\n                term: noteData.term,\r\n                title: noteData.title,\r\n                content: noteData.content,\r\n                file_url: noteData.fileUrl,\r\n                status: 'Pending'\r\n            });\r\n\r\n        if (error) throw error;\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error creating lesson note:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n// ============================================\r\n// FEATURE EXPANSION: CBT EXAMS\r\n// ============================================\r\n\r\nexport async function fetchCBTExams(teacherId?: number, isPublished?: boolean): Promise<any[]> {\r\n    try {\r\n        let query = supabase\r\n            .from('cbt_exams')\r\n            .select('*')\r\n            .order('created_at', { ascending: false }); // Newest first\r\n\r\n        if (teacherId) query = query.eq('teacher_id', teacherId);\r\n        if (isPublished !== undefined) query = query.eq('is_published', isPublished);\r\n\r\n        const { data, error } = await query;\r\n        if (error) throw error;\r\n\r\n        return (data || []).map(exam => ({\r\n            id: exam.id,\r\n            title: exam.title,\r\n            subjectId: exam.subject_id,\r\n            classGrade: exam.class_grade,\r\n            curriculumId: exam.curriculum_id,\r\n            durationMinutes: exam.duration_minutes,\r\n            totalQuestions: exam.total_questions,\r\n            isPublished: exam.is_published,\r\n            teacherId: exam.teacher_id,\r\n            createdAt: exam.created_at\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching CBT exams:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchCBTQuestions(examId: number): Promise<any[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('cbt_questions')\r\n            .select('*')\r\n            .eq('exam_id', examId)\r\n            .order('id');\r\n\r\n        if (error) throw error;\r\n\r\n        return (data || []).map(q => ({\r\n            id: q.id,\r\n            examId: q.exam_id,\r\n            questionText: q.question_text,\r\n            questionType: q.question_type,\r\n            options: q.options, // Should be array of strings\r\n            correctOption: q.correct_option,\r\n            points: q.points\r\n        }));\r\n    } catch (err) {\r\n        console.error('Error fetching CBT questions:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function fetchSchools(): Promise<{ id: number; name: string }[]> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('schools')\r\n            .select('id, name')\r\n            .order('name');\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n    } catch (err) {\r\n        console.error('Error fetching schools:', err);\r\n        return [];\r\n    }\r\n}\r\n\r\n// ============================================\r\n// FEATURE EXPANSION: REPORT CARDS & SUBJECTS\r\n// ============================================\r\n\r\nexport async function fetchStudentSubjects(studentId: number): Promise<any[]> {\r\n    try {\r\n        const { data: student, error: sErr } = await supabase.from('students').select('grade, section').eq('id', studentId).single();\r\n        if (sErr || !student) return [];\r\n\r\n        const { data: classes, error: cErr } = await supabase\r\n            .from('classes')\r\n            .select('subject')\r\n            .eq('grade', student.grade)\r\n            .eq('section', student.section);\r\n\r\n        if (cErr) return [];\r\n        return classes.map((c: any) => ({ name: c.subject }));\r\n    } catch (e) { return []; }\r\n}\r\n\r\nexport async function fetchReportCard(studentId: number, term: string, session: string): Promise<ReportCard | null> {\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from('report_cards')\r\n            .select(`\r\n                *,\r\n                report_card_records(*)\r\n            `)\r\n            .eq('student_id', studentId)\r\n            .eq('term', term)\r\n            .eq('session', session)\r\n            .single();\r\n\r\n        if (error) {\r\n            if (error.code === 'PGRST116') return null;\r\n            throw error;\r\n        }\r\n\r\n        if (!data) return null;\r\n\r\n        return {\r\n            term: data.term,\r\n            session: data.session,\r\n            status: data.status,\r\n            attendance: data.attendance || { total: 0, present: 0, absent: 0, late: 0 },\r\n            skills: data.skills || {},\r\n            psychomotor: data.psychomotor || {},\r\n            teacherComment: data.teacher_comment || '',\r\n            principalComment: data.principal_comment || '',\r\n            academicRecords: (data.report_card_records || []).map((r: any) => ({\r\n                subject: r.subject,\r\n                ca: r.ca,\r\n                exam: r.exam,\r\n                total: r.total,\r\n                grade: r.grade,\r\n                remark: r.remark\r\n            }))\r\n        };\r\n    } catch (err) {\r\n        console.error('Error fetching report card:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function upsertReportCard(studentId: number, reportCard: ReportCard): Promise<boolean> {\r\n    try {\r\n        // 1. Save Report Card (Master Record)\r\n        const { data: rcData, error: rcError } = await supabase\r\n            .from('report_cards')\r\n            .upsert({\r\n                student_id: studentId,\r\n                term: reportCard.term,\r\n                session: reportCard.session,\r\n                status: reportCard.status,\r\n                attendance: reportCard.attendance,\r\n                skills: reportCard.skills,\r\n                psychomotor: reportCard.psychomotor,\r\n                teacher_comment: reportCard.teacherComment,\r\n                principal_comment: reportCard.principalComment,\r\n                updated_at: new Date().toISOString()\r\n            }, { onConflict: 'student_id, term, session' })\r\n            .select()\r\n            .single();\r\n\r\n        if (rcError) throw rcError;\r\n\r\n        const reportCardId = rcData.id;\r\n\r\n        // 2. Save Breakdown Records (Sub-table)\r\n        // First clean up old records for this card to prevent duplicates/orphans\r\n        await supabase.from('report_card_records').delete().eq('report_card_id', reportCardId);\r\n\r\n        const records = reportCard.academicRecords.map(rec => ({\r\n            report_card_id: reportCardId,\r\n            subject: rec.subject,\r\n            ca: rec.ca,\r\n            exam: rec.exam,\r\n            total: rec.total,\r\n            grade: rec.grade,\r\n            remark: rec.remark\r\n        }));\r\n\r\n        if (records.length > 0) {\r\n            const { error: recordsError } = await supabase\r\n                .from('report_card_records')\r\n                .insert(records);\r\n            if (recordsError) throw recordsError;\r\n        }\r\n\r\n        // 3. SYNC TO ACADEMIC PERFORMANCE (For Parent/Student Dashboard Visibility)\r\n        // Parents view `academic_performance` table, not `report_cards` usually.\r\n        // We calculate 'score' as the Total.\r\n        for (const rec of reportCard.academicRecords) {\r\n            const score = typeof rec.total === 'number' ? rec.total : parseFloat(rec.total) || 0;\r\n            await supabase.from('academic_performance').upsert({\r\n                student_id: studentId,\r\n                subject: rec.subject,\r\n                term: reportCard.term,\r\n                session: reportCard.session || '2023/2024',\r\n                score: score,\r\n                grade: rec.grade,\r\n                remark: rec.remark,\r\n                ca_score: rec.ca,\r\n                exam_score: rec.exam,\r\n                last_updated: new Date().toISOString()\r\n            }, { onConflict: 'student_id, subject, term, session' });\r\n        }\r\n\r\n        return true;\r\n    } catch (err) {\r\n        console.error('Error upserting report card:', err);\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}