{"ast":null,"code":"import { useEffect, useState } from 'react';\nexport function registerServiceWorker() {\n  if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\n    return;\n  }\n  window.addEventListener('load', async () => {\n    try {\n      const registration = await navigator.serviceWorker.register('/sw.js');\n      console.log('Service Worker registered with scope:', registration.scope);\n    } catch (error) {\n      console.error('Service Worker registration failed:', error);\n    }\n  });\n}\nexport function usePWAInstall() {\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\n  const [isInstalled, setIsInstalled] = useState(false);\n  useEffect(() => {\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      setIsInstalled(true);\n    }\n    const handleBeforeInstall = e => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n    };\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setDeferredPrompt(null);\n    };\n    window.addEventListener('beforeinstallprompt', handleBeforeInstall);\n    window.addEventListener('appinstalled', handleAppInstalled);\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstall);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n  const promptInstall = async () => {\n    if (!deferredPrompt) return false;\n    await deferredPrompt.prompt();\n    const choiceResult = await deferredPrompt.userChoice;\n    if (choiceResult.outcome === 'accepted') {\n      setDeferredPrompt(null);\n      return true;\n    }\n    return false;\n  };\n  return {\n    canInstall: !!deferredPrompt,\n    isInstalled,\n    promptInstall\n  };\n}\nexport async function cacheOfflineData(urls) {\n  if (!('serviceWorker' in navigator)) return;\n  const registration = await navigator.serviceWorker.ready;\n  registration.active?.postMessage({\n    type: 'CACHE_URLS',\n    urls\n  });\n}\nexport function isStandalone() {\n  if (typeof window === 'undefined') return false;\n  return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true || document.referrer.includes('android-app://');\n}\nexport function useOfflineStatus() {\n  const [isOffline, setIsOffline] = useState(!navigator.onLine);\n  useEffect(() => {\n    const handleOnline = () => setIsOffline(false);\n    const handleOffline = () => setIsOffline(true);\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n  return {\n    isOffline,\n    isOnline: !isOffline\n  };\n}\nexport function getNetworkInfo() {\n  if (typeof window === 'undefined' || !('connection' in navigator)) {\n    return {\n      effectiveType: 'unknown',\n      saveData: false\n    };\n  }\n  const connection = navigator.connection;\n  return {\n    effectiveType: connection?.effectiveType || 'unknown',\n    saveData: connection?.saveData || false,\n    downlink: connection?.downlink || null,\n    rtt: connection?.rtt || null\n  };\n}","map":{"version":3,"names":["useEffect","useState","registerServiceWorker","window","navigator","addEventListener","registration","serviceWorker","register","console","log","scope","error","usePWAInstall","deferredPrompt","setDeferredPrompt","isInstalled","setIsInstalled","matchMedia","matches","handleBeforeInstall","e","preventDefault","handleAppInstalled","removeEventListener","promptInstall","prompt","choiceResult","userChoice","outcome","canInstall","cacheOfflineData","urls","ready","active","postMessage","type","isStandalone","standalone","document","referrer","includes","useOfflineStatus","isOffline","setIsOffline","onLine","handleOnline","handleOffline","isOnline","getNetworkInfo","effectiveType","saveData","connection","downlink","rtt"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/pwa.ts"],"sourcesContent":["/**\r\n * PWA Installation and Service Worker Registration\r\n * Handles PWA install prompts and service worker lifecycle\r\n */\r\n\r\nimport { useEffect, useState } from 'react';\r\n\r\ninterface BeforeInstallPromptEvent extends Event {\r\n    prompt: () => Promise<void>;\r\n    userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\r\n}\r\n\r\n// Register service worker - MODIFIED FOR DEV DEBUGGING TO UNREGISTER\r\nexport function registerServiceWorker() {\r\n    if (typeof window === 'undefined' || !('serviceWorker' in navigator)) {\r\n        return;\r\n    }\r\n\r\n    // FORCE UNREGISTER FOR DEVELOPMENT DEBUGGING\r\n    window.addEventListener('load', async () => {\r\n        try {\r\n            const registration = await navigator.serviceWorker.register('/sw.js');\r\n            console.log('Service Worker registered with scope:', registration.scope);\r\n        } catch (error) {\r\n            console.error('Service Worker registration failed:', error);\r\n        }\r\n    });\r\n}\r\n\r\n// Hook for PWA install prompt\r\nexport function usePWAInstall() {\r\n    const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);\r\n    const [isInstalled, setIsInstalled] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Check if already installed\r\n        if (window.matchMedia('(display-mode: standalone)').matches) {\r\n            setIsInstalled(true);\r\n        }\r\n\r\n        const handleBeforeInstall = (e: Event) => {\r\n            e.preventDefault();\r\n            setDeferredPrompt(e as BeforeInstallPromptEvent);\r\n        };\r\n\r\n        const handleAppInstalled = () => {\r\n            setIsInstalled(true);\r\n            setDeferredPrompt(null);\r\n        };\r\n\r\n        window.addEventListener('beforeinstallprompt', handleBeforeInstall);\r\n        window.addEventListener('appinstalled', handleAppInstalled);\r\n\r\n        return () => {\r\n            window.removeEventListener('beforeinstallprompt', handleBeforeInstall);\r\n            window.removeEventListener('appinstalled', handleAppInstalled);\r\n        };\r\n    }, []);\r\n\r\n    const promptInstall = async () => {\r\n        if (!deferredPrompt) return false;\r\n\r\n        await deferredPrompt.prompt();\r\n        const choiceResult = await deferredPrompt.userChoice;\r\n\r\n        if (choiceResult.outcome === 'accepted') {\r\n            setDeferredPrompt(null);\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    };\r\n\r\n    return {\r\n        canInstall: !!deferredPrompt,\r\n        isInstalled,\r\n        promptInstall\r\n    };\r\n}\r\n\r\n// Cache important data for offline use\r\nexport async function cacheOfflineData(urls: string[]) {\r\n    if (!('serviceWorker' in navigator)) return;\r\n\r\n    const registration = await navigator.serviceWorker.ready;\r\n    registration.active?.postMessage({\r\n        type: 'CACHE_URLS',\r\n        urls\r\n    });\r\n}\r\n\r\n// Check if app is running in standalone mode (installed PWA)\r\nexport function isStandalone(): boolean {\r\n    if (typeof window === 'undefined') return false;\r\n\r\n    return (\r\n        window.matchMedia('(display-mode: standalone)').matches ||\r\n        (window.navigator as any).standalone === true ||\r\n        document.referrer.includes('android-app://')\r\n    );\r\n}\r\n\r\n// Hook for monitoring offline/online status\r\nexport function useOfflineStatus() {\r\n    const [isOffline, setIsOffline] = useState(!navigator.onLine);\r\n\r\n    useEffect(() => {\r\n        const handleOnline = () => setIsOffline(false);\r\n        const handleOffline = () => setIsOffline(true);\r\n\r\n        window.addEventListener('online', handleOnline);\r\n        window.addEventListener('offline', handleOffline);\r\n\r\n        return () => {\r\n            window.removeEventListener('online', handleOnline);\r\n            window.removeEventListener('offline', handleOffline);\r\n        };\r\n    }, []);\r\n\r\n    return { isOffline, isOnline: !isOffline };\r\n}\r\n\r\n// Get network information (for showing data usage warnings)\r\nexport function getNetworkInfo() {\r\n    if (typeof window === 'undefined' || !('connection' in navigator)) {\r\n        return { effectiveType: 'unknown', saveData: false };\r\n    }\r\n\r\n    const connection = (navigator as any).connection;\r\n    return {\r\n        effectiveType: connection?.effectiveType || 'unknown',\r\n        saveData: connection?.saveData || false,\r\n        downlink: connection?.downlink || null,\r\n        rtt: connection?.rtt || null\r\n    };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}