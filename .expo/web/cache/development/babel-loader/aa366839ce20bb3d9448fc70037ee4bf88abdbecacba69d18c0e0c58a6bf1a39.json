{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\shared\\\\ChatScreen.tsx\";\nimport React, { useState, useRef, useEffect } from 'react';\nimport { supabase } from '../../lib/supabase';\nimport { SendIcon, DotsVerticalIcon } from '../../constants';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst THEME_STYLES = {\n  indigo: {\n    primary: 'bg-indigo-600',\n    secondary: 'bg-indigo-50',\n    text: 'text-indigo-600',\n    border: 'border-indigo-100',\n    ring: 'focus-within:ring-indigo-100',\n    userBubble: 'bg-gradient-to-br from-indigo-500 to-indigo-600 text-white',\n    otherBubble: 'bg-white text-gray-800',\n    sendButton: 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-200',\n    timestampUser: 'text-indigo-100',\n    timestampOther: 'text-gray-400',\n    senderName: 'text-indigo-600',\n    icon: 'text-indigo-400'\n  },\n  orange: {\n    primary: 'bg-orange-500',\n    secondary: 'bg-orange-50',\n    text: 'text-orange-600',\n    border: 'border-orange-100',\n    ring: 'focus-within:ring-orange-100',\n    userBubble: 'bg-gradient-to-br from-orange-400 to-orange-600 text-white',\n    otherBubble: 'bg-white text-gray-800',\n    sendButton: 'bg-orange-500 hover:bg-orange-600 shadow-orange-200',\n    timestampUser: 'text-orange-100',\n    timestampOther: 'text-gray-400',\n    senderName: 'text-orange-600',\n    icon: 'text-orange-400'\n  },\n  purple: {\n    primary: 'bg-purple-600',\n    secondary: 'bg-purple-50',\n    text: 'text-purple-600',\n    border: 'border-purple-100',\n    ring: 'focus-within:ring-purple-100',\n    userBubble: 'bg-gradient-to-br from-purple-500 to-purple-600 text-white',\n    otherBubble: 'bg-white text-gray-800',\n    sendButton: 'bg-purple-600 hover:bg-purple-700 shadow-purple-200',\n    timestampUser: 'text-purple-100',\n    timestampOther: 'text-gray-400',\n    senderName: 'text-purple-600',\n    icon: 'text-purple-400'\n  },\n  green: {\n    primary: 'bg-green-600',\n    secondary: 'bg-green-50',\n    text: 'text-green-600',\n    border: 'border-green-100',\n    ring: 'focus-within:ring-green-100',\n    userBubble: 'bg-gradient-to-br from-green-500 to-green-600 text-white',\n    otherBubble: 'bg-white text-gray-800',\n    sendButton: 'bg-green-600 hover:bg-green-700 shadow-green-200',\n    timestampUser: 'text-green-100',\n    timestampOther: 'text-gray-400',\n    senderName: 'text-green-600',\n    icon: 'text-green-400'\n  },\n  blue: {\n    primary: 'bg-blue-600',\n    secondary: 'bg-blue-50',\n    text: 'text-blue-600',\n    border: 'border-blue-100',\n    ring: 'focus-within:ring-blue-100',\n    userBubble: 'bg-gradient-to-br from-blue-500 to-blue-600 text-white',\n    otherBubble: 'bg-white text-gray-800',\n    sendButton: 'bg-blue-600 hover:bg-blue-700 shadow-blue-200',\n    timestampUser: 'text-blue-100',\n    timestampOther: 'text-gray-400',\n    senderName: 'text-blue-600',\n    icon: 'text-blue-400'\n  }\n};\nconst ChatScreen = ({\n  conversationId,\n  conversation,\n  roomDetails,\n  currentUserId,\n  themeColor = 'orange',\n  hideHeader = false\n}) => {\n  const roomId = conversationId || (conversation?.id ? parseInt(conversation.id.replace('conv-', '')) : null) || (conversation?.id ? parseInt(conversation.id) : null);\n  const theme = THEME_STYLES[themeColor] || THEME_STYLES.orange;\n  const [messages, setMessages] = useState([]);\n  const [inputText, setInputText] = useState('');\n  const [loading, setLoading] = useState(true);\n  const endOfMessagesRef = useRef(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const [typingUsers, setTypingUsers] = useState(new Set());\n  const typingTimeoutRef = useRef(null);\n  useEffect(() => {\n    if (!roomId) return;\n    const fetchMessages = async () => {\n      const {\n        data,\n        error\n      } = await supabase.from('messages').select(`\n                    *,\n                    sender:users!sender_id (id, name, avatar_url, role)\n                `).eq('conversation_id', roomId).order('created_at', {\n        ascending: true\n      });\n      if (data) {\n        const mappedMessages = data.map(msg => ({\n          id: msg.id,\n          roomId: msg.conversation_id,\n          senderId: msg.sender_id,\n          content: msg.content,\n          type: msg.type,\n          mediaUrl: msg.media_url,\n          createdAt: msg.created_at,\n          updatedAt: msg.created_at,\n          isDeleted: false,\n          isEdited: false,\n          sender: msg.sender ? {\n            id: msg.sender.id,\n            name: msg.sender.name,\n            avatarUrl: msg.sender.avatar_url,\n            role: msg.sender.role || 'Member'\n          } : undefined\n        }));\n        setMessages(mappedMessages);\n      }\n      setLoading(false);\n    };\n    fetchMessages();\n  }, [roomId]);\n  useEffect(() => {\n    if (!roomId) return;\n    const channel = supabase.channel(`conversation:${roomId}`).on('postgres_changes', {\n      event: 'INSERT',\n      schema: 'public',\n      table: 'messages',\n      filter: `conversation_id=eq.${roomId}`\n    }, async payload => {\n      const newMsg = payload.new;\n      const {\n        data: userData\n      } = await supabase.from('users').select('id, name, avatar_url, role').eq('id', newMsg.sender_id).single();\n      const formattedMsg = {\n        id: newMsg.id,\n        roomId: newMsg.conversation_id,\n        senderId: newMsg.sender_id,\n        content: newMsg.content,\n        type: newMsg.type,\n        mediaUrl: newMsg.media_url,\n        createdAt: newMsg.created_at,\n        updatedAt: newMsg.created_at,\n        isDeleted: false,\n        isEdited: false,\n        sender: userData ? {\n          id: userData.id,\n          name: userData.name,\n          avatarUrl: userData.avatar_url,\n          role: userData.role || 'Member'\n        } : undefined\n      };\n      setMessages(prev => [...prev, formattedMsg]);\n    }).on('broadcast', {\n      event: 'typing'\n    }, payload => {\n      if (payload.payload.userId !== currentUserId) {\n        setTypingUsers(prev => {\n          const newSet = new Set(prev);\n          if (payload.payload.isTyping) {\n            newSet.add(payload.payload.userId);\n          } else {\n            newSet.delete(payload.payload.userId);\n          }\n          return newSet;\n        });\n      }\n    }).subscribe();\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [roomId, currentUserId]);\n  useEffect(() => {\n    endOfMessagesRef.current?.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages, roomId, typingUsers]);\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (inputText.trim() === '' || !roomId) return;\n    const textToSend = inputText.trim();\n    setInputText('');\n    const {\n      error\n    } = await supabase.from('messages').insert({\n      conversation_id: roomId,\n      sender_id: currentUserId,\n      content: textToSend,\n      type: 'text'\n    });\n    if (error) {\n      console.error('Error sending message:', error);\n      setInputText(textToSend);\n      return;\n    }\n    await supabase.from('conversations').update({\n      last_message_at: new Date().toISOString(),\n      last_message_text: textToSend\n    }).eq('id', roomId);\n    handleTyping(false);\n  };\n  const handleTyping = async isTypingNow => {\n    if (!roomId) return;\n    await supabase.channel(`conversation:${roomId}`).send({\n      type: 'broadcast',\n      event: 'typing',\n      payload: {\n        userId: currentUserId,\n        isTyping: isTypingNow\n      }\n    });\n  };\n  const onInputChange = e => {\n    setInputText(e.target.value);\n    if (!isTyping) {\n      setIsTyping(true);\n      handleTyping(true);\n    }\n    if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n      handleTyping(false);\n    }, 2000);\n  };\n  if (loading) {\n    return _jsxDEV(\"div\", {\n      className: \"h-full flex items-center justify-center text-gray-400 bg-slate-50\",\n      children: _jsxDEV(\"div\", {\n        className: \"flex flex-col items-center animate-pulse\",\n        children: [_jsxDEV(\"div\", {\n          className: \"w-10 h-10 bg-gray-200 rounded-full mb-3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 17\n        }, this), _jsxDEV(\"div\", {\n          className: \"h-4 w-32 bg-gray-200 rounded\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 16\n    }, this);\n  }\n  if (!roomId) {\n    return _jsxDEV(\"div\", {\n      className: \"h-full flex flex-col items-center justify-center text-center p-8 bg-slate-50\",\n      children: [_jsxDEV(\"div\", {\n        className: `w-24 h-24 ${theme.secondary} rounded-full flex items-center justify-center mb-6 ring-4 ring-white shadow-sm`,\n        children: _jsxDEV(SendIcon, {\n          className: `w-10 h-10 ${theme.icon}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 17\n      }, this), _jsxDEV(\"h3\", {\n        className: \"text-xl font-bold text-gray-800 mb-2\",\n        children: \"Your Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 17\n      }, this), _jsxDEV(\"p\", {\n        className: \"text-gray-500 max-w-xs\",\n        children: \"Select a conversation to begin.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 13\n    }, this);\n  }\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full w-full relative bg-slate-50\",\n    children: [!hideHeader && _jsxDEV(\"div\", {\n      className: \"bg-white/80 backdrop-blur-md p-3 border-b border-gray-200 flex items-center justify-between sticky top-0 z-10 shadow-sm\",\n      children: [_jsxDEV(\"div\", {\n        className: \"flex items-center space-x-3\",\n        children: [roomDetails?.displayAvatar ? _jsxDEV(\"div\", {\n          className: \"relative\",\n          children: _jsxDEV(\"img\", {\n            src: roomDetails.displayAvatar,\n            className: \"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm\",\n            alt: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 29\n        }, this) : _jsxDEV(\"div\", {\n          className: `w-10 h-10 rounded-full ${theme.secondary} flex items-center justify-center border-2 border-white shadow-sm`,\n          children: _jsxDEV(\"span\", {\n            className: `font-bold ${theme.text}`,\n            children: roomDetails?.displayName?.charAt(0)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 33\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 29\n        }, this), _jsxDEV(\"div\", {\n          children: [_jsxDEV(\"h3\", {\n            className: \"font-bold text-gray-800 leading-tight\",\n            children: roomDetails?.displayName || 'Chat'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 29\n          }, this), typingUsers.size > 0 && _jsxDEV(\"p\", {\n            className: `text-xs ${theme.text} animate-pulse`,\n            children: \"typing...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 21\n      }, this), _jsxDEV(\"button\", {\n        className: \"p-2 hover:bg-gray-100 rounded-full text-gray-400 transition-colors\",\n        children: _jsxDEV(DotsVerticalIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 17\n    }, this), _jsxDEV(\"div\", {\n      className: \"flex-grow p-4 space-y-3 overflow-y-auto custom-scrollbar\",\n      children: [messages.map((msg, index) => {\n        const isCurrentUser = msg.senderId === currentUserId;\n        const isSequence = index > 0 && messages[index - 1].senderId === msg.senderId;\n        return _jsxDEV(\"div\", {\n          className: `flex ${isCurrentUser ? 'justify-end' : 'justify-start'} ${isSequence ? 'mt-1' : 'mt-4'} group animate-in fade-in slide-in-from-bottom-2 duration-300`,\n          children: [!isCurrentUser && !isSequence && _jsxDEV(\"div\", {\n            className: \"w-8 h-8 mr-2 rounded-full bg-gray-200 overflow-hidden flex-shrink-0 self-end mb-1 shadow-sm ring-2 ring-white\",\n            children: msg.sender?.avatarUrl ? _jsxDEV(\"img\", {\n              src: msg.sender.avatarUrl,\n              className: \"w-full h-full object-cover\",\n              alt: msg.sender.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 330,\n              columnNumber: 41\n            }, this) : _jsxDEV(\"div\", {\n              className: \"w-full h-full flex items-center justify-center text-xs font-bold text-gray-500\",\n              children: \"?\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 41\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 33\n          }, this), !isCurrentUser && isSequence && _jsxDEV(\"div\", {\n            className: \"w-8 mr-2 flex-shrink-0\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 62\n          }, this), _jsxDEV(\"div\", {\n            className: `max-w-[75%] md:max-w-[60%] px-4 py-3 shadow-sm relative text-[15px] ${isCurrentUser ? `${theme.userBubble} rounded-2xl rounded-tr-sm` : `${theme.otherBubble} rounded-2xl rounded-tl-sm border border-gray-100/50`}`,\n            children: [!isCurrentUser && !isSequence && msg.sender?.name && _jsxDEV(\"p\", {\n              className: `text-[11px] font-bold ${theme.senderName} mb-1 opacity-90`,\n              children: msg.sender.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 344,\n              columnNumber: 37\n            }, this), msg.type === 'text' && _jsxDEV(\"p\", {\n              className: \"whitespace-pre-wrap break-words leading-relaxed tracking-wide\",\n              children: msg.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 37\n            }, this), _jsxDEV(\"div\", {\n              className: `flex items-end gap-1 mt-1 ${isCurrentUser ? `justify-end ${theme.timestampUser} opacity-80` : `justify-end ${theme.timestampOther}`}`,\n              children: _jsxDEV(\"span\", {\n                className: \"text-[10px] leading-none font-medium\",\n                children: msg.createdAt ? new Date(msg.createdAt).toLocaleTimeString([], {\n                  hour: '2-digit',\n                  minute: '2-digit'\n                }) : '...'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 352,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 351,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 29\n          }, this)]\n        }, msg.id || index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 326,\n          columnNumber: 25\n        }, this);\n      }), _jsxDEV(\"div\", {\n        ref: endOfMessagesRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 13\n    }, this), _jsxDEV(\"div\", {\n      className: \"p-4 bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.02)]\",\n      children: _jsxDEV(\"form\", {\n        onSubmit: handleSendMessage,\n        className: \"flex items-end space-x-3 max-w-5xl mx-auto\",\n        children: [_jsxDEV(\"div\", {\n          className: `flex-grow bg-gray-50 rounded-2xl flex items-center px-4 py-3 transition-all border border-transparent ${theme.ring} focus-within:bg-white focus-within:shadow-sm ring-1 ring-gray-100`,\n          children: _jsxDEV(\"input\", {\n            type: \"text\",\n            value: inputText,\n            onChange: onInputChange,\n            placeholder: \"Type a message...\",\n            className: \"flex-grow bg-transparent border-none focus:ring-0 text-gray-800 placeholder-gray-400 h-full py-0 text-base outline-none\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 367,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 21\n        }, this), _jsxDEV(\"button\", {\n          type: \"submit\",\n          disabled: !inputText.trim(),\n          className: `p-3.5 rounded-full shadow-lg text-white transition-all transform duration-200 ${inputText.trim() ? `${theme.sendButton} hover:scale-105 active:scale-95` : 'bg-gray-200 cursor-not-allowed'}`,\n          children: _jsxDEV(SendIcon, {\n            className: \"w-5 h-5\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 291,\n    columnNumber: 9\n  }, this);\n};\nexport default ChatScreen;","map":{"version":3,"names":["React","useState","useRef","useEffect","supabase","SendIcon","DotsVerticalIcon","jsxDEV","_jsxDEV","THEME_STYLES","indigo","primary","secondary","text","border","ring","userBubble","otherBubble","sendButton","timestampUser","timestampOther","senderName","icon","orange","purple","green","blue","ChatScreen","conversationId","conversation","roomDetails","currentUserId","themeColor","hideHeader","roomId","id","parseInt","replace","theme","messages","setMessages","inputText","setInputText","loading","setLoading","endOfMessagesRef","isTyping","setIsTyping","typingUsers","setTypingUsers","Set","typingTimeoutRef","fetchMessages","data","error","from","select","eq","order","ascending","mappedMessages","map","msg","conversation_id","senderId","sender_id","content","type","mediaUrl","media_url","createdAt","created_at","updatedAt","isDeleted","isEdited","sender","name","avatarUrl","avatar_url","role","undefined","channel","on","event","schema","table","filter","payload","newMsg","new","userData","single","formattedMsg","prev","userId","newSet","add","delete","subscribe","removeChannel","current","scrollIntoView","behavior","handleSendMessage","e","preventDefault","trim","textToSend","insert","console","update","last_message_at","Date","toISOString","last_message_text","handleTyping","isTypingNow","send","onInputChange","target","value","clearTimeout","setTimeout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","displayAvatar","src","alt","displayName","charAt","size","index","isCurrentUser","isSequence","toLocaleTimeString","hour","minute","ref","onSubmit","onChange","placeholder","disabled"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/shared/ChatScreen.tsx"],"sourcesContent":["\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport { ChatMessage } from '../../types';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { SendIcon, PaperclipIcon, HappyIcon, DotsVerticalIcon } from '../../constants';\r\n\r\ninterface ChatScreenProps {\r\n    conversationId?: number;\r\n    conversation?: any;\r\n    roomDetails?: any;\r\n    themeColor?: 'indigo' | 'orange' | 'purple' | 'green' | 'blue';\r\n    hideHeader?: boolean;\r\n    currentUserId?: number;\r\n}\r\n\r\nconst THEME_STYLES = {\r\n    indigo: {\r\n        primary: 'bg-indigo-600',\r\n        secondary: 'bg-indigo-50',\r\n        text: 'text-indigo-600',\r\n        border: 'border-indigo-100',\r\n        ring: 'focus-within:ring-indigo-100',\r\n        userBubble: 'bg-gradient-to-br from-indigo-500 to-indigo-600 text-white',\r\n        otherBubble: 'bg-white text-gray-800',\r\n        sendButton: 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-200',\r\n        timestampUser: 'text-indigo-100',\r\n        timestampOther: 'text-gray-400',\r\n        senderName: 'text-indigo-600',\r\n        icon: 'text-indigo-400'\r\n    },\r\n    orange: {\r\n        primary: 'bg-orange-500',\r\n        secondary: 'bg-orange-50',\r\n        text: 'text-orange-600',\r\n        border: 'border-orange-100',\r\n        ring: 'focus-within:ring-orange-100',\r\n        userBubble: 'bg-gradient-to-br from-orange-400 to-orange-600 text-white',\r\n        otherBubble: 'bg-white text-gray-800',\r\n        sendButton: 'bg-orange-500 hover:bg-orange-600 shadow-orange-200',\r\n        timestampUser: 'text-orange-100',\r\n        timestampOther: 'text-gray-400',\r\n        senderName: 'text-orange-600',\r\n        icon: 'text-orange-400'\r\n    },\r\n    purple: {\r\n        primary: 'bg-purple-600',\r\n        secondary: 'bg-purple-50',\r\n        text: 'text-purple-600',\r\n        border: 'border-purple-100',\r\n        ring: 'focus-within:ring-purple-100',\r\n        userBubble: 'bg-gradient-to-br from-purple-500 to-purple-600 text-white',\r\n        otherBubble: 'bg-white text-gray-800',\r\n        sendButton: 'bg-purple-600 hover:bg-purple-700 shadow-purple-200',\r\n        timestampUser: 'text-purple-100',\r\n        timestampOther: 'text-gray-400',\r\n        senderName: 'text-purple-600',\r\n        icon: 'text-purple-400'\r\n    },\r\n    green: {\r\n        primary: 'bg-green-600',\r\n        secondary: 'bg-green-50',\r\n        text: 'text-green-600',\r\n        border: 'border-green-100',\r\n        ring: 'focus-within:ring-green-100',\r\n        userBubble: 'bg-gradient-to-br from-green-500 to-green-600 text-white',\r\n        otherBubble: 'bg-white text-gray-800',\r\n        sendButton: 'bg-green-600 hover:bg-green-700 shadow-green-200',\r\n        timestampUser: 'text-green-100',\r\n        timestampOther: 'text-gray-400',\r\n        senderName: 'text-green-600',\r\n        icon: 'text-green-400'\r\n    },\r\n    blue: {\r\n        primary: 'bg-blue-600',\r\n        secondary: 'bg-blue-50',\r\n        text: 'text-blue-600',\r\n        border: 'border-blue-100',\r\n        ring: 'focus-within:ring-blue-100',\r\n        userBubble: 'bg-gradient-to-br from-blue-500 to-blue-600 text-white',\r\n        otherBubble: 'bg-white text-gray-800',\r\n        sendButton: 'bg-blue-600 hover:bg-blue-700 shadow-blue-200',\r\n        timestampUser: 'text-blue-100',\r\n        timestampOther: 'text-gray-400',\r\n        senderName: 'text-blue-600',\r\n        icon: 'text-blue-400'\r\n    }\r\n};\r\n\r\nconst ChatScreen: React.FC<ChatScreenProps> = ({ conversationId, conversation, roomDetails, currentUserId, themeColor = 'orange', hideHeader = false }) => {\r\n    const roomId = conversationId || (conversation?.id ? parseInt(conversation.id.replace('conv-', '')) : null) || (conversation?.id ? parseInt(conversation.id) : null);\r\n\r\n    const theme = THEME_STYLES[themeColor] || THEME_STYLES.orange;\r\n\r\n    // Fallback: if we still don't have a numeric roomId but have a conversation object with an ID that might be the numeric one.\r\n    // If conversation.id is 'conv-123', we parse it. If it is 123 (number), we use it.\r\n\r\n    const [messages, setMessages] = useState<ChatMessage[]>([]);\r\n    const [inputText, setInputText] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n    const endOfMessagesRef = useRef<HTMLDivElement>(null);\r\n    const [isTyping, setIsTyping] = useState(false);\r\n    const [typingUsers, setTypingUsers] = useState<Set<number>>(new Set());\r\n    const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    // Initial Fetch\r\n    useEffect(() => {\r\n        if (!roomId) return;\r\n\r\n        const fetchMessages = async () => {\r\n            const { data, error } = await supabase\r\n                .from('messages')\r\n                .select(`\r\n                    *,\r\n                    sender:users!sender_id (id, name, avatar_url, role)\r\n                `)\r\n                .eq('conversation_id', roomId)\r\n                .order('created_at', { ascending: true });\r\n\r\n            if (data) {\r\n                const mappedMessages = data.map((msg: any) => ({\r\n                    id: msg.id,\r\n                    roomId: msg.conversation_id, // Map DB 'conversation_id' to frontend 'roomId'\r\n                    senderId: msg.sender_id,\r\n                    content: msg.content,\r\n                    type: msg.type,\r\n                    mediaUrl: msg.media_url,\r\n                    createdAt: msg.created_at,\r\n                    updatedAt: msg.created_at, // Use created_at as fallback\r\n                    isDeleted: false,\r\n                    isEdited: false,\r\n                    sender: msg.sender ? {\r\n                        id: msg.sender.id,\r\n                        name: msg.sender.name,\r\n                        avatarUrl: msg.sender.avatar_url,\r\n                        role: msg.sender.role || 'Member'\r\n                    } : undefined\r\n                }));\r\n                // Limit to last 50 messages for performance and \"load more\" later\r\n                setMessages(mappedMessages);\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchMessages();\r\n    }, [roomId]);\r\n\r\n    // Real-time Subscription\r\n    useEffect(() => {\r\n        if (!roomId) return;\r\n\r\n        const channel = supabase.channel(`conversation:${roomId}`)\r\n            .on('postgres_changes', {\r\n                event: 'INSERT',\r\n                schema: 'public',\r\n                table: 'messages',\r\n                filter: `conversation_id=eq.${roomId}`\r\n            }, async (payload) => {\r\n                const newMsg = payload.new;\r\n                // Fetch sender info \r\n                const { data: userData } = await supabase\r\n                    .from('users')\r\n                    .select('id, name, avatar_url, role')\r\n                    .eq('id', newMsg.sender_id)\r\n                    .single();\r\n\r\n                const formattedMsg: ChatMessage = {\r\n                    id: newMsg.id,\r\n                    roomId: newMsg.conversation_id,\r\n                    senderId: newMsg.sender_id,\r\n                    content: newMsg.content,\r\n                    type: newMsg.type,\r\n                    mediaUrl: newMsg.media_url,\r\n                    createdAt: newMsg.created_at,\r\n                    updatedAt: newMsg.created_at,\r\n                    isDeleted: false,\r\n                    isEdited: false,\r\n                    sender: userData ? {\r\n                        id: userData.id,\r\n                        name: userData.name,\r\n                        avatarUrl: userData.avatar_url,\r\n                        role: userData.role || 'Member'\r\n                    } : undefined\r\n                };\r\n\r\n                setMessages(prev => [...prev, formattedMsg]);\r\n            })\r\n            .on('broadcast', { event: 'typing' }, (payload) => {\r\n                if (payload.payload.userId !== currentUserId) {\r\n                    setTypingUsers(prev => {\r\n                        const newSet = new Set(prev);\r\n                        if (payload.payload.isTyping) {\r\n                            newSet.add(payload.payload.userId);\r\n                        } else {\r\n                            newSet.delete(payload.payload.userId);\r\n                        }\r\n                        return newSet;\r\n                    });\r\n                }\r\n            })\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [roomId, currentUserId]);\r\n\r\n    // Auto-scroll \r\n    useEffect(() => {\r\n        endOfMessagesRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [messages, roomId, typingUsers]);\r\n\r\n    const handleSendMessage = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (inputText.trim() === '' || !roomId) return;\r\n\r\n        const textToSend = inputText.trim();\r\n        setInputText('');\r\n\r\n        // 1. Insert into DB (messages)\r\n        const { error } = await supabase\r\n            .from('messages')\r\n            .insert({\r\n                conversation_id: roomId,\r\n                sender_id: currentUserId,\r\n                content: textToSend,\r\n                type: 'text'\r\n            });\r\n\r\n        if (error) {\r\n            console.error('Error sending message:', error);\r\n            setInputText(textToSend);\r\n            return;\r\n        }\r\n\r\n        // 2. Update conversation's last_message_at\r\n        await supabase\r\n            .from('conversations')\r\n            .update({\r\n                last_message_at: new Date().toISOString(),\r\n                last_message_text: textToSend\r\n            })\r\n            .eq('id', roomId);\r\n\r\n        handleTyping(false);\r\n    };\r\n\r\n    const handleTyping = async (isTypingNow: boolean) => {\r\n        if (!roomId) return;\r\n        await supabase.channel(`conversation:${roomId}`).send({\r\n            type: 'broadcast',\r\n            event: 'typing',\r\n            payload: { userId: currentUserId, isTyping: isTypingNow }\r\n        });\r\n    };\r\n\r\n    const onInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        setInputText(e.target.value);\r\n        if (!isTyping) {\r\n            setIsTyping(true);\r\n            handleTyping(true);\r\n        }\r\n        if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\r\n        typingTimeoutRef.current = setTimeout(() => {\r\n            setIsTyping(false);\r\n            handleTyping(false);\r\n        }, 2000);\r\n    };\r\n\r\n    if (loading) {\r\n        return <div className=\"h-full flex items-center justify-center text-gray-400 bg-slate-50\">\r\n            <div className=\"flex flex-col items-center animate-pulse\">\r\n                <div className=\"w-10 h-10 bg-gray-200 rounded-full mb-3\"></div>\r\n                <div className=\"h-4 w-32 bg-gray-200 rounded\"></div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    if (!roomId) {\r\n        return (\r\n            <div className=\"h-full flex flex-col items-center justify-center text-center p-8 bg-slate-50\">\r\n                <div className={`w-24 h-24 ${theme.secondary} rounded-full flex items-center justify-center mb-6 ring-4 ring-white shadow-sm`}>\r\n                    <SendIcon className={`w-10 h-10 ${theme.icon}`} />\r\n                </div>\r\n                <h3 className=\"text-xl font-bold text-gray-800 mb-2\">Your Messages</h3>\r\n                <p className=\"text-gray-500 max-w-xs\">Select a conversation to begin.</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full w-full relative bg-slate-50\">\r\n            {/* Header */}\r\n            {!hideHeader && (\r\n                <div className=\"bg-white/80 backdrop-blur-md p-3 border-b border-gray-200 flex items-center justify-between sticky top-0 z-10 shadow-sm\">\r\n                    <div className=\"flex items-center space-x-3\">\r\n                        {roomDetails?.displayAvatar ? (\r\n                            <div className=\"relative\">\r\n                                <img src={roomDetails.displayAvatar} className=\"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm\" alt=\"\" />\r\n                                {/* Online status indicator could go here */}\r\n                            </div>\r\n                        ) : (\r\n                            <div className={`w-10 h-10 rounded-full ${theme.secondary} flex items-center justify-center border-2 border-white shadow-sm`}>\r\n                                <span className={`font-bold ${theme.text}`}>{roomDetails?.displayName?.charAt(0)}</span>\r\n                            </div>\r\n                        )}\r\n                        <div>\r\n                            <h3 className=\"font-bold text-gray-800 leading-tight\">{roomDetails?.displayName || 'Chat'}</h3>\r\n                            {typingUsers.size > 0 && (\r\n                                <p className={`text-xs ${theme.text} animate-pulse`}>typing...</p>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                    <button className=\"p-2 hover:bg-gray-100 rounded-full text-gray-400 transition-colors\">\r\n                        <DotsVerticalIcon />\r\n                    </button>\r\n                </div>\r\n            )}\r\n\r\n            {/* Messages Area */}\r\n            <div className=\"flex-grow p-4 space-y-3 overflow-y-auto custom-scrollbar\">\r\n                {messages.map((msg, index) => {\r\n                    const isCurrentUser = msg.senderId === currentUserId;\r\n                    const isSequence = index > 0 && messages[index - 1].senderId === msg.senderId;\r\n\r\n                    return (\r\n                        <div key={msg.id || index} className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'} ${isSequence ? 'mt-1' : 'mt-4'} group animate-in fade-in slide-in-from-bottom-2 duration-300`}>\r\n                            {!isCurrentUser && !isSequence && (\r\n                                <div className=\"w-8 h-8 mr-2 rounded-full bg-gray-200 overflow-hidden flex-shrink-0 self-end mb-1 shadow-sm ring-2 ring-white\">\r\n                                    {msg.sender?.avatarUrl ? (\r\n                                        <img src={msg.sender.avatarUrl} className=\"w-full h-full object-cover\" alt={msg.sender.name} />\r\n                                    ) : (\r\n                                        <div className=\"w-full h-full flex items-center justify-center text-xs font-bold text-gray-500\">?</div>\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                            {!isCurrentUser && isSequence && <div className=\"w-8 mr-2 flex-shrink-0\" />}\r\n\r\n                            <div className={`max-w-[75%] md:max-w-[60%] px-4 py-3 shadow-sm relative text-[15px] ${isCurrentUser\r\n                                ? `${theme.userBubble} rounded-2xl rounded-tr-sm`\r\n                                : `${theme.otherBubble} rounded-2xl rounded-tl-sm border border-gray-100/50`\r\n                                }`}>\r\n\r\n                                {!isCurrentUser && !isSequence && msg.sender?.name && (\r\n                                    <p className={`text-[11px] font-bold ${theme.senderName} mb-1 opacity-90`}>{msg.sender.name}</p>\r\n                                )}\r\n\r\n                                {msg.type === 'text' && (\r\n                                    <p className=\"whitespace-pre-wrap break-words leading-relaxed tracking-wide\">{msg.content}</p>\r\n                                )}\r\n\r\n                                <div className={`flex items-end gap-1 mt-1 ${isCurrentUser ? `justify-end ${theme.timestampUser} opacity-80` : `justify-end ${theme.timestampOther}`}`}>\r\n                                    <span className=\"text-[10px] leading-none font-medium\">\r\n                                        {msg.createdAt ? new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '...'}\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n                <div ref={endOfMessagesRef} />\r\n            </div>\r\n\r\n            {/* Input Area */}\r\n            <div className=\"p-4 bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.02)]\">\r\n                <form onSubmit={handleSendMessage} className=\"flex items-end space-x-3 max-w-5xl mx-auto\">\r\n                    <div className={`flex-grow bg-gray-50 rounded-2xl flex items-center px-4 py-3 transition-all border border-transparent ${theme.ring} focus-within:bg-white focus-within:shadow-sm ring-1 ring-gray-100`}>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={inputText}\r\n                            onChange={onInputChange}\r\n                            placeholder=\"Type a message...\"\r\n                            className=\"flex-grow bg-transparent border-none focus:ring-0 text-gray-800 placeholder-gray-400 h-full py-0 text-base outline-none\"\r\n                        />\r\n                    </div>\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={!inputText.trim()}\r\n                        className={`p-3.5 rounded-full shadow-lg text-white transition-all transform duration-200 ${inputText.trim()\r\n                            ? `${theme.sendButton} hover:scale-105 active:scale-95`\r\n                            : 'bg-gray-200 cursor-not-allowed'\r\n                            }`}\r\n                    >\r\n                        <SendIcon className=\"w-5 h-5\" />\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChatScreen;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}