{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USER\\\\OneDrive\\\\Desktop\\\\Project\\\\school-app-\\\\components\\\\admin\\\\TimetableEditor.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { XCircleIcon, SparklesIcon, BriefcaseIcon, CheckCircleIcon, PlusIcon, EditIcon, CloudUploadIcon, ChevronLeftIcon } from '../../constants';\nimport { SUBJECT_COLORS } from '../../constants';\nimport { supabase } from '../../lib/supabase';\nimport { notifyClass } from '../../lib/database';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst formatTime12Hour = timeStr => {\n  if (!timeStr) return '';\n  const [hours, minutes] = timeStr.split(':');\n  let h = parseInt(hours, 10);\n  const ampm = h >= 12 ? 'PM' : 'AM';\n  h = h % 12;\n  h = h ? h : 12;\n  return `${h}:${minutes} ${ampm}`;\n};\nconst PERIODS = [{\n  name: 'Period 1',\n  start: '09:00',\n  end: '09:45'\n}, {\n  name: 'Period 2',\n  start: '09:45',\n  end: '10:30'\n}, {\n  name: 'Period 3',\n  start: '10:30',\n  end: '11:15'\n}, {\n  name: 'Short Break',\n  start: '11:15',\n  end: '11:30',\n  isBreak: true\n}, {\n  name: 'Period 4',\n  start: '11:30',\n  end: '12:15'\n}, {\n  name: 'Period 5',\n  start: '12:15',\n  end: '13:00'\n}, {\n  name: 'Long Break',\n  start: '13:00',\n  end: '13:45',\n  isBreak: true\n}, {\n  name: 'Period 6',\n  start: '13:45',\n  end: '14:30'\n}, {\n  name: 'Period 7',\n  start: '14:30',\n  end: '15:15'\n}, {\n  name: 'Period 8',\n  start: '15:15',\n  end: '16:00'\n}];\nconst DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];\nconst Toast = ({\n  message,\n  onClear\n}) => {\n  useEffect(() => {\n    const timer = setTimeout(onClear, 3000);\n    return () => clearTimeout(timer);\n  }, [onClear]);\n  return _jsxDEV(\"div\", {\n    className: \"fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur-md text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center space-x-3 animate-slide-in-up z-[100] border border-white/10\",\n    children: [_jsxDEV(CheckCircleIcon, {\n      className: \"w-5 h-5 text-emerald-400\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 13\n    }, this), _jsxDEV(\"span\", {\n      className: \"font-medium\",\n      children: message\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 9\n  }, this);\n};\nconst DraggableSubject = ({\n  subjectName,\n  onClick\n}) => {\n  const [isDragging, setIsDragging] = useState(false);\n  const colorClass = SUBJECT_COLORS[subjectName] || 'bg-gray-100 text-gray-700';\n  return _jsxDEV(\"div\", {\n    draggable: true,\n    onClick: onClick,\n    onDragStart: e => {\n      e.dataTransfer.setData('subjectName', subjectName);\n      setIsDragging(true);\n    },\n    onDragEnd: () => setIsDragging(false),\n    className: `p-3 rounded-xl cursor-grab text-sm font-bold text-center shadow-sm hover:shadow-md transition-all active:cursor-grabbing border-b-2 border-black/5\n                ${colorClass} \n                ${isDragging ? 'opacity-50 scale-95 ring-2 ring-offset-2 ring-indigo-400' : 'hover:-translate-y-0.5'}\n            `,\n    children: subjectName\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 9\n  }, this);\n};\nconst TimetableCell = ({\n  subject,\n  teacher,\n  onDrop,\n  onClear,\n  onClick,\n  isBreak\n}) => {\n  const [isHovering, setIsHovering] = useState(false);\n  const handleDragOver = e => {\n    e.preventDefault();\n    if (isBreak) {\n      e.dataTransfer.dropEffect = \"none\";\n    } else {\n      e.dataTransfer.dropEffect = \"move\";\n      e.currentTarget.classList.add('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\n    }\n  };\n  const handleDragLeave = e => {\n    e.currentTarget.classList.remove('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\n  };\n  const handleDrop = e => {\n    e.preventDefault();\n    e.currentTarget.classList.remove('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\n    if (!isBreak) onDrop(e);\n  };\n  if (isBreak) {\n    return _jsxDEV(\"div\", {\n      className: \"h-full bg-gray-100/50 border border-gray-200 rounded-lg flex items-center justify-center\",\n      children: _jsxDEV(\"span\", {\n        className: \"text-xs font-bold text-gray-400 uppercase tracking-widest transform -rotate-0\",\n        children: \"Break\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }, this);\n  }\n  return _jsxDEV(\"div\", {\n    onDragOver: handleDragOver,\n    onDragLeave: handleDragLeave,\n    onDrop: handleDrop,\n    onClick: onClick,\n    className: `h-full min-h-[80px] rounded-xl border transition-all duration-200 relative group\n                ${subject ? `${SUBJECT_COLORS[subject] || 'bg-white'} border-transparent shadow-sm hover:shadow-md` : 'bg-white border-dashed border-gray-200 hover:border-indigo-300 hover:bg-indigo-50/30'}\n            `,\n    children: subject ? _jsxDEV(\"div\", {\n      className: \"h-full px-2 py-1.5 flex flex-col justify-center text-center\",\n      children: [_jsxDEV(\"span\", {\n        className: \"text-[13px] font-bold text-gray-800 leading-tight line-clamp-2\",\n        children: subject\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 21\n      }, this), teacher && _jsxDEV(\"div\", {\n        className: \"flex items-center justify-center mt-1 space-x-1\",\n        children: [_jsxDEV(BriefcaseIcon, {\n          className: \"w-3 h-3 text-gray-500/70\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 29\n        }, this), _jsxDEV(\"span\", {\n          className: \"text-[10px] text-gray-600 font-medium truncate max-w-full\",\n          children: teacher\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 25\n      }, this), _jsxDEV(\"button\", {\n        onClick: e => {\n          e.stopPropagation();\n          onClear();\n        },\n        className: \"absolute -top-1.5 -right-1.5 p-0.5 bg-white rounded-full shadow-sm text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity hover:text-red-500 hover:bg-red-50\",\n        children: _jsxDEV(XCircleIcon, {\n          className: \"w-4 h-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 21\n      }, this), _jsxDEV(\"div\", {\n        className: \"absolute inset-0 bg-black/0 group-hover:bg-black/5 rounded-xl transition-colors pointer-events-none\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 17\n    }, this) : _jsxDEV(\"div\", {\n      className: \"flex items-center justify-center h-full text-indigo-200/50 group-hover:text-indigo-400 transition-colors\",\n      children: _jsxDEV(PlusIcon, {\n        className: \"w-6 h-6\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 9\n  }, this);\n};\nconst MobileSubjectPicker = ({\n  isOpen,\n  onClose,\n  onSelect,\n  subjects\n}) => {\n  if (!isOpen) return null;\n  return _jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in\",\n    children: _jsxDEV(\"div\", {\n      className: \"bg-white rounded-t-3xl sm:rounded-3xl w-full max-w-md max-h-[85vh] flex flex-col animate-slide-in-up shadow-2xl\",\n      children: [_jsxDEV(\"div\", {\n        className: \"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-3xl\",\n        children: [_jsxDEV(\"div\", {\n          children: [_jsxDEV(\"h3\", {\n            className: \"font-bold text-xl text-gray-900\",\n            children: \"Assign Subject\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 25\n          }, this), _jsxDEV(\"p\", {\n            className: \"text-xs text-gray-500 font-medium\",\n            children: \"Choose a subject for this slot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 21\n        }, this), _jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"p-2 bg-gray-200/50 rounded-full hover:bg-gray-200 transition-colors\",\n          children: _jsxDEV(XCircleIcon, {\n            className: \"w-6 h-6 text-gray-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }, this), _jsxDEV(\"div\", {\n        className: \"p-5 overflow-y-auto grid grid-cols-2 gap-3 pb-safe\",\n        children: [subjects.map(subject => _jsxDEV(\"button\", {\n          onClick: () => onSelect(subject),\n          className: `p-4 rounded-2xl font-bold text-sm text-left shadow-sm border border-black/5 hover:scale-[1.02] transition-transform active:scale-95 ${SUBJECT_COLORS[subject] || 'bg-gray-100 text-gray-800'}`,\n          children: subject\n        }, subject, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 25\n        }, this)), _jsxDEV(\"button\", {\n          onClick: () => onSelect(''),\n          className: \"p-4 rounded-2xl font-bold text-sm text-center border-2 border-dashed border-red-200 text-red-500 bg-red-50 hover:bg-red-100 active:scale-95 transition-all col-span-2\",\n          children: \"Clear This Slot\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 9\n  }, this);\n};\nconst MobileDayEditor = ({\n  day,\n  periods,\n  timetable,\n  onEditSlot\n}) => {\n  return _jsxDEV(\"div\", {\n    className: \"space-y-4 pb-24\",\n    children: periods.map((period, idx) => {\n      if (period.isBreak) return _jsxDEV(\"div\", {\n        className: \"flex items-center justify-center py-4 bg-gray-50/50 rounded-2xl border border-gray-100 border-dashed\",\n        children: _jsxDEV(\"span\", {\n          className: \"text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em]\",\n          children: period.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 25\n        }, this)\n      }, idx, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 21\n      }, this);\n      const key = `${day}-${idx}`;\n      const subject = timetable[key];\n      const colorClass = subject ? SUBJECT_COLORS[subject] : 'bg-white border border-gray-200';\n      return _jsxDEV(\"button\", {\n        onClick: () => onEditSlot(period.name),\n        className: `w-full text-left p-0 rounded-2xl shadow-sm overflow-hidden flex transition-all active:scale-[0.98] ${!subject ? 'bg-white border border-gray-200' : 'shadow-md ring-1 ring-black/5'}`,\n        children: [_jsxDEV(\"div\", {\n          className: \"w-20 bg-gray-50 border-r border-gray-100 p-4 flex flex-col justify-center items-center text-center\",\n          children: [_jsxDEV(\"span\", {\n            className: \"font-bold text-gray-700 text-sm leading-none\",\n            children: period.name.split(' ')[1] || period.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 29\n          }, this), _jsxDEV(\"span\", {\n            className: \"text-[10px] font-medium text-gray-400 mt-1 leading-tight\",\n            children: [formatTime12Hour(period.start), _jsxDEV(\"br\", {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 236,\n              columnNumber: 136\n            }, this), formatTime12Hour(period.end)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 25\n        }, this), _jsxDEV(\"div\", {\n          className: `flex-1 p-4 flex items-center justify-between ${subject ? colorClass : ''}`,\n          children: [_jsxDEV(\"div\", {\n            children: [_jsxDEV(\"h4\", {\n              className: `font-bold text-base ${!subject ? 'text-gray-400 italic' : ''}`,\n              children: subject || 'Free Period'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 242,\n              columnNumber: 33\n            }, this), subject && _jsxDEV(\"span\", {\n              className: \"text-xs opacity-75 mt-0.5 block font-medium\",\n              children: \"Assigned\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 243,\n              columnNumber: 45\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 29\n          }, this), _jsxDEV(\"div\", {\n            className: `w-8 h-8 rounded-full flex items-center justify-center ${subject ? 'bg-black/10' : 'bg-gray-100'}`,\n            children: _jsxDEV(EditIcon, {\n              className: `w-4 h-4 ${subject ? 'opacity-70' : 'text-gray-400'}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 25\n        }, this)]\n      }, idx, true, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 21\n      }, this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 9\n  }, this);\n};\nconst AISummary = ({\n  suggestions,\n  teacherLoad\n}) => {\n  if (suggestions.length === 0 && teacherLoad.length === 0) return null;\n  return _jsxDEV(\"div\", {\n    className: \"space-y-6\",\n    children: [_jsxDEV(\"h3\", {\n      className: \"text-lg font-bold text-gray-900 flex items-center gap-2\",\n      children: [_jsxDEV(SparklesIcon, {\n        className: \"w-5 h-5 text-indigo-600\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 17\n      }, this), \"AI Insights\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 13\n    }, this), teacherLoad.length > 0 && _jsxDEV(\"div\", {\n      className: \"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm\",\n      children: [_jsxDEV(\"h4\", {\n        className: \"font-bold text-xs text-gray-400 uppercase tracking-wider mb-4 flex items-center\",\n        children: [_jsxDEV(BriefcaseIcon, {\n          className: \"w-4 h-4 mr-2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 117\n        }, this), \"Faculty Workload\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 21\n      }, this), _jsxDEV(\"ul\", {\n        className: \"space-y-3\",\n        children: teacherLoad.map(load => _jsxDEV(\"li\", {\n          className: \"flex justify-between items-center text-sm\",\n          children: [_jsxDEV(\"span\", {\n            className: \"text-gray-700 font-medium\",\n            children: load.teacherName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 33\n          }, this), _jsxDEV(\"span\", {\n            className: `px-2 py-0.5 rounded-full text-xs font-bold ${load.totalPeriods > 20 ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`,\n            children: [load.totalPeriods, \" hrs\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 33\n          }, this)]\n        }, load.teacherName, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 29\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 17\n    }, this), suggestions.length > 0 && _jsxDEV(\"div\", {\n      className: \"bg-indigo-50/50 p-4 rounded-2xl border border-indigo-100\",\n      children: [_jsxDEV(\"h4\", {\n        className: \"font-bold text-xs text-indigo-400 uppercase tracking-wider mb-3\",\n        children: \"Suggestions\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 21\n      }, this), _jsxDEV(\"div\", {\n        className: \"prose prose-sm max-w-none prose-p:text-indigo-900/80 prose-li:text-indigo-900/80 prose-li:marker:text-indigo-400\",\n        children: _jsxDEV(ReactMarkdown, {\n          children: suggestions.map(s => `- ${s}`).join('\\n')\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 260,\n    columnNumber: 9\n  }, this);\n};\nconst TimetableEditor = ({\n  timetableData,\n  navigateTo,\n  handleBack\n}) => {\n  const [timetable, setTimetable] = useState(timetableData?.schedule || {});\n  const [teacherAssignments, setTeacherAssignments] = useState(timetableData?.teacherAssignments || {});\n  const [status, setStatus] = useState(timetableData?.status || 'Draft');\n  const [selectedClass, setSelectedClass] = useState(timetableData?.className || '');\n  const [teachers, setTeachers] = useState(['Mr. Anderson', 'Ms. Davis', 'Mrs. Wilson', 'Mr. Brown', 'Dr. Clark']);\n  const [toastMessage, setToastMessage] = useState('');\n  const [isSaving, setIsSaving] = useState(false);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [aiPrompt, setAiPrompt] = useState('');\n  const [showAiModal, setShowAiModal] = useState(false);\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);\n  const [selectedDay, setSelectedDay] = useState(DAYS[new Date().getDay() - 1] || 'Monday');\n  const [editingSlot, setEditingSlot] = useState(null);\n  useEffect(() => {\n    const handleResize = () => setIsMobile(window.innerWidth < 1024);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n  useEffect(() => {\n    if (timetableData) {\n      setSelectedClass(timetableData.className || '');\n      setTimetable(timetableData.schedule || {});\n      setTeacherAssignments(timetableData.teacherAssignments || {});\n    }\n  }, [timetableData]);\n  useEffect(() => {\n    const fetchTeachers = async () => {\n      const {\n        data\n      } = await supabase.from('teachers').select('name');\n      if (data) {\n        setTeachers(data.map(t => t.name));\n      }\n    };\n    fetchTeachers();\n  }, []);\n  const handleDrop = (day, periodIndex, e) => {\n    const subjectName = e.dataTransfer.getData('subjectName');\n    if (subjectName) {\n      updateTimetable(day, periodIndex, subjectName);\n    }\n  };\n  const updateTimetable = (day, periodIndex, subjectName) => {\n    const key = `${day}-${periodIndex}`;\n    if (!subjectName) {\n      clearCell(day, periodIndex);\n      return;\n    }\n    setTimetable(prev => Object.assign({}, prev, {\n      [key]: subjectName\n    }));\n    if (!teacherAssignments[key]) {\n      const randomTeacher = teachers[Math.floor(Math.random() * teachers.length)];\n      setTeacherAssignments(prev => Object.assign({}, prev, {\n        [key]: randomTeacher\n      }));\n    }\n  };\n  const clearCell = (day, periodIndex) => {\n    const key = `${day}-${periodIndex}`;\n    setTimetable(prev => {\n      const newTimetable = Object.assign({}, prev);\n      delete newTimetable[key];\n      return newTimetable;\n    });\n    setTeacherAssignments(prev => {\n      const newAssignments = Object.assign({}, prev);\n      delete newAssignments[key];\n      return newAssignments;\n    });\n  };\n  const saveTimetable = async () => {\n    if (!selectedClass) {\n      setToastMessage(\"Please select or enter a class name first.\");\n      return;\n    }\n    setIsSaving(true);\n    try {\n      await saveTimetableToDatabase(status);\n      setToastMessage('Timetable saved successfully!');\n      if (status === 'Published') {\n        notifyClass(selectedClass, 'New Timetable Published', `The timetable for ${selectedClass} has been updated.`).catch(console.error);\n      }\n    } catch (error) {\n      console.error('Error saving timetable:', error);\n      setToastMessage('Failed to save: ' + error.message);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  const handlePublish = async () => {\n    setStatus('Published');\n    setIsSaving(true);\n    try {\n      await saveTimetableToDatabase('Published');\n      setToastMessage('Timetable Published!');\n      notifyClass(selectedClass, 'Timetable Published', `Timetable for ${selectedClass} is now live.`).catch(console.error);\n    } catch (err) {\n      setToastMessage(\"Error: \" + err.message);\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  const saveTimetableToDatabase = async statusToSave => {\n    await supabase.from('timetable').delete().eq('class_name', selectedClass);\n    const entries = [];\n    for (const day of DAYS) {\n      for (let i = 0; i < PERIODS.length; i++) {\n        if (PERIODS[i].isBreak) continue;\n        const key = `${day}-${i}`;\n        const subject = timetable[key];\n        const teacherName = teacherAssignments[key];\n        if (subject) {\n          let teacherId = null;\n          if (teacherName) {\n            const {\n              data: tData\n            } = await supabase.from('teachers').select('id').eq('name', teacherName).single();\n            if (tData) teacherId = tData.id;\n          }\n          entries.push({\n            day_of_week: day,\n            period_index: i,\n            start_time: PERIODS[i].start,\n            end_time: PERIODS[i].end,\n            subject,\n            class_name: selectedClass,\n            teacher_id: teacherId,\n            status: statusToSave\n          });\n        }\n      }\n    }\n    if (entries.length > 0) {\n      const {\n        error\n      } = await supabase.from('timetable').insert(entries);\n      if (error) throw error;\n    }\n  };\n  const handleAiGenerate = async () => {\n    if (!aiPrompt) return;\n    setIsGenerating(true);\n    setTimeout(() => {\n      const newSchedule = {};\n      const newAssignments = {};\n      DAYS.forEach(day => {\n        PERIODS.forEach((p, idx) => {\n          if (!p.isBreak && Math.random() > 0.3) {\n            const sub = ['Math', 'English', 'Science', 'History'][Math.floor(Math.random() * 4)];\n            newSchedule[`${day}-${idx}`] = sub;\n            newAssignments[`${day}-${idx}`] = teachers[Math.floor(Math.random() * teachers.length)];\n          }\n        });\n      });\n      setTimetable(newSchedule);\n      setTeacherAssignments(newAssignments);\n      setIsGenerating(false);\n      setShowAiModal(false);\n      setToastMessage(\"AI Schedule Generated!\");\n    }, 1500);\n  };\n  const handleMobileSlotClick = periodName => {\n    const idx = PERIODS.findIndex(p => p.name === periodName);\n    if (idx !== -1) {\n      setEditingSlot({\n        day: selectedDay,\n        period: idx.toString()\n      });\n    }\n  };\n  const handleMobileSubjectSelect = subject => {\n    if (editingSlot) {\n      const idx = parseInt(editingSlot.period);\n      updateTimetable(editingSlot.day, idx, subject);\n      setEditingSlot(null);\n    }\n  };\n  return _jsxDEV(\"div\", {\n    className: \"flex flex-col h-full bg-gray-50 relative\",\n    children: [toastMessage && _jsxDEV(Toast, {\n      message: toastMessage,\n      onClear: () => setToastMessage('')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 524,\n      columnNumber: 30\n    }, this), _jsxDEV(MobileSubjectPicker, {\n      isOpen: !!editingSlot,\n      onClose: () => setEditingSlot(null),\n      onSelect: handleMobileSubjectSelect,\n      subjects: Object.keys(SUBJECT_COLORS)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 13\n    }, this), _jsxDEV(\"header\", {\n      className: \"px-4 py-3 md:px-8 md:py-5 bg-white border-b border-gray-200 flex-shrink-0 z-40 sticky top-0\",\n      children: _jsxDEV(\"div\", {\n        className: \"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4\",\n        children: [_jsxDEV(\"div\", {\n          className: \"flex items-center justify-between w-full lg:w-auto\",\n          children: _jsxDEV(\"div\", {\n            className: \"flex items-center space-x-4\",\n            children: [_jsxDEV(\"button\", {\n              onClick: handleBack,\n              className: \"p-2 hover:bg-gray-100 rounded-full transition-colors lg:hidden\",\n              children: _jsxDEV(ChevronLeftIcon, {\n                className: \"w-5 h-5 text-gray-600\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 539,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 538,\n              columnNumber: 29\n            }, this), _jsxDEV(\"div\", {\n              children: [_jsxDEV(\"h2\", {\n                className: \"text-xl md:text-2xl font-extrabold text-gray-900 tracking-tight flex items-center gap-2\",\n                children: [\"Timetable Editor\", _jsxDEV(\"span\", {\n                  className: `px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded-full border ${status === 'Published' ? 'bg-green-50 text-green-600 border-green-200' : 'bg-amber-50 text-amber-600 border-amber-200'}`,\n                  children: status\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 544,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 542,\n                columnNumber: 33\n              }, this), _jsxDEV(\"p\", {\n                className: \"text-gray-500 text-xs md:text-sm font-medium\",\n                children: \"Drag subjects, AI Auto-Fill, or Tap to edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 548,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-xl border border-gray-200\",\n          children: [_jsxDEV(\"span\", {\n            className: \"text-xs font-bold text-gray-400 uppercase\",\n            children: \"Class:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 555,\n            columnNumber: 25\n          }, this), _jsxDEV(\"input\", {\n            type: \"text\",\n            value: selectedClass,\n            onChange: e => setSelectedClass(e.target.value),\n            placeholder: \"e.g. Grade 5A\",\n            className: \"bg-transparent text-sm font-bold text-gray-800 focus:outline-none w-32\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 556,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 554,\n          columnNumber: 21\n        }, this), _jsxDEV(\"div\", {\n          className: \"flex items-center space-x-3 overflow-x-auto pb-1 lg:pb-0 no-scrollbar\",\n          children: [_jsxDEV(\"button\", {\n            onClick: () => setShowAiModal(true),\n            className: \"flex-shrink-0 flex items-center gap-2 px-3 py-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 font-bold text-xs\",\n            children: [_jsxDEV(SparklesIcon, {\n              className: \"w-4 h-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 570,\n              columnNumber: 29\n            }, this), \" AI Auto-Fill\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 566,\n            columnNumber: 25\n          }, this), _jsxDEV(\"div\", {\n            className: \"h-8 w-[1px] bg-gray-200 mx-2 hidden sm:block\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 573,\n            columnNumber: 25\n          }, this), _jsxDEV(\"button\", {\n            onClick: handlePublish,\n            disabled: isSaving,\n            className: `flex-shrink-0 px-5 py-2.5 text-sm font-bold rounded-xl shadow-sm transition-all flex items-center gap-2 disabled:opacity-50 ${status === 'Published' ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-900 text-white hover:bg-gray-800'}`,\n            children: [isSaving ? _jsxDEV(\"div\", {\n              className: \"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 581,\n              columnNumber: 33\n            }, this) : _jsxDEV(CloudUploadIcon, {\n              className: \"w-4 h-4\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 583,\n              columnNumber: 33\n            }, this), isSaving ? 'Saving...' : status === 'Published' ? 'Update Live' : 'Publish Live']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 575,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 565,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 534,\n      columnNumber: 13\n    }, this), _jsxDEV(\"div\", {\n      className: \"flex-grow flex flex-col lg:flex-row overflow-hidden relative\",\n      children: [!isMobile && _jsxDEV(\"aside\", {\n        className: \"w-64 flex-shrink-0 p-6 bg-white border-r border-gray-200 overflow-y-auto space-y-8 z-30 shadow-[4px_0_24px_rgba(0,0,0,0.02)]\",\n        children: _jsxDEV(\"div\", {\n          children: [_jsxDEV(\"h3\", {\n            className: \"text-xs font-bold text-gray-400 uppercase tracking-widest mb-4\",\n            children: \"Subjects Palette\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 596,\n            columnNumber: 29\n          }, this), _jsxDEV(\"div\", {\n            className: \"grid grid-cols-2 gap-3\",\n            children: Object.keys(SUBJECT_COLORS).map(subject => _jsxDEV(DraggableSubject, {\n              subjectName: subject\n            }, subject, false, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 37\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 597,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 595,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 594,\n        columnNumber: 21\n      }, this), _jsxDEV(\"main\", {\n        className: \"flex-1 overflow-auto bg-gray-50/50 relative\",\n        children: [_jsxDEV(\"div\", {\n          className: \"absolute inset-0 pattern-grid-lg opacity-[0.03] pointer-events-none\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 610,\n          columnNumber: 21\n        }, this), isMobile ? _jsxDEV(\"div\", {\n          className: \"flex flex-col h-full bg-gray-50\",\n          children: [_jsxDEV(\"div\", {\n            className: \"flex overflow-x-auto p-4 space-x-3 bg-white border-b border-gray-200 snap-x sticky top-0 z-20 shadow-sm no-scrollbar\",\n            children: DAYS.map(day => _jsxDEV(\"button\", {\n              onClick: () => setSelectedDay(day),\n              className: `flex-shrink-0 snap-start px-5 py-2.5 rounded-full font-bold text-sm transition-all border ${selectedDay === day ? 'bg-indigo-600 border-indigo-600 text-white shadow-md' : 'bg-white border-gray-200 text-gray-500'}`,\n              children: day.slice(0, 3)\n            }, day, false, {\n              fileName: _jsxFileName,\n              lineNumber: 617,\n              columnNumber: 37\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 29\n          }, this), _jsxDEV(\"div\", {\n            className: \"flex-1 overflow-y-auto p-4 md:p-6\",\n            children: _jsxDEV(MobileDayEditor, {\n              day: selectedDay,\n              periods: PERIODS,\n              timetable: timetable,\n              onEditSlot: handleMobileSlotClick\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 627,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 25\n        }, this) : _jsxDEV(\"div\", {\n          className: \"p-8 min-w-[1000px] h-full overflow-visible\",\n          children: _jsxDEV(\"div\", {\n            className: \"bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-gray-100 overflow-hidden\",\n            children: _jsxDEV(\"div\", {\n              className: \"grid gap-[1px] bg-gray-100\",\n              style: {\n                gridTemplateColumns: `80px repeat(${PERIODS.length}, 1fr)`\n              },\n              children: [_jsxDEV(\"div\", {\n                className: \"bg-gray-50/80 backdrop-blur p-4 z-10 sticky top-0 left-0 border-b border-gray-200\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 643,\n                columnNumber: 37\n              }, this), \" \", PERIODS.map(period => _jsxDEV(\"div\", {\n                className: \"text-center py-4 px-2 bg-gray-50/80 backdrop-blur z-10 sticky top-0 border-b border-gray-200\",\n                children: [_jsxDEV(\"div\", {\n                  className: \"font-bold text-gray-700 text-xs uppercase tracking-wider mb-1\",\n                  children: period.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 646,\n                  columnNumber: 45\n                }, this), _jsxDEV(\"div\", {\n                  className: \"text-[10px] font-medium text-gray-400 bg-white inline-block px-2 py-0.5 rounded-full border border-gray-100 shadow-sm\",\n                  children: [formatTime12Hour(period.start), \" - \", formatTime12Hour(period.end)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 647,\n                  columnNumber: 45\n                }, this)]\n              }, period.name, true, {\n                fileName: _jsxFileName,\n                lineNumber: 645,\n                columnNumber: 41\n              }, this)), DAYS.map(day => _jsxDEV(React.Fragment, {\n                children: [_jsxDEV(\"div\", {\n                  className: \"bg-white font-bold text-gray-800 text-xs uppercase tracking-widest flex items-center justify-center p-4 border-r border-gray-100 writing-vertical-lr rotate-180 md:rotate-0 md:writing-horizontal-tb sticky left-0 z-10 shadow-[4px_0_10px_rgba(0,0,0,0.02)]\",\n                  children: day.slice(0, 3)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 656,\n                  columnNumber: 45\n                }, this), PERIODS.map((period, index) => _jsxDEV(\"div\", {\n                  className: \"bg-white min-h-[6rem]\",\n                  children: _jsxDEV(TimetableCell, {\n                    isBreak: period.isBreak,\n                    subject: period.isBreak ? period.name : timetable[`${day}-${index}`] || null,\n                    teacher: teacherAssignments[`${day}-${index}`] || null,\n                    onDrop: e => handleDrop(day, index, e),\n                    onClear: () => clearCell(day, index)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 661,\n                    columnNumber: 53\n                  }, this)\n                }, `${day}-${period.name}`, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 660,\n                  columnNumber: 49\n                }, this))]\n              }, day, true, {\n                fileName: _jsxFileName,\n                lineNumber: 655,\n                columnNumber: 41\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 640,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 639,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 638,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 591,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 523,\n    columnNumber: 9\n  }, this);\n};\nexport default TimetableEditor;","map":{"version":3,"names":["React","useState","useEffect","ReactMarkdown","XCircleIcon","SparklesIcon","BriefcaseIcon","CheckCircleIcon","PlusIcon","EditIcon","CloudUploadIcon","ChevronLeftIcon","SUBJECT_COLORS","supabase","notifyClass","jsxDEV","_jsxDEV","formatTime12Hour","timeStr","hours","minutes","split","h","parseInt","ampm","PERIODS","name","start","end","isBreak","DAYS","Toast","message","onClear","timer","setTimeout","clearTimeout","className","children","fileName","_jsxFileName","lineNumber","columnNumber","DraggableSubject","subjectName","onClick","isDragging","setIsDragging","colorClass","draggable","onDragStart","e","dataTransfer","setData","onDragEnd","TimetableCell","subject","teacher","onDrop","isHovering","setIsHovering","handleDragOver","preventDefault","dropEffect","currentTarget","classList","add","handleDragLeave","remove","handleDrop","onDragOver","onDragLeave","stopPropagation","MobileSubjectPicker","isOpen","onClose","onSelect","subjects","map","MobileDayEditor","day","periods","timetable","onEditSlot","period","idx","key","AISummary","suggestions","teacherLoad","length","load","teacherName","totalPeriods","s","join","TimetableEditor","timetableData","navigateTo","handleBack","setTimetable","schedule","teacherAssignments","setTeacherAssignments","status","setStatus","selectedClass","setSelectedClass","teachers","setTeachers","toastMessage","setToastMessage","isSaving","setIsSaving","isGenerating","setIsGenerating","aiPrompt","setAiPrompt","showAiModal","setShowAiModal","isMobile","setIsMobile","window","innerWidth","selectedDay","setSelectedDay","Date","getDay","editingSlot","setEditingSlot","handleResize","addEventListener","removeEventListener","fetchTeachers","data","from","select","t","periodIndex","getData","updateTimetable","clearCell","prev","Object","assign","randomTeacher","Math","floor","random","newTimetable","newAssignments","saveTimetable","saveTimetableToDatabase","catch","console","error","handlePublish","err","statusToSave","delete","eq","entries","i","teacherId","tData","single","id","push","day_of_week","period_index","start_time","end_time","class_name","teacher_id","insert","handleAiGenerate","newSchedule","forEach","p","sub","handleMobileSlotClick","periodName","findIndex","toString","handleMobileSubjectSelect","keys","type","value","onChange","target","placeholder","disabled","slice","style","gridTemplateColumns","Fragment","index"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/components/admin/TimetableEditor.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport { XCircleIcon, SparklesIcon, BriefcaseIcon, CheckCircleIcon, PlusIcon, EditIcon, CalendarIcon, SaveIcon, CloudUploadIcon, RefreshIcon, ChevronLeftIcon } from '../../constants';\r\nimport { SUBJECT_COLORS } from '../../constants';\r\nimport { TimetableEntry } from '../../types';\r\nimport { supabase } from '../../lib/supabase';\r\nimport { notifyClass } from '../../lib/database';\r\n\r\n// --- TYPES ---\r\ntype Timetable = { [key: string]: string | null };\r\ntype TeacherAssignments = { [key: string]: string | null };\r\ntype TeacherLoad = { teacherName: string; totalPeriods: number };\r\ninterface TeacherInfo { name: string; subjects: string[]; }\r\n\r\ninterface TimetableEditorProps {\r\n    timetableData: any; // The whole object from the generator/save\r\n    navigateTo: (view: string, title: string, props?: any) => void;\r\n    handleBack: () => void;\r\n}\r\n\r\n\r\n// --- CONSTANTS & HELPERS ---\r\nconst formatTime12Hour = (timeStr: string) => {\r\n    if (!timeStr) return '';\r\n    const [hours, minutes] = timeStr.split(':');\r\n    let h = parseInt(hours, 10);\r\n    const ampm = h >= 12 ? 'PM' : 'AM';\r\n    h = h % 12;\r\n    h = h ? h : 12; // the hour '0' should be '12'\r\n    return `${h}:${minutes} ${ampm}`;\r\n};\r\n\r\nconst PERIODS = [\r\n    { name: 'Period 1', start: '09:00', end: '09:45' },\r\n    { name: 'Period 2', start: '09:45', end: '10:30' },\r\n    { name: 'Period 3', start: '10:30', end: '11:15' },\r\n    { name: 'Short Break', start: '11:15', end: '11:30', isBreak: true },\r\n    { name: 'Period 4', start: '11:30', end: '12:15' },\r\n    { name: 'Period 5', start: '12:15', end: '13:00' },\r\n    { name: 'Long Break', start: '13:00', end: '13:45', isBreak: true },\r\n    { name: 'Period 6', start: '13:45', end: '14:30' },\r\n    { name: 'Period 7', start: '14:30', end: '15:15' },\r\n    { name: 'Period 8', start: '15:15', end: '16:00' },\r\n];\r\n\r\nconst DAYS = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];\r\n\r\n// --- SUB-COMPONENTS ---\r\n\r\nconst Toast: React.FC<{ message: string; onClear: () => void; }> = ({ message, onClear }) => {\r\n    useEffect(() => {\r\n        const timer = setTimeout(onClear, 3000);\r\n        return () => clearTimeout(timer);\r\n    }, [onClear]);\r\n\r\n    return (\r\n        <div className=\"fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur-md text-white px-6 py-3 rounded-2xl shadow-2xl flex items-center space-x-3 animate-slide-in-up z-[100] border border-white/10\">\r\n            <CheckCircleIcon className=\"w-5 h-5 text-emerald-400\" />\r\n            <span className=\"font-medium\">{message}</span>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst DraggableSubject: React.FC<{ subjectName: string; onClick?: () => void }> = ({ subjectName, onClick }) => {\r\n    const [isDragging, setIsDragging] = useState(false);\r\n    const colorClass = SUBJECT_COLORS[subjectName] || 'bg-gray-100 text-gray-700';\r\n\r\n    return (\r\n        <div\r\n            draggable\r\n            onClick={onClick}\r\n            onDragStart={(e) => {\r\n                e.dataTransfer.setData('subjectName', subjectName);\r\n                setIsDragging(true);\r\n            }}\r\n            onDragEnd={() => setIsDragging(false)}\r\n            className={`p-3 rounded-xl cursor-grab text-sm font-bold text-center shadow-sm hover:shadow-md transition-all active:cursor-grabbing border-b-2 border-black/5\r\n                ${colorClass} \r\n                ${isDragging ? 'opacity-50 scale-95 ring-2 ring-offset-2 ring-indigo-400' : 'hover:-translate-y-0.5'}\r\n            `}\r\n        >\r\n            {subjectName}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst TimetableCell: React.FC<{ subject: string | null; teacher: string | null; onDrop: (e: React.DragEvent<HTMLDivElement>) => void; onClear: () => void; onClick?: () => void; isBreak?: boolean }> = ({ subject, teacher, onDrop, onClear, onClick, isBreak }) => {\r\n    const [isHovering, setIsHovering] = useState(false);\r\n\r\n    const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\r\n        e.preventDefault();\r\n        if (isBreak) {\r\n            e.dataTransfer.dropEffect = \"none\";\r\n        } else {\r\n            e.dataTransfer.dropEffect = \"move\";\r\n            e.currentTarget.classList.add('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\r\n        }\r\n    };\r\n\r\n    const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\r\n        e.currentTarget.classList.remove('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\r\n    };\r\n\r\n    const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\r\n        e.preventDefault();\r\n        e.currentTarget.classList.remove('bg-indigo-50', 'ring-2', 'ring-indigo-400', 'ring-inset');\r\n        if (!isBreak) onDrop(e);\r\n    };\r\n\r\n    if (isBreak) {\r\n        return (\r\n            <div className=\"h-full bg-gray-100/50 border border-gray-200 rounded-lg flex items-center justify-center\">\r\n                <span className=\"text-xs font-bold text-gray-400 uppercase tracking-widest transform -rotate-0\">Break</span>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            onDragOver={handleDragOver}\r\n            onDragLeave={handleDragLeave}\r\n            onDrop={handleDrop}\r\n            onClick={onClick}\r\n            className={`h-full min-h-[80px] rounded-xl border transition-all duration-200 relative group\r\n                ${subject\r\n                    ? `${SUBJECT_COLORS[subject] || 'bg-white'} border-transparent shadow-sm hover:shadow-md`\r\n                    : 'bg-white border-dashed border-gray-200 hover:border-indigo-300 hover:bg-indigo-50/30'\r\n                }\r\n            `}\r\n        >\r\n            {subject ? (\r\n                <div className=\"h-full px-2 py-1.5 flex flex-col justify-center text-center\">\r\n                    <span className=\"text-[13px] font-bold text-gray-800 leading-tight line-clamp-2\">\r\n                        {subject}\r\n                    </span>\r\n                    {teacher && (\r\n                        <div className=\"flex items-center justify-center mt-1 space-x-1\">\r\n                            <BriefcaseIcon className=\"w-3 h-3 text-gray-500/70\" />\r\n                            <span className=\"text-[10px] text-gray-600 font-medium truncate max-w-full\">\r\n                                {teacher}\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n                    <button\r\n                        onClick={(e) => { e.stopPropagation(); onClear(); }}\r\n                        className=\"absolute -top-1.5 -right-1.5 p-0.5 bg-white rounded-full shadow-sm text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity hover:text-red-500 hover:bg-red-50\"\r\n                    >\r\n                        <XCircleIcon className=\"w-4 h-4\" />\r\n                    </button>\r\n                    {/* Hover Tooltip (Simulated) */}\r\n                    <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/5 rounded-xl transition-colors pointer-events-none\" />\r\n                </div>\r\n            ) : (\r\n                <div className=\"flex items-center justify-center h-full text-indigo-200/50 group-hover:text-indigo-400 transition-colors\">\r\n                    <PlusIcon className=\"w-6 h-6\" />\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\n// --- MOBILE EDITING SUB-COMPONENTS ---\r\n\r\nconst MobileSubjectPicker: React.FC<{\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSelect: (subject: string) => void;\r\n    subjects: string[]\r\n}> = ({ isOpen, onClose, onSelect, subjects }) => {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-[110] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in\">\r\n            <div className=\"bg-white rounded-t-3xl sm:rounded-3xl w-full max-w-md max-h-[85vh] flex flex-col animate-slide-in-up shadow-2xl\">\r\n                <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50/50 rounded-t-3xl\">\r\n                    <div>\r\n                        <h3 className=\"font-bold text-xl text-gray-900\">Assign Subject</h3>\r\n                        <p className=\"text-xs text-gray-500 font-medium\">Choose a subject for this slot</p>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 bg-gray-200/50 rounded-full hover:bg-gray-200 transition-colors\">\r\n                        <XCircleIcon className=\"w-6 h-6 text-gray-500\" />\r\n                    </button>\r\n                </div>\r\n                <div className=\"p-5 overflow-y-auto grid grid-cols-2 gap-3 pb-safe\">\r\n                    {subjects.map(subject => (\r\n                        <button\r\n                            key={subject}\r\n                            onClick={() => onSelect(subject)}\r\n                            className={`p-4 rounded-2xl font-bold text-sm text-left shadow-sm border border-black/5 hover:scale-[1.02] transition-transform active:scale-95 ${SUBJECT_COLORS[subject] || 'bg-gray-100 text-gray-800'}`}\r\n                        >\r\n                            {subject}\r\n                        </button>\r\n                    ))}\r\n                    <button\r\n                        onClick={() => onSelect('')}\r\n                        className=\"p-4 rounded-2xl font-bold text-sm text-center border-2 border-dashed border-red-200 text-red-500 bg-red-50 hover:bg-red-100 active:scale-95 transition-all col-span-2\"\r\n                    >\r\n                        Clear This Slot\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst MobileDayEditor: React.FC<{\r\n    day: string;\r\n    periods: typeof PERIODS;\r\n    timetable: Timetable;\r\n    onEditSlot: (period: string) => void;\r\n}> = ({ day, periods, timetable, onEditSlot }) => {\r\n    return (\r\n        <div className=\"space-y-4 pb-24\">\r\n            {periods.map((period, idx) => {\r\n                if (period.isBreak) return (\r\n                    <div key={idx} className=\"flex items-center justify-center py-4 bg-gray-50/50 rounded-2xl border border-gray-100 border-dashed\">\r\n                        <span className=\"text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em]\">{period.name}</span>\r\n                    </div>\r\n                );\r\n\r\n                const key = `${day}-${idx}`;\r\n                const subject = timetable[key];\r\n                const colorClass = subject ? SUBJECT_COLORS[subject] : 'bg-white border border-gray-200';\r\n\r\n                return (\r\n                    <button\r\n                        key={idx}\r\n                        onClick={() => onEditSlot(period.name)}\r\n                        className={`w-full text-left p-0 rounded-2xl shadow-sm overflow-hidden flex transition-all active:scale-[0.98] ${!subject ? 'bg-white border border-gray-200' : 'shadow-md ring-1 ring-black/5'}`}\r\n                    >\r\n                        {/* Time Column */}\r\n                        <div className=\"w-20 bg-gray-50 border-r border-gray-100 p-4 flex flex-col justify-center items-center text-center\">\r\n                            <span className=\"font-bold text-gray-700 text-sm leading-none\">{period.name.split(' ')[1] || period.name}</span>\r\n                            <span className=\"text-[10px] font-medium text-gray-400 mt-1 leading-tight\">{formatTime12Hour(period.start)}<br />{formatTime12Hour(period.end)}</span>\r\n                        </div>\r\n\r\n                        {/* Content Column */}\r\n                        <div className={`flex-1 p-4 flex items-center justify-between ${subject ? colorClass : ''}`}>\r\n                            <div>\r\n                                <h4 className={`font-bold text-base ${!subject ? 'text-gray-400 italic' : ''}`}>{subject || 'Free Period'}</h4>\r\n                                {subject && <span className=\"text-xs opacity-75 mt-0.5 block font-medium\">Assigned</span>}\r\n                            </div>\r\n                            <div className={`w-8 h-8 rounded-full flex items-center justify-center ${subject ? 'bg-black/10' : 'bg-gray-100'}`}>\r\n                                <EditIcon className={`w-4 h-4 ${subject ? 'opacity-70' : 'text-gray-400'}`} />\r\n                            </div>\r\n                        </div>\r\n                    </button>\r\n                );\r\n            })}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst AISummary: React.FC<{ suggestions: string[]; teacherLoad: TeacherLoad[] }> = ({ suggestions, teacherLoad }) => {\r\n    if (suggestions.length === 0 && teacherLoad.length === 0) return null;\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <h3 className=\"text-lg font-bold text-gray-900 flex items-center gap-2\">\r\n                <SparklesIcon className=\"w-5 h-5 text-indigo-600\" />\r\n                AI Insights\r\n            </h3>\r\n\r\n            {teacherLoad.length > 0 && (\r\n                <div className=\"bg-white p-4 rounded-2xl border border-gray-100 shadow-sm\">\r\n                    <h4 className=\"font-bold text-xs text-gray-400 uppercase tracking-wider mb-4 flex items-center\"><BriefcaseIcon className=\"w-4 h-4 mr-2\" />Faculty Workload</h4>\r\n                    <ul className=\"space-y-3\">\r\n                        {teacherLoad.map(load => (\r\n                            <li key={load.teacherName} className=\"flex justify-between items-center text-sm\">\r\n                                <span className=\"text-gray-700 font-medium\">{load.teacherName}</span>\r\n                                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${load.totalPeriods > 20 ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>\r\n                                    {load.totalPeriods} hrs\r\n                                </span>\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n            {suggestions.length > 0 && (\r\n                <div className=\"bg-indigo-50/50 p-4 rounded-2xl border border-indigo-100\">\r\n                    <h4 className=\"font-bold text-xs text-indigo-400 uppercase tracking-wider mb-3\">Suggestions</h4>\r\n                    <div className=\"prose prose-sm max-w-none prose-p:text-indigo-900/80 prose-li:text-indigo-900/80 prose-li:marker:text-indigo-400\">\r\n                        <ReactMarkdown>{suggestions.map(s => `- ${s}`).join('\\n')}</ReactMarkdown>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n// --- MAIN COMPONENT ---\r\nconst TimetableEditor: React.FC<TimetableEditorProps> = ({ timetableData, navigateTo, handleBack }) => {\r\n    const [timetable, setTimetable] = useState<Timetable>(timetableData?.schedule || {});\r\n    const [teacherAssignments, setTeacherAssignments] = useState<TeacherAssignments>(timetableData?.teacherAssignments || {});\r\n    const [status, setStatus] = useState<'Draft' | 'Published'>(timetableData?.status || 'Draft');\r\n    const [selectedClass, setSelectedClass] = useState<string>(timetableData?.className || '');\r\n    const [teachers, setTeachers] = useState<string[]>(['Mr. Anderson', 'Ms. Davis', 'Mrs. Wilson', 'Mr. Brown', 'Dr. Clark']);\r\n    const [toastMessage, setToastMessage] = useState('');\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [isGenerating, setIsGenerating] = useState(false);\r\n\r\n    // AI Generation prompt state\r\n    const [aiPrompt, setAiPrompt] = useState('');\r\n    const [showAiModal, setShowAiModal] = useState(false);\r\n\r\n    // Mobile State\r\n    const [isMobile, setIsMobile] = useState(window.innerWidth < 1024);\r\n    const [selectedDay, setSelectedDay] = useState(DAYS[(new Date().getDay() - 1)] || 'Monday');\r\n    const [editingSlot, setEditingSlot] = useState<{ day: string, period: string } | null>(null);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobile(window.innerWidth < 1024);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // If we opened this with existing data, ensure state is set\r\n        if (timetableData) {\r\n            setSelectedClass(timetableData.className || '');\r\n            setTimetable(timetableData.schedule || {});\r\n            setTeacherAssignments(timetableData.teacherAssignments || {});\r\n        }\r\n    }, [timetableData]);\r\n\r\n    // Fetch teachers\r\n    useEffect(() => {\r\n        const fetchTeachers = async () => {\r\n            const { data } = await supabase.from('teachers').select('name');\r\n            if (data) {\r\n                setTeachers(data.map(t => t.name));\r\n            }\r\n        };\r\n        fetchTeachers();\r\n    }, []);\r\n\r\n\r\n    const handleDrop = (day: string, periodIndex: number, e: React.DragEvent<HTMLDivElement>) => {\r\n        const subjectName = e.dataTransfer.getData('subjectName');\r\n        if (subjectName) {\r\n            updateTimetable(day, periodIndex, subjectName);\r\n        }\r\n    };\r\n\r\n    // Updated to accept number index\r\n    const updateTimetable = (day: string, periodIndex: number, subjectName: string) => {\r\n        const key = `${day}-${periodIndex}`;\r\n\r\n        if (!subjectName) {\r\n            clearCell(day, periodIndex);\r\n            return;\r\n        }\r\n\r\n        setTimetable(prev => ({ ...prev, [key]: subjectName }));\r\n\r\n        // Auto-assign teacher\r\n        // (Simplified logic for now, picking random or unassigned)\r\n        if (!teacherAssignments[key]) {\r\n            const randomTeacher = teachers[Math.floor(Math.random() * teachers.length)];\r\n            setTeacherAssignments(prev => ({ ...prev, [key]: randomTeacher }));\r\n        }\r\n    };\r\n\r\n    const clearCell = (day: string, periodIndex: number) => {\r\n        const key = `${day}-${periodIndex}`;\r\n        setTimetable(prev => {\r\n            const newTimetable = { ...prev };\r\n            delete newTimetable[key];\r\n            return newTimetable;\r\n        });\r\n        setTeacherAssignments(prev => {\r\n            const newAssignments = { ...prev };\r\n            delete newAssignments[key];\r\n            return newAssignments;\r\n        })\r\n    };\r\n\r\n    const saveTimetable = async () => {\r\n        if (!selectedClass) {\r\n            setToastMessage(\"Please select or enter a class name first.\");\r\n            return;\r\n        }\r\n\r\n        setIsSaving(true);\r\n        try {\r\n            await saveTimetableToDatabase(status);\r\n            setToastMessage('Timetable saved successfully!');\r\n\r\n            if (status === 'Published') {\r\n                notifyClass(\r\n                    selectedClass,\r\n                    'New Timetable Published',\r\n                    `The timetable for ${selectedClass} has been updated.`\r\n                ).catch(console.error);\r\n            }\r\n\r\n        } catch (error: any) {\r\n            console.error('Error saving timetable:', error);\r\n            setToastMessage('Failed to save: ' + error.message);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    // Allow saving as Draft explicitly via simpler button if needed, but UI uses saveTimetable mostly.\r\n    // We can add separate Draft/Publish handlers if desired, but adhering to simplified UI for now.\r\n\r\n    const handlePublish = async () => {\r\n        setStatus('Published');\r\n        setIsSaving(true); // Trigger save with new status\r\n        try {\r\n            await saveTimetableToDatabase('Published');\r\n            setToastMessage('Timetable Published!');\r\n            notifyClass(\r\n                selectedClass,\r\n                'Timetable Published',\r\n                `Timetable for ${selectedClass} is now live.`\r\n            ).catch(console.error);\r\n        } catch (err: any) {\r\n            setToastMessage(\"Error: \" + err.message);\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const saveTimetableToDatabase = async (statusToSave: 'Draft' | 'Published') => {\r\n        // DELETE existing\r\n        await supabase\r\n            .from('timetable')\r\n            .delete()\r\n            .eq('class_name', selectedClass);\r\n\r\n        // INSERT new\r\n        const entries = [];\r\n\r\n        for (const day of DAYS) {\r\n            for (let i = 0; i < PERIODS.length; i++) {\r\n                if (PERIODS[i].isBreak) continue;\r\n\r\n                const key = `${day}-${i}`;\r\n                const subject = timetable[key];\r\n                const teacherName = teacherAssignments[key];\r\n\r\n                if (subject) {\r\n                    // Resolve teacher ID\r\n                    // NOTE: This could be slow in a loop. Ideally fetch all teachers once.\r\n                    // We cached teachers names in state, but not IDs?\r\n                    // Ideally we should cache {id, name} objects.\r\n                    // But for now, let's fetch quickly or assume we refactor strictly later.\r\n                    // Optimization: Map names to IDs if possible.\r\n                    let teacherId = null;\r\n                    if (teacherName) {\r\n                        const { data: tData } = await supabase.from('teachers').select('id').eq('name', teacherName).single();\r\n                        if (tData) teacherId = tData.id;\r\n                    }\r\n\r\n                    entries.push({\r\n                        day_of_week: day,\r\n                        period_index: i,\r\n                        start_time: PERIODS[i].start,\r\n                        end_time: PERIODS[i].end,\r\n                        subject,\r\n                        class_name: selectedClass,\r\n                        teacher_id: teacherId,\r\n                        status: statusToSave,\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        if (entries.length > 0) {\r\n            const { error } = await supabase.from('timetable').insert(entries);\r\n            if (error) throw error;\r\n        }\r\n    };\r\n\r\n    const handleAiGenerate = async () => {\r\n        if (!aiPrompt) return;\r\n        setIsGenerating(true);\r\n        setTimeout(() => {\r\n            const newSchedule: Timetable = {};\r\n            const newAssignments: TeacherAssignments = {};\r\n\r\n            DAYS.forEach(day => {\r\n                PERIODS.forEach((p, idx) => {\r\n                    if (!p.isBreak && Math.random() > 0.3) {\r\n                        const sub = ['Math', 'English', 'Science', 'History'][Math.floor(Math.random() * 4)];\r\n                        newSchedule[`${day}-${idx}`] = sub;\r\n                        newAssignments[`${day}-${idx}`] = teachers[Math.floor(Math.random() * teachers.length)];\r\n                    }\r\n                });\r\n            });\r\n\r\n            setTimetable(newSchedule);\r\n            setTeacherAssignments(newAssignments);\r\n            setIsGenerating(false);\r\n            setShowAiModal(false);\r\n            setToastMessage(\"AI Schedule Generated!\");\r\n        }, 1500);\r\n    };\r\n\r\n    // Mobile specific handlers\r\n    const handleMobileSlotClick = (periodName: string) => {\r\n        // Map name to index\r\n        const idx = PERIODS.findIndex(p => p.name === periodName);\r\n        if (idx !== -1) {\r\n            setEditingSlot({ day: selectedDay, period: idx.toString() });\r\n        }\r\n    };\r\n\r\n    const handleMobileSubjectSelect = (subject: string) => {\r\n        if (editingSlot) {\r\n            const idx = parseInt(editingSlot.period);\r\n            updateTimetable(editingSlot.day, idx, subject);\r\n            setEditingSlot(null);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-gray-50 relative\">\r\n            {toastMessage && <Toast message={toastMessage} onClear={() => setToastMessage('')} />}\r\n\r\n            <MobileSubjectPicker\r\n                isOpen={!!editingSlot}\r\n                onClose={() => setEditingSlot(null)}\r\n                onSelect={handleMobileSubjectSelect}\r\n                subjects={Object.keys(SUBJECT_COLORS)}\r\n            />\r\n\r\n            {/* HEADER */}\r\n            <header className=\"px-4 py-3 md:px-8 md:py-5 bg-white border-b border-gray-200 flex-shrink-0 z-40 sticky top-0\">\r\n                <div className=\"flex flex-col lg:flex-row lg:justify-between lg:items-center gap-4\">\r\n                    <div className=\"flex items-center justify-between w-full lg:w-auto\">\r\n                        <div className=\"flex items-center space-x-4\">\r\n                            <button onClick={handleBack} className=\"p-2 hover:bg-gray-100 rounded-full transition-colors lg:hidden\">\r\n                                <ChevronLeftIcon className=\"w-5 h-5 text-gray-600\" />\r\n                            </button>\r\n                            <div>\r\n                                <h2 className=\"text-xl md:text-2xl font-extrabold text-gray-900 tracking-tight flex items-center gap-2\">\r\n                                    Timetable Editor\r\n                                    <span className={`px-2.5 py-0.5 text-[10px] font-bold uppercase tracking-wider rounded-full border ${status === 'Published' ? 'bg-green-50 text-green-600 border-green-200' : 'bg-amber-50 text-amber-600 border-amber-200'}`}>\r\n                                        {status}\r\n                                    </span>\r\n                                </h2>\r\n                                <p className=\"text-gray-500 text-xs md:text-sm font-medium\">Drag subjects, AI Auto-Fill, or Tap to edit</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Class Name Input */}\r\n                    <div className=\"flex items-center gap-2 bg-gray-50 px-3 py-2 rounded-xl border border-gray-200\">\r\n                        <span className=\"text-xs font-bold text-gray-400 uppercase\">Class:</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={selectedClass}\r\n                            onChange={(e) => setSelectedClass(e.target.value)}\r\n                            placeholder=\"e.g. Grade 5A\"\r\n                            className=\"bg-transparent text-sm font-bold text-gray-800 focus:outline-none w-32\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center space-x-3 overflow-x-auto pb-1 lg:pb-0 no-scrollbar\">\r\n                        <button\r\n                            onClick={() => setShowAiModal(true)}\r\n                            className=\"flex-shrink-0 flex items-center gap-2 px-3 py-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 font-bold text-xs\"\r\n                        >\r\n                            <SparklesIcon className=\"w-4 h-4\" /> AI Auto-Fill\r\n                        </button>\r\n\r\n                        <div className=\"h-8 w-[1px] bg-gray-200 mx-2 hidden sm:block\"></div>\r\n\r\n                        <button\r\n                            onClick={handlePublish}\r\n                            disabled={isSaving}\r\n                            className={`flex-shrink-0 px-5 py-2.5 text-sm font-bold rounded-xl shadow-sm transition-all flex items-center gap-2 disabled:opacity-50 ${status === 'Published' ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-gray-900 text-white hover:bg-gray-800'}`}\r\n                        >\r\n                            {isSaving ? (\r\n                                <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n                            ) : (\r\n                                <CloudUploadIcon className=\"w-4 h-4\" />\r\n                            )}\r\n                            {isSaving ? 'Saving...' : (status === 'Published' ? 'Update Live' : 'Publish Live')}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex-grow flex flex-col lg:flex-row overflow-hidden relative\">\r\n                {/* TOOLBAR SIDEBAR (Desktop) */}\r\n                {!isMobile && (\r\n                    <aside className=\"w-64 flex-shrink-0 p-6 bg-white border-r border-gray-200 overflow-y-auto space-y-8 z-30 shadow-[4px_0_24px_rgba(0,0,0,0.02)]\">\r\n                        <div>\r\n                            <h3 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-4\">Subjects Palette</h3>\r\n                            <div className=\"grid grid-cols-2 gap-3\">\r\n                                {Object.keys(SUBJECT_COLORS).map(subject => (\r\n                                    <DraggableSubject key={subject} subjectName={subject} />\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        {/* Teachers List could go here */}\r\n                    </aside>\r\n                )}\r\n\r\n                {/* MAIN GRID AREA */}\r\n                <main className=\"flex-1 overflow-auto bg-gray-50/50 relative\">\r\n                    {/* Background Pattern */}\r\n                    <div className=\"absolute inset-0 pattern-grid-lg opacity-[0.03] pointer-events-none\"></div>\r\n\r\n                    {isMobile ? (\r\n                        // MOBILE VIEW\r\n                        <div className=\"flex flex-col h-full bg-gray-50\">\r\n                            <div className=\"flex overflow-x-auto p-4 space-x-3 bg-white border-b border-gray-200 snap-x sticky top-0 z-20 shadow-sm no-scrollbar\">\r\n                                {DAYS.map(day => (\r\n                                    <button\r\n                                        key={day}\r\n                                        onClick={() => setSelectedDay(day)}\r\n                                        className={`flex-shrink-0 snap-start px-5 py-2.5 rounded-full font-bold text-sm transition-all border ${selectedDay === day ? 'bg-indigo-600 border-indigo-600 text-white shadow-md' : 'bg-white border-gray-200 text-gray-500'}`}\r\n                                    >\r\n                                        {day.slice(0, 3)}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 overflow-y-auto p-4 md:p-6\">\r\n                                <MobileDayEditor\r\n                                    day={selectedDay}\r\n                                    periods={PERIODS}\r\n                                    timetable={timetable}\r\n                                    onEditSlot={handleMobileSlotClick}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        // DESKTOP GRID VIEW\r\n                        <div className=\"p-8 min-w-[1000px] h-full overflow-visible\">\r\n                            <div className=\"bg-white rounded-3xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-gray-100 overflow-hidden\">\r\n                                <div className=\"grid gap-[1px] bg-gray-100\" style={{ gridTemplateColumns: `80px repeat(${PERIODS.length}, 1fr)` }}>\r\n\r\n                                    {/* Header Row */}\r\n                                    <div className=\"bg-gray-50/80 backdrop-blur p-4 z-10 sticky top-0 left-0 border-b border-gray-200\"></div> {/* Corner */}\r\n                                    {PERIODS.map(period => (\r\n                                        <div key={period.name} className=\"text-center py-4 px-2 bg-gray-50/80 backdrop-blur z-10 sticky top-0 border-b border-gray-200\">\r\n                                            <div className=\"font-bold text-gray-700 text-xs uppercase tracking-wider mb-1\">{period.name}</div>\r\n                                            <div className=\"text-[10px] font-medium text-gray-400 bg-white inline-block px-2 py-0.5 rounded-full border border-gray-100 shadow-sm\">\r\n                                                {formatTime12Hour(period.start)} - {formatTime12Hour(period.end)}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n\r\n                                    {/* Data Rows */}\r\n                                    {DAYS.map(day => (\r\n                                        <React.Fragment key={day}>\r\n                                            <div className=\"bg-white font-bold text-gray-800 text-xs uppercase tracking-widest flex items-center justify-center p-4 border-r border-gray-100 writing-vertical-lr rotate-180 md:rotate-0 md:writing-horizontal-tb sticky left-0 z-10 shadow-[4px_0_10px_rgba(0,0,0,0.02)]\">\r\n                                                {day.slice(0, 3)}\r\n                                            </div>\r\n                                            {PERIODS.map((period, index) => (\r\n                                                <div key={`${day}-${period.name}`} className=\"bg-white min-h-[6rem]\">\r\n                                                    <TimetableCell\r\n                                                        isBreak={period.isBreak}\r\n                                                        subject={period.isBreak ? period.name : timetable[`${day}-${index}`] || null}\r\n                                                        teacher={teacherAssignments[`${day}-${index}`] || null}\r\n                                                        onDrop={(e) => handleDrop(day, index, e)}\r\n                                                        onClear={() => clearCell(day, index)}\r\n                                                    />\r\n                                                </div>\r\n                                            ))}\r\n                                        </React.Fragment>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </main>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TimetableEditor;"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}