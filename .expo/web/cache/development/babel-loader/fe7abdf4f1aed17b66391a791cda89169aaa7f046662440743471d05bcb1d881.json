{"ast":null,"code":"import { supabase } from './supabase';\nexport async function createPaymentPlan(params) {\n  try {\n    const {\n      feeId,\n      studentId,\n      totalAmount,\n      installmentCount,\n      frequency,\n      startDate,\n      customDueDates\n    } = params;\n    const {\n      data: plan,\n      error: planError\n    } = await supabase.from('payment_plans').insert([{\n      fee_id: feeId,\n      student_id: studentId,\n      total_amount: totalAmount,\n      installment_count: installmentCount,\n      frequency: frequency,\n      status: 'active'\n    }]).select().single();\n    if (planError || !plan) {\n      console.error('Error creating payment plan:', planError);\n      return null;\n    }\n    const installments = generateInstallments(plan.id, totalAmount, installmentCount, frequency, startDate || new Date(), customDueDates);\n    const {\n      error: installmentsError\n    } = await supabase.from('installments').insert(installments);\n    if (installmentsError) {\n      console.error('Error creating installments:', installmentsError);\n      await supabase.from('payment_plans').delete().eq('id', plan.id);\n      return null;\n    }\n    const {\n      error: feeUpdateError\n    } = await supabase.from('fees').update({\n      has_payment_plan: true,\n      updated_at: new Date().toISOString()\n    }).eq('id', feeId);\n    if (feeUpdateError) {\n      console.error('Error updating fee payment plan status:', feeUpdateError);\n    }\n    return normalizePaymentPlan(plan);\n  } catch (error) {\n    console.error('createPaymentPlan error:', error);\n    return null;\n  }\n}\nfunction generateInstallments(planId, totalAmount, count, frequency, startDate, customDueDates) {\n  const installmentAmount = Math.round(totalAmount / count * 100) / 100;\n  const remainder = totalAmount - installmentAmount * count;\n  const installments = [];\n  for (let i = 0; i < count; i++) {\n    let dueDate;\n    if (customDueDates && customDueDates[i]) {\n      dueDate = customDueDates[i];\n    } else {\n      dueDate = calculateDueDate(startDate, frequency, i);\n    }\n    const amount = i === count - 1 ? installmentAmount + remainder : installmentAmount;\n    installments.push({\n      payment_plan_id: planId,\n      installment_number: i + 1,\n      amount: amount,\n      due_date: dueDate.toISOString().split('T')[0],\n      paid_amount: 0,\n      status: 'pending'\n    });\n  }\n  return installments;\n}\nfunction calculateDueDate(startDate, frequency, installmentIndex) {\n  const date = new Date(startDate);\n  switch (frequency) {\n    case 'weekly':\n      date.setDate(date.getDate() + installmentIndex * 7);\n      break;\n    case 'monthly':\n      date.setMonth(date.getMonth() + installmentIndex);\n      break;\n    case 'termly':\n      date.setMonth(date.getMonth() + installmentIndex * 3);\n      break;\n    default:\n      date.setMonth(date.getMonth() + installmentIndex);\n  }\n  return date;\n}\nexport async function getPaymentPlan(feeId) {\n  try {\n    const {\n      data: plan,\n      error: planError\n    } = await supabase.from('payment_plans').select('*').eq('fee_id', feeId).single();\n    if (planError || !plan) {\n      return null;\n    }\n    const {\n      data: installments,\n      error: installmentsError\n    } = await supabase.from('installments').select('*').eq('payment_plan_id', plan.id).order('installment_number');\n    if (installmentsError) {\n      console.error('Error fetching installments:', installmentsError);\n      return null;\n    }\n    return {\n      plan: normalizePaymentPlan(plan),\n      installments: (installments || []).map(normalizeInstallment)\n    };\n  } catch (error) {\n    console.error('getPaymentPlan error:', error);\n    return null;\n  }\n}\nexport async function hasPaymentPlan(feeId) {\n  const {\n    data\n  } = await supabase.from('payment_plans').select('id').eq('fee_id', feeId).single();\n  return !!data;\n}\nexport async function getUpcomingInstallments(studentId, daysAhead = 7) {\n  try {\n    const today = new Date();\n    const futureDate = new Date();\n    futureDate.setDate(today.getDate() + daysAhead);\n    const {\n      data,\n      error\n    } = await supabase.from('installments').select(`\n                *,\n                payment_plans!inner(student_id)\n            `).eq('payment_plans.student_id', studentId).in('status', ['pending', 'partial']).gte('due_date', today.toISOString().split('T')[0]).lte('due_date', futureDate.toISOString().split('T')[0]).order('due_date');\n    if (error) {\n      console.error('Error fetching upcoming installments:', error);\n      return [];\n    }\n    return (data || []).map(normalizeInstallment);\n  } catch (error) {\n    console.error('getUpcomingInstallments error:', error);\n    return [];\n  }\n}\nexport async function cancelPaymentPlan(planId) {\n  const {\n    error\n  } = await supabase.from('payment_plans').update({\n    status: 'cancelled'\n  }).eq('id', planId);\n  return !error;\n}\nexport async function processInstallmentPayment(installmentId, amount, transactionId) {\n  try {\n    const {\n      data: installment\n    } = await supabase.from('installments').select('paid_amount, amount').eq('id', installmentId).single();\n    if (!installment) return false;\n    const newPaidAmount = (installment.paid_amount || 0) + amount;\n    const {\n      error\n    } = await supabase.from('installments').update({\n      paid_amount: newPaidAmount,\n      transaction_id: transactionId\n    }).eq('id', installmentId);\n    if (error) {\n      console.error('Error updating installment:', error);\n      return false;\n    }\n    return true;\n  } catch (error) {\n    console.error('processInstallmentPayment error:', error);\n    return false;\n  }\n}\nfunction normalizePaymentPlan(data) {\n  return {\n    id: data.id,\n    feeId: data.fee_id,\n    studentId: data.student_id,\n    totalAmount: parseFloat(data.total_amount),\n    installmentCount: data.installment_count,\n    frequency: data.frequency,\n    status: data.status,\n    createdAt: data.created_at\n  };\n}\nfunction normalizeInstallment(data) {\n  return {\n    id: data.id,\n    paymentPlanId: data.payment_plan_id,\n    installmentNumber: data.installment_number,\n    amount: parseFloat(data.amount),\n    dueDate: data.due_date,\n    paidAmount: parseFloat(data.paid_amount || 0),\n    status: data.status,\n    paidAt: data.paid_at,\n    transactionId: data.transaction_id\n  };\n}","map":{"version":3,"names":["supabase","createPaymentPlan","params","feeId","studentId","totalAmount","installmentCount","frequency","startDate","customDueDates","data","plan","error","planError","from","insert","fee_id","student_id","total_amount","installment_count","status","select","single","console","installments","generateInstallments","id","Date","installmentsError","delete","eq","feeUpdateError","update","has_payment_plan","updated_at","toISOString","normalizePaymentPlan","planId","count","installmentAmount","Math","round","remainder","i","dueDate","calculateDueDate","amount","push","payment_plan_id","installment_number","due_date","split","paid_amount","installmentIndex","date","setDate","getDate","setMonth","getMonth","getPaymentPlan","order","map","normalizeInstallment","hasPaymentPlan","getUpcomingInstallments","daysAhead","today","futureDate","in","gte","lte","cancelPaymentPlan","processInstallmentPayment","installmentId","transactionId","installment","newPaidAmount","transaction_id","parseFloat","createdAt","created_at","paymentPlanId","installmentNumber","paidAmount","paidAt","paid_at"],"sources":["C:/Users/USER/OneDrive/Desktop/Project/school-app-/lib/payment-plans.ts"],"sourcesContent":["/**\r\n * Payment Plans Library\r\n * Handles installment-based fee payments\r\n */\r\n\r\nimport { supabase } from './supabase';\r\n\r\nexport interface PaymentPlan {\r\n    id: number;\r\n    feeId: number;\r\n    studentId: number;\r\n    totalAmount: number;\r\n    installmentCount: number;\r\n    frequency: 'weekly' | 'monthly' | 'termly' | 'custom';\r\n    status: 'active' | 'completed' | 'cancelled';\r\n    createdAt: string;\r\n}\r\n\r\nexport interface Installment {\r\n    id: number;\r\n    paymentPlanId: number;\r\n    installmentNumber: number;\r\n    amount: number;\r\n    dueDate: string;\r\n    paidAmount: number;\r\n    status: 'pending' | 'paid' | 'partial' | 'overdue';\r\n    paidAt?: string;\r\n    transactionId?: number;\r\n}\r\n\r\nexport interface CreatePaymentPlanParams {\r\n    feeId: number;\r\n    studentId: number;\r\n    totalAmount: number;\r\n    installmentCount: number;\r\n    frequency: 'weekly' | 'monthly' | 'termly' | 'custom';\r\n    startDate?: Date;\r\n    customDueDates?: Date[]; // For 'custom' frequency\r\n}\r\n\r\n/**\r\n * Create a payment plan with installments\r\n */\r\nexport async function createPaymentPlan(params: CreatePaymentPlanParams): Promise<PaymentPlan | null> {\r\n    try {\r\n        const { feeId, studentId, totalAmount, installmentCount, frequency, startDate, customDueDates } = params;\r\n\r\n        // 1. Create payment plan\r\n        const { data: plan, error: planError } = await supabase\r\n            .from('payment_plans')\r\n            .insert([{\r\n                fee_id: feeId,\r\n                student_id: studentId,\r\n                total_amount: totalAmount,\r\n                installment_count: installmentCount,\r\n                frequency: frequency,\r\n                status: 'active'\r\n            }])\r\n            .select()\r\n            .single();\r\n\r\n        if (planError || !plan) {\r\n            console.error('Error creating payment plan:', planError);\r\n            return null;\r\n        }\r\n\r\n        // 2. Generate installments\r\n        const installments = generateInstallments(\r\n            plan.id,\r\n            totalAmount,\r\n            installmentCount,\r\n            frequency,\r\n            startDate || new Date(),\r\n            customDueDates\r\n        );\r\n\r\n        // 3. Insert installments\r\n        const { error: installmentsError } = await supabase\r\n            .from('installments')\r\n            .insert(installments);\r\n\r\n        if (installmentsError) {\r\n            console.error('Error creating installments:', installmentsError);\r\n            // Rollback plan creation\r\n            await supabase.from('payment_plans').delete().eq('id', plan.id);\r\n            return null;\r\n        }\r\n\r\n        // 4. Update fee to indicate it has a payment plan\r\n        const { error: feeUpdateError } = await supabase\r\n            .from('fees')\r\n            .update({\r\n                has_payment_plan: true,\r\n                updated_at: new Date().toISOString()\r\n            })\r\n            .eq('id', feeId);\r\n\r\n        if (feeUpdateError) {\r\n            console.error('Error updating fee payment plan status:', feeUpdateError);\r\n            // Don't rollback - the plan is still valid even if we can't update this flag\r\n        }\r\n\r\n        return normalizePaymentPlan(plan);\r\n    } catch (error) {\r\n        console.error('createPaymentPlan error:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Generate installment records\r\n */\r\nfunction generateInstallments(\r\n    planId: number,\r\n    totalAmount: number,\r\n    count: number,\r\n    frequency: string,\r\n    startDate: Date,\r\n    customDueDates?: Date[]\r\n): any[] {\r\n    const installmentAmount = Math.round((totalAmount / count) * 100) / 100; // Round to 2 decimals\r\n    const remainder = totalAmount - (installmentAmount * count);\r\n    const installments = [];\r\n\r\n    for (let i = 0; i < count; i++) {\r\n        let dueDate: Date;\r\n\r\n        if (customDueDates && customDueDates[i]) {\r\n            dueDate = customDueDates[i];\r\n        } else {\r\n            dueDate = calculateDueDate(startDate, frequency, i);\r\n        }\r\n\r\n        // Add remainder to last installment\r\n        const amount = i === count - 1 ? installmentAmount + remainder : installmentAmount;\r\n\r\n        installments.push({\r\n            payment_plan_id: planId,\r\n            installment_number: i + 1,\r\n            amount: amount,\r\n            due_date: dueDate.toISOString().split('T')[0], // YYYY-MM-DD\r\n            paid_amount: 0,\r\n            status: 'pending'\r\n        });\r\n    }\r\n\r\n    return installments;\r\n}\r\n\r\n/**\r\n * Calculate due date based on frequency\r\n */\r\nfunction calculateDueDate(startDate: Date, frequency: string, installmentIndex: number): Date {\r\n    const date = new Date(startDate);\r\n\r\n    switch (frequency) {\r\n        case 'weekly':\r\n            date.setDate(date.getDate() + (installmentIndex * 7));\r\n            break;\r\n        case 'monthly':\r\n            date.setMonth(date.getMonth() + installmentIndex);\r\n            break;\r\n        case 'termly':\r\n            // Assuming 3 months per term\r\n            date.setMonth(date.getMonth() + (installmentIndex * 3));\r\n            break;\r\n        default:\r\n            date.setMonth(date.getMonth() + installmentIndex);\r\n    }\r\n\r\n    return date;\r\n}\r\n\r\n/**\r\n * Get payment plan with installments\r\n */\r\nexport async function getPaymentPlan(feeId: number): Promise<{ plan: PaymentPlan; installments: Installment[] } | null> {\r\n    try {\r\n        // Get plan\r\n        const { data: plan, error: planError } = await supabase\r\n            .from('payment_plans')\r\n            .select('*')\r\n            .eq('fee_id', feeId)\r\n            .single();\r\n\r\n        if (planError || !plan) {\r\n            return null;\r\n        }\r\n\r\n        // Get installments\r\n        const { data: installments, error: installmentsError } = await supabase\r\n            .from('installments')\r\n            .select('*')\r\n            .eq('payment_plan_id', plan.id)\r\n            .order('installment_number');\r\n\r\n        if (installmentsError) {\r\n            console.error('Error fetching installments:', installmentsError);\r\n            return null;\r\n        }\r\n\r\n        return {\r\n            plan: normalizePaymentPlan(plan),\r\n            installments: (installments || []).map(normalizeInstallment)\r\n        };\r\n    } catch (error) {\r\n        console.error('getPaymentPlan error:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Check if fee has payment plan\r\n */\r\nexport async function hasPaymentPlan(feeId: number): Promise<boolean> {\r\n    const { data } = await supabase\r\n        .from('payment_plans')\r\n        .select('id')\r\n        .eq('fee_id', feeId)\r\n        .single();\r\n\r\n    return !!data;\r\n}\r\n\r\n/**\r\n * Get upcoming installments (due within X days)\r\n */\r\nexport async function getUpcomingInstallments(studentId: number, daysAhead: number = 7): Promise<Installment[]> {\r\n    try {\r\n        const today = new Date();\r\n        const futureDate = new Date();\r\n        futureDate.setDate(today.getDate() + daysAhead);\r\n\r\n        const { data, error } = await supabase\r\n            .from('installments')\r\n            .select(`\r\n                *,\r\n                payment_plans!inner(student_id)\r\n            `)\r\n            .eq('payment_plans.student_id', studentId)\r\n            .in('status', ['pending', 'partial'])\r\n            .gte('due_date', today.toISOString().split('T')[0])\r\n            .lte('due_date', futureDate.toISOString().split('T')[0])\r\n            .order('due_date');\r\n\r\n        if (error) {\r\n            console.error('Error fetching upcoming installments:', error);\r\n            return [];\r\n        }\r\n\r\n        return (data || []).map(normalizeInstallment);\r\n    } catch (error) {\r\n        console.error('getUpcomingInstallments error:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Cancel payment plan\r\n */\r\nexport async function cancelPaymentPlan(planId: number): Promise<boolean> {\r\n    const { error } = await supabase\r\n        .from('payment_plans')\r\n        .update({ status: 'cancelled' })\r\n        .eq('id', planId);\r\n\r\n    return !error;\r\n}\r\n\r\n/**\r\n * Process payment for an installment\r\n */\r\nexport async function processInstallmentPayment(\r\n    installmentId: number,\r\n    amount: number,\r\n    transactionId: number\r\n): Promise<boolean> {\r\n    try {\r\n        // Get current installment\r\n        const { data: installment } = await supabase\r\n            .from('installments')\r\n            .select('paid_amount, amount')\r\n            .eq('id', installmentId)\r\n            .single();\r\n\r\n        if (!installment) return false;\r\n\r\n        const newPaidAmount = (installment.paid_amount || 0) + amount;\r\n\r\n        // Update installment\r\n        const { error } = await supabase\r\n            .from('installments')\r\n            .update({\r\n                paid_amount: newPaidAmount,\r\n                transaction_id: transactionId,\r\n                // Status will be updated by trigger\r\n            })\r\n            .eq('id', installmentId);\r\n\r\n        if (error) {\r\n            console.error('Error updating installment:', error);\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error('processInstallmentPayment error:', error);\r\n        return false;\r\n    }\r\n}\r\n\r\n\r\n// Normalization functions\r\nfunction normalizePaymentPlan(data: any): PaymentPlan {\r\n    return {\r\n        id: data.id,\r\n        feeId: data.fee_id,\r\n        studentId: data.student_id,\r\n        totalAmount: parseFloat(data.total_amount),\r\n        installmentCount: data.installment_count,\r\n        frequency: data.frequency,\r\n        status: data.status,\r\n        createdAt: data.created_at\r\n    };\r\n}\r\n\r\nfunction normalizeInstallment(data: any): Installment {\r\n    return {\r\n        id: data.id,\r\n        paymentPlanId: data.payment_plan_id,\r\n        installmentNumber: data.installment_number,\r\n        amount: parseFloat(data.amount),\r\n        dueDate: data.due_date,\r\n        paidAmount: parseFloat(data.paid_amount || 0),\r\n        status: data.status,\r\n        paidAt: data.paid_at,\r\n        transactionId: data.transaction_id\r\n    };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}